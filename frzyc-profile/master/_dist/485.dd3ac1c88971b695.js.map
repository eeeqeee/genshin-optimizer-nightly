{"version":3,"file":"485.dd3ac1c88971b695.js","mappings":"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","sources":["webpack:///./src/app/Context/GraphContext.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/CharSelectButton.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/FormulaModal.tsx","webpack:///./src/app/Components/ExpandButton.tsx","webpack:///./src/app/Components/StatInput.tsx","webpack:///./src/app/Components/EnemyEditor.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/StatModal.tsx","webpack:///./src/app/Context/OptimizationTargetContext.tsx","webpack:///./src/app/Solver/common.ts","webpack:///../../libs/util/src/lib/queue.ts","webpack:///./src/app/Solver/coordinator.ts","webpack:///./src/app/Solver/GOSolver/GOSolver.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/useBuildSetting.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/AllowChar.tsx","webpack:///./src/app/Components/Artifact/SetEffectDisplay.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ArtifactSetConfig.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/AssumeFullLevelToggle.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/BonusStatsCard.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/BuildAlert.tsx","webpack:///./src/app/Components/Character/LocationIcon.tsx","webpack:///./src/app/Components/StatDisplay.tsx","webpack:///./src/app/Components/Artifact/ArtifactCardNano.tsx","webpack:///./src/app/Components/Character/StatDisplayComponent.tsx","webpack:///./src/app/Components/Weapon/WeaponCardNano.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ArtifactSetBadges.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/BuildDisplayItem.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/useBuildResult.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/CustomDot.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/CustomTooltip.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/EnhancedPoint.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/index.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ExcludeArt.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/MainStatSelectionCard.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/OptimizationTargetEditorList.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/StatFilterCard.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/foreground.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/index.tsx","webpack:///./src/app/ReactHooks/useGlobalError.tsx","webpack:///../../libs/char-cards/src/index.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/CompareBuildButton.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/ArtifactSwapModal.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/WeaponSwapModal.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/EquipmentSection.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/index.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTalent.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTeambuffs.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTheorycraft/index.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTheorycraft/useCharTC.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/TravelerElementSelect.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/TravelerGenderSelect.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/index.tsx"],"sourcesContent":["import { createContext } from 'react'\nimport type { NumNode } from '../Formula/type'\nimport type { Build } from '../Solver/common'\n\nexport type ChartData = {\n  valueNode: NumNode\n  plotNode: NumNode\n  data: Build[]\n}\nexport type GraphContextObj = {\n  chartData?: ChartData\n  setChartData: (data: ChartData | undefined) => void\n  graphBuilds: string[][] | undefined\n  setGraphBuilds: (builds: string[][] | undefined) => void\n}\nexport const GraphContext = createContext({} as GraphContextObj)\n","import { Button } from '@mui/material'\nimport React, { Suspense, useContext, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CharIconSide from '../../Components/Image/CharIconSide'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport useCharSelectionCallback from '../../ReactHooks/useCharSelectionCallback'\n\nconst CharacterSelectionModal = React.lazy(\n  () => import('../CharacterSelectionModal')\n)\n\nexport default function CharSelectButton() {\n  const { t } = useTranslation('page_character')\n  const {\n    characterSheet,\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const [showModal, setshowModal] = useState(false)\n  const setCharacter = useCharSelectionCallback()\n  return (\n    <>\n      <Suspense fallback={false}>\n        <CharacterSelectionModal\n          show={showModal}\n          onHide={() => setshowModal(false)}\n          onSelect={setCharacter}\n        />\n      </Suspense>\n      <Button\n        color=\"info\"\n        onClick={() => setshowModal(true)}\n        startIcon={<CharIconSide characterKey={characterKey} />}\n      >\n        {characterSheet?.name ?? t('selectCharacter')}\n      </Button>\n    </>\n  )\n}\n","import { ExpandMore } from '@mui/icons-material'\nimport {\n  Accordion,\n  AccordionDetails,\n  AccordionSummary,\n  Box,\n  CardContent,\n  CardHeader,\n  Divider,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport type { MutableRefObject } from 'react'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport AmpReactionModeText from '../../Components/AmpReactionModeText'\nimport CardDark from '../../Components/Card/CardDark'\nimport CardHeaderCustom from '../../Components/Card/CardHeaderCustom'\nimport CardLight from '../../Components/Card/CardLight'\nimport CloseButton from '../../Components/CloseButton'\nimport ColorText from '../../Components/ColoredText'\nimport ImgIcon from '../../Components/Image/ImgIcon'\nimport ModalWrapper from '../../Components/ModalWrapper'\nimport SqBadge from '../../Components/SqBadge'\nimport { DataContext } from '../../Context/DataContext'\nimport { FormulaDataContext } from '../../Context/FormulaDataContext'\nimport { DatabaseContext } from '../../Database/Database'\nimport { getDisplayHeader, getDisplaySections } from '../../Formula/DisplayUtil'\nimport type { DisplaySub } from '../../Formula/type'\nimport type { NodeDisplay } from '../../Formula/uiData'\nimport { nodeVStr } from '../../Formula/uiData'\nimport type { AmpReactionKey } from '../../Types/consts'\nimport { allAmpReactions } from '../../Types/consts'\n\nexport default function FormulaModal() {\n  const { modalOpen } = useContext(FormulaDataContext)\n  const { setFormulaData } = useContext(FormulaDataContext)\n  const onCloseHandler = useCallback(\n    () => setFormulaData?.(undefined, undefined),\n    [setFormulaData]\n  )\n  return (\n    <ModalWrapper open={!!modalOpen} onClose={onCloseHandler}>\n      <CardDark>\n        <CardHeader\n          title=\"Formulas & Calculations\"\n          action={<CloseButton onClick={onCloseHandler} />}\n        />\n        <CardContent sx={{ pt: 0 }}>\n          <CalculationDisplay />\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n\nfunction CalculationDisplay() {\n  const { data } = useContext(DataContext)\n  const { data: contextData } = useContext(FormulaDataContext)\n  const sections = getDisplaySections(contextData ?? data)\n  return (\n    <Suspense\n      fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={1000} />}\n    >\n      <Box sx={{ mr: -1, mb: -1 }}>\n        {sections.map(([key, Nodes]) => (\n          <FormulaCalc key={key} displayNs={Nodes} sectionKey={key} />\n        ))}\n      </Box>\n    </Suspense>\n  )\n}\nfunction FormulaCalc({\n  sectionKey,\n  displayNs,\n}: {\n  displayNs: DisplaySub<NodeDisplay>\n  sectionKey: string\n}) {\n  const { data } = useContext(DataContext)\n  const { database } = useContext(DatabaseContext)\n  const { data: contextData } = useContext(FormulaDataContext)\n  const header = useMemo(\n    () => getDisplayHeader(contextData ?? data, sectionKey, database),\n    [database, contextData, data, sectionKey]\n  )\n  if (!header) return null\n  if (Object.entries(displayNs).every(([_, node]) => node.isEmpty)) return null\n  const { title, icon, action } = header\n  return (\n    <CardLight sx={{ mb: 1 }}>\n      <CardHeaderCustom\n        avatar={icon && <ImgIcon size={2} src={icon} />}\n        title={title}\n        action={action && <SqBadge>{action}</SqBadge>}\n      />\n      <Divider />\n      <CardContent>\n        {Object.entries(displayNs).map(\n          ([key, node]) =>\n            !node.isEmpty && <FormulaAccordian key={key} node={node} />\n        )}\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction FormulaAccordian({ node }: { node: NodeDisplay }) {\n  const { node: contextNode } = useContext(FormulaDataContext)\n  const [expanded, setExpanded] = useState(false)\n  const handleChange = useCallback(\n    (e: React.SyntheticEvent, isExpanded: boolean) => setExpanded(isExpanded),\n    []\n  )\n  const scrollRef =\n    useRef<HTMLDivElement>() as MutableRefObject<HTMLDivElement | null>\n\n  useEffect(() => {\n    if (node === contextNode)\n      setTimeout(\n        () => scrollRef?.current?.scrollIntoView?.({ behavior: 'smooth' }),\n        300\n      )\n  }, [scrollRef, node, contextNode])\n\n  return (\n    <Accordion\n      sx={{ bgcolor: 'contentDark.main' }}\n      expanded={node === contextNode || expanded}\n      onChange={handleChange}\n      ref={scrollRef}\n    >\n      <AccordionSummary expandIcon={<ExpandMore />}>\n        <Typography>\n          <ColorText color={node.info.variant}>{node.info.name}</ColorText>{' '}\n          <strong>{nodeVStr(node)}</strong>\n        </Typography>\n        {allAmpReactions.includes(node.info.variant as 'vaporize' | 'melt') && (\n          <Box sx={{ display: 'inline-block', ml: 'auto', mr: 2 }}>\n            <AmpReactionModeText\n              reaction={node.info.variant as AmpReactionKey}\n              trigger={\n                node.info.subVariant as 'cryo' | 'pyro' | 'hydro' | undefined\n              }\n            />\n          </Box>\n        )}\n      </AccordionSummary>\n      <AccordionDetails>\n        {node.formulas.map((subform, i) => (\n          <Typography key={i} component=\"div\">\n            {subform}\n          </Typography>\n        ))}\n      </AccordionDetails>\n    </Accordion>\n  )\n}\n","import type { IconButtonProps } from '@mui/material'\nimport { IconButton, styled } from '@mui/material'\n\ninterface ExpandMoreProps extends IconButtonProps {\n  expand: boolean\n}\nconst ExpandButton = styled((props: ExpandMoreProps) => {\n  const { expand, ...other } = props\n  return <IconButton {...other} />\n})(({ theme, expand }) => ({\n  transform: !expand ? 'rotate(0deg)' : 'rotate(180deg)',\n  marginLeft: 'auto',\n  transition: (theme as any).transitions.create('transform', {\n    duration: (theme as any).transitions.duration.shortest,\n  }),\n}))\n\nexport default ExpandButton\n","import { Replay } from '@mui/icons-material'\nimport type { ButtonGroupProps } from '@mui/material'\nimport { Button, ButtonGroup, styled } from '@mui/material'\nimport type { ReactNode } from 'react'\nimport CustomNumberInput, {\n  CustomNumberInputButtonGroupWrapper,\n} from './CustomNumberInput'\nimport TextButton from './TextButton'\n\ntype StatInputInput = ButtonGroupProps & {\n  name: Displayable\n  children?: ReactNode\n  value: number\n  placeholder?: string\n  defaultValue?: number\n  onValueChange: (newValue: number | undefined) => void\n  percent?: boolean\n  disabled?: boolean\n  onReset?: () => void\n}\nconst FlexButtonGroup = styled(ButtonGroup)({\n  display: 'flex',\n})\n\nexport default function StatInput({\n  name,\n  children,\n  value,\n  placeholder,\n  defaultValue = 0,\n  onValueChange,\n  percent = false,\n  disabled = false,\n  onReset,\n  ...restProps\n}: StatInputInput) {\n  return (\n    <FlexButtonGroup {...restProps}>\n      {children}\n      <TextButton sx={{ px: 1 }}>{name}</TextButton>\n      <CustomNumberInputButtonGroupWrapper\n        sx={{ flexBasis: '10em', flexGrow: 1 }}\n      >\n        <CustomNumberInput\n          sx={{ px: 1 }}\n          inputProps={{\n            sx: { textAlign: 'right' },\n          }}\n          float={percent}\n          placeholder={placeholder}\n          value={value}\n          onChange={onValueChange}\n          disabled={disabled}\n          endAdornment={percent ? '%' : undefined}\n        />\n      </CustomNumberInputButtonGroupWrapper>\n      <Button\n        sx={{ flexShrink: 2 }}\n        size=\"small\"\n        color=\"error\"\n        onClick={() => (onReset ? onReset() : onValueChange(defaultValue))}\n        disabled={disabled || value === defaultValue}\n      >\n        <Replay />\n      </Button>\n    </FlexButtonGroup>\n  )\n}\n","import type { ElementWithPhyKey } from '@genshin-optimizer/consts'\nimport { allElementWithPhyKeys } from '@genshin-optimizer/consts'\nimport {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  ExpandMore,\n  Replay,\n} from '@mui/icons-material'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Chip,\n  Collapse,\n  Grid,\n  Typography,\n} from '@mui/material'\nimport { useCallback, useContext, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { CharacterContext } from '../Context/CharacterContext'\nimport { DataContext } from '../Context/DataContext'\nimport { uiInput as input } from '../Formula'\nimport { nodeVStr } from '../Formula/uiData'\nimport KeyMap from '../KeyMap'\nimport { ElementIcon } from '../KeyMap/StatIcon'\nimport { iconInlineProps } from '../SVGIcons'\nimport CardLight from './Card/CardLight'\nimport ColorText from './ColoredText'\nimport ExpandButton from './ExpandButton'\nimport StatInput from './StatInput'\n\nexport function EnemyExpandCard() {\n  const { t } = useTranslation('ui')\n  const { characterDispatch } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const [expanded, setexpanded] = useState(false)\n  const toggle = useCallback(\n    () => setexpanded(!expanded),\n    [setexpanded, expanded]\n  )\n  const eLvlNode = data.get(input.enemy.level)\n  const eDefRed = data.get(input.enemy.defRed)\n  const eDefIgn = data.get(input.enemy.defIgn)\n  const onReset = useCallback(\n    () => characterDispatch({ enemyOverride: {} }),\n    [characterDispatch]\n  )\n\n  return (\n    <CardLight>\n      <CardContent\n        sx={{ display: 'flex', gap: 1, alignItems: 'center', flexWrap: 'wrap' }}\n      >\n        <Chip\n          size=\"small\"\n          color=\"success\"\n          label={\n            <span>\n              {eLvlNode.info.name} <strong>{eLvlNode.value}</strong>\n            </span>\n          }\n        />\n        {allElementWithPhyKeys.map((element) => (\n          <Typography key={element}>\n            <EnemyResText element={element} />\n          </Typography>\n        ))}\n        <Typography>DEF Red. {nodeVStr(eDefRed)}</Typography>\n        <Typography>DEF Ignore {nodeVStr(eDefIgn)}</Typography>\n        <Box flexGrow={1} display=\"flex\" justifyContent=\"flex-end\" gap={1}>\n          <Button\n            size=\"small\"\n            color=\"error\"\n            onClick={onReset}\n            startIcon={<Replay />}\n          >{t`reset`}</Button>\n          <ExpandButton\n            expand={expanded}\n            onClick={toggle}\n            aria-expanded={expanded}\n            aria-label=\"show more\"\n            size=\"small\"\n            sx={{ marginLeft: 0 }}\n          >\n            <ExpandMore />\n          </ExpandButton>\n        </Box>\n      </CardContent>\n      <Collapse in={expanded} timeout=\"auto\" unmountOnExit>\n        <CardContent sx={{ pt: 0 }}>\n          <EnemyEditor />\n        </CardContent>\n      </Collapse>\n    </CardLight>\n  )\n}\n\nexport function EnemyResText({ element }: { element: ElementWithPhyKey }) {\n  const { data } = useContext(DataContext)\n  const node = data.get(input.enemy[`${element}_res_`])\n  const immune = !isFinite(node.value)\n  const icon = <ElementIcon ele={element} iconProps={iconInlineProps} />\n  const content = immune ? (\n    <span>{icon} &#8734;</span>\n  ) : (\n    <span>\n      {icon} <strong>{nodeVStr(node)}</strong>\n    </span>\n  )\n  return <ColorText color={element}>{content}</ColorText>\n}\n\nexport function EnemyEditor({\n  bsProps = { xs: 12, md: 6 },\n}: {\n  bsProps?: object\n}) {\n  const {\n    character: { enemyOverride },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const defaultVal = 10\n\n  const eLvl = enemyOverride.enemyLevel ?? data.get(input.lvl).value\n  const eDefRed = enemyOverride.enemyDefIgn_ ?? 0\n  const eDefIgn = enemyOverride.enemyDefRed_ ?? 0\n  return (\n    <Grid container spacing={1}>\n      <Grid item {...bsProps}>\n        <Button\n          fullWidth\n          sx={{ height: '100%' }}\n          size=\"small\"\n          component=\"a\"\n          color=\"warning\"\n          href=\"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances\"\n          target=\"_blank\"\n          rel=\"noreferrer\"\n        >\n          To get the specific resistance values of enemies, please visit the\n          wiki.\n        </Button>\n      </Grid>\n      <Grid item {...bsProps}>\n        <StatInput\n          sx={{ bgcolor: (t) => t.palette.contentLight.main, width: '100%' }}\n          name={<b>{KeyMap.get('enemyLevel')}</b>}\n          value={eLvl}\n          placeholder={KeyMap.getStr('enemyLevel')}\n          defaultValue={data.get(input.lvl).value}\n          onValueChange={(value) =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyLevel',\n              value,\n            })\n          }\n          onReset={() =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyLevel',\n              value: undefined,\n            })\n          }\n        />\n      </Grid>\n      {allElementWithPhyKeys.map((eleKey) => {\n        const statKey = `${eleKey}_enemyRes_`\n        const val = enemyOverride[statKey]\n        const elementImmunity = val === Number.MAX_VALUE\n        return (\n          <Grid item key={eleKey} {...bsProps}>\n            <StatInput\n              sx={{\n                bgcolor: (t) => t.palette.contentLight.main,\n                width: '100%',\n              }}\n              name={\n                <ColorText color={eleKey}>\n                  <b>{KeyMap.get(statKey)}</b>\n                </ColorText>\n              }\n              value={\n                val !== undefined ? (elementImmunity ? Infinity : val) : 10\n              }\n              placeholder={elementImmunity ? '∞ ' : KeyMap.getStr(statKey)}\n              defaultValue={defaultVal}\n              onValueChange={(value) =>\n                characterDispatch({ type: 'enemyOverride', statKey, value })\n              }\n              disabled={elementImmunity}\n              percent\n            >\n              <Button\n                color={eleKey}\n                onClick={() =>\n                  characterDispatch({\n                    type: 'enemyOverride',\n                    statKey,\n                    value: elementImmunity ? defaultVal : Number.MAX_VALUE,\n                  })\n                }\n                startIcon={\n                  elementImmunity ? <CheckBox /> : <CheckBoxOutlineBlank />\n                }\n              >\n                Immunity\n              </Button>\n            </StatInput>\n          </Grid>\n        )\n      })}\n      <Grid item {...bsProps}>\n        <StatInput\n          sx={{ bgcolor: (t) => t.palette.contentLight.main, width: '100%' }}\n          name={<b>{KeyMap.get('enemyDefIgn_')}</b>}\n          value={eDefRed}\n          placeholder={KeyMap.getStr('enemyDefIgn_')}\n          defaultValue={0}\n          onValueChange={(value) =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyDefIgn_',\n              value,\n            })\n          }\n          percent\n        />\n      </Grid>\n      <Grid item {...bsProps}>\n        <StatInput\n          sx={{ bgcolor: (t) => t.palette.contentLight.main, width: '100%' }}\n          name={<b>{KeyMap.get('enemyDefRed_')}</b>}\n          value={eDefIgn}\n          placeholder={KeyMap.getStr('enemyDefRed_')}\n          defaultValue={0}\n          onValueChange={(value) =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyDefRed_',\n              value,\n            })\n          }\n          percent\n        />\n      </Grid>\n      <Grid item xs={12}>\n        <small>\n          Note: Genshin Impact halves resistance shred values below 0%. For the\n          sake of calculations enter the RAW value and GO will do the rest.\n          (e.g. 10% - 20% = -10%)\n        </small>\n      </Grid>\n    </Grid>\n  )\n}\n","import {\n  CardContent,\n  CardHeader,\n  Grid,\n  ListItem,\n  Stack,\n  Typography,\n  Box,\n  Alert,\n} from '@mui/material'\nimport { useCallback, useContext, useMemo } from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport CardDark from '../../Components/Card/CardDark'\nimport CardLight from '../../Components/Card/CardLight'\nimport CloseButton from '../../Components/CloseButton'\nimport ColorText from '../../Components/ColoredText'\nimport { EnemyExpandCard } from '../../Components/EnemyEditor'\nimport {\n  FieldDisplayList,\n  NodeFieldDisplay,\n} from '../../Components/FieldDisplay'\nimport ModalWrapper from '../../Components/ModalWrapper'\nimport StatEditorList from '../../Components/StatEditorList'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport { DataContext } from '../../Context/DataContext'\nimport { allInputPremodKeys, uiInput as input } from '../../Formula'\nimport type { ReadNode } from '../../Formula/type'\nimport { nodeVStr } from '../../Formula/uiData'\nimport { allEleDmgKeys, allEleResKeys } from '../../KeyMap'\n\nconst cols = {\n  xs: 1,\n  md: 2,\n  lg: 3,\n}\n\nexport default function StatModal({ open, onClose }) {\n  const { t } = useTranslation('page_character')\n  return (\n    <ModalWrapper open={open} onClose={onClose}>\n      <CardDark>\n        <CardHeader\n          title={t`addStats.title`}\n          action={<CloseButton onClick={onClose} />}\n        />\n        <CardContent sx={{ pt: 0 }}>\n          <Stack spacing={1}>\n            <BonusStatsEditor />\n            <EnemyExpandCard />\n            <MainStatsCards />\n          </Stack>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\nconst keys = [...allInputPremodKeys]\nconst wrapperFunc = (e: JSX.Element, key?: string) => (\n  <Grid item key={key} xs={1}>\n    {e}\n  </Grid>\n)\nfunction BonusStatsEditor() {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { bonusStats },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const setFilter = useCallback(\n    (bonusStats) => characterDispatch({ bonusStats }),\n    [characterDispatch]\n  )\n  return (\n    <CardLight>\n      <CardContent sx={{ display: 'flex' }}>\n        <Grid container columns={cols} sx={{ pt: 1 }} spacing={1}>\n          <Grid item xs={12}>\n            <Alert severity=\"info\" variant=\"filled\">\n              <Trans i18nKey={'addStats.info'} t={t}>\n                You can use these fields to add buffs/debuffs not directly\n                supported in GO, such as food buffs, abyss cards, or\n                Superconduct. Please refer to the{' '}\n                <a href=\"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki\">\n                  Genshin Impact wiki\n                </a>{' '}\n                for specific values.\n              </Trans>\n            </Alert>\n          </Grid>\n          <StatEditorList\n            statKeys={keys}\n            statFilters={bonusStats}\n            setStatFilters={setFilter}\n            wrapperFunc={wrapperFunc}\n          />\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\n\nconst mainBaseKeys = ['hp', 'atk', 'def'] as const\nconst mainSubKeys = [\n  'eleMas',\n  'critRate_',\n  'critDMG_',\n  'enerRech_',\n  'heal_',\n] as const\nconst mainReadNodes = [...mainBaseKeys, ...mainSubKeys].map(\n  (k) => input.total[k]\n)\nconst mainEditKeys = [\n  'atk_',\n  'atk',\n  'hp_',\n  'hp',\n  'def_',\n  'def',\n  ...mainSubKeys,\n] as const\n\nconst otherStatKeys = [\n  ...allEleDmgKeys,\n  ...allEleResKeys,\n  'stamina',\n  'incHeal_',\n  'shield_',\n  'cdRed_',\n] as const\n\nconst miscStatkeys = allInputPremodKeys.filter(\n  (k) =>\n    !(mainEditKeys as readonly string[]).includes(k) &&\n    !(otherStatKeys as readonly string[]).includes(k)\n)\n\nfunction StatDisplayContent({\n  nodes,\n  extra,\n}: {\n  nodes: ReadNode<number>[]\n  extra?: Displayable\n}) {\n  const { data, oldData } = useContext(DataContext)\n  return (\n    <FieldDisplayList>\n      {nodes.map((rn) => (\n        <NodeFieldDisplay\n          component={ListItem}\n          key={JSON.stringify(rn.info)}\n          node={data.get(rn)}\n          oldValue={oldData?.get(rn)?.value}\n        />\n      ))}\n      {extra}\n    </FieldDisplayList>\n  )\n}\n\nfunction MainStatsCards() {\n  const { characterSheet } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const specialNode = data.get(input.special)\n  const charEle = characterSheet.elementKey\n  const isMelee = characterSheet.isMelee()\n\n  const otherStatReadNodes = useMemo(() => {\n    const nodes = otherStatKeys\n      .filter((k) => {\n        if (k.includes(charEle)) return false\n        if (isMelee && k.includes('physical')) return true\n        return true\n      })\n      .map((k) => input.total[k])\n\n    return nodes.filter((n) => !!data.get(n).value)\n  }, [data, charEle, isMelee])\n\n  const miscStatReadNodes = useMemo(\n    () =>\n      miscStatkeys.map((k) => input.total[k]).filter((n) => data.get(n).value),\n    [data]\n  )\n\n  return (\n    <CardLight>\n      <CardContent>\n        <Grid container columns={cols} spacing={1}>\n          <Grid item xs={1}>\n            <StatDisplayCard title=\"Main Stats\">\n              <StatDisplayContent\n                nodes={mainReadNodes}\n                extra={\n                  specialNode && (\n                    <ListItem\n                      sx={{ display: 'flex', justifyContent: 'space-between' }}\n                    >\n                      <span>\n                        <b>Special:</b>{' '}\n                        <ColorText color={specialNode.info.variant}>\n                          {specialNode.info.icon} {specialNode.info.name}\n                        </ColorText>\n                      </span>\n                      <span>{nodeVStr(specialNode)}</span>\n                    </ListItem>\n                  )\n                }\n              />\n            </StatDisplayCard>\n          </Grid>\n          <Grid item xs={1}>\n            <StatDisplayCard title=\"Other Stats\">\n              <StatDisplayContent nodes={otherStatReadNodes} />\n            </StatDisplayCard>\n          </Grid>\n          {!!miscStatReadNodes.length && (\n            <Grid item xs={1}>\n              <StatDisplayCard title=\"Misc Stats\">\n                <StatDisplayContent nodes={miscStatReadNodes} />\n              </StatDisplayCard>\n            </Grid>\n          )}\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction StatDisplayCard({ title, children }) {\n  return (\n    <CardDark>\n      <CardContent sx={{ py: 1 }}>\n        <Box display=\"flex\" justifyContent=\"space-between\">\n          <Typography variant=\"subtitle1\">{title}</Typography>\n        </Box>\n      </CardContent>\n      {children}\n    </CardDark>\n  )\n}\n","import { createContext } from 'react'\n\nexport const OptimizationTargetContext = createContext(\n  undefined as string[] | undefined\n)\n","import type { ArtSetExclusion } from '../Database/DataManagers/BuildSettingData'\nimport { forEachNodes, mapFormulas } from '../Formula/internal'\nimport type { OptNode } from '../Formula/optimization'\nimport { allOperations, constantFold } from '../Formula/optimization'\nimport type { ConstantNode } from '../Formula/type'\nimport { constant, customRead, max, min, threshold } from '../Formula/utils'\nimport type { ArtifactSetKey, SlotKey } from '../Types/consts'\nimport { allSlotKeys } from '../Types/consts'\nimport { assertUnreachable, objectKeyMap, objectMap, range } from '../Util/Util'\n\ntype MicropassOperation =\n  | 'reaffine'\n  | 'pruneArtRange'\n  | 'pruneNodeRange'\n  | 'pruneOrder'\nexport function pruneAll(\n  nodes: OptNode[],\n  minimum: number[],\n  arts: ArtifactsBySlot,\n  numTop: number,\n  exclusion: ArtSetExclusion,\n  forced: Dict<MicropassOperation, boolean>\n): { nodes: OptNode[]; arts: ArtifactsBySlot } {\n  let should = forced\n  /** If `key` makes progress, all operations in `value` should be performed */\n  const deps: StrictDict<MicropassOperation, Dict<MicropassOperation, true>> = {\n    pruneOrder: { pruneNodeRange: true },\n    pruneArtRange: { pruneNodeRange: true },\n    pruneNodeRange: { reaffine: true },\n    reaffine: { pruneOrder: true, pruneArtRange: true, pruneNodeRange: true },\n  }\n  let count = 0\n  while (Object.values(should).some((x) => x) && count++ < 20) {\n    if (should.pruneOrder) {\n      delete should.pruneOrder\n      const newArts = pruneOrder(arts, numTop, exclusion)\n      if (arts !== newArts) {\n        arts = newArts\n        should = { ...should, ...deps.pruneOrder }\n      }\n    }\n    if (should.pruneArtRange) {\n      delete should.pruneArtRange\n      const newArts = pruneArtRange(nodes, arts, minimum)\n      if (arts !== newArts) {\n        arts = newArts\n        should = { ...should, ...deps.pruneArtRange }\n      }\n    }\n    if (should.pruneNodeRange) {\n      delete should.pruneNodeRange\n      const newNodes = pruneNodeRange(nodes, arts)\n      if (nodes !== newNodes) {\n        nodes = newNodes\n        should = { ...should, ...deps.pruneNodeRange }\n      }\n    }\n    if (should.reaffine) {\n      delete should.reaffine\n      const { nodes: newNodes, arts: newArts } = reaffine(nodes, arts)\n      if (nodes !== newNodes || arts !== newArts) {\n        nodes = newNodes\n        arts = newArts\n        should = { ...should, ...deps.reaffine }\n      }\n    }\n  }\n  return { nodes, arts }\n}\n\nexport function pruneExclusion(\n  nodes: OptNode[],\n  exclusion: ArtSetExclusion\n): OptNode[] {\n  const maxValues: Dict<keyof typeof exclusion, number> = {}\n  for (const [key, e] of Object.entries(exclusion)) {\n    if (!e.includes(4)) continue\n    maxValues[key] = e.includes(2) ? 1 : 3\n  }\n  return mapFormulas(\n    nodes,\n    (f) => f,\n    (f) => {\n      if (f.operation !== 'threshold') return f\n\n      const [v, t, pass, fail] = f.operands\n      if (v.operation === 'read' && t.operation === 'const') {\n        const key = v.path[v.path.length - 1],\n          thres = t.value\n        if (key in maxValues) {\n          const max: number = maxValues[key]\n          if (max < thres) return fail\n          if (thres === 2 && exclusion[key]!.includes(2))\n            return threshold(v, 4, pass, fail)\n        }\n      }\n      return f\n    }\n  )\n}\n\nfunction reaffine(\n  nodes: OptNode[],\n  arts: ArtifactsBySlot,\n  forceRename = false\n): { nodes: OptNode[]; arts: ArtifactsBySlot } {\n  const affineNodes = new Set<OptNode>(),\n    topLevelAffine = new Set<OptNode>()\n\n  function visit(node: OptNode, isAffine: boolean) {\n    if (isAffine) affineNodes.add(node)\n    else\n      node.operands.forEach(\n        (op) => affineNodes.has(op) && topLevelAffine.add(op)\n      )\n  }\n\n  const dynKeys = new Set<string>()\n\n  forEachNodes(\n    nodes,\n    (_) => {},\n    (f) => {\n      const { operation } = f\n      switch (operation) {\n        case 'read':\n          dynKeys.add(f.path[1])\n          visit(f, true)\n          break\n        case 'add':\n          visit(\n            f,\n            f.operands.every((op) => affineNodes.has(op))\n          )\n          break\n        case 'mul': {\n          const nonConst = f.operands.filter((op) => op.operation !== 'const')\n          visit(\n            f,\n            nonConst.length === 0 ||\n              (nonConst.length === 1 && affineNodes.has(nonConst[0]))\n          )\n          break\n        }\n        case 'const':\n          visit(f, true)\n          break\n        case 'res':\n        case 'threshold':\n        case 'sum_frac':\n        case 'max':\n        case 'min':\n          visit(f, false)\n          break\n        default:\n          assertUnreachable(operation)\n      }\n    }\n  )\n\n  if (\n    [...topLevelAffine].every(\n      ({ operation }) => operation === 'read' || operation === 'const'\n    ) &&\n    Object.keys(arts.base).length === dynKeys.size\n  )\n    return { nodes, arts }\n\n  let current = -1\n  function nextDynKey(): string {\n    while (dynKeys.has(`${++current}`));\n    return `${current}`\n  }\n\n  nodes.forEach((node) => affineNodes.has(node) && topLevelAffine.add(node))\n  const affine = [...topLevelAffine].filter((f) => f.operation !== 'const')\n  const affineMap = new Map(\n    affine.map((node) => [\n      node,\n      !forceRename && node.operation === 'read' && node.path[0] === 'dyn'\n        ? node\n        : { ...customRead(['dyn', `${nextDynKey()}`]), accu: 'add' as const },\n    ])\n  )\n  nodes = mapFormulas(\n    nodes,\n    (f) => affineMap.get(f) ?? f,\n    (f) => f\n  )\n\n  function reaffineArt(stat: DynStat): DynStat {\n    const values = constantFold(\n      [...affineMap.keys()],\n      {\n        dyn: objectMap(stat, (value) => constant(value)),\n      } as any,\n      (_) => true\n    )\n    return Object.fromEntries(\n      [...affineMap.values()].map((v, i) => [\n        v.path[1],\n        (values[i] as ConstantNode<number>).value,\n      ])\n    )\n  }\n  const result = {\n    nodes,\n    arts: {\n      base: reaffineArt(arts.base),\n      values: objectKeyMap(allSlotKeys, (slot) =>\n        arts.values[slot].map(({ id, set, values }) => ({\n          id,\n          set,\n          values: reaffineArt(values),\n        }))\n      ),\n    },\n  }\n  const offsets = Object.entries(reaffineArt({}))\n  for (const arts of Object.values(result.arts.values))\n    for (const { values } of arts)\n      for (const [key, baseValue] of offsets) values[key] -= baseValue\n  return result\n}\n/** Remove artifacts that cannot be in top `numTop` builds */\nfunction pruneOrder(\n  arts: ArtifactsBySlot,\n  numTop: number,\n  exclusion: ArtSetExclusion\n): ArtifactsBySlot {\n  let progress = false\n  /**\n   * Note:\n   * This function assumes that every base (reaffined) stats are monotonically increasing. That is, artifacts\n   * with higher stats are better. This remains true as long as the main and substats are in increasing. Set\n   * effects that decrease enemy resistance (which is monotonically decreasing) does not violate this assumption\n   * as set effects are not handled here.\n   */\n  const allowRainbow = !exclusion.rainbow?.length,\n    keys = Object.keys(arts.base)\n  const noSwitchIn = new Set(\n    Object.entries(exclusion)\n      .filter(([_, v]) => v.length)\n      .map(([k]) => k) as ArtifactSetKey[]\n  )\n  const noSwitchOut = new Set(\n    Object.entries(exclusion)\n      .filter(([_, v]) => v.includes(2) && !v.includes(4))\n      .map(([k]) => k) as ArtifactSetKey[]\n  )\n  const values = objectKeyMap(allSlotKeys, (slot) => {\n    const list = arts.values[slot]\n    const newList = list.filter((art) => {\n      let count = 0\n      return list.every((other) => {\n        const otherBetterEqual = keys.every(\n          (k) => (other.values[k] ?? 0) >= (art.values[k] ?? 0)\n        )\n        const otherMaybeBetter = keys.some(\n          (k) => (other.values[k] ?? 0) > (art.values[k] ?? 0)\n        )\n        const otherBetter =\n          otherBetterEqual && (otherMaybeBetter || other.id > art.id)\n        const canSwitch =\n          (allowRainbow &&\n            !noSwitchIn.has(other.set!) &&\n            !noSwitchOut.has(art.set!)) ||\n          art.set === other.set\n        if (otherBetter && canSwitch) count++\n        return count < numTop\n      })\n    })\n    if (newList.length !== list.length) progress = true\n    return newList\n  })\n  return progress ? { base: arts.base, values } : arts\n}\n/** Remove artifacts that cannot reach `minimum` in any build */\nfunction pruneArtRange(\n  nodes: OptNode[],\n  arts: ArtifactsBySlot,\n  minimum: number[]\n): ArtifactsBySlot {\n  const baseRange = Object.fromEntries(\n    Object.entries(arts.base).map(([key, x]) => [key, { min: x, max: x }])\n  )\n  const wrap = { arts }\n  while (true) {\n    const artRanges = objectKeyMap(allSlotKeys, (slot) =>\n      computeArtRange(wrap.arts.values[slot])\n    )\n    const otherArtRanges = objectKeyMap(allSlotKeys, (key) =>\n      addArtRange(\n        Object.entries(artRanges)\n          .map((a) => (a[0] === key ? baseRange : a[1]))\n          .filter((x) => x)\n      )\n    )\n\n    let progress = false\n    const values = objectKeyMap(allSlotKeys, (slot) => {\n      const result = wrap.arts.values[slot].filter((art) => {\n        const read = addArtRange([computeArtRange([art]), otherArtRanges[slot]])\n        const newRange = computeNodeRange(nodes, read)\n        return nodes.every(\n          (node, i) => newRange.get(node)!.max >= (minimum[i] ?? -Infinity)\n        )\n      })\n      if (result.length !== wrap.arts.values[slot].length) progress = true\n      return result\n    })\n    if (!progress) break\n    wrap.arts = { base: wrap.arts.base, values }\n  }\n  return wrap.arts\n}\nfunction pruneNodeRange(nodes: OptNode[], arts: ArtifactsBySlot): OptNode[] {\n  const baseRange = Object.fromEntries(\n    Object.entries(arts.base).map(([key, x]) => [key, { min: x, max: x }])\n  )\n  const reads = addArtRange([\n    baseRange,\n    ...Object.values(arts.values).map((values) => computeArtRange(values)),\n  ])\n  const nodeRange = computeNodeRange(nodes, reads)\n\n  return mapFormulas(\n    nodes,\n    (f) => {\n      {\n        const { min, max } = nodeRange.get(f)!\n        if (min === max) return constant(min)\n      }\n      const { operation } = f\n      const operandRanges = f.operands.map((x) => nodeRange.get(x)!)\n      switch (operation) {\n        case 'threshold': {\n          const [value, threshold, pass, fail] = operandRanges\n          if (value.min >= threshold.max) return f.operands[2]\n          else if (value.max < threshold.min) return f.operands[3]\n          if (\n            pass.max === pass.min &&\n            fail.max === fail.min &&\n            pass.min === fail.min &&\n            isFinite(pass.min)\n          )\n            return constant(pass.max)\n          break\n        }\n        case 'min': {\n          const newOperands = f.operands.filter((_, i) => {\n            const op1 = operandRanges[i]\n            return operandRanges.every((op2) => op1.min <= op2.max)\n          })\n          if (newOperands.length < operandRanges.length)\n            return min(...newOperands)\n          break\n        }\n        case 'max': {\n          const newOperands = f.operands.filter((_, i) => {\n            const op1 = operandRanges[i]\n            return operandRanges.every((op2) => op1.max >= op2.min)\n          })\n          if (newOperands.length < operandRanges.length)\n            return max(...newOperands)\n          break\n        }\n      }\n      return f\n    },\n    (f) => f\n  )\n}\nfunction addArtRange(ranges: DynMinMax[]): DynMinMax {\n  const result: DynMinMax = {}\n  ranges.forEach((range) => {\n    Object.entries(range).forEach(([key, value]) => {\n      if (result[key]) {\n        result[key].min += value.min\n        result[key].max += value.max\n      } else result[key] = { ...value }\n    })\n  })\n  return result\n}\nfunction computeArtRange(arts: ArtifactBuildData[]): DynMinMax {\n  const result: DynMinMax = {}\n  if (arts.length) {\n    Object.keys(arts[0].values)\n      .filter((key) => arts.every((art) => art.values[key]))\n      .forEach(\n        (key) =>\n          (result[key] = { min: arts[0].values[key], max: arts[0].values[key] })\n      )\n    arts.forEach(({ values }) => {\n      for (const [key, value] of Object.entries(values)) {\n        if (!result[key]) result[key] = { min: 0, max: value }\n        else {\n          if (result[key].max < value) result[key].max = value\n          if (result[key].min > value) result[key].min = value\n        }\n      }\n    })\n  }\n  return result\n}\nexport function computeFullArtRange(arts: ArtifactsBySlot): DynMinMax {\n  const baseRange = Object.fromEntries(\n    Object.entries(arts.base).map(([key, x]) => [key, { min: x, max: x }])\n  )\n  return addArtRange([\n    baseRange,\n    ...Object.values(arts.values).map((values) => computeArtRange(values)),\n  ])\n}\nexport function computeNodeRange(\n  nodes: OptNode[],\n  reads: DynMinMax\n): Map<OptNode, MinMax> {\n  const range = new Map<OptNode, MinMax>()\n\n  forEachNodes(\n    nodes,\n    (_) => {},\n    (f) => {\n      const { operation } = f\n      const operands = f.operands.map((op) => range.get(op)!)\n      let current: MinMax\n      switch (operation) {\n        case 'read':\n          if (f.path[0] !== 'dyn')\n            throw new Error(\n              `Found non-dyn path ${f.path} while computing range`\n            )\n          current = reads[f.path[1]] ?? { min: 0, max: 0 }\n          break\n        case 'const':\n          current = computeMinMax([f.value])\n          break\n        case 'add':\n        case 'min':\n        case 'max':\n          current = {\n            min: allOperations[operation](operands.map((x) => x.min)),\n            max: allOperations[operation](operands.map((x) => x.max)),\n          }\n          break\n        case 'res':\n          current = {\n            min: allOperations[operation]([operands[0].max]),\n            max: allOperations[operation]([operands[0].min]),\n          }\n          break\n        case 'mul':\n          current = operands.reduce((accu, current) =>\n            computeMinMax([\n              accu.min * current.min,\n              accu.min * current.max,\n              accu.max * current.min,\n              accu.max * current.max,\n            ])\n          )\n          break\n        case 'threshold':\n          if (operands[0].min >= operands[1].max) current = operands[2]\n          else if (operands[0].max < operands[1].min) current = operands[3]\n          else current = computeMinMax([], [operands[2], operands[3]])\n          break\n        case 'sum_frac': {\n          const [x, c] = operands,\n            sum = { min: x.min + c.min, max: x.max + c.max }\n          if (sum.min <= 0 && sum.max >= 0)\n            current =\n              x.min <= 0 && x.max >= 0\n                ? { min: NaN, max: NaN }\n                : { min: -Infinity, max: Infinity }\n          // TODO: Check this\n          else\n            current = computeMinMax([\n              x.min / sum.min,\n              x.min / sum.max,\n              x.max / sum.min,\n              x.max / sum.max,\n            ])\n          break\n        }\n        default:\n          assertUnreachable(operation)\n      }\n      range.set(f, current)\n    }\n  )\n  return range\n}\nfunction computeMinMax(\n  values: readonly number[],\n  minMaxes: readonly MinMax[] = []\n): MinMax {\n  const max = Math.max(...values, ...minMaxes.map((x) => x.max))\n  const min = Math.min(...values, ...minMaxes.map((x) => x.min))\n  return { min, max }\n}\n\nexport function filterArts(\n  arts: ArtifactsBySlot,\n  filters: RequestFilter\n): ArtifactsBySlot {\n  return {\n    base: arts.base,\n    values: objectKeyMap(allSlotKeys, (slot) => {\n      const filter = filters[slot]\n      switch (filter.kind) {\n        case 'id':\n          return arts.values[slot].filter((art) => filter.ids.has(art.id))\n        case 'exclude':\n          return arts.values[slot].filter((art) => !filter.sets.has(art.set!))\n        case 'required':\n          return arts.values[slot].filter((art) => filter.sets.has(art.set!))\n      }\n    }),\n  }\n}\n\nexport function mergeBuilds(builds: Build[][], maxNum: number): Build[] {\n  return builds\n    .flatMap((x) => x)\n    .sort((a, b) => b.value - a.value)\n    .slice(0, maxNum)\n}\nexport function mergePlot(plots: PlotData[]): PlotData {\n  let scale = 0.01\n  const reductionScaling = 2,\n    maxCount = 1500\n  let keys = new Set(\n    plots.flatMap((x) =>\n      Object.values(x).map((v) => Math.round(v.plot! / scale))\n    )\n  )\n  while (keys.size > maxCount) {\n    scale *= reductionScaling\n    keys = new Set([...keys].map((key) => Math.round(key / reductionScaling)))\n  }\n  const result: PlotData = {}\n  for (const plot of plots)\n    for (const build of Object.values(plot)) {\n      const x = Math.round(build.plot! / scale) * scale\n      if (!result[x] || result[x]!.value < build.value) result[x] = build\n    }\n  return result\n}\n\nexport function countBuilds(arts: ArtifactsBySlot): number {\n  return allSlotKeys.reduce(\n    (_count, slot) => _count * arts.values[slot].length,\n    1\n  )\n}\n\nexport function* filterFeasiblePerm(\n  filters: Iterable<RequestFilter>,\n  _artSets: ArtifactsBySlot\n): Iterable<RequestFilter> {\n  const artSets = objectMap(\n    _artSets.values,\n    (values) => new Set(values.map((v) => v.set))\n  )\n  filter_loop: for (const filter of filters) {\n    for (const [slot, f] of Object.entries(filter)) {\n      const available = artSets[slot]!\n      switch (f.kind) {\n        case 'required':\n          if ([...f.sets].every((s) => !available.has(s))) continue filter_loop\n          break\n        case 'exclude':\n          if ([...available].every((s) => f.sets.has(s!))) continue filter_loop\n          break\n        case 'id':\n          break\n      }\n    }\n    yield filter\n  }\n}\nexport function exclusionToAllowed(\n  exclusion: number[] | undefined\n): Set<number> {\n  return new Set(\n    exclusion?.includes(2)\n      ? exclusion.includes(4)\n        ? [0, 1]\n        : [0, 1, 4, 5]\n      : exclusion?.includes(4)\n      ? [0, 1, 2, 3]\n      : [0, 1, 2, 3, 4, 5]\n  )\n}\n/** A *disjoint* set of `RequestFilter` satisfying the exclusion rules */\nexport function* artSetPerm(\n  exclusion: ArtSetExclusion,\n  _artSets: ArtifactSetKey[]\n): Iterable<RequestFilter> {\n  /**\n   * This generation algorithm is separated into two parts:\n   * - \"Shape\" generation\n   *   - It first generates all build \"shapes\", e.g., AABBC, ABBCD\n   *   - It then filters the generated shapes according to the rainbow exclusion, e.g., removes ABBCD if excluding 3 rainbows\n   *   - It then merges the remaining shapes into wildcards, e.g. AABAA + AABAB + AABAC => AABA*\n   * - Shape filling\n   *   - From the given shapes, it tries to fill in all non-rainbow slots, e.g., slots A and B of AABBC, with actual artifacts\n   *   - It then fills the rainbow slots, e.g., slot C of AABBC while ensuring the exclusion rule of each sets\n   */\n  const artSets = [...new Set(_artSets)],\n    allowedRainbows = exclusionToAllowed(exclusion.rainbow)\n  let shapes: number[][] = []\n  function populateShapes(\n    current: number[],\n    list: Set<number>,\n    rainbows: number[]\n  ) {\n    if (current.length === 5) {\n      if (allowedRainbows.has(rainbows.length)) shapes.push(current)\n      return\n    }\n    for (const i of list)\n      populateShapes(\n        [...current, i],\n        list,\n        rainbows.filter((j) => j !== i)\n      )\n    populateShapes(\n      [...current, current.length],\n      new Set([...list, current.length]),\n      [...rainbows, current.length]\n    )\n  }\n  populateShapes([0], new Set([0]), [0])\n  function indexOfShape(shape: number[], replacing: number) {\n    if (range(replacing + 1, 4).some((i) => shape[i] !== 5)) return undefined\n    shape = [...shape]\n    shape[replacing] = 5\n    return shape.reduce((a, b) => a * 6 + b, 0)\n  }\n  for (let replacing = 4; replacing >= 0; replacing--) {\n    const required: Map<number, number> = new Map()\n    for (const shape of shapes) {\n      const id = indexOfShape(shape, replacing)\n      if (id === undefined) continue\n      required.set(\n        id,\n        (required.get(id) ?? new Set(shape.slice(0, replacing)).size + 1) - 1\n      )\n    }\n    for (const [id, remaining] of required.entries()) {\n      if (remaining === 0) {\n        const shape = [\n          ...shapes.find((shape) => indexOfShape(shape, replacing) === id)!,\n        ]\n        shape[replacing] = 5\n        shapes = shapes.filter((shape) => indexOfShape(shape, replacing) !== id)\n        shapes.push(shape)\n      }\n    }\n  }\n\n  // Shapes are now calculated and merged, proceed to fill in the sets\n\n  const noFilter = { kind: 'exclude' as const, sets: new Set<ArtifactSetKey>() }\n  const result: RequestFilter = objectKeyMap(allSlotKeys, (_) => noFilter)\n\n  const counts = {\n    ...objectMap(exclusion, (_) => 0),\n    ...objectKeyMap(artSets, (_) => 0),\n  }\n  const allowedCounts = objectMap(exclusion, exclusionToAllowed)\n\n  function* check(shape: number[]) {\n    const used: Set<ArtifactSetKey> = new Set(),\n      rainbows: number[] = []\n    let groupped: number[][] = []\n    for (const i of shape) {\n      groupped.push([])\n      if (i === 5) rainbows.push(groupped.length - 1)\n      else groupped[i].push(groupped.length - 1)\n    }\n    groupped = groupped\n      .filter((v) => v.length)\n      .sort((a, b) => b.length - a.length)\n    let usableRainbows = rainbows.length\n\n    // Inception.. because js doesn't like functions inside a for-loop\n    function* check(i: number) {\n      if (i === groupped.length) return yield* check_free(0)\n\n      for (const set of artSets) {\n        if (used.has(set)) continue\n        const length = groupped[i].length,\n          allowedSet = allowedCounts[set]\n        let requiredRainbows = 0\n\n        if (allowedSet && !allowedSet.has(length)) {\n          // Look ahead and see if we have enough rainbows to fill to the next `allowedSet` if we use the current set\n          requiredRainbows =\n            (range(length + 1, 5).find((l) => allowedSet.has(l)) ?? 6) - length\n          if (requiredRainbows > usableRainbows) continue // Not enough rainbows. Next..\n        }\n\n        used.add(set)\n        counts[set] = groupped[i].length\n        groupped[i].forEach(\n          (j) =>\n            (result[allSlotKeys[j]] = {\n              kind: 'required',\n              sets: new Set([set]),\n            })\n        )\n        usableRainbows -= requiredRainbows\n\n        yield* check(i + 1)\n\n        usableRainbows += requiredRainbows\n        counts[set] = 0\n        used.delete(set)\n      }\n    }\n    // We separate filling rainbow slots from groupped slots because it has an entirely\n    // different set of rules regarding what can be filled and what states to be kept.\n    function* check_free(i: number) {\n      const remaining = rainbows.length - i,\n        isolated: ArtifactSetKey[] = [],\n        missing: ArtifactSetKey[] = [],\n        rejected: ArtifactSetKey[] = []\n      let required = 0\n      for (const set of artSets) {\n        const allowedSet = allowedCounts[set],\n          count = counts[set]\n        if (!allowedSet) continue\n        if (range(1, remaining).every((j) => !allowedSet.has(count + j)))\n          rejected.push(set)\n        else if (!allowedSet.has(count)) {\n          required += [...allowedSet].find((x) => x > count)! - count\n          missing.push(set)\n        } else if (range(0, remaining).some((j) => !allowedSet.has(count + j)))\n          isolated.push(set)\n      }\n      if (required > remaining) return\n      if (i === rainbows.length) {\n        yield { ...result }\n        return\n      }\n      if (required === remaining) {\n        for (const set of missing) {\n          counts[set]++\n          result[allSlotKeys[rainbows[i]]] = {\n            kind: 'required',\n            sets: new Set([set]),\n          }\n          yield* check_free(i + 1)\n          counts[set]--\n        }\n        return\n      }\n      for (const set of [...isolated, ...missing]) {\n        counts[set]++\n        result[allSlotKeys[rainbows[i]]] = {\n          kind: 'required',\n          sets: new Set([set]),\n        }\n        yield* check_free(i + 1)\n        counts[set]--\n      }\n      result[allSlotKeys[rainbows[i]]] = {\n        kind: 'exclude',\n        sets: new Set([...missing, ...rejected, ...isolated]),\n      }\n      yield* check_free(i + 1)\n    }\n    yield* check(0)\n  }\n  for (const shape of shapes) yield* check(shape)\n}\n\nexport type RequestFilter = StrictDict<\n  SlotKey,\n  | { kind: 'required'; sets: Set<ArtifactSetKey> }\n  | { kind: 'exclude'; sets: Set<ArtifactSetKey> }\n  | { kind: 'id'; ids: Set<string> }\n>\n\nexport type DynStat = { [key in string]: number }\nexport type ArtifactBuildData = {\n  id: string\n  set?: ArtifactSetKey\n  values: DynStat\n}\nexport type ArtifactsBySlot = {\n  base: DynStat\n  values: StrictDict<SlotKey, ArtifactBuildData[]>\n}\n\nexport type PlotData = Dict<number, Build>\nexport interface Build {\n  value: number\n  plot?: number\n  artifactIds: string[]\n}\n\nexport type DynMinMax = { [key in string]: MinMax }\nexport type MinMax = { min: number; max: number }\n","export class MaxPrio<V> {\n  // Fibonacci Heap\n  list: (PrioNode<V> | undefined)[] = []\n  maxNode: PrioNode<V> | undefined\n\n  insert(key: number, value: V): void {\n    let node: PrioNode<V> | undefined = { key, value, children: [] }\n    if (!this.maxNode || this.maxNode.key < key)\n      [this.maxNode, node] = [node, this.maxNode]\n    if (node) this.addNode(node, node.children.length)\n  }\n  pop(): V | undefined {\n    if (!this.maxNode) return\n    const { value, children } = this.maxNode\n    children.forEach((child, i) => this.addNode(child, i))\n\n    const [_, maxDegree] = this.list.reduce(\n      (max, cur, iCur) =>\n        !cur || (max[0] && max[0].key > cur.key) ? max : [cur, iCur],\n      [undefined as PrioNode<V> | undefined, -1]\n    )\n    if (maxDegree === this.list.length - 1) this.maxNode = this.list.pop()\n    else this.maxNode = this.popNode(maxDegree)\n    return value\n  }\n\n  private addNode(node: PrioNode<V>, degree: number): void {\n    let other: PrioNode<V> | undefined\n    while ((other = this.popNode(degree))) {\n      if (other.key > node.key) {\n        other.children.push(node)\n        node = other\n      } else node.children.push(other)\n      degree += 1\n    }\n    this.list[degree] = node\n  }\n  private popNode(degree: number): PrioNode<V> | undefined {\n    const result = this.list[degree]\n    this.list[degree] = undefined\n    return result\n  }\n}\n\ninterface PrioNode<V> {\n  key: number\n  value: V\n  children: PrioNode<V>[]\n}\n\nexport class FIFO<T> {\n  // Simple two-stack implementation\n  head: T[] = []\n  tail: T[] = []\n\n  get length(): number {\n    return this.head.length + this.tail.length\n  }\n  push(t: T): void {\n    this.tail.push(t)\n  }\n  pop(): T | undefined {\n    if (!this.head.length && this.tail.length)\n      [this.head, this.tail] = [this.tail.reverse(), this.head]\n    return this.head.pop()\n  }\n}\n","import { FIFO } from '@genshin-optimizer/util'\n\nexport class WorkerCoordinator<\n  Command extends { command: string; resultType?: never },\n  Response extends { command?: never; resultType: string }\n> {\n  prio: Map<Command['command'], number>\n  commands: FIFO<Command>[]\n  workers: Promise<Worker>[]\n  workDone: Map<Worker, () => void> = new Map()\n  _workers: Worker[]\n\n  cancel: (e?: Error) => void\n  cancelled: Promise<never>\n  callback: (_: Response, w: Worker) => void\n  notifyNonEmpty: (() => void) | undefined\n\n  constructor(\n    workers: Worker[],\n    prio: Command['command'][],\n    callback: (_: Response, w: Worker) => void\n  ) {\n    this.commands = prio.map((_) => new FIFO())\n    this.prio = new Map(prio.map((p, i) => [p, i]))\n    this.callback = callback\n\n    workers.forEach((worker) => {\n      worker.onmessage = (x) => this.onMessage(x.data, worker)\n      worker.onerror = (e) => this.onError(e)\n    })\n    this._workers = workers\n    this.workers = workers.map((w) => Promise.resolve(w))\n    this.cancel = () => {}\n    this.cancelled = new Promise<never>((_, rej) => (this.cancel = rej))\n    this.cancelled.catch((_) => workers.forEach((w) => w.terminate()))\n  }\n\n  /**\n   * Send `commands` to available workers. If a worker sends back a `Command`,\n   * that command is further sent to an available worker (may be the same worker).\n   * If a worker sends back a `Response`, `this.callback` is invoked.\n   *\n   * Note that `{ resultType: 'done' }` is a special type that the worker is\n   * expected to send back when completing its `command`.\n   */\n  async execute(commands: Iterable<Command> | AsyncIterable<Command>) {\n    const processingInput = (async () => {\n      for await (const command of commands) this.add(command)\n    })()\n\n    while (true) {\n      const command = this.commands.find((x) => x.length)?.pop()\n      if (command === undefined) {\n        const hasCommand = await Promise.race([\n          new Promise<boolean>(\n            (res) => (this.notifyNonEmpty = () => res(true))\n          ),\n          Promise.all([...this.workers, processingInput]).then((_) => false),\n          this.cancelled,\n        ])\n\n        this.notifyNonEmpty = undefined\n        if (hasCommand) continue\n        break\n      }\n\n      const { i, w } = await Promise.race([\n        ...this.workers.map((w, i) => w.then((w) => ({ i, w }))),\n        this.cancelled,\n      ])\n      this.workers[i] = new Promise((res) => this.workDone.set(w, () => res(w)))\n      w.postMessage(command)\n    }\n  }\n\n  onError(e: { message: string }) {\n    this.cancel(new Error(`Worker Error: ${e.message}`))\n  }\n  onMessage(msg: Command | Response, worker: Worker) {\n    if (msg.command !== undefined) this.add(msg)\n    else if (msg.resultType === 'done') this.workDone.get(worker)!()\n    else this.callback(msg, worker)\n  }\n  /** May be ignored after `execute` ends */\n  add(command: Command) {\n    const prio = this.prio.get(command.command)!\n    this.commands[prio].push(command)\n    this.notifyNonEmpty?.()\n  }\n  /** May be ignored after `execute` ends */\n  broadcast(command: Command) {\n    this._workers.forEach((w) => w.postMessage(command))\n  }\n  /** MUST be followed by `execute` and cannot be called while `execute` is running */\n  notifiedBroadcast(command: Command) {\n    this.workers = this.workers.map((worker) =>\n      worker.then(\n        (w) =>\n          new Promise((res) => {\n            this.workDone.set(w, () => res(w))\n          })\n      )\n    )\n    this._workers.forEach((w) => w.postMessage(command))\n  }\n}\n","import type {\n  Count,\n  FinalizeResult,\n  Interim,\n  OptProblemInput,\n  Setup,\n  WorkerCommand,\n  WorkerResult,\n} from '..'\nimport { optimize } from '../../Formula/optimization'\nimport { pruneAll, pruneExclusion } from '../common'\nimport { WorkerCoordinator } from '../coordinator'\n\nexport class GOSolver extends WorkerCoordinator<WorkerCommand, WorkerResult> {\n  private maxIterateSize = 16_000_000\n  private status: Record<'tested' | 'failed' | 'skipped' | 'total', number>\n  private exclusion: Count['exclusion']\n  private topN: number\n  private buildValues: { w: Worker; val: number }[]\n  private finalizedResults: FinalizeResult[] = []\n\n  constructor(\n    problem: OptProblemInput,\n    status: GOSolver['status'],\n    numWorker: number\n  ) {\n    const workers = Array(numWorker)\n      .fill(NaN)\n      .map((_) => new Worker(new URL('./BackgroundWorker.ts', import.meta.url)))\n    super(workers, ['iterate', 'split', 'count'], (r, w) => {\n      switch (r.resultType) {\n        case 'interim':\n          this.interim(r, w)\n          break\n        case 'finalize':\n          this.finalizedResults.push(r)\n          break\n        case 'count':\n          this.status.total = r.count\n          break\n        case 'err':\n          this.onError(r)\n          break\n      }\n    })\n    const { exclusion, topN } = problem\n    this.status = status\n    this.exclusion = exclusion\n    this.topN = topN\n    this.status.total = NaN\n    this.buildValues = Array(topN).fill({ w: undefined as any, val: -Infinity })\n\n    this.notifiedBroadcast(this.preprocess(problem))\n  }\n\n  async solve() {\n    const { exclusion, maxIterateSize } = this\n    this.finalizedResults = []\n    await this.execute([{ command: 'count', exclusion, maxIterateSize }])\n    this.notifiedBroadcast({ command: 'finalize' })\n    await this.execute([])\n    return this.finalizedResults\n  }\n\n  preprocess({\n    plotBase,\n    optimizationTarget,\n    arts,\n    topN,\n    exclusion,\n    constraints,\n  }: OptProblemInput): Setup {\n    constraints = constraints.filter((x) => x.min > -Infinity)\n\n    let nodes = [...constraints.map((x) => x.value), optimizationTarget]\n    const minimums = [...constraints.map((x) => x.min), -Infinity]\n    if (plotBase) {\n      nodes.push(plotBase)\n      minimums.push(-Infinity)\n    }\n\n    nodes = pruneExclusion(nodes, exclusion)\n    ;({ nodes, arts } = pruneAll(nodes, minimums, arts, topN, exclusion, {\n      reaffine: true,\n      pruneArtRange: true,\n      pruneNodeRange: true,\n      pruneOrder: true,\n    }))\n    nodes = optimize(nodes, {}, (_) => false)\n\n    if (plotBase) plotBase = nodes.pop()\n    const optTarget = nodes.pop()!\n\n    return {\n      command: 'setup',\n      arts,\n      optTarget,\n      plotBase,\n      topN,\n      constraints: nodes.map((value, i) => ({ value, min: minimums[i] })),\n    }\n  }\n\n  /** Returns a new `threshold` if altered */\n  private interim(r: Interim, worker: Worker) {\n    this.status.tested += r.tested\n    this.status.failed += r.failed\n    this.status.skipped += r.skipped\n\n    if (r.buildValues) {\n      const { topN } = this,\n        oldThreshold = this.buildValues[topN - 1].val ?? -Infinity\n\n      this.buildValues.filter(({ w }) => w !== worker)\n      this.buildValues.push(\n        ...r.buildValues.map((val) => ({ w: worker!, val }))\n      )\n      this.buildValues.sort((a, b) => b.val - a.val).splice(topN)\n\n      const threshold = this.buildValues[topN - 1].val ?? -Infinity\n      if (oldThreshold !== threshold)\n        this.broadcast({ command: 'threshold', threshold })\n    }\n  }\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { useCallback, useContext, useEffect, useState } from 'react'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport type { BuildSetting } from '../../../../Database/DataManagers/BuildSettingData'\n\nexport default function useBuildSetting(characterKey: CharacterKey) {\n  const { database } = useContext(DatabaseContext)\n  const [buildSetting, setBuildSetting] = useState(() =>\n    database.buildSettings.get(characterKey)\n  )\n  useEffect(\n    () => setBuildSetting(database.buildSettings.get(characterKey)),\n    [database, characterKey]\n  )\n  useEffect(\n    () =>\n      database.buildSettings.follow(\n        characterKey,\n        (k, r, v) => r === 'update' && setBuildSetting(v)\n      ),\n    [characterKey, setBuildSetting, database]\n  )\n  const buildSettingDispatch = useCallback(\n    (action: Partial<BuildSetting>) =>\n      characterKey && database.buildSettings.set(characterKey, action),\n    [characterKey, database]\n  )\n\n  return { buildSetting: buildSetting as BuildSetting, buildSettingDispatch }\n}\n","import type {\n  CharacterKey,\n  LocationCharacterKey,\n} from '@genshin-optimizer/consts'\nimport {\n  allArtifactSlotKeys,\n  allElementKeys,\n  allWeaponTypeKeys,\n  charKeyToLocCharKey,\n} from '@genshin-optimizer/consts'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport ShowChartIcon from '@mui/icons-material/ShowChart'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  Stack,\n  TextField,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport type { ChangeEvent, MouseEvent } from 'react'\nimport {\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport CharacterCardPico from '../../../../../Components/Character/CharacterCardPico'\nimport CloseButton from '../../../../../Components/CloseButton'\nimport InfoTooltip from '../../../../../Components/InfoTooltip'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SolidToggleButtonGroup from '../../../../../Components/SolidToggleButtonGroup'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport ElementToggle from '../../../../../Components/ToggleButton/ElementToggle'\nimport WeaponToggle from '../../../../../Components/ToggleButton/WeaponToggle'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport { SillyContext } from '../../../../../Context/SillyContext'\nimport { getCharSheet } from '../../../../../Data/Characters'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport type { AllowLocationsState } from '../../../../../Database/DataManagers/BuildSettingData'\nimport { allAllowLocationsState } from '../../../../../Database/DataManagers/BuildSettingData'\nimport useBoolState from '../../../../../ReactHooks/useBoolState'\nimport useForceUpdate from '../../../../../ReactHooks/useForceUpdate'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport type { ICachedCharacter } from '../../../../../Types/character'\nimport { characterFilterConfigs } from '../../../../../Util/CharacterSort'\nimport { filterFunction } from '../../../../../Util/SortByFilters'\nimport { bulkCatTotal } from '../../../../../Util/totalUtils'\nimport useBuildSetting from '../useBuildSetting'\n\nenum CharListMode {\n  ToggleToAllow,\n  ToggleToExclude,\n}\n\nexport default function AllowChar({\n  disabled = false,\n  allowListTotal,\n}: {\n  disabled?: boolean\n  allowListTotal: string\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const { t: t_pc } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { silly } = useContext(SillyContext)\n  const {\n    buildSetting: { excludedLocations, allowLocationsState },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState(false)\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  const deferredDbDirty = useDeferredValue(dbDirty)\n\n  const [searchTerm, setSearchTerm] = useState('')\n  const deferredSearchTerm = useDeferredValue(searchTerm)\n  const [elementKeys, setElementKeys] = useState([...allElementKeys])\n  const deferredElementKeys = useDeferredValue(elementKeys)\n  const [weaponTypeKeys, setWeaponTypeKeys] = useState([...allWeaponTypeKeys])\n  const deferredWeaponTypeKeys = useDeferredValue(weaponTypeKeys)\n\n  const charKeyMap: Dict<CharacterKey, ICachedCharacter> = useMemo(\n    () =>\n      deferredDbDirty &&\n      Object.fromEntries(\n        Array.from(\n          new Set(\n            Object.entries(database.chars.data)\n              .filter(([ck]) => ck !== characterKey)\n              .filter(([ck]) =>\n                filterFunction(\n                  {\n                    element: deferredElementKeys,\n                    weaponType: deferredWeaponTypeKeys,\n                    name: deferredSearchTerm,\n                  },\n                  characterFilterConfigs(database, silly)\n                )(ck)\n              )\n          )\n        )\n      ),\n    [\n      deferredDbDirty,\n      database,\n      characterKey,\n      deferredElementKeys,\n      deferredWeaponTypeKeys,\n      deferredSearchTerm,\n      silly,\n    ]\n  )\n\n  const locList = Object.entries(charKeyMap)\n    .sort(([ck1, c1], [ck2, c2]) => {\n      // sort characters by: star => more artifacts equipped\n      const [choosec1, choosec2] = [-1, 1]\n      const c1f = database.charMeta.get(ck1).favorite\n      const c2f = database.charMeta.get(ck2).favorite\n      if (c1f && !c2f) return choosec1\n      else if (c2f && !c1f) return choosec2\n\n      const art1 = Object.values(c1.equippedArtifacts).filter((id) => id).length\n      const art2 = Object.values(c2.equippedArtifacts).filter((id) => id).length\n      if (art1 > art2) return choosec1\n      else if (art2 > art1) return choosec2\n      return ck1.localeCompare(ck2)\n    })\n    .map(([ck]) => charKeyToLocCharKey(ck))\n\n  const { elementTotals, weaponTypeTotals, locListTotals } = useMemo(() => {\n    const catKeys = {\n      elementTotals: [...allElementKeys],\n      weaponTypeTotals: [...allWeaponTypeKeys],\n      locListTotals: ['allowed', 'excluded'],\n    } as const\n    return bulkCatTotal(catKeys, (ctMap) =>\n      Object.entries(database.chars.data)\n        .filter(([ck]) => ck !== characterKey)\n        .forEach(([ck]) => {\n          const sheet = getCharSheet(ck, database.gender)\n          const eleKey = sheet.elementKey\n          ctMap.elementTotals[eleKey].total++\n          if (charKeyMap[ck]) ctMap.elementTotals[eleKey].current++\n\n          const weaponTypeKey = sheet.weaponTypeKey\n          ctMap.weaponTypeTotals[weaponTypeKey].total++\n          if (charKeyMap[ck]) ctMap.weaponTypeTotals[weaponTypeKey].current++\n\n          const locKey = charKeyToLocCharKey(ck)\n          if (locList.includes(locKey)) {\n            ctMap.locListTotals.allowed.total++\n            ctMap.locListTotals.excluded.total++\n            if (!excludedLocations.includes(locKey))\n              ctMap.locListTotals.allowed.current++\n            else ctMap.locListTotals.excluded.current++\n          }\n        })\n    )\n  }, [\n    charKeyMap,\n    characterKey,\n    database.chars.data,\n    database.gender,\n    excludedLocations,\n    locList,\n  ])\n\n  useEffect(\n    () => database.charMeta.followAny((_) => forceUpdate()),\n    [forceUpdate, database]\n  )\n  useEffect(\n    () => database.chars.followAny((_) => forceUpdate()),\n    [forceUpdate, database]\n  )\n\n  const [mouseUpDetected, setMouseUpDetected] = useState(false)\n\n  const allowAll = useCallback(\n    () =>\n      buildSettingDispatch({\n        excludedLocations: excludedLocations.filter(\n          (key) => !locList.includes(key)\n        ),\n        allowLocationsState: 'customList',\n      }),\n    [buildSettingDispatch, excludedLocations, locList]\n  )\n  const disallowAll = useCallback(\n    () =>\n      buildSettingDispatch({\n        excludedLocations: Array.from(\n          new Set(excludedLocations.concat(locList))\n        ),\n        allowLocationsState: 'customList',\n      }),\n    [buildSettingDispatch, excludedLocations, locList]\n  )\n\n  const setState = useCallback(\n    (_e: MouseEvent, state: AllowLocationsState) =>\n      buildSettingDispatch({ allowLocationsState: state }),\n    [buildSettingDispatch]\n  )\n\n  const toggleList = useCallback(\n    (lkList: Set<LocationCharacterKey>) => {\n      const lkArray = [...lkList]\n      const newExcludedLocations = lkArray\n        .filter((lk) => !excludedLocations.includes(lk))\n        .concat(excludedLocations.filter((lk) => !lkArray.includes(lk)))\n      buildSettingDispatch({\n        excludedLocations: newExcludedLocations,\n        allowLocationsState: 'customList',\n      })\n    },\n    [excludedLocations, buildSettingDispatch]\n  )\n\n  const onMouseUp = useCallback(() => setMouseUpDetected(true), [])\n\n  const total = database.chars.keys.length - 1\n  const useTot = total - excludedLocations.length\n  const totalStr = useTot === total ? useTot : `${useTot}/${total}`\n  const charactersAllowed =\n    allowLocationsState === 'all'\n      ? total\n      : allowLocationsState === 'customList'\n      ? totalStr\n      : 0 // unequippedOnly\n  const stateBadgeColor =\n    allowLocationsState === 'all'\n      ? 'success'\n      : allowLocationsState === 'customList'\n      ? 'info'\n      : 'secondary' // unequippedOnly\n\n  return (\n    <Box display=\"flex\" gap={1}>\n      {/* Begin modal */}\n      <ModalWrapper\n        open={show}\n        onClose={onClose}\n        containerProps={{ maxWidth: 'xl' }}\n        draggable={false}\n        onMouseUp={onMouseUp}\n      >\n        <CardDark>\n          {/* Header */}\n          <CardContent>\n            <Box display=\"flex\" gap={1} alignItems=\"center\">\n              <Typography variant=\"h6\">{t`excludeChar.title`}</Typography>\n              <InfoTooltip\n                title={<Typography>{t`excludeChar.tooltip`}</Typography>}\n              />\n              <Box flexGrow={1} />\n              <CloseButton onClick={onClose} size=\"small\" />\n            </Box>\n          </CardContent>\n          <Divider />\n          {/* Content */}\n          <CardContent sx={{ pb: 0 }}>\n            <Stack gap={1}>\n              {/* State + Search box */}\n              <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                <SolidToggleButtonGroup\n                  exclusive\n                  baseColor=\"secondary\"\n                  size=\"small\"\n                  value={allowLocationsState}\n                  onChange={setState}\n                >\n                  {allAllowLocationsState.map((s) => (\n                    <ToggleButton\n                      key={s}\n                      value={s}\n                      disabled={allowLocationsState === s || disabled}\n                    >\n                      {t(`excludeChar.states.${s}`)}\n                    </ToggleButton>\n                  ))}\n                </SolidToggleButtonGroup>\n                <TextField\n                  autoFocus\n                  value={searchTerm}\n                  onChange={(e: ChangeEvent<HTMLTextAreaElement>) =>\n                    setSearchTerm(e.target.value)\n                  }\n                  label={t_pc('characterName')}\n                  size=\"small\"\n                  sx={{ height: '100%' }}\n                  InputProps={{\n                    sx: { height: '100%' },\n                  }}\n                />\n              </Box>\n              {/* Filter toggles */}\n              <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                <WeaponToggle\n                  sx={{ height: '100%' }}\n                  onChange={setWeaponTypeKeys}\n                  value={deferredWeaponTypeKeys}\n                  totals={weaponTypeTotals}\n                  size=\"small\"\n                />\n                <ElementToggle\n                  sx={{ height: '100%' }}\n                  onChange={setElementKeys}\n                  value={deferredElementKeys}\n                  totals={elementTotals}\n                  size=\"small\"\n                />\n              </Box>\n            </Stack>\n          </CardContent>\n          {/* Allow/Disallow + grid */}\n          <CardContent\n            sx={{ opacity: allowLocationsState === 'customList' ? 1 : 0.6 }}\n          >\n            <Grid container pb={1} gap={1} flexWrap=\"nowrap\">\n              <Grid item xs={6}>\n                <Button color=\"success\" fullWidth onClick={allowAll}>\n                  {t`excludeChar.modal.allow_all`}\n                  <SqBadge sx={{ ml: 1 }}>\n                    <strong>{locListTotals.allowed}</strong>\n                  </SqBadge>\n                </Button>\n              </Grid>\n              <Grid item xs={6}>\n                <Button fullWidth color=\"error\" onClick={disallowAll}>\n                  {t`excludeChar.modal.disallow_All`}\n                  <SqBadge sx={{ ml: 1 }}>\n                    <strong>{locListTotals.excluded}</strong>\n                  </SqBadge>\n                </Button>\n              </Grid>\n            </Grid>\n            <SelectItemGrid\n              locList={locList}\n              excludedLocations={excludedLocations}\n              mouseUpDetected={mouseUpDetected}\n              setMouseUpDetected={setMouseUpDetected}\n              toggleList={toggleList}\n            />\n          </CardContent>\n        </CardDark>\n      </ModalWrapper>\n\n      {/* Button to open modal */}\n      <CardLight sx={{ display: 'flex', width: '100%' }}>\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Stack spacing={1}>\n            <Typography>\n              <strong>{t('excludeChar.title')}</strong>\n            </Typography>\n            <Typography>\n              {t('excludeChar.usingState')}{' '}\n              <SqBadge color={stateBadgeColor}>\n                {t(`excludeChar.states.${allowLocationsState}`)}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t('excludeChar.chars')}{' '}\n              <SqBadge color=\"success\">\n                {charactersAllowed} <ShowChartIcon {...iconInlineProps} />\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t('excludeChar.artis')}{' '}\n              <SqBadge color=\"success\">\n                {allowListTotal} <ShowChartIcon {...iconInlineProps} />\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n          </Stack>\n        </CardContent>\n        <Button\n          sx={{ borderRadius: 0, flexShrink: 1, minWidth: 40 }}\n          onClick={onOpen}\n          disabled={disabled}\n          color=\"info\"\n        >\n          <SettingsIcon />\n        </Button>\n      </CardLight>\n    </Box>\n  )\n}\n\nfunction SelectItemGrid({\n  locList,\n  excludedLocations,\n  mouseUpDetected,\n  setMouseUpDetected,\n  toggleList,\n}: {\n  locList: LocationCharacterKey[]\n  excludedLocations: LocationCharacterKey[]\n  mouseUpDetected: boolean\n  setMouseUpDetected: (v: boolean) => void\n  toggleList: (charList: Set<LocationCharacterKey>) => void\n}) {\n  const [charList, setCharList] = useState(new Set<LocationCharacterKey>())\n  const [charListMode, setCharListMode] = useState<CharListMode>()\n  useEffect(() => {\n    if (mouseUpDetected) {\n      setMouseUpDetected(false)\n      if (charList.size > 0) {\n        toggleList(charList)\n        setCharList(new Set<LocationCharacterKey>())\n        setCharListMode(undefined)\n      }\n    }\n  }, [charList, setCharList, setMouseUpDetected, mouseUpDetected, toggleList])\n  return (\n    <Grid\n      container\n      spacing={1}\n      columns={{ xs: 6, sm: 7, md: 10, lg: 12, xl: 16 }}\n    >\n      {locList.map((lk) => (\n        <Grid item key={lk} xs={1}>\n          <SelectItem\n            locKey={lk}\n            charList={charList}\n            charListMode={charListMode}\n            setCharList={setCharList}\n            setCharListMode={setCharListMode}\n            selected={!excludedLocations.includes(lk)}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n\nfunction SelectItem({\n  locKey,\n  selected,\n  charList,\n  charListMode,\n  setCharList,\n  setCharListMode,\n}: {\n  locKey: LocationCharacterKey\n  selected: boolean\n  charList: Set<LocationCharacterKey>\n  charListMode?: CharListMode\n  setCharList: (list: Set<LocationCharacterKey>) => void\n  setCharListMode: (mode?: CharListMode) => void\n}) {\n  const { database } = useContext(DatabaseContext)\n  const char = database.chars.get(database.chars.LocationToCharacterKey(locKey))\n  const onMouseEnter = useCallback(\n    (e: MouseEvent) =>\n      // Mouse 1 being held down\n      e.buttons === 1 &&\n      // Only select characters with the same exclusion state as the rest of the list\n      ((charListMode === CharListMode.ToggleToAllow && !selected) ||\n        (charListMode === CharListMode.ToggleToExclude && selected)) &&\n      setCharList(new Set([...charList]).add(locKey)),\n    [charListMode, selected, setCharList, charList, locKey]\n  )\n  const onMouseDown = useCallback(() => {\n    const mode = selected\n      ? CharListMode.ToggleToExclude\n      : CharListMode.ToggleToAllow\n    setCharListMode(mode)\n    setCharList(new Set([...charList]).add(locKey))\n  }, [selected, setCharListMode, setCharList, charList, locKey])\n  const disableTooltip = useMemo(() => charList.size !== 0, [charList.size])\n  const allowed =\n    // Character is already allowed, and not selected to be excluded\n    (selected &&\n      !(\n        charListMode === CharListMode.ToggleToExclude && charList.has(locKey)\n      )) ||\n    // Or character is selected to be allowed\n    (charListMode === CharListMode.ToggleToAllow && charList.has(locKey))\n  const sx = {\n    opacity: allowed ? undefined : 0.6,\n    borderColor: allowed ? 'rgb(100,200,100)' : 'rgb(200,100,100)',\n    borderWidth: '3px',\n    borderStyle: 'solid',\n    borderRadius: '8px',\n  }\n  const content = useMemo(\n    () => (\n      <Box\n        fontSize=\"0.85em\"\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        p={0.3}\n      >\n        {allArtifactSlotKeys.map((s) => (\n          <SlotIcon\n            key={s}\n            slotKey={s}\n            iconProps={{\n              fontSize: 'inherit',\n              sx: { opacity: char?.equippedArtifacts[s] ? undefined : 0.5 },\n            }}\n          />\n        ))}\n      </Box>\n    ),\n    [char?.equippedArtifacts]\n  )\n  return (\n    <CardLight sx={sx}>\n      <CharacterCardPico\n        characterKey={database.chars.LocationToCharacterKey(locKey)}\n        onMouseDown={onMouseDown}\n        onMouseEnter={onMouseEnter}\n        disableTooltip={disableTooltip}\n      />\n      {content}\n    </CardLight>\n  )\n}\n","import { Box } from '@mui/material'\nimport { getArtSheet } from '../../Data/Artifacts'\nimport type { ArtifactSetKey, SetNum } from '../../Types/consts'\nimport DocumentDisplay from '../DocumentDisplay'\n\ntype Data = {\n  setKey: ArtifactSetKey\n  setNumKey: SetNum\n  hideHeader?: boolean\n  conditionalsOnly?: boolean\n}\n\nexport default function SetEffectDisplay({\n  setKey,\n  setNumKey,\n  hideHeader = false,\n  conditionalsOnly = false,\n}: Data) {\n  const sheet = getArtSheet(setKey)\n\n  const document = conditionalsOnly\n    ? sheet\n        .setEffectDocument(setNumKey)\n        ?.filter((section) => 'states' in section)\n    : sheet.setEffectDocument(setNumKey)\n  return (\n    <Box display=\"flex\" flexDirection=\"column\">\n      {document ? (\n        <DocumentDisplay sections={document} hideHeader={hideHeader} />\n      ) : null}\n    </Box>\n  )\n}\n","import type { ArtifactSetKey, ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport {\n  allArtifactSetKeys,\n  allArtifactSlotKeys,\n} from '@genshin-optimizer/consts'\nimport { CheckBox, CheckBoxOutlineBlank, Replay } from '@mui/icons-material'\nimport BlockIcon from '@mui/icons-material/Block'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport ShowChartIcon from '@mui/icons-material/ShowChart'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  CardContent,\n  Divider,\n  Grid,\n  Stack,\n  Typography,\n} from '@mui/material'\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport SetEffectDisplay from '../../../../../Components/Artifact/SetEffectDisplay'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport CloseButton from '../../../../../Components/CloseButton'\nimport ColorText from '../../../../../Components/ColoredText'\nimport { InfoTooltipInline } from '../../../../../Components/InfoTooltip'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { Translate } from '../../../../../Components/Translate'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../../../Context/DataContext'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport { getArtSheet, setKeysByRarities } from '../../../../../Data/Artifacts'\nimport { artifactDefIcon } from '../../../../../Data/Artifacts/ArtifactSheet'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport { handleArtSetExclusion } from '../../../../../Database/DataManagers/BuildSettingData'\nimport { UIData } from '../../../../../Formula/uiData'\nimport { constant } from '../../../../../Formula/utils'\nimport useForceUpdate from '../../../../../ReactHooks/useForceUpdate'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport type { SetNum } from '../../../../../Types/consts'\nimport { bulkCatTotal } from '../../../../../Util/totalUtils'\nimport { deepClone, objectKeyMap } from '../../../../../Util/Util'\nimport useBuildSetting from '../useBuildSetting'\n\nexport default function ArtifactSetConfig({\n  disabled,\n}: {\n  disabled?: boolean\n}) {\n  const { t } = useTranslation(['page_character_optimize', 'sheet'])\n  const dataContext = useContext(DataContext)\n  const { database } = useContext(DatabaseContext)\n  const {\n    character: { key: characterKey, conditional },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { artSetExclusion },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const [open, setOpen] = useState(false)\n  const onOpen = useCallback(() => setOpen(true), [setOpen])\n  const onClose = useCallback(() => setOpen(false), [setOpen])\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(() => database.arts.followAny(forceUpdate), [database, forceUpdate])\n\n  const artKeysByRarity = useMemo(\n    () =>\n      Object.entries(setKeysByRarities)\n        .reverse()\n        .flatMap(([, sets]) => sets)\n        .filter((key) => !key.includes('Prayers')),\n    []\n  )\n  const { artKeys, artSlotCount } = useMemo(() => {\n    const artSlotCount = objectKeyMap(artKeysByRarity, (_) =>\n      objectKeyMap(allArtifactSlotKeys, (_) => 0)\n    )\n    database.arts.values.forEach(\n      (art) =>\n        artSlotCount[art.setKey] && artSlotCount[art.setKey][art.slotKey]++\n    )\n    const artKeys = [...artKeysByRarity].sort(\n      (a, b) =>\n        +(getNumSlots(artSlotCount[a]) < 2) -\n        +(getNumSlots(artSlotCount[b]) < 2)\n    )\n    return dbDirty && { artKeys, artSlotCount }\n  }, [dbDirty, database, artKeysByRarity])\n\n  const allowRainbow2 = !artSetExclusion.rainbow?.includes(2)\n  const allowRainbow4 = !artSetExclusion.rainbow?.includes(4)\n\n  const { allowTotals } = useMemo(() => {\n    const catKeys = { allowTotals: ['2', '4'] }\n    return bulkCatTotal(catKeys, (ctMap) =>\n      artKeysByRarity.forEach((setKey) => {\n        ctMap.allowTotals['2'].total++\n        if (!artSetExclusion[setKey]?.includes(2)) {\n          ctMap.allowTotals['2'].current++\n        }\n        ctMap.allowTotals['4'].total++\n        if (!artSetExclusion[setKey]?.includes(4)) {\n          ctMap.allowTotals['4'].current++\n        }\n      })\n    )\n  }, [artKeysByRarity, artSetExclusion])\n  const artifactCondCount = useMemo(\n    () =>\n      Object.keys(conditional).filter(\n        (k) =>\n          allArtifactSetKeys.includes(k as ArtifactSetKey) &&\n          !!Object.keys(conditional[k] ?? {}).length\n      ).length,\n    [conditional]\n  )\n  const fakeDataContextObj = useMemo(\n    () => ({\n      ...dataContext,\n      data: new UIData(\n        {\n          ...dataContext.data.data[0],\n          artSet: objectKeyMap(allArtifactSetKeys, (_) => constant(4)),\n        },\n        undefined\n      ),\n    }),\n    [dataContext]\n  )\n  const resetArtConds = useCallback(() => {\n    const tconditional = Object.fromEntries(\n      Object.entries(conditional).filter(\n        ([k]) => !allArtifactSetKeys.includes(k as any)\n      )\n    )\n    characterDispatch({ conditional: tconditional })\n  }, [conditional, characterDispatch])\n  const setAllExclusion = useCallback(\n    (setnum: number, exclude = true) => {\n      const artSetExclusion_ = deepClone(artSetExclusion)\n      artKeysByRarity.forEach((k) => {\n        if (exclude)\n          artSetExclusion_[k] = [...(artSetExclusion_[k] ?? []), setnum]\n        else if (artSetExclusion_[k])\n          artSetExclusion_[k] = artSetExclusion_[k].filter((n) => n !== setnum)\n      })\n      buildSettingDispatch({ artSetExclusion: artSetExclusion_ })\n    },\n    [artKeysByRarity, artSetExclusion, buildSettingDispatch]\n  )\n\n  return (\n    <>\n      {/* Button to open modal */}\n      <CardLight sx={{ display: 'flex', width: '100%' }}>\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Typography>\n            <strong>{t`artSetConfig.title`}</strong>\n          </Typography>\n          <Stack spacing={1}>\n            <Typography>\n              {t`artSetConfig.setEffCond`}{' '}\n              <SqBadge color={artifactCondCount ? 'success' : 'warning'}>\n                {artifactCondCount} {t('artSetConfig.enabled')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`sheet:2set`}{' '}\n              <SqBadge color=\"success\">\n                {allowTotals['2']} <ShowChartIcon {...iconInlineProps} />{' '}\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`sheet:4set`}{' '}\n              <SqBadge color=\"success\">\n                {allowTotals['4']} <ShowChartIcon {...iconInlineProps} />{' '}\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`artSetConfig.2rainbow`}{' '}\n              <SqBadge color={allowRainbow2 ? 'success' : 'secondary'}>\n                {allowRainbow2 ? (\n                  <ShowChartIcon {...iconInlineProps} />\n                ) : (\n                  <BlockIcon {...iconInlineProps} />\n                )}{' '}\n                {allowRainbow2 ? t('artSetConfig.allowed') : 'Excluded'}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`artSetConfig.4rainbow`}{' '}\n              <SqBadge color={allowRainbow4 ? 'success' : 'secondary'}>\n                {allowRainbow4 ? (\n                  <ShowChartIcon {...iconInlineProps} />\n                ) : (\n                  <BlockIcon {...iconInlineProps} />\n                )}{' '}\n                {allowRainbow4 ? t('artSetConfig.allowed') : 'Excluded'}\n              </SqBadge>\n            </Typography>\n          </Stack>\n        </CardContent>\n        <Button\n          onClick={onOpen}\n          disabled={disabled}\n          color=\"info\"\n          sx={{ borderRadius: 0, flexShrink: 1, minWidth: 40 }}\n        >\n          <SettingsIcon />\n        </Button>\n      </CardLight>\n\n      {/* Begin modal */}\n      <ModalWrapper open={open} onClose={onClose}>\n        <CardDark>\n          <CardContent\n            sx={{ display: 'flex', gap: 1, justifyContent: 'space-between' }}\n          >\n            <Typography variant=\"h6\">{t`artSetConfig.title`}</Typography>\n            <CloseButton onClick={onClose} />\n          </CardContent>\n          <Divider />\n          <CardContent>\n            <CardLight sx={{ mb: 1 }}>\n              <CardContent>\n                <Box display=\"flex\" gap={1}>\n                  <Typography>\n                    <strong>{t`artSetConfig.modal.setCond.title`}</strong>\n                  </Typography>\n                  <Typography sx={{ flexGrow: 1 }}>\n                    <SqBadge color={artifactCondCount ? 'success' : 'warning'}>\n                      {artifactCondCount} {t('artSetConfig.selected')}\n                    </SqBadge>\n                  </Typography>\n                  <Button\n                    size=\"small\"\n                    onClick={resetArtConds}\n                    color=\"error\"\n                    startIcon={<Replay />}\n                  >{t`artSetConfig.modal.setCond.reset`}</Button>\n                </Box>\n                <Typography>{t`artSetConfig.modal.setCond.text`}</Typography>\n              </CardContent>\n            </CardLight>\n            <CardLight sx={{ mb: 1 }}>\n              <CardContent>\n                <Typography sx={{ flexGrow: 1 }}>\n                  <strong>\n                    <Trans\n                      t={t}\n                      i18nKey=\"artSetConfig.modal.ArtSetFilter.title\"\n                    >\n                      Artifact Sets{' '}\n                      <ColorText color=\"success\">\n                        Allowed\n                        <ShowChartIcon {...iconInlineProps} />\n                      </ColorText>{' '}\n                      /{' '}\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluded\n                        <BlockIcon {...iconInlineProps} />\n                      </ColorText>\n                    </Trans>\n                  </strong>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.intro\">\n                    You can allow/exclude which sets you want the builder to\n                    consider. In the following examples, <strong>A</strong> is\n                    on-set, and <strong>R</strong> is rainbow(off-set)\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.2set\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 2-Set\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude 2-Set builds:{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AA\n                      </ColorText>\n                      RRR\n                    </strong>{' '}\n                    and{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AAA\n                      </ColorText>\n                      RR\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.4set\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 4-Set\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude 4-Set builds:{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AAAA\n                      </ColorText>\n                      R\n                    </strong>{' '}\n                    and{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AAAAA\n                      </ColorText>\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.2rain\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 3-Rainbow\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude 2-Set + 3-Rainbow builds:{' '}\n                    <strong>\n                      AA\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        RRR\n                      </ColorText>\n                    </strong>{' '}\n                    and{' '}\n                    <strong>\n                      AAA\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        RR\n                      </ColorText>\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.4rain\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 5-Rainbow\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude full 5-Rainbow builds:{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        RRRRR\n                      </ColorText>\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n              </CardContent>\n            </CardLight>\n            <Grid\n              container\n              columns={{ xs: 2, lg: 3 }}\n              sx={{ mb: 1 }}\n              spacing={1}\n            >\n              <Grid item xs={1}>\n                <AllSetAllowExcludeCard\n                  allowTotal={allowTotals['2']}\n                  setNum={2}\n                  setAllExclusion={setAllExclusion}\n                />\n              </Grid>\n              <Grid item xs={1}>\n                <AllSetAllowExcludeCard\n                  allowTotal={allowTotals['4']}\n                  setNum={4}\n                  setAllExclusion={setAllExclusion}\n                />\n              </Grid>\n              <Grid item xs={1}>\n                <CardLight>\n                  <CardContent>\n                    <Typography gutterBottom>\n                      <strong>\n                        <Trans t={t} i18nKey=\"artSetConfig.alExRainbow\">\n                          <ColorText color=\"success\">\n                            Allow <ShowChartIcon {...iconInlineProps} />\n                          </ColorText>{' '}\n                          /{' '}\n                          <ColorText color=\"secondary\" variant=\"light\">\n                            Exclude <BlockIcon {...iconInlineProps} />\n                          </ColorText>{' '}\n                          Rainbow Builds\n                        </Trans>\n                      </strong>\n                    </Typography>\n                    <Box\n                      sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n                    >\n                      <Button\n                        fullWidth\n                        onClick={() =>\n                          buildSettingDispatch({\n                            artSetExclusion: handleArtSetExclusion(\n                              artSetExclusion,\n                              'rainbow',\n                              2\n                            ),\n                          })\n                        }\n                        color={allowRainbow2 ? 'success' : 'secondary'}\n                        startIcon={\n                          !allowRainbow2 ? (\n                            <CheckBoxOutlineBlank />\n                          ) : (\n                            <CheckBox />\n                          )\n                        }\n                        endIcon={\n                          allowRainbow2 ? <ShowChartIcon /> : <BlockIcon />\n                        }\n                      >{t`artSetConfig.2rainbow`}</Button>\n                      <Button\n                        fullWidth\n                        onClick={() =>\n                          buildSettingDispatch({\n                            artSetExclusion: handleArtSetExclusion(\n                              artSetExclusion,\n                              'rainbow',\n                              4\n                            ),\n                          })\n                        }\n                        color={allowRainbow4 ? 'success' : 'secondary'}\n                        startIcon={\n                          !allowRainbow4 ? (\n                            <CheckBoxOutlineBlank />\n                          ) : (\n                            <CheckBox />\n                          )\n                        }\n                        endIcon={\n                          allowRainbow4 ? <ShowChartIcon /> : <BlockIcon />\n                        }\n                      >{t`artSetConfig.4rainbow`}</Button>\n                    </Box>\n                  </CardContent>\n                </CardLight>\n              </Grid>\n            </Grid>\n            <Grid container spacing={1} columns={{ xs: 2, lg: 3 }}>\n              {artKeys.map((setKey) => (\n                <ArtifactSetCard\n                  key={setKey}\n                  setKey={setKey}\n                  fakeDataContextObj={fakeDataContextObj}\n                  slotCount={artSlotCount[setKey]}\n                />\n              ))}\n            </Grid>\n          </CardContent>\n          <Divider />\n          <CardContent sx={{ py: 1 }}>\n            <CloseButton large onClick={onClose} />\n          </CardContent>\n        </CardDark>\n      </ModalWrapper>\n    </>\n  )\n}\nfunction AllSetAllowExcludeCard({\n  allowTotal,\n  setNum,\n  setAllExclusion,\n}: {\n  allowTotal: string\n  setNum: 2 | 4\n  setAllExclusion: (setNum: 2 | 4, exclude?: boolean) => void\n}) {\n  const { t } = useTranslation(['page_character_optimize', 'sheet'])\n  return (\n    <CardLight>\n      <CardContent>\n        <Typography gutterBottom>\n          <strong>{t(`sheet:${setNum}set`)}</strong>{' '}\n          <SqBadge color=\"success\">\n            {allowTotal} <ShowChartIcon {...iconInlineProps} />{' '}\n            {t('artSetConfig.allowed')}\n          </SqBadge>\n        </Typography>\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n          <Button\n            fullWidth\n            disabled={\n              allowTotal.charAt(0) !== '0' && allowTotal.indexOf('/') === -1\n            }\n            onClick={() => setAllExclusion(setNum, false)}\n            color=\"success\"\n            startIcon={<ShowChartIcon />}\n          >\n            {t(`artSetConfig.allowAll${setNum}set`)}\n          </Button>\n          <Button\n            fullWidth\n            disabled={allowTotal.charAt(0) === '0'}\n            onClick={() => setAllExclusion(setNum, true)}\n            color=\"secondary\"\n            startIcon={<BlockIcon />}\n          >\n            {t(`artSetConfig.excludeAll${setNum}set`)}\n          </Button>\n        </Box>\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction ArtifactSetCard({\n  setKey,\n  fakeDataContextObj,\n  slotCount,\n}: {\n  setKey: ArtifactSetKey\n  fakeDataContextObj: dataContextObj\n  slotCount: Record<ArtifactSlotKey, number>\n}) {\n  const { t } = useTranslation('sheet')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { buildSetting, buildSettingDispatch } = useBuildSetting(characterKey)\n  const { artSetExclusion } = buildSetting\n  const setExclusionSet = artSetExclusion?.[setKey] ?? []\n  const allow4 = !setExclusionSet.includes(4)\n  const slots = getNumSlots(slotCount)\n  const sheet = getArtSheet(setKey)\n  /* Assumes that all conditionals are from 4-Set. needs to change if there are 2-Set conditionals */\n  const set4CondNums = useMemo(() => {\n    if (!allow4) return []\n    return Object.keys(sheet.setEffects).filter((setNumKey) =>\n      sheet.setEffects[setNumKey]?.document.some((doc) => 'states' in doc)\n    )\n  }, [sheet.setEffects, allow4])\n  const exclude2 = setExclusionSet.includes(2)\n  const exclude4 = setExclusionSet.includes(4)\n  return (\n    <Grid item key={setKey} xs={1}>\n      <CardLight\n        sx={{ height: '100%', opacity: slots < 2 ? '50%' : undefined }}\n      >\n        <Box\n          className={`grad-${sheet.rarity[0]}star`}\n          width=\"100%\"\n          sx={{ display: 'flex' }}\n        >\n          <Box\n            component=\"img\"\n            src={artifactDefIcon(setKey)}\n            sx={{ height: 100, width: 'auto', mx: -1 }}\n          />\n          <Box\n            sx={{\n              flexGrow: 1,\n              px: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              justifyContent: 'center',\n            }}\n          >\n            <Typography variant=\"h6\">{sheet.name ?? ''}</Typography>\n            <Box>\n              {/* If there is ever a 2-Set conditional, we will need to change this */}\n              <Typography variant=\"subtitle1\">\n                {sheet.rarity.map((ns, i) => (\n                  <Box\n                    component=\"span\"\n                    sx={{ display: 'inline-flex', alignItems: 'center' }}\n                    key={ns}\n                  >\n                    {ns} <StarRoundedIcon fontSize=\"inherit\" />{' '}\n                    {i < sheet.rarity.length - 1 ? '/ ' : null}\n                  </Box>\n                ))}{' '}\n                <InfoTooltipInline\n                  title={\n                    <Box>\n                      <Typography>\n                        <SqBadge color=\"success\">{t`2set`}</SqBadge>\n                      </Typography>\n                      <Typography>\n                        <Translate\n                          ns={`artifact_${setKey}_gen`}\n                          key18={'setEffects.2'}\n                        />\n                      </Typography>\n                      <Box\n                        paddingTop={2}\n                        sx={{ opacity: setExclusionSet.includes(4) ? 0.6 : 1 }}\n                      >\n                        <Typography>\n                          <SqBadge color=\"success\">{t`4set`}</SqBadge>\n                        </Typography>\n                        <Typography>\n                          <Translate\n                            ns={`artifact_${setKey}_gen`}\n                            key18={'setEffects.4'}\n                          />\n                        </Typography>\n                      </Box>\n                    </Box>\n                  }\n                />\n              </Typography>\n            </Box>\n            <Box sx={{ display: 'flex', gap: 1 }}>\n              {Object.entries(slotCount).map(([slotKey, count]) => (\n                <Typography\n                  key={slotKey}\n                  sx={{ flexGrow: 1 }}\n                  variant=\"subtitle2\"\n                >\n                  <SqBadge\n                    sx={{ width: '100%' }}\n                    color={count ? 'primary' : 'secondary'}\n                  >\n                    <SlotIcon slotKey={slotKey} iconProps={iconInlineProps} />{' '}\n                    {count}\n                  </SqBadge>\n                </Typography>\n              ))}\n            </Box>\n          </Box>\n        </Box>\n        <ButtonGroup sx={{ '.MuiButton-root': { borderRadius: 0 } }} fullWidth>\n          <Button\n            startIcon={exclude2 ? <CheckBoxOutlineBlank /> : <CheckBox />}\n            onClick={() =>\n              buildSettingDispatch({\n                artSetExclusion: handleArtSetExclusion(\n                  artSetExclusion,\n                  setKey,\n                  2\n                ),\n              })\n            }\n            color={exclude2 ? 'secondary' : 'success'}\n            endIcon={exclude2 ? <BlockIcon /> : <ShowChartIcon />}\n          >{t`2set`}</Button>\n          <Button\n            startIcon={exclude4 ? <CheckBoxOutlineBlank /> : <CheckBox />}\n            onClick={() =>\n              buildSettingDispatch({\n                artSetExclusion: handleArtSetExclusion(\n                  artSetExclusion,\n                  setKey,\n                  4\n                ),\n              })\n            }\n            color={exclude4 ? 'secondary' : 'success'}\n            endIcon={exclude4 ? <BlockIcon /> : <ShowChartIcon />}\n          >{t`4set`}</Button>\n        </ButtonGroup>\n\n        {!!set4CondNums.length && (\n          <DataContext.Provider value={fakeDataContextObj}>\n            <CardContent\n              sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}\n            >\n              {set4CondNums.map((setNumKey) => (\n                <SetEffectDisplay\n                  key={setNumKey}\n                  setKey={setKey}\n                  setNumKey={parseInt(setNumKey) as SetNum}\n                  hideHeader\n                  conditionalsOnly\n                />\n              ))}\n            </CardContent>\n          </DataContext.Provider>\n        )}\n      </CardLight>\n    </Grid>\n  )\n}\n\nfunction getNumSlots(slotCount: Record<string, number>): number {\n  return Object.values(slotCount).reduce((tot, v) => tot + (v ? 1 : 0), 0)\n}\n","import { MenuItem } from '@mui/material'\nimport { useTranslation } from 'react-i18next'\nimport DropdownButton from '../../../../../Components/DropdownMenu/DropdownButton'\n\nconst levels = [0, 4, 8, 12, 16, 20] as const\nexport default function AssumeFullLevelToggle({\n  mainStatAssumptionLevel = 0,\n  setmainStatAssumptionLevel,\n  disabled,\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  return (\n    <DropdownButton\n      fullWidth\n      color={mainStatAssumptionLevel ? 'success' : 'primary'}\n      disabled={disabled}\n      title={\n        mainStatAssumptionLevel\n          ? t('mainStat.assumptionLvl.lvl', { lvl: mainStatAssumptionLevel })\n          : t('mainStat.assumptionLvl.no')\n      }\n    >\n      {levels.map((lvl) => (\n        <MenuItem key={lvl} onClick={() => setmainStatAssumptionLevel(lvl)}>\n          {lvl\n            ? t('mainStat.assumptionLvl.lvl', { lvl })\n            : t('mainStat.assumptionLvl.no')}\n        </MenuItem>\n      ))}\n    </DropdownButton>\n  )\n}\n","import { CardContent, Divider, Typography } from '@mui/material'\nimport { useContext } from 'react'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport { NodeFieldDisplay } from '../../../../../Components/FieldDisplay'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport { uiInput as input } from '../../../../../Formula'\nimport type { NumNode } from '../../../../../Formula/type'\nimport { useTranslation } from 'react-i18next'\n\nexport default function BonusStatsCard() {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { bonusStats },\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const bonusStatsKeys = Object.keys(bonusStats)\n  if (!bonusStatsKeys.length) return null\n  const nodes = bonusStatsKeys.map((k) =>\n    data.get(input.customBonus[k] as NumNode)\n  )\n  return (\n    <CardLight>\n      <CardContent>\n        <Typography\n          sx={{ fontWeight: 'bold' }}\n        >{t`bonusStats.title`}</Typography>\n      </CardContent>\n      <Divider />\n      <CardContent>\n        {nodes.map((n) => (\n          <NodeFieldDisplay key={JSON.stringify(n.info)} node={n} />\n        ))}\n      </CardContent>\n    </CardLight>\n  )\n}\n","import { Alert, Grid, LinearProgress, styled, Typography } from '@mui/material'\nimport type { ReactNode } from 'react'\nimport { timeStringMs } from '../../../../../Util/TimeUtil'\n\nexport const warningBuildNumber = 10000000\nexport type BuildStatus = {\n  type: 'active' | 'inactive'\n  tested: number // tested, including `failed`\n  failed: number // tested but fail the filter criteria, e.g., not enough EM\n  skipped: number\n  total: number\n  startTime?: number\n  finishTime?: number\n}\n\nconst Monospace = styled('strong')({\n  fontFamily: 'monospace',\n})\n\nconst BorderLinearProgress = styled(LinearProgress)(() => ({\n  height: 10,\n  borderRadius: 5,\n}))\nexport default function BuildAlert({\n  status: { type, tested, failed: _, skipped, total, startTime, finishTime },\n  characterName,\n}: {\n  status: BuildStatus\n  characterName: Displayable\n}) {\n  const hasTotal = isFinite(total)\n\n  const generatingBuilds = type !== 'inactive'\n  const unskipped = total - skipped\n\n  const testedString = <Monospace>{tested.toLocaleString()}</Monospace>\n  const unskippedString = <Monospace>{unskipped.toLocaleString()}</Monospace>\n  const skippedText = !!skipped && (\n    <span>\n      (<b>{<Monospace>{skipped.toLocaleString()}</Monospace>}</b> skipped)\n    </span>\n  )\n\n  const durationString = (\n    <Monospace>\n      {timeStringMs(\n        Math.round((finishTime ?? performance.now()) - (startTime ?? NaN))\n      )}\n    </Monospace>\n  )\n\n  const color = 'success' as 'success' | 'warning' | 'error'\n  let title = '' as ReactNode\n  let subtitle = '' as ReactNode\n  let progress = undefined as undefined | number\n\n  if (generatingBuilds) {\n    progress = (tested * 100) / unskipped\n    title = (\n      <Typography>\n        Generating and testing {testedString}\n        {hasTotal ? <>/{unskippedString}</> : undefined} build configurations\n        against the criteria for <b>{characterName}</b>. {skippedText}\n      </Typography>\n    )\n    subtitle = <Typography>Time elapsed: {durationString}</Typography>\n  } else if (tested + skipped) {\n    progress = 100\n    title = (\n      <Typography>\n        Generated and tested {testedString} Build configurations against the\n        criteria for <b>{characterName}</b>. {skippedText}\n      </Typography>\n    )\n    subtitle = <Typography>Total duration: {durationString}</Typography>\n  } else {\n    return null\n  }\n\n  return (\n    <Alert\n      severity={color}\n      variant=\"filled\"\n      sx={{\n        '& .MuiAlert-message': {\n          flexGrow: 1,\n        },\n      }}\n    >\n      {title}\n      {subtitle}\n      {progress !== undefined && (\n        <Grid container spacing={1} alignItems=\"center\">\n          {hasTotal && (\n            <Grid item>\n              <Typography>{`${progress.toFixed(1)}%`}</Typography>\n            </Grid>\n          )}\n          <Grid item flexGrow={1}>\n            <BorderLinearProgress\n              variant={hasTotal ? 'determinate' : 'indeterminate'}\n              value={progress}\n              color=\"primary\"\n            />\n          </Grid>\n        </Grid>\n      )}\n    </Alert>\n  )\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { Typography } from '@mui/material'\nimport { getCharSheet } from '../../Data/Characters'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\nimport BootstrapTooltip from '../BootstrapTooltip'\nimport CharIconSide from '../Image/CharIconSide'\n\nexport default function LocationIcon({\n  characterKey,\n}: {\n  characterKey: CharacterKey\n}) {\n  const { gender } = useDBMeta()\n  const characterSheet = getCharSheet(characterKey, gender)\n  if (!characterSheet) return null\n  return (\n    <BootstrapTooltip\n      placement=\"right-end\"\n      title={<Typography>{characterSheet.name}</Typography>}\n    >\n      <CharIconSide characterKey={characterKey} sideMargin />\n    </BootstrapTooltip>\n  )\n}\n","import { Box } from '@mui/material'\nimport type { StatKey } from '../KeyMap'\nimport KeyMap from '../KeyMap'\nimport StatIcon from '../KeyMap/StatIcon'\nimport { iconInlineProps } from '../SVGIcons'\nimport ColorText from './ColoredText'\n\nexport function StatWithUnit({\n  statKey,\n  disableIcon = false,\n}: {\n  statKey: StatKey\n  disableIcon?: boolean\n}) {\n  return (\n    <Box component=\"span\" display=\"flex\" alignItems=\"center\" gap={1}>\n      {!disableIcon && (\n        <StatIcon statKey={statKey} iconProps={iconInlineProps} />\n      )}\n      <span>\n        {KeyMap.get(statKey)}\n        {KeyMap.unit(statKey)}\n      </span>\n    </Box>\n  )\n}\nexport function StatColoredWithUnit({\n  statKey,\n  disableIcon = false,\n}: {\n  statKey: StatKey\n  disableIcon?: boolean\n}) {\n  return (\n    <ColorText color={KeyMap.getVariant(statKey)}>\n      <StatWithUnit statKey={statKey} disableIcon={disableIcon} />\n    </ColorText>\n  )\n}\n","import { artifactAsset } from '@genshin-optimizer/g-assets'\nimport { BusinessCenter } from '@mui/icons-material'\nimport {\n  alpha,\n  Box,\n  CardActionArea,\n  Chip,\n  Typography,\n  useTheme,\n} from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport Assets from '../../Assets/Assets'\nimport Artifact from '../../Data/Artifacts/Artifact'\nimport { DatabaseContext } from '../../Database/Database'\nimport KeyMap, { cacheValueString } from '../../KeyMap'\nimport StatIcon from '../../KeyMap/StatIcon'\nimport useArtifact from '../../ReactHooks/useArtifact'\nimport type { ICachedSubstat } from '../../Types/artifact'\nimport type { ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport { allElementWithPhyKeys } from '@genshin-optimizer/consts'\nimport { clamp } from '../../Util/Util'\nimport BootstrapTooltip from '../BootstrapTooltip'\nimport CardDark from '../Card/CardDark'\nimport LocationIcon from '../Character/LocationIcon'\nimport ColorText from '../ColoredText'\nimport ConditionalWrapper from '../ConditionalWrapper'\nimport { StatColoredWithUnit } from '../StatDisplay'\nimport ArtifactTooltip from './ArtifactTooltip'\n\ntype Data = {\n  artifactId?: string\n  slotKey: ArtifactSlotKey\n  mainStatAssumptionLevel?: number\n  onClick?: () => void\n  showLocation?: boolean\n  BGComponent?: React.ElementType\n}\n\nexport default function ArtifactCardNano({\n  artifactId,\n  slotKey: pSlotKey,\n  mainStatAssumptionLevel = 0,\n  showLocation = false,\n  onClick,\n  BGComponent = CardDark,\n}: Data) {\n  const art = useArtifact(artifactId)\n  const { database } = useContext(DatabaseContext)\n  const actionWrapperFunc = useCallback(\n    (children) => (\n      <CardActionArea onClick={onClick} sx={{ height: '100%' }}>\n        {children}\n      </CardActionArea>\n    ),\n    [onClick]\n  )\n  const theme = useTheme()\n  if (!art)\n    return (\n      <BGComponent\n        sx={{\n          display: 'flex',\n          height: '100%',\n          alignItems: 'center',\n          justifyContent: 'center',\n        }}\n      >\n        <Box\n          component=\"img\"\n          src={Assets.slot[pSlotKey]}\n          sx={{ width: '25%', height: 'auto', opacity: 0.7 }}\n        />\n      </BGComponent>\n    )\n\n  const { slotKey, rarity, level, mainStatKey, substats, location } = art\n  const mainStatLevel = Math.max(\n    Math.min(mainStatAssumptionLevel, rarity * 4),\n    level\n  )\n  const mainStatUnit = KeyMap.unit(mainStatKey)\n  const element = allElementWithPhyKeys.find((ele) =>\n    art.mainStatKey.includes(ele)\n  )\n  const color = element\n    ? alpha(theme.palette[element].main, 0.6)\n    : alpha(theme.palette.secondary.main, 0.6)\n  return (\n    <BGComponent sx={{ height: '100%' }}>\n      <ConditionalWrapper condition={!!onClick} wrapper={actionWrapperFunc}>\n        <Box display=\"flex\" height=\"100%\">\n          <Box\n            className={`grad-${rarity}star`}\n            sx={{\n              position: 'relative',\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n          >\n            <ArtifactTooltip art={art}>\n              <Box\n                component=\"img\"\n                src={artifactAsset(art.setKey, slotKey)}\n                sx={{ m: -1, maxHeight: '110%', maxWidth: '110%' }}\n              />\n            </ArtifactTooltip>\n            <Box\n              sx={{\n                position: 'absolute',\n                width: '100%',\n                height: '100%',\n                p: 0.5,\n                opacity: 0.85,\n                display: 'flex',\n                justifyContent: 'space-between',\n                pointerEvents: 'none',\n              }}\n            >\n              <Chip\n                size=\"small\"\n                label={<strong>{` +${level}`}</strong>}\n                color={Artifact.levelVariant(level)}\n              />\n              {showLocation && (\n                <Chip\n                  size=\"small\"\n                  label={\n                    location ? (\n                      <LocationIcon\n                        characterKey={\n                          location &&\n                          database.chars.LocationToCharacterKey(location)\n                        }\n                      />\n                    ) : (\n                      <BusinessCenter />\n                    )\n                  }\n                  color={'secondary'}\n                  sx={{\n                    overflow: 'visible',\n                    '.MuiChip-label': {\n                      overflow: 'visible',\n                    },\n                  }}\n                />\n              )}\n            </Box>\n            {/* mainstats */}\n            <Chip\n              size=\"small\"\n              sx={{\n                position: 'absolute',\n                bottom: 0,\n                mb: 1,\n                backgroundColor: color,\n                p: 1,\n              }}\n              icon={\n                <BootstrapTooltip\n                  placement=\"top\"\n                  title={\n                    <Typography>\n                      <StatColoredWithUnit statKey={mainStatKey} />\n                    </Typography>\n                  }\n                  disableInteractive\n                >\n                  <Box lineHeight={0}>\n                    <StatIcon\n                      statKey={mainStatKey}\n                      iconProps={{ style: { padding: '4px' } }}\n                    />\n                  </Box>\n                </BootstrapTooltip>\n              }\n              label={\n                <Typography sx={{ mx: -0.7 }}>\n                  <ColorText\n                    color={mainStatLevel !== level ? 'warning' : undefined}\n                  >\n                    {cacheValueString(\n                      Artifact.mainStatValue(\n                        mainStatKey,\n                        rarity,\n                        mainStatLevel\n                      ) ?? 0,\n                      KeyMap.unit(mainStatKey)\n                    )}\n                    {mainStatUnit}\n                  </ColorText>\n                </Typography>\n              }\n            />\n          </Box>\n          {/* substats */}\n          <Box\n            display=\"flex\"\n            flexDirection=\"column\"\n            justifyContent=\"space-between\"\n            sx={{ p: 1 }}\n          >\n            {substats.map((stat: ICachedSubstat, i: number) => (\n              <SubstatDisplay key={i + stat.key} stat={stat} />\n            ))}\n          </Box>\n        </Box>\n      </ConditionalWrapper>\n    </BGComponent>\n  )\n}\nfunction SubstatDisplay({ stat }: { stat: ICachedSubstat }) {\n  if (!stat.value) return null\n  const numRolls = stat.rolls?.length ?? 0\n  const rollColor = `roll${clamp(numRolls, 1, 6)}`\n  const unit = KeyMap.unit(stat.key)\n  return (\n    <Box display=\"flex\" gap={1} alignContent=\"center\">\n      <Typography\n        sx={{ flexGrow: 1, display: 'flex', gap: 0.5, alignItems: 'center' }}\n        color={(numRolls ? `${rollColor}.main` : 'error.main') as any}\n        component=\"span\"\n      >\n        <BootstrapTooltip\n          placement=\"top\"\n          title={\n            <Typography>\n              {stat.key && <StatColoredWithUnit statKey={stat.key} />}\n            </Typography>\n          }\n          disableInteractive\n        >\n          <Box lineHeight={0}>\n            <StatIcon statKey={stat.key} iconProps={{ fontSize: 'inherit' }} />\n          </Box>\n        </BootstrapTooltip>\n        <span>{`${cacheValueString(\n          stat.value,\n          KeyMap.unit(stat.key)\n        )}${unit}`}</span>\n      </Typography>\n    </Box>\n  )\n}\n","import { Masonry } from '@mui/lab'\nimport { Box, Divider, ListItem } from '@mui/material'\nimport { useContext, useMemo } from 'react'\nimport { DataContext } from '../../Context/DataContext'\nimport { OptimizationTargetContext } from '../../Context/OptimizationTargetContext'\nimport { DatabaseContext } from '../../Database/Database'\nimport { getDisplayHeader, getDisplaySections } from '../../Formula/DisplayUtil'\nimport type { DisplaySub } from '../../Formula/type'\nimport type { NodeDisplay } from '../../Formula/uiData'\nimport { customRead } from '../../Formula/utils'\nimport { objectMap } from '../../Util/Util'\nimport CardDark from '../Card/CardDark'\nimport CardHeaderCustom from '../Card/CardHeaderCustom'\nimport { FieldDisplayList, NodeFieldDisplay } from '../FieldDisplay'\nimport ImgIcon from '../Image/ImgIcon'\nimport SqBadge from '../SqBadge'\n\nexport default function StatDisplayComponent() {\n  const { data } = useContext(DataContext)\n  const sections = useMemo(\n    () =>\n      getDisplaySections(data).filter(([, ns]) =>\n        Object.values(ns).some((n) => !n.isEmpty)\n      ),\n    [data]\n  )\n  return (\n    <Box sx={{ mr: -1, mb: -1 }}>\n      <Masonry columns={{ xs: 1, sm: 2, md: 3, xl: 4 }} spacing={1}>\n        {sections.map(([key, Nodes]) => (\n          <Section key={key} displayNs={Nodes} sectionKey={key} />\n        ))}\n      </Masonry>\n    </Box>\n  )\n}\n\nfunction Section({\n  displayNs,\n  sectionKey,\n}: {\n  displayNs: DisplaySub<NodeDisplay>\n  sectionKey: string\n}) {\n  const optimizationTarget = useContext(OptimizationTargetContext)\n  const { data, oldData } = useContext(DataContext)\n  const { database } = useContext(DatabaseContext)\n  const header = useMemo(\n    () => getDisplayHeader(data, sectionKey, database),\n    [database, data, sectionKey]\n  )\n  const displayNsReads = useMemo(\n    () =>\n      objectMap(displayNs, (n, nodeKey) =>\n        customRead(['display', sectionKey, nodeKey])\n      ),\n    [displayNs, sectionKey]\n  )\n  if (!header) return <CardDark></CardDark>\n\n  const { title, icon, action } = header\n  return (\n    <CardDark>\n      <CardHeaderCustom\n        avatar={icon && <ImgIcon size={2} src={icon} />}\n        title={title}\n        action={action && <SqBadge>{action}</SqBadge>}\n      />\n      <Divider />\n      <FieldDisplayList sx={{ m: 0 }}>\n        {Object.entries(displayNs).map(([nodeKey, n]) => (\n          <NodeFieldDisplay\n            key={nodeKey}\n            node={n}\n            oldValue={\n              oldData ? oldData.get(displayNsReads[nodeKey]!).value : undefined\n            }\n            component={ListItem}\n            emphasize={\n              JSON.stringify(optimizationTarget) ===\n              JSON.stringify([sectionKey, nodeKey])\n            }\n          />\n        ))}\n      </FieldDisplayList>\n    </CardDark>\n  )\n}\n","import { weaponAsset } from '@genshin-optimizer/g-assets'\nimport { BusinessCenter } from '@mui/icons-material'\nimport { Box, CardActionArea, Chip, Skeleton, Typography } from '@mui/material'\nimport { useCallback, useContext, useMemo } from 'react'\nimport { getWeaponSheet } from '../../Data/Weapons'\nimport WeaponSheet from '../../Data/Weapons/WeaponSheet'\nimport { DatabaseContext } from '../../Database/Database'\nimport { input } from '../../Formula'\nimport { computeUIData, dataObjForWeapon } from '../../Formula/api'\nimport type { NodeDisplay } from '../../Formula/uiData'\nimport { nodeVStr } from '../../Formula/uiData'\nimport useWeapon from '../../ReactHooks/useWeapon'\nimport BootstrapTooltip from '../BootstrapTooltip'\nimport CardDark from '../Card/CardDark'\nimport LocationIcon from '../Character/LocationIcon'\nimport ConditionalWrapper from '../ConditionalWrapper'\nimport WeaponNameTooltip from './WeaponNameTooltip'\n\ntype Data = {\n  weaponId?: string\n  onClick?: () => void\n  showLocation?: boolean\n  BGComponent?: React.ElementType\n}\n\nexport default function WeaponCardNano({\n  weaponId,\n  showLocation = false,\n  onClick,\n  BGComponent = CardDark,\n}: Data) {\n  const { database } = useContext(DatabaseContext)\n  const weapon = useWeapon(weaponId)\n  const weaponSheet = weapon?.key && getWeaponSheet(weapon.key)\n  const actionWrapperFunc = useCallback(\n    (children) => (\n      <CardActionArea sx={{ height: '100%' }} onClick={onClick}>\n        {children}\n      </CardActionArea>\n    ),\n    [onClick]\n  )\n  const UIData = useMemo(\n    () =>\n      weaponSheet &&\n      weapon &&\n      computeUIData([weaponSheet.data, dataObjForWeapon(weapon)]),\n    [weaponSheet, weapon]\n  )\n  if (!weapon || !weaponSheet || !UIData)\n    return (\n      <BGComponent sx={{ height: '100%' }}>\n        <Skeleton\n          variant=\"rectangular\"\n          sx={{ width: '100%', height: '100%' }}\n        />\n      </BGComponent>\n    )\n  const { refinement, location } = weapon\n  return (\n    <BGComponent sx={{ height: '100%' }}>\n      <ConditionalWrapper condition={!!onClick} wrapper={actionWrapperFunc}>\n        <Box display=\"flex\" height=\"100%\" alignItems=\"stretch\">\n          <Box\n            className={`grad-${weaponSheet.rarity}star`}\n            sx={{\n              height: '100%',\n              position: 'relative',\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'flex-end',\n            }}\n          >\n            <WeaponNameTooltip sheet={weaponSheet}>\n              <Box\n                component=\"img\"\n                src={weaponAsset(weapon.key, weapon.ascension >= 2)}\n                sx={{ mx: -1, maxHeight: '100%', maxWidth: '100%' }}\n              />\n            </WeaponNameTooltip>\n            <Box\n              sx={{\n                position: 'absolute',\n                width: '100%',\n                height: '100%',\n                p: 0.5,\n                opacity: 0.85,\n                display: 'flex',\n                justifyContent: 'space-between',\n                pointerEvents: 'none',\n              }}\n            >\n              <Chip\n                size=\"small\"\n                label={<strong>{WeaponSheet.getLevelString(weapon)}</strong>}\n                color=\"primary\"\n              />\n              {showLocation && (\n                <Chip\n                  size=\"small\"\n                  label={\n                    location ? (\n                      <LocationIcon\n                        characterKey={database.chars.LocationToCharacterKey(\n                          location\n                        )}\n                      />\n                    ) : (\n                      <BusinessCenter />\n                    )\n                  }\n                  color={'secondary'}\n                  sx={{\n                    overflow: 'visible',\n                    '.MuiChip-label': {\n                      overflow: 'visible',\n                    },\n                  }}\n                />\n              )}\n            </Box>\n            <Box\n              sx={{\n                position: 'absolute',\n                width: '100%',\n                height: '100%',\n                p: 0.5,\n                opacity: 0.85,\n                display: 'flex',\n                justifyContent: 'flex-end',\n                alignItems: 'flex-end',\n              }}\n            >\n              {weaponSheet.hasRefinement && (\n                <Chip\n                  size=\"small\"\n                  color=\"info\"\n                  label={<strong>R{refinement}</strong>}\n                />\n              )}\n            </Box>\n          </Box>\n          <Box display=\"flex\" flexDirection=\"column\" sx={{ p: 1 }}>\n            <WeaponStat node={UIData.get(input.weapon.main)} />\n            <WeaponStat node={UIData.get(input.weapon.sub)} />\n          </Box>\n        </Box>\n      </ConditionalWrapper>\n    </BGComponent>\n  )\n}\nfunction WeaponStat({ node }: { node: NodeDisplay }) {\n  if (!node.info.name) return null\n  return (\n    <Box display=\"flex\" gap={1} alignContent=\"center\">\n      <Typography\n        sx={{ flexGrow: 1, display: 'flex', gap: 1 }}\n        component=\"span\"\n      >\n        <BootstrapTooltip\n          placement=\"top\"\n          title={<Typography>{node.info.name}</Typography>}\n          disableInteractive\n        >\n          <span>{node.info.icon}</span>\n        </BootstrapTooltip>\n        <span>{nodeVStr(node)}</span>\n      </Typography>\n    </Box>\n  )\n}\n","import type { ArtifactSetKey, ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport { Box, Typography } from '@mui/material'\nimport { useMemo } from 'react'\nimport ArtifactSetTooltip from '../../../../../Components/Artifact/ArtifactSetTooltip'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { getArtSheet } from '../../../../../Data/Artifacts'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport type { ICachedArtifact } from '../../../../../Types/artifact'\n\ntype ArtifactSetBadgesProps = {\n  artifacts: ICachedArtifact[]\n  currentlyEquipped?: boolean\n}\nexport function ArtifactSetBadges({\n  artifacts,\n  currentlyEquipped = false,\n}: ArtifactSetBadgesProps) {\n  const setToSlots: Partial<Record<ArtifactSetKey, ArtifactSlotKey[]>> =\n    useMemo(\n      () =>\n        artifacts\n          .filter((arti) => arti)\n          .reduce((acc, curr) => {\n            acc[curr.setKey]\n              ? acc[curr.setKey].push(curr.slotKey)\n              : (acc[curr.setKey] = [curr.slotKey])\n            return acc\n          }, {}),\n      [artifacts]\n    )\n  return (\n    <>\n      {Object.entries(setToSlots)\n        .sort(\n          ([_k1, slotarr1], [_k2, slotarr2]) =>\n            slotarr2.length - slotarr1.length\n        )\n        .map(([key, slotarr]) => (\n          <ArtifactSetBadge\n            key={key}\n            setKey={key}\n            currentlyEquipped={currentlyEquipped}\n            slotarr={slotarr}\n          />\n        ))}\n    </>\n  )\n}\nfunction ArtifactSetBadge({\n  setKey,\n  currentlyEquipped = false,\n  slotarr,\n}: {\n  setKey: ArtifactSetKey\n  currentlyEquipped: boolean\n  slotarr: ArtifactSlotKey[]\n}) {\n  const artifactSheet = getArtSheet(setKey)\n  const numInSet = slotarr.length\n  const setActive = Object.keys(artifactSheet.setEffects)\n    .map((setKey) => parseInt(setKey))\n    .filter((setNum) => setNum <= numInSet)\n  return (\n    <Box>\n      <ArtifactSetTooltip artifactSheet={artifactSheet} numInSet={numInSet}>\n        <SqBadge\n          sx={{ height: '100%' }}\n          color={currentlyEquipped ? 'success' : 'primary'}\n        >\n          <Typography>\n            {slotarr.map((slotKey) => (\n              <SlotIcon\n                key={slotKey}\n                slotKey={slotKey}\n                iconProps={iconInlineProps}\n              />\n            ))}{' '}\n            {artifactSheet.name ?? ''}\n            {setActive.map((n, i) => (\n              <SqBadge sx={{ ml: 0.5 }} key={'' + n + i} color=\"success\">\n                {n}\n              </SqBadge>\n            ))}\n          </Typography>\n        </SqBadge>\n      </ArtifactSetTooltip>\n    </Box>\n  )\n}\n","import type { LocationCharacterKey } from '@genshin-optimizer/consts'\nimport {\n  allArtifactSlotKeys,\n  charKeyToLocCharKey,\n} from '@genshin-optimizer/consts'\nimport { Checkroom, ChevronRight } from '@mui/icons-material'\nimport BlockIcon from '@mui/icons-material/Block'\nimport CheckBoxIcon from '@mui/icons-material/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank'\nimport ShowChartIcon from '@mui/icons-material/ShowChart'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport { Suspense, useCallback, useContext, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport ArtifactCardNano from '../../../../../Components/Artifact/ArtifactCardNano'\nimport BootstrapTooltip from '../../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport StatDisplayComponent from '../../../../../Components/Character/StatDisplayComponent'\nimport ColorText from '../../../../../Components/ColoredText'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport WeaponCardNano from '../../../../../Components/Weapon/WeaponCardNano'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport { getCharSheet } from '../../../../../Data/Characters'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport type { AllowLocationsState } from '../../../../../Database/DataManagers/BuildSettingData'\nimport { uiInput as input } from '../../../../../Formula'\nimport ArtifactCard from '../../../../../PageArtifact/ArtifactCard'\nimport type { ICachedArtifact } from '../../../../../Types/artifact'\nimport { toggleArr } from '../../../../../Util/Util'\nimport useBuildSetting from '../useBuildSetting'\nimport { ArtifactSetBadges } from './ArtifactSetBadges'\n\ntype NewOld = {\n  newId: string\n  oldId?: string\n}\n\ntype BuildDisplayItemProps = {\n  label?: Displayable\n  compareBuild: boolean\n  disabled?: boolean\n  extraButtonsRight?: JSX.Element\n  extraButtonsLeft?: JSX.Element\n}\n//for displaying each artifact build\nexport default function BuildDisplayItem({\n  label,\n  compareBuild,\n  extraButtonsRight,\n  extraButtonsLeft,\n  disabled,\n}: BuildDisplayItemProps) {\n  const {\n    character: { key: characterKey, equippedArtifacts },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { mainStatAssumptionLevel, allowLocationsState },\n  } = useBuildSetting(characterKey)\n  const { database } = useContext(DatabaseContext)\n  const dataContext = useContext(DataContext)\n\n  const { data, oldData } = dataContext\n  const [newOld, setNewOld] = useState(undefined as NewOld | undefined)\n  const close = useCallback(() => setNewOld(undefined), [setNewOld])\n\n  const equipBuild = useCallback(() => {\n    if (!window.confirm('Do you want to equip this build to this character?'))\n      return\n    const char = database.chars.get(characterKey)\n    if (!char) return\n    allArtifactSlotKeys.forEach((s) => {\n      const aid = data.get(input.art[s].id).value\n      if (aid)\n        database.arts.set(aid, { location: charKeyToLocCharKey(characterKey) })\n      else {\n        const oldAid = char.equippedArtifacts[s]\n        if (oldAid && database.arts.get(oldAid))\n          database.arts.set(oldAid, { location: '' })\n      }\n    })\n    const weapon = data.get(input.weapon.id).value\n    if (weapon)\n      database.weapons.set(weapon, {\n        location: charKeyToLocCharKey(characterKey),\n      })\n  }, [characterKey, data, database])\n\n  const statProviderContext = useMemo(() => {\n    const dataContext_ = { ...dataContext }\n    if (!compareBuild) dataContext_.oldData = undefined\n    return dataContext_\n  }, [dataContext, compareBuild])\n\n  const artifactIdsBySlot = useMemo(\n    () =>\n      Object.fromEntries(\n        allArtifactSlotKeys.map((slotKey) => [\n          slotKey,\n          data.get(input.art[slotKey].id).value,\n        ])\n      ),\n    [data]\n  )\n  const artifacts = useMemo(\n    () =>\n      artifactIdsBySlot &&\n      (Object.values(artifactIdsBySlot)\n        .map((artiId: string) => database.arts.get(artiId))\n        .filter((arti) => arti) as ICachedArtifact[]),\n    [artifactIdsBySlot, database.arts]\n  )\n\n  // Memoize Arts because of its dynamic onClick\n  const artNanos = useMemo(\n    () =>\n      allArtifactSlotKeys.map((slotKey) => (\n        <Grid item xs={1} key={slotKey}>\n          <ArtifactCardNano\n            showLocation\n            slotKey={slotKey}\n            artifactId={artifactIdsBySlot[slotKey]}\n            mainStatAssumptionLevel={mainStatAssumptionLevel}\n            onClick={() => {\n              const oldId = equippedArtifacts[slotKey]\n              const newId = artifactIdsBySlot[slotKey]!\n              setNewOld({ oldId: oldId !== newId ? oldId : undefined, newId })\n            }}\n          />\n        </Grid>\n      )),\n    [setNewOld, equippedArtifacts, mainStatAssumptionLevel, artifactIdsBySlot]\n  )\n\n  if (!oldData) return null\n  const currentlyEquipped =\n    allArtifactSlotKeys.every(\n      (slotKey) =>\n        artifactIdsBySlot[slotKey] === oldData.get(input.art[slotKey].id).value\n    ) && data.get(input.weapon.id).value === oldData.get(input.weapon.id).value\n\n  return (\n    <CardLight>\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={600} />}\n      >\n        {newOld && (\n          <CompareArtifactModal\n            newOld={newOld}\n            mainStatAssumptionLevel={mainStatAssumptionLevel}\n            onClose={close}\n            allowLocationsState={allowLocationsState}\n          />\n        )}\n        <CardContent>\n          <Box display=\"flex\" gap={1} sx={{ pb: 1 }} flexWrap=\"wrap\">\n            {label !== undefined && (\n              <SqBadge color=\"info\">\n                <Typography>\n                  <strong>\n                    {label}\n                    {currentlyEquipped ? ' (Equipped)' : ''}\n                  </strong>\n                </Typography>\n              </SqBadge>\n            )}\n            <ArtifactSetBadges\n              artifacts={artifacts}\n              currentlyEquipped={currentlyEquipped}\n            />\n            <Box\n              sx={{ flexGrow: 1, display: 'flex', justifyContent: 'flex-end' }}\n            />\n            {extraButtonsLeft}\n            <Button\n              size=\"small\"\n              color=\"success\"\n              onClick={equipBuild}\n              disabled={disabled || currentlyEquipped}\n              startIcon={<Checkroom />}\n            >\n              Equip Build\n            </Button>\n            {extraButtonsRight}\n          </Box>\n          <Grid\n            container\n            spacing={1}\n            sx={{ pb: 1 }}\n            columns={{ xs: 2, sm: 3, md: 4, lg: 6 }}\n          >\n            <Grid item xs={1}>\n              <WeaponCardNano\n                showLocation\n                weaponId={data.get(input.weapon.id).value}\n              />\n            </Grid>\n            {artNanos}\n          </Grid>\n          <DataContext.Provider value={statProviderContext}>\n            <StatDisplayComponent />\n          </DataContext.Provider>\n        </CardContent>\n      </Suspense>\n    </CardLight>\n  )\n}\n\nfunction CompareArtifactModal({\n  newOld: { newId, oldId },\n  mainStatAssumptionLevel,\n  onClose,\n  allowLocationsState,\n}: {\n  newOld: NewOld\n  mainStatAssumptionLevel: number\n  onClose: () => void\n  allowLocationsState: AllowLocationsState\n}) {\n  const { database } = useContext(DatabaseContext)\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const onEquip = useCallback(() => {\n    if (\n      !window.confirm('Do you want to equip this artifact to this character?')\n    )\n      return\n    database.arts.set(newId, { location: charKeyToLocCharKey(characterKey) })\n    onClose()\n  }, [newId, database, characterKey, onClose])\n  const newLoc = database.arts.get(newId)?.location ?? ''\n  return (\n    <ModalWrapper\n      open={!!newId}\n      onClose={onClose}\n      containerProps={{ maxWidth: oldId ? 'md' : 'xs' }}\n    >\n      <CardDark>\n        <CardContent\n          sx={{\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'stretch',\n            gap: 2,\n          }}\n        >\n          {oldId && (\n            <Box minWidth={320}>\n              <ArtifactCard\n                artifactId={oldId}\n                mainStatAssumptionLevel={mainStatAssumptionLevel}\n                canEquip\n                editorProps={{ disableSet: true, disableSlot: true }}\n                extraButtons={<ExcludeButton id={oldId} />}\n              />\n            </Box>\n          )}\n          {oldId && <Box display=\"flex\" flexGrow={1} />}\n          {oldId && (\n            <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\">\n              <Button onClick={onEquip} sx={{ display: 'flex' }}>\n                <ChevronRight sx={{ fontSize: 40 }} />\n              </Button>\n            </Box>\n          )}\n          {oldId && <Box display=\"flex\" flexGrow={1} />}\n          <Box minWidth={320} display=\"flex\" flexDirection=\"column\" gap={1}>\n            <ArtifactCard\n              artifactId={newId}\n              mainStatAssumptionLevel={mainStatAssumptionLevel}\n              canEquip\n              editorProps={{ disableSet: true, disableSlot: true }}\n              extraButtons={<ExcludeButton id={newId} />}\n            />\n            {newLoc &&\n              newLoc !== charKeyToLocCharKey(characterKey) &&\n              allowLocationsState !== 'all' && (\n                <ExcludeEquipButton locationKey={newLoc} />\n              )}\n          </Box>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\nfunction ExcludeButton({ id }: { id: string }) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { artExclusion },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const excluded = artExclusion.includes(id)\n  const toggle = useCallback(\n    () => buildSettingDispatch({ artExclusion: toggleArr(artExclusion, id) }),\n    [id, artExclusion, buildSettingDispatch]\n  )\n\n  return (\n    <BootstrapTooltip\n      title={\n        <Box>\n          <Typography>{t`excludeArt.excludeArtifactTip`}</Typography>\n          <Typography>\n            <ColorText color={excluded ? 'error' : 'success'}>\n              {t(excluded ? 'excludeArt.excluded' : 'excludeArt.included')}\n            </ColorText>\n          </Typography>\n        </Box>\n      }\n      placement=\"top\"\n      arrow\n    >\n      <Button\n        onClick={toggle}\n        color={excluded ? 'error' : 'success'}\n        size=\"small\"\n      >\n        {excluded ? <BlockIcon /> : <ShowChartIcon />}\n      </Button>\n    </BootstrapTooltip>\n  )\n}\nfunction ExcludeEquipButton({\n  locationKey,\n}: {\n  locationKey: LocationCharacterKey\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const characterSheet = getCharSheet(\n    database.chars.LocationToCharacterKey(locationKey)\n  )\n  const {\n    buildSetting: { excludedLocations },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const excluded = excludedLocations.includes(locationKey)\n  const toggle = useCallback(\n    () =>\n      buildSettingDispatch({\n        excludedLocations: toggleArr(excludedLocations, locationKey),\n      }),\n    [locationKey, excludedLocations, buildSettingDispatch]\n  )\n\n  return (\n    <Button\n      onClick={toggle}\n      color={excluded ? 'secondary' : 'success'}\n      size=\"small\"\n      startIcon={excluded ? <CheckBoxOutlineBlankIcon /> : <CheckBoxIcon />}\n    >\n      <span>\n        {t`excludeChar.allowEquip`} <strong>{characterSheet.name}</strong>\n      </span>\n    </Button>\n  )\n}\n","import { useCallback, useContext, useEffect, useState } from 'react'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport type { IBuildResult } from '../../../../Database/DataManagers/BuildResult'\nimport type { CharacterKey } from '../../../../Types/consts'\n\nexport default function useBuildResult(characterKey: CharacterKey) {\n  const { database } = useContext(DatabaseContext)\n  const [buildResult, setBuildResult] = useState(() =>\n    database.buildResult.get(characterKey)\n  )\n  useEffect(\n    () => setBuildResult(database.buildResult.get(characterKey)),\n    [database, characterKey]\n  )\n  useEffect(\n    () =>\n      database.buildResult.follow(\n        characterKey,\n        (k, r, v) => r === 'update' && setBuildResult(v)\n      ),\n    [characterKey, setBuildResult, database]\n  )\n  const buildResultDispatch = useCallback(\n    (action: Partial<IBuildResult>) =>\n      characterKey && database.buildResult.set(characterKey, action),\n    [characterKey, database]\n  )\n\n  return { buildResult, buildResultDispatch }\n}\n","import type { DotProps } from 'recharts'\nimport type EnhancedPoint from './EnhancedPoint'\n\ntype CustomShapeType = 'circle' | 'diamond' | 'square'\ntype CustomDotProps = DotProps & {\n  selectedPoint: EnhancedPoint | undefined\n  payload?: EnhancedPoint\n  radiusSelected?: number\n  radiusUnselected?: number\n  colorSelected?: string\n  colorUnselected: string\n  shape?: CustomShapeType\n}\nexport default function CustomDot({\n  cx,\n  cy,\n  payload,\n  selectedPoint,\n  radiusSelected = 6,\n  radiusUnselected = 3,\n  colorSelected = 'red',\n  colorUnselected,\n  shape = 'circle',\n}: CustomDotProps) {\n  if (!cx || !cy || !payload) {\n    return null\n  }\n\n  const isSelected =\n    selectedPoint &&\n    selectedPoint.x === payload.x &&\n    selectedPoint.y === payload.y\n\n  return (\n    <g\n      className=\"custom-dot\"\n      data-chart-x={cx}\n      data-chart-y={cy}\n      data-x-value={payload.x}\n      data-y-value={payload.y}\n      data-radius={isSelected ? radiusUnselected : radiusSelected}\n    >\n      {!isSelected ? (\n        <CustomShape\n          id=\"customShapeUnselected\"\n          shape={shape}\n          cx={cx}\n          cy={cy}\n          r={radiusUnselected}\n          fill={colorUnselected}\n        />\n      ) : (\n        <>\n          <CustomShape\n            id=\"customShapeSelected\"\n            shape={shape}\n            cx={cx}\n            cy={cy}\n            r={radiusSelected / 2}\n            fill={colorSelected}\n          />\n          <CustomShape\n            id=\"customShapeBorder\"\n            shape={shape}\n            cx={cx}\n            cy={cy}\n            r={radiusSelected}\n            fill=\"none\"\n            stroke={colorSelected}\n          />\n        </>\n      )}\n    </g>\n  )\n}\nfunction CustomShape({\n  shape,\n  id,\n  cx,\n  cy,\n  r,\n  fill,\n  stroke,\n}: {\n  shape: CustomShapeType\n  id?: string\n  cx: number\n  cy: number\n  r: number\n  fill?: string\n  stroke?: string\n}) {\n  switch (shape) {\n    case 'circle':\n      return (\n        <circle id={id} cx={cx} cy={cy} r={r} fill={fill} stroke={stroke} />\n      )\n    case 'square':\n      return (\n        <rect\n          id={id}\n          x={cx - r}\n          y={cy - r}\n          width={r * 2}\n          height={r * 2}\n          fill={fill}\n          stroke={stroke}\n        />\n      )\n    case 'diamond':\n      return (\n        <polygon\n          id={id}\n          points={`${cx},${cy + r * 2.5} ${cx + r * 1.5},${cy} ${cx},${\n            cy - r * 2.5\n          } ${cx - r * 1.5},${cy}`}\n          fill={fill}\n          stroke={stroke}\n        />\n      )\n  }\n}\n","import { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport {\n  Button,\n  CardContent,\n  ClickAwayListener,\n  Grid,\n  Skeleton,\n  Stack,\n  Typography,\n} from '@mui/material'\nimport { Suspense, useCallback, useContext, useMemo } from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport type { TooltipProps } from 'recharts'\nimport ArtifactCardPico from '../../../../../../Components/Artifact/ArtifactCardPico'\nimport BootstrapTooltip from '../../../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../../../Components/Card/CardDark'\nimport CloseButton from '../../../../../../Components/CloseButton'\nimport SqBadge from '../../../../../../Components/SqBadge'\nimport { DataContext } from '../../../../../../Context/DataContext'\nimport { DatabaseContext } from '../../../../../../Database/Database'\nimport { input } from '../../../../../../Formula'\nimport type { Unit } from '../../../../../../KeyMap'\nimport { valueString } from '../../../../../../KeyMap'\nimport type { ICachedArtifact } from '../../../../../../Types/artifact'\nimport { ArtifactSetBadges } from '../ArtifactSetBadges'\nimport type EnhancedPoint from './EnhancedPoint'\n\ntype CustomTooltipProps = TooltipProps<number, string> & {\n  xLabel: Displayable\n  xUnit: Unit | undefined\n  yLabel: Displayable\n  yUnit: Unit | undefined\n  selectedPoint: EnhancedPoint | undefined\n  setSelectedPoint: (pt: EnhancedPoint | undefined) => void\n  addBuildToList: (build: string[]) => void\n}\nexport default function CustomTooltip({\n  xLabel,\n  xUnit,\n  yLabel,\n  yUnit,\n  selectedPoint,\n  setSelectedPoint,\n  addBuildToList,\n  ...tooltipProps\n}: CustomTooltipProps) {\n  const { database } = useContext(DatabaseContext)\n  const { data } = useContext(DataContext)\n  const { t } = useTranslation('page_character_optimize')\n\n  const artifactsBySlot: { [slot: string]: ICachedArtifact } = useMemo(\n    () =>\n      selectedPoint &&\n      selectedPoint.artifactIds &&\n      Object.fromEntries(\n        selectedPoint.artifactIds\n          .map((id) => {\n            const artiObj = database.arts.get(id)\n            return [artiObj?.slotKey, artiObj]\n          })\n          .filter((arti) => arti)\n      ),\n    [database.arts, selectedPoint]\n  )\n  const clickAwayHandler = useCallback(\n    (e) => {\n      if (\n        !(\n          e.target.id.includes('customShape') ||\n          e.target.id.includes('chartContainer')\n        )\n      ) {\n        setSelectedPoint(undefined)\n      }\n    },\n    [setSelectedPoint]\n  )\n\n  const currentlyEquipped =\n    artifactsBySlot &&\n    allArtifactSlotKeys.every(\n      (slotKey) =>\n        artifactsBySlot[slotKey]?.id === data.get(input.art[slotKey].id).value\n    )\n\n  const generLabel = useMemo(\n    () =>\n      selectedPoint?.generBuildNumber !== undefined &&\n      `#${selectedPoint?.generBuildNumber}`,\n    [selectedPoint]\n  )\n  const graphLabel = useMemo(\n    () =>\n      selectedPoint?.graphBuildNumber !== undefined && (\n        <Trans\n          t={t}\n          i18nKey=\"graphBuildLabel\"\n          count={selectedPoint?.graphBuildNumber}\n        >\n          Graph #{{ count: selectedPoint?.graphBuildNumber + 1 }}\n        </Trans>\n      ),\n    [selectedPoint, t]\n  )\n\n  if (tooltipProps.active && selectedPoint) {\n    return (\n      <ClickAwayListener onClickAway={clickAwayHandler}>\n        <CardDark\n          sx={{ minWidth: '400px', maxWidth: '400px' }}\n          onClick={(e) => e.stopPropagation()}\n        >\n          <CardContent>\n            <Stack gap={1}>\n              <Stack direction=\"row\" alignItems=\"start\" gap={1}>\n                <Stack spacing={0.5} flexGrow={99}>\n                  {currentlyEquipped && (\n                    <SqBadge color=\"info\">\n                      <strong>{t('currentlyEquippedBuild')}</strong>\n                    </SqBadge>\n                  )}\n                  {generLabel && <SqBadge color=\"info\">{generLabel}</SqBadge>}\n                  {graphLabel && <SqBadge color=\"info\">{graphLabel}</SqBadge>}\n                  <Suspense fallback={<Skeleton width={300} height={50} />}>\n                    <ArtifactSetBadges\n                      artifacts={Object.values(artifactsBySlot)}\n                      currentlyEquipped={currentlyEquipped}\n                    />\n                  </Suspense>\n                </Stack>\n                <Grid item flexGrow={1} />\n                <CloseButton onClick={() => setSelectedPoint(undefined)} />\n              </Stack>\n              <Grid container direction=\"row\" spacing={0.75} columns={5}>\n                {allArtifactSlotKeys.map((key) => (\n                  <Grid item key={key} xs={1}>\n                    <Suspense fallback={<Skeleton width={75} height={75} />}>\n                      <ArtifactCardPico\n                        artifactObj={artifactsBySlot[key]}\n                        slotKey={key}\n                      />\n                    </Suspense>\n                  </Grid>\n                ))}\n              </Grid>\n              <Typography>\n                <strong>{xLabel}</strong>:{' '}\n                {valueString(\n                  xUnit === '%' ? selectedPoint.x / 100 : selectedPoint.x,\n                  xUnit\n                )}\n              </Typography>\n              <Typography>\n                <strong>{yLabel}</strong>:{' '}\n                {valueString(\n                  yUnit === '%' ? selectedPoint.y / 100 : selectedPoint.y,\n                  yUnit\n                )}\n              </Typography>\n              <BootstrapTooltip\n                title={\n                  selectedPoint.highlighted\n                    ? t('tcGraph.buildAlreadyInList')\n                    : ''\n                }\n                placement=\"top\"\n              >\n                <span>\n                  <Button\n                    sx={{ width: '100%' }}\n                    disabled={selectedPoint?.graphBuildNumber !== undefined}\n                    color=\"info\"\n                    onClick={() => addBuildToList(selectedPoint.artifactIds)}\n                  >\n                    {t('addBuildToList')}\n                  </Button>\n                </span>\n              </BootstrapTooltip>\n            </Stack>\n          </CardContent>\n        </CardDark>\n      </ClickAwayListener>\n    )\n  }\n\n  return null\n}\n","export default class EnhancedPoint {\n  public x: number\n  public trueY?: number\n  public artifactIds: string[]\n  public min?: number\n  public current?: number\n  public highlighted?: number\n  public generBuildNumber?: number\n  public graphBuildNumber?: number\n\n  public constructor(x: number, y: number, artifactIds: string[]) {\n    this.x = x\n    this.trueY = y\n    this.artifactIds = artifactIds\n  }\n\n  public get y(): number {\n    return (this.trueY || this.current || this.highlighted) as number\n  }\n  public set y(y: number | undefined) {\n    this.trueY = y\n  }\n}\n","import { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  Download,\n  Replay,\n} from '@mui/icons-material'\nimport {\n  Button,\n  CardContent,\n  Collapse,\n  Divider,\n  Grid,\n  Slider,\n  Typography,\n} from '@mui/material'\nimport type { TFunction } from 'i18next'\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport type { LegendType } from 'recharts'\nimport {\n  CartesianGrid,\n  ComposedChart,\n  Label,\n  Legend,\n  Line,\n  ResponsiveContainer,\n  Scatter,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from 'recharts'\nimport BootstrapTooltip from '../../../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../../Components/Card/CardLight'\nimport InfoTooltip from '../../../../../../Components/InfoTooltip'\nimport ReadOnlyTextArea from '../../../../../../Components/ReadOnlyTextArea'\nimport { CharacterContext } from '../../../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../../../Context/DataContext'\nimport { GraphContext } from '../../../../../../Context/GraphContext'\nimport { input } from '../../../../../../Formula'\nimport type { NumNode } from '../../../../../../Formula/type'\nimport { valueString } from '../../../../../../KeyMap'\nimport { objectKeyMap, objPathValue } from '../../../../../../Util/Util'\nimport useBuildResult from '../../useBuildResult'\nimport OptimizationTargetSelector from '../OptimizationTargetSelector'\nimport CustomDot from './CustomDot'\nimport CustomTooltip from './CustomTooltip'\nimport EnhancedPoint from './EnhancedPoint'\n\nexport type Point = {\n  x: number\n  y: number\n  artifactIds: string[]\n  min?: number\n}\ntype ChartCardProps = {\n  plotBase?: string[]\n  setPlotBase: (path: string[] | undefined) => void\n  disabled?: boolean\n  showTooltip?: boolean\n}\nexport default function ChartCard({\n  plotBase,\n  setPlotBase,\n  disabled = false,\n  showTooltip = false,\n}: ChartCardProps) {\n  const { t } = useTranslation(['page_character_optimize', 'ui'])\n  const { data } = useContext(DataContext)\n  const { chartData } = useContext(GraphContext)\n  const [showDownload, setshowDownload] = useState(false)\n  const [showMin, setshowMin] = useState(true)\n  const { graphBuilds } = useContext(GraphContext)\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildResult: { builds: generatedBuilds },\n  } = useBuildResult(characterKey)\n\n  const [sliderLow, setSliderLow] = useState(-Infinity)\n  const [sliderHigh, setSliderHigh] = useState(Infinity)\n  const setSlider = useCallback(\n    (_e: unknown, value: number | number[]) => {\n      if (typeof value === 'number') throw new TypeError()\n      const [l, h] = value\n      setSliderLow(l)\n      setSliderHigh(h)\n    },\n    [setSliderLow, setSliderHigh]\n  )\n  useEffect(() => {\n    setSliderLow(-Infinity)\n    setSliderHigh(Infinity)\n  }, [chartData])\n\n  const { displayData, downloadData, sliderMin, sliderMax } = useMemo(() => {\n    if (!chartData) return { displayData: null, downloadData: null }\n    let sliderMin = Infinity\n    let sliderMax = -Infinity\n    const currentBuild = allArtifactSlotKeys.map(\n      (slotKey) => data?.get(input.art[slotKey].id).value ?? ''\n    )\n    // Shape the data so we know the current and highlighted builds\n    const points = chartData.data\n      .map(({ value: y, plot: x, artifactIds }) => {\n        if (x === undefined) return null\n        if (x < sliderMin) sliderMin = x\n        if (x > sliderMax) sliderMax = x\n        const enhancedDatum: EnhancedPoint = new EnhancedPoint(\n          x,\n          y,\n          artifactIds\n        )\n        const datumBuildMap = objectKeyMap(artifactIds, (_) => true)\n\n        const isCurrentBuild = currentBuild.every((aId) => datumBuildMap[aId])\n        if (isCurrentBuild) {\n          enhancedDatum.current = y\n          // Remove the Y-value so there are not 2 dots displayed for these builds\n          enhancedDatum.y = undefined\n          // Don't return yet, still need to check if build is highlighted\n          console.log(enhancedDatum)\n        }\n\n        const graphBuildIndex = graphBuilds?.findIndex((build) =>\n          build.every((aId) => datumBuildMap[aId])\n        )\n        if (graphBuildIndex !== undefined && graphBuildIndex !== -1) {\n          // Skip setting y-value if it has already been set.\n          if (isCurrentBuild) console.log(enhancedDatum)\n          if (enhancedDatum.trueY !== undefined) {\n            enhancedDatum.highlighted = y\n            // Remove the Y-value so there are not 2 dots displayed for these builds\n            enhancedDatum.y = undefined\n          }\n          enhancedDatum.graphBuildNumber = graphBuildIndex + 1\n          if (isCurrentBuild) console.log(enhancedDatum)\n        }\n\n        const generBuildIndex = generatedBuilds.findIndex((build) =>\n          build.every((aId) => datumBuildMap[aId])\n        )\n        if (generBuildIndex !== -1) {\n          // Skip setting y-value if it has already been set.\n          if (isCurrentBuild) console.log(enhancedDatum)\n          if (enhancedDatum.trueY !== undefined) {\n            enhancedDatum.highlighted = y\n            // Remove the Y-value so there are not 2 dots displayed for these builds\n            enhancedDatum.y = undefined\n          }\n          enhancedDatum.generBuildNumber = generBuildIndex + 1\n          if (isCurrentBuild) console.log(enhancedDatum)\n        }\n\n        return enhancedDatum\n      })\n      .filter((pt): pt is NonNullable<EnhancedPoint> => pt !== null)\n      .sort((a, b) => a.x - b.x)\n\n    const minimumData: EnhancedPoint[] = []\n    for (const point of points) {\n      let last: EnhancedPoint | undefined\n      while ((last = minimumData.pop())) {\n        if (last.y > point.y) {\n          minimumData.push(last)\n          break\n        }\n      }\n      minimumData.push(point)\n    }\n\n    // Note:\n    // We can also just use `minimumData` if the plotter supports multiple data sources.\n    // It could be faster too since there're no empty entries in `minimumData`.\n    // From my limited testing, using multiple data sources makes the graph behave strangely though.\n    if (minimumData[0]?.x !== points[0]?.x) points[0].min = minimumData[0].y\n    minimumData.forEach((pt) => {\n      pt.min = pt.y\n    })\n\n    const downloadData = {\n      minimum: minimumData.map((point) => [point.x, point.y]),\n      allData: points.map((point) => [point.x, point.y]),\n    }\n    return {\n      displayData: points.filter(\n        (pt) => pt && pt.x >= sliderLow && pt.x <= sliderHigh\n      ),\n      downloadData,\n      sliderMin,\n      sliderMax,\n    }\n  }, [chartData, generatedBuilds, data, graphBuilds, sliderLow, sliderHigh])\n\n  const plotBaseNode = plotBase && objPathValue(data?.getDisplay(), plotBase)\n  const invalidTarget = plotBase && (!plotBaseNode || plotBaseNode.isEmpty)\n\n  const buttonText = invalidTarget\n    ? t('page_character_optimize:targetSelector.invalidTarget')\n    : t('page_character_optimize:targetSelector.selectGraphTarget')\n\n  return (\n    <CardLight>\n      <CardContent>\n        <Grid container spacing={1} alignItems=\"center\">\n          <Grid item>\n            <Typography>{t`tcGraph.vs`}</Typography>\n          </Grid>\n          <Grid item>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={\n                showTooltip\n                  ? t('page_character_optimize:selectTargetFirst')\n                  : ''\n              }\n            >\n              <span>\n                <OptimizationTargetSelector\n                  optimizationTarget={plotBase}\n                  setTarget={(target) => setPlotBase(target)}\n                  defaultText={buttonText}\n                  disabled={disabled}\n                />\n              </span>\n            </BootstrapTooltip>\n          </Grid>\n          <Grid item>\n            <BootstrapTooltip\n              title={!plotBase ? '' : t('ui:reset')}\n              placement=\"top\"\n            >\n              <span>\n                <Button\n                  color=\"error\"\n                  onClick={() => setPlotBase(undefined)}\n                  disabled={!plotBase || disabled}\n                >\n                  <Replay />\n                </Button>\n              </span>\n            </BootstrapTooltip>\n          </Grid>\n          <Grid item flexGrow={1}>\n            <InfoTooltip\n              placement=\"top\"\n              title={t('page_character_optimize:tcGraph.desc')}\n            />\n          </Grid>\n          {!!downloadData && (\n            <Grid item>\n              <Button\n                size=\"small\"\n                startIcon={showMin ? <CheckBox /> : <CheckBoxOutlineBlank />}\n                color={showMin ? 'success' : 'secondary'}\n                onClick={() => setshowMin(!showMin)}\n              >{t`tcGraph.showStatThr`}</Button>\n            </Grid>\n          )}\n          {!!downloadData && (\n            <Grid item>\n              <Button\n                size=\"small\"\n                color=\"info\"\n                startIcon={<Download />}\n                onClick={() => setshowDownload(!showDownload)}\n              >{t`tcGraph.downloadData`}</Button>\n            </Grid>\n          )}\n        </Grid>\n      </CardContent>\n      {displayData && displayData.length && <Divider />}\n      {chartData && displayData && displayData.length && (\n        <CardContent>\n          <Collapse in={!!downloadData && showDownload}>\n            <CardDark sx={{ mb: 2 }}>\n              <CardContent>\n                <Typography>Min Data</Typography>\n                <ReadOnlyTextArea\n                  value={JSON.stringify(downloadData?.minimum)}\n                />\n                <Typography>All Data</Typography>\n                <ReadOnlyTextArea\n                  value={JSON.stringify(downloadData?.allData)}\n                />\n              </CardContent>\n            </CardDark>\n          </Collapse>\n          <Chart\n            displayData={displayData}\n            plotNode={chartData.plotNode}\n            valueNode={chartData.valueNode}\n            showMin={showMin}\n          />\n          {displayData.length > 1 && (\n            <Slider\n              marks\n              value={[sliderLow, sliderHigh]}\n              onChange={setSlider}\n              onChangeCommitted={setSlider}\n              min={sliderMin}\n              max={sliderMax}\n              step={(sliderMax - sliderMin) / 20}\n              valueLabelDisplay=\"auto\"\n              valueLabelFormat={(n) =>\n                valueString(\n                  chartData.plotNode.info?.unit === '%' ? n / 100 : n,\n                  chartData.plotNode.info?.unit\n                )\n              }\n              sx={{ ml: '6%', width: '93%' }}\n            />\n          )}\n        </CardContent>\n      )}\n    </CardLight>\n  )\n}\n\nconst optTargetColor = '#8884d8'\nconst highlightedColor = 'cyan'\nconst currentColor = '#46a046'\nconst lineColor = '#ff7300'\nfunction Chart({\n  displayData,\n  plotNode,\n  valueNode,\n  showMin,\n}: {\n  displayData: EnhancedPoint[]\n  plotNode: NumNode\n  valueNode: NumNode\n  showMin: boolean\n}) {\n  const { graphBuilds, setGraphBuilds } = useContext(GraphContext)\n  const { t } = useTranslation('page_character_optimize')\n  const [selectedPoint, setSelectedPoint] = useState<EnhancedPoint>()\n  const addBuildToList = useCallback(\n    (build: string[]) => {\n      setGraphBuilds([...(graphBuilds ?? []), build])\n      setSelectedPoint(undefined)\n    },\n    [setGraphBuilds, graphBuilds]\n  )\n  const chartOnClick = useCallback(\n    (props) => {\n      if (props && props.chartX && props.chartY)\n        setSelectedPoint(\n          getNearestPoint(props.chartX, props.chartY, 20, displayData)\n        )\n    },\n    [setSelectedPoint, displayData]\n  )\n\n  // Below works because character translation should already be loaded\n  const xLabelValue = getLabelFromNode(plotNode, t)\n  const yLabelValue = getLabelFromNode(valueNode, t)\n\n  return (\n    <ResponsiveContainer width=\"100%\" height={600}>\n      <ComposedChart\n        id=\"chartContainer\"\n        data={displayData}\n        onClick={chartOnClick}\n        style={{ cursor: 'pointer' }}\n      >\n        <CartesianGrid strokeDasharray=\"3 3\" />\n        <XAxis\n          dataKey=\"x\"\n          scale=\"linear\"\n          unit={plotNode.info?.unit}\n          domain={['auto', 'auto']}\n          tick={{ fill: 'white' }}\n          type=\"number\"\n          tickFormatter={(n) => (n > 10000 ? n.toFixed() : n.toFixed(1))}\n          label={\n            <Label fill=\"white\" dy={10}>\n              {xLabelValue}\n            </Label>\n          }\n          height={50}\n        />\n        <YAxis\n          name=\"DMG\"\n          domain={['auto', 'auto']}\n          unit={valueNode.info?.unit}\n          allowDecimals={false}\n          tick={{ fill: 'white' }}\n          type=\"number\"\n          label={\n            <Label fill=\"white\" angle={-90} dx={-40}>\n              {yLabelValue}\n            </Label>\n          }\n          width={100}\n        />\n        <Tooltip\n          content={\n            <CustomTooltip\n              xLabel={xLabelValue}\n              xUnit={plotNode.info?.unit}\n              yLabel={yLabelValue}\n              yUnit={valueNode.info?.unit}\n              selectedPoint={selectedPoint}\n              setSelectedPoint={setSelectedPoint}\n              addBuildToList={addBuildToList}\n            />\n          }\n          trigger=\"click\"\n          wrapperStyle={{ pointerEvents: 'auto', cursor: 'auto' }}\n          cursor={false}\n        />\n        <Legend\n          payload={[\n            ...(showMin\n              ? [\n                  {\n                    id: 'min',\n                    value: t`tcGraph.statReqThr`,\n                    type: 'line' as LegendType,\n                    color: lineColor,\n                  },\n                ]\n              : []),\n            {\n              id: 'trueY',\n              value: t`tcGraph.generatedBuilds`,\n              type: 'circle',\n              color: optTargetColor,\n            },\n            {\n              id: 'highlighted',\n              value: t`tcGraph.highlightedBuilds`,\n              type: 'square',\n              color: highlightedColor,\n            },\n            {\n              id: 'current',\n              value: t`tcGraph.currentBuild`,\n              type: 'diamond',\n              color: currentColor,\n            },\n          ]}\n        />\n        {showMin && (\n          <Line\n            dataKey=\"min\"\n            stroke={lineColor}\n            type=\"stepBefore\"\n            connectNulls\n            strokeWidth={2}\n            isAnimationActive={false}\n            dot={false}\n            activeDot={false}\n          />\n        )}\n        <Scatter\n          dataKey=\"trueY\"\n          isAnimationActive={false}\n          shape={\n            <CustomDot\n              selectedPoint={selectedPoint}\n              colorUnselected={optTargetColor}\n            />\n          }\n        />\n        <Scatter\n          dataKey=\"highlighted\"\n          isAnimationActive={false}\n          shape={\n            <CustomDot\n              shape=\"square\"\n              selectedPoint={selectedPoint}\n              colorUnselected={highlightedColor}\n            />\n          }\n        />\n        <Scatter\n          dataKey=\"current\"\n          isAnimationActive={false}\n          shape={\n            <CustomDot\n              shape=\"diamond\"\n              selectedPoint={selectedPoint}\n              colorUnselected={currentColor}\n            />\n          }\n        />\n      </ComposedChart>\n    </ResponsiveContainer>\n  )\n}\n\ninterface DomPt extends Element {\n  dataset: {\n    chartX: number\n    chartY: number\n    xValue: string\n    yValue: string\n  }\n}\nfunction getNearestPoint(\n  clickedX: number,\n  clickedY: number,\n  threshold: number,\n  data: EnhancedPoint[]\n) {\n  const nearestDomPtData = Array.from(\n    document.querySelectorAll<DomPt>('.custom-dot')\n  ).reduce((domPtA, domPtB) => {\n    const { chartX: aChartX, chartY: aChartY } = domPtA.dataset\n    const aDistance = Math.sqrt(\n      (clickedX - aChartX) ** 2 + (clickedY - aChartY) ** 2\n    )\n    const { chartX: bChartX, chartY: bChartY } = domPtB.dataset\n    const bDistance = Math.sqrt(\n      (clickedX - bChartX) ** 2 + (clickedY - bChartY) ** 2\n    )\n    return aDistance <= bDistance ? domPtA : domPtB\n  })['dataset']\n\n  // Don't select a point too far away\n  const distance = Math.sqrt(\n    (clickedX - nearestDomPtData.chartX) ** 2 +\n      (clickedY - nearestDomPtData.chartY) ** 2\n  )\n  return distance < threshold\n    ? data.find(\n        (d) =>\n          d.x === +nearestDomPtData.xValue && d.y === +nearestDomPtData.yValue\n      )\n    : undefined\n}\n\nfunction getLabelFromNode(node: NumNode, t: TFunction) {\n  return typeof node.info?.name === 'string'\n    ? node.info.name\n    : `${t(`${node.info?.name?.props.ns}:${node.info?.name?.props.key18}`)}${\n        node.info?.textSuffix ? ` ${node.info?.textSuffix}` : ''\n      }`\n}\n","import AddIcon from '@mui/icons-material/Add'\nimport CheckBoxIcon from '@mui/icons-material/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  CardContent,\n  Divider,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n} from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport ArtifactCardNano from '../../../../../Components/Artifact/ArtifactCardNano'\nimport ArtifactFilterDisplay from '../../../../../Components/Artifact/ArtifactFilterDisplay'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport CloseButton from '../../../../../Components/CloseButton'\nimport InfoTooltip from '../../../../../Components/InfoTooltip'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport ArtifactCard from '../../../../../PageArtifact/ArtifactCard'\nimport {\n  artifactFilterConfigs,\n  initialFilterOption,\n} from '../../../../../PageArtifact/ArtifactSort'\nimport useBoolState from '../../../../../ReactHooks/useBoolState'\nimport useForceUpdate from '../../../../../ReactHooks/useForceUpdate'\nimport useMediaQueryUp from '../../../../../ReactHooks/useMediaQueryUp'\nimport { filterFunction } from '../../../../../Util/SortByFilters'\nimport useBuildSetting from '../useBuildSetting'\n\nexport default function ExcludeArt({\n  disabled = false,\n  excludedTotal,\n}: {\n  disabled?: boolean\n  excludedTotal: string\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { artExclusion, useExcludedArts },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const [show, onOpen, onClose] = useBoolState(false)\n  const numExcludedArt = artExclusion.length\n  const [showSel, onOpenSel, onCloseSel] = useBoolState(false)\n  const onSelect = useCallback(\n    (id: string) => {\n      buildSettingDispatch({\n        artExclusion: [...artExclusion, id],\n        useExcludedArts: true,\n      })\n    },\n    [buildSettingDispatch, artExclusion]\n  )\n  const onDelSelect = useCallback(\n    (id: string) => {\n      buildSettingDispatch({\n        artExclusion: artExclusion.filter((i) => i !== id),\n        useExcludedArts: true,\n      })\n    },\n    [buildSettingDispatch, artExclusion]\n  )\n  const toggleArtExclusion = useCallback(\n    () => buildSettingDispatch({ useExcludedArts: !useExcludedArts }),\n    [buildSettingDispatch, useExcludedArts]\n  )\n  return (\n    <>\n      {/* Begin modal */}\n      <ModalWrapper\n        open={show}\n        onClose={onClose}\n        containerProps={{ maxWidth: 'xl' }}\n      >\n        <CardDark>\n          <CardContent>\n            <Box display=\"flex\" gap={1} alignItems=\"center\">\n              <Typography variant=\"h6\">{t`excludeArt.title_exclude`}</Typography>\n              <InfoTooltip\n                title={<Typography>{t`excludeArt.title_tooltip`}</Typography>}\n              />\n              <Box flexGrow={1} />\n              <CloseButton onClick={onClose} size=\"small\" />\n            </Box>\n          </CardContent>\n          <Divider />\n          <CardContent>\n            <ArtifactSelectModal\n              show={showSel}\n              onClose={onCloseSel}\n              onSelect={onSelect}\n              artExclusion={artExclusion}\n            />\n            <Button\n              fullWidth\n              onClick={onOpenSel}\n              color=\"info\"\n              sx={{ mb: 1 }}\n              startIcon={<AddIcon />}\n            >{t`excludeArt.addExc`}</Button>\n            {!!numExcludedArt && (\n              <CardLight sx={{ mb: 1 }}>\n                <Typography textAlign=\"center\">{t`excludeArt.deSelectExc`}</Typography>\n              </CardLight>\n            )}\n            <Grid\n              container\n              columns={{ xs: 3, md: 5, lg: 6, xl: 8 }}\n              spacing={1}\n            >\n              {artExclusion.map((id) => (\n                <Grid item key={id} xs={1}>\n                  <ArtifactCardNano\n                    artifactId={id}\n                    slotKey=\"flower\"\n                    BGComponent={CardLight}\n                    onClick={() => onDelSelect(id)}\n                    showLocation\n                  />\n                </Grid>\n              ))}\n            </Grid>\n          </CardContent>\n        </CardDark>\n      </ModalWrapper>\n\n      {/* Button to open modal */}\n      <ButtonGroup sx={{ display: 'flex', width: '100%' }}>\n        <Button\n          onClick={toggleArtExclusion}\n          disabled={disabled}\n          startIcon={\n            useExcludedArts ? <CheckBoxIcon /> : <CheckBoxOutlineBlankIcon />\n          }\n          color={useExcludedArts ? 'success' : 'secondary'}\n          sx={{ flexGrow: 1 }}\n        >\n          <Box sx={{ display: 'flex', gap: 1 }}>\n            <Box>{t('excludeArt.button_text')}</Box>\n            <SqBadge sx={{ whiteSpace: 'normal' }}>\n              {useExcludedArts ? (\n                <Trans t={t} i18nKey=\"excludeArt.usingNum\">\n                  Using {{ totalStr: excludedTotal } as TransObject} excluded\n                  artifacts\n                </Trans>\n              ) : (\n                <Trans t={t} i18nKey=\"excludeArt.excNum\" count={numExcludedArt}>\n                  {{ count: numExcludedArt } as TransObject} artifacts are\n                  excluded\n                </Trans>\n              )}\n            </SqBadge>\n          </Box>\n        </Button>\n        <Button\n          color=\"info\"\n          onClick={onOpen}\n          disabled={disabled}\n          sx={{ flexShrink: 1 }}\n        >\n          <SettingsIcon />\n        </Button>\n      </ButtonGroup>\n    </>\n  )\n}\n\nconst numToShowMap = { xs: 2 * 3, sm: 2 * 3, md: 3 * 3, lg: 4 * 3, xl: 4 * 3 }\nconst filterOptionReducer = (state, action) => ({ ...state, ...action })\nfunction ArtifactSelectModal({\n  onSelect,\n  show,\n  onClose,\n  artExclusion,\n}: {\n  onSelect: (id: string) => void\n  show: boolean\n  onClose: () => void\n  artExclusion: string[]\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const { database } = useContext(DatabaseContext)\n  const clickHandler = useCallback(\n    (id: string) => {\n      onSelect(id)\n      onClose()\n    },\n    [onSelect, onClose]\n  )\n\n  const [filterOption, filterOptionDispatch] = useReducer(\n    filterOptionReducer,\n    initialFilterOption()\n  )\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(() => {\n    return database.arts.followAny(forceUpdate)\n  }, [database, forceUpdate])\n\n  const brPt = useMediaQueryUp()\n\n  const filterConfigs = useMemo(() => artifactFilterConfigs(), [])\n  const artIdList = useMemo(() => {\n    const filterFunc = filterFunction(filterOption, filterConfigs)\n    return (\n      dbDirty &&\n      database.arts.values\n        .filter(filterFunc)\n        .map((art) => art.id)\n        .filter((id) => !artExclusion.includes(id))\n        .slice(0, numToShowMap[brPt])\n    )\n  }, [dbDirty, database, filterConfigs, filterOption, brPt, artExclusion])\n\n  return (\n    <ModalWrapper\n      open={show}\n      onClose={onClose}\n      containerProps={{ maxWidth: 'xl' }}\n    >\n      <CardDark>\n        <CardContent\n          sx={{\n            py: 1,\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <Typography variant=\"h6\">{t`excludeArt.selExc`}</Typography>\n          <CloseButton onClick={onClose} />\n        </CardContent>\n        <Divider />\n        <CardContent>\n          <Suspense\n            fallback={\n              <Skeleton variant=\"rectangular\" width=\"100%\" height={200} />\n            }\n          >\n            <ArtifactFilterDisplay\n              filterOption={filterOption}\n              filterOptionDispatch={filterOptionDispatch}\n              filteredIds={artIdList}\n            />\n          </Suspense>\n          <Box mt={1}>\n            <Suspense\n              fallback={\n                <Skeleton variant=\"rectangular\" width=\"100%\" height={300} />\n              }\n            >\n              <Grid container spacing={1} columns={{ xs: 2, md: 3, lg: 4 }}>\n                {artIdList.map((id) => (\n                  <Grid item key={id} xs={1}>\n                    <ArtifactCard artifactId={id} onClick={clickHandler} />\n                  </Grid>\n                ))}\n              </Grid>\n            </Suspense>\n          </Box>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n","import { allElementWithPhyKeys } from '@genshin-optimizer/consts'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  Typography,\n} from '@mui/material'\nimport { useContext, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport BootstrapTooltip from '../../../../../Components/BootstrapTooltip'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { StatColoredWithUnit } from '../../../../../Components/StatDisplay'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport Artifact from '../../../../../Data/Artifacts/Artifact'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport StatIcon from '../../../../../KeyMap/StatIcon'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport FlowerIcon from '../../../../../SVGIcons/ArtifactSlot/FlowerIcon'\nimport PlumeIcon from '../../../../../SVGIcons/ArtifactSlot/PlumeIcon'\nimport AtkIcon from '../../../../../SVGIcons/Stats/AtkIcon'\nimport HpIcon from '../../../../../SVGIcons/Stats/HpIcon'\nimport { handleMultiSelect } from '../../../../../Util/MultiSelect'\nimport { bulkCatTotal } from '../../../../../Util/totalUtils'\nimport useBuildSetting from '../useBuildSetting'\n\nexport const artifactsSlotsToSelectMainStats = [\n  'sands',\n  'goblet',\n  'circlet',\n] as const\n\nexport default function MainStatSelectionCard({\n  disabled = false,\n  filteredArtIdMap,\n}: {\n  disabled?: boolean\n  filteredArtIdMap: Record<string, boolean>\n}) {\n  const { t } = useTranslation('artifact')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { mainStatKeys },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const { database } = useContext(DatabaseContext)\n  const { mainStatSlotTots, slotTots } = useMemo(() => {\n    const catKeys = {\n      flowerMainStatTots: Artifact.slotMainStats('flower'),\n      plumeMainStatTots: Artifact.slotMainStats('plume'),\n      sandsMainStatTots: Artifact.slotMainStats('sands'),\n      gobletMainStatTots: Artifact.slotMainStats('goblet'),\n      circletMainStatTots: Artifact.slotMainStats('circlet'),\n      slotTots: artifactsSlotsToSelectMainStats,\n    } as const\n    const catTotals = bulkCatTotal(catKeys, (ctMap) =>\n      Object.entries(database.arts.data).forEach(([id, art]) => {\n        const { slotKey, mainStatKey } = art\n        if (\n          (artifactsSlotsToSelectMainStats as readonly string[]).includes(\n            slotKey\n          )\n        ) {\n          ctMap.slotTots[slotKey].total++\n          if (filteredArtIdMap[id]) ctMap.slotTots[slotKey].current++\n        }\n        ctMap[`${slotKey}MainStatTots`][mainStatKey].total++\n        if (filteredArtIdMap[id])\n          ctMap[`${slotKey}MainStatTots`][mainStatKey].current++\n      })\n    )\n    return {\n      mainStatSlotTots: {\n        flower: catTotals.flowerMainStatTots,\n        plume: catTotals.plumeMainStatTots,\n        sands: catTotals.sandsMainStatTots,\n        goblet: catTotals.gobletMainStatTots,\n        circlet: catTotals.circletMainStatTots,\n      },\n      slotTots: catTotals.slotTots,\n    }\n  }, [database, filteredArtIdMap])\n\n  return (\n    <Box display=\"flex\" flexDirection=\"column\">\n      <Divider />\n      <Box display=\"flex\">\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={<Typography>{t(`slotName.flower`)}</Typography>}\n            >\n              <FlowerIcon fontSize=\"inherit\" />\n            </BootstrapTooltip>\n            <Box flexGrow={1}>\n              <SqBadge color=\"info\">\n                <HpIcon {...iconInlineProps} /> {mainStatSlotTots.flower.hp}\n              </SqBadge>\n            </Box>\n          </Box>\n        </CardContent>\n        <Divider orientation=\"vertical\" flexItem />\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={<Typography>{t(`slotName.plume`)}</Typography>}\n            >\n              <PlumeIcon fontSize=\"inherit\" />\n            </BootstrapTooltip>\n            <Box flexGrow={1}>\n              <SqBadge color=\"info\">\n                <AtkIcon {...iconInlineProps} /> {mainStatSlotTots.plume.atk}\n              </SqBadge>\n            </Box>\n          </Box>\n        </CardContent>\n      </Box>\n      {artifactsSlotsToSelectMainStats.map((slotKey) => {\n        const selectedMainKeys = mainStatKeys[slotKey]\n        const mainKeys = Artifact.slotMainStats(slotKey)\n        const mainKeysHandler = handleMultiSelect([...mainKeys])\n        return (\n          <Box key={slotKey}>\n            <Divider />\n            <CardContent sx={{ pt: 1, pb: 1 }}>\n              <Box\n                sx={{ display: 'flex', gap: 1, alignItems: 'center', pb: 1 }}\n              >\n                <BootstrapTooltip\n                  placement=\"top\"\n                  title={<Typography>{t(`slotName.${slotKey}`)}</Typography>}\n                >\n                  <Box lineHeight={0}>\n                    <SlotIcon\n                      slotKey={slotKey}\n                      iconProps={{ fontSize: 'inherit' }}\n                    />\n                  </Box>\n                </BootstrapTooltip>\n                <Box flexGrow={1}>\n                  <SqBadge color=\"info\">{slotTots[slotKey]}</SqBadge>\n                </Box>\n              </Box>\n              <Grid container spacing={1}>\n                {mainKeys.map((mainStatKey, i) => {\n                  const element = allElementWithPhyKeys.find((ele) =>\n                    mainStatKey.includes(ele)\n                  )\n                  const color = selectedMainKeys.includes(mainStatKey)\n                    ? element ?? 'success'\n                    : 'secondary'\n                  return (\n                    <Grid\n                      item\n                      key={mainStatKey}\n                      flexGrow={1}\n                      xs={\n                        (i < 3 && slotKey !== 'goblet') || slotKey === 'goblet'\n                          ? 4\n                          : undefined\n                      }\n                    >\n                      <BootstrapTooltip\n                        placement=\"top\"\n                        title={\n                          <Typography>\n                            <strong>\n                              <StatColoredWithUnit statKey={mainStatKey} />\n                            </strong>\n                          </Typography>\n                        }\n                        disableInteractive\n                      >\n                        <Button\n                          fullWidth\n                          size=\"small\"\n                          color={color}\n                          sx={{\n                            height: '100%',\n                            pointerEvents: disabled ? 'none' : undefined,\n                            cursor: disabled ? 'none' : undefined,\n                          }}\n                          startIcon={<StatIcon statKey={mainStatKey} />}\n                          onClick={() =>\n                            buildSettingDispatch({\n                              mainStatKeys: {\n                                ...mainStatKeys,\n                                [slotKey]: mainKeysHandler(\n                                  selectedMainKeys,\n                                  mainStatKey\n                                ),\n                              },\n                            })\n                          }\n                        >\n                          {mainStatSlotTots[slotKey][mainStatKey]}\n                        </Button>\n                      </BootstrapTooltip>\n                    </Grid>\n                  )\n                })}\n              </Grid>\n            </CardContent>\n          </Box>\n        )\n      })}\n    </Box>\n  )\n}\n","import {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  DeleteForever,\n} from '@mui/icons-material'\nimport { Button, ButtonGroup } from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CustomNumberInput, {\n  CustomNumberInputButtonGroupWrapper,\n} from '../../../../../Components/CustomNumberInput'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport type {\n  StatFilters,\n  StatFilterSetting,\n} from '../../../../../Database/DataManagers/BuildSettingData'\nimport type { NodeDisplay } from '../../../../../Formula/uiData'\nimport { objPathValue } from '../../../../../Util/Util'\nimport OptimizationTargetSelector from './OptimizationTargetSelector'\n\ntype OptimizationTargetEditorListProps = {\n  statFilters: StatFilters\n  setStatFilters: (statFilters: StatFilters) => void\n  disabled: boolean\n}\n\nexport default function OptimizationTargetEditorList({\n  statFilters,\n  setStatFilters,\n  disabled = false,\n}: OptimizationTargetEditorListProps) {\n  const setTarget = useCallback(\n    (path: string[], oldPath?: string[], oldIndex?: number) => {\n      const statFilters_ = { ...statFilters }\n      const oldPathStr = JSON.stringify(oldPath)\n      const oldFilterArr = oldPath ? [...statFilters[oldPathStr]!] : undefined\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...(statFilters[pathStr] ?? [])]\n      // Copy/create new setting\n      if (oldIndex !== undefined && oldFilterArr)\n        filterArr.push(oldFilterArr[oldIndex])\n      else filterArr.push({ value: 0, disabled: false })\n      statFilters_[pathStr] = filterArr\n      // Remove old setting\n      if (oldIndex !== undefined && oldFilterArr) {\n        oldFilterArr.splice(oldIndex, 1)\n        if (oldFilterArr.length) statFilters_[oldPathStr] = oldFilterArr\n        else delete statFilters_[oldPathStr]\n      }\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  const delTarget = useCallback(\n    (path: string[], index: number) => {\n      const statFilters_ = { ...statFilters }\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...statFilters[pathStr]!]\n      filterArr.splice(index, 1)\n      if (filterArr.length) statFilters_[pathStr] = filterArr\n      else delete statFilters_[pathStr]\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  const setTargetValue = useCallback(\n    (path: string[], index: number, value: number) => {\n      const statFilters_ = { ...statFilters }\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...statFilters[pathStr]!]\n      filterArr[index] = { ...filterArr[index], value } as StatFilterSetting\n      statFilters_[pathStr] = filterArr\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  const setTargetDisabled = useCallback(\n    (path: string[], index: number, disabled: boolean) => {\n      const statFilters_ = { ...statFilters }\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...statFilters[pathStr]!]\n      filterArr[index] = { ...filterArr[index], disabled } as StatFilterSetting\n      statFilters_[pathStr] = filterArr\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  return (\n    <>\n      {Object.entries(statFilters).flatMap(([pathStr, settings]) =>\n        settings?.map((setting, index) => (\n          <OptimizationTargetEditorItem\n            path={JSON.parse(pathStr)}\n            setting={setting}\n            index={index}\n            setTarget={setTarget}\n            delTarget={delTarget}\n            setValue={setTargetValue}\n            setDisabled={setTargetDisabled}\n            disabled={disabled}\n            key={pathStr + index}\n          />\n        ))\n      )}\n      <OptimizationTargetEditorItem\n        setTarget={setTarget}\n        delTarget={delTarget}\n        setValue={setTargetValue}\n        setDisabled={setTargetDisabled}\n        disabled={disabled}\n      />\n    </>\n  )\n}\n\ntype OptimizationTargetEditorItemProps = {\n  path?: string[]\n  setting?: StatFilterSetting\n  index?: number\n  setTarget: (path: string[], oldPath?: string[], oldIndex?: number) => void\n  delTarget: (path: string[], index: number) => void\n  setValue: (path: string[], index: number, value: number) => void\n  setDisabled: (path: string[], index: number, disabled: boolean) => void\n  disabled: boolean\n}\nfunction OptimizationTargetEditorItem({\n  path,\n  setting,\n  index,\n  setTarget,\n  delTarget,\n  setValue,\n  setDisabled,\n  disabled,\n}: OptimizationTargetEditorItemProps) {\n  const { t } = useTranslation('page_character_optimize')\n  const { data } = useContext(DataContext)\n  const onChange = useCallback(\n    (val: number | undefined) =>\n      path && index !== undefined && setValue(path, index, val ?? 0),\n    [setValue, path, index]\n  )\n  const buttonStyle = { p: 1, flexBasis: 30, flexGrow: 0, flexShrink: 0 }\n\n  const buildConstraintNode: NodeDisplay = objPathValue(\n    data.getDisplay(),\n    path ?? []\n  )\n  const isPercent = buildConstraintNode?.info?.unit === '%'\n\n  return (\n    <ButtonGroup\n      sx={{ '& .MuiButtonGroup-grouped': { minWidth: 24 }, width: '100%' }}\n    >\n      {!!setting && !!path && index !== undefined && (\n        <Button\n          sx={buttonStyle}\n          color={setting.disabled ? 'secondary' : 'success'}\n          onClick={() => setDisabled(path, index, !setting.disabled)}\n          disabled={disabled}\n        >\n          {setting.disabled ? <CheckBoxOutlineBlank /> : <CheckBox />}\n        </Button>\n      )}\n      <OptimizationTargetSelector\n        showEmptyTargets\n        optimizationTarget={path}\n        setTarget={(target) => setTarget(target, path, index)}\n        defaultText={t('targetSelector.selectBuildTarget')}\n      />\n      <CustomNumberInputButtonGroupWrapper sx={{ flexBasis: 150, flexGrow: 1 }}>\n        <CustomNumberInput\n          float\n          disabled={!path || disabled}\n          value={setting?.value}\n          placeholder=\"Stat Value\"\n          onChange={onChange}\n          sx={{ px: 1 }}\n          inputProps={{ sx: { textAlign: 'right' } }}\n          endAdornment={isPercent ? '%' : undefined}\n        />\n      </CustomNumberInputButtonGroupWrapper>\n      {!!path && index !== undefined && (\n        <Button\n          sx={buttonStyle}\n          color=\"error\"\n          onClick={() => delTarget(path, index)}\n          disabled={disabled}\n        >\n          <DeleteForever fontSize=\"small\" />\n        </Button>\n      )}\n    </ButtonGroup>\n  )\n}\n","import { Box, CardContent, Divider, Typography } from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport InfoTooltip from '../../../../../Components/InfoTooltip'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport type { StatFilters } from '../../../../../Database/DataManagers/BuildSettingData'\nimport useBuildSetting from '../useBuildSetting'\nimport OptimizationTargetEditorList from './OptimizationTargetEditorList'\n\nexport default function StatFilterCard({\n  disabled = false,\n}: {\n  disabled?: boolean\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { statFilters },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const setStatFilters = useCallback(\n    (statFilters: StatFilters) => buildSettingDispatch({ statFilters }),\n    [buildSettingDispatch]\n  )\n\n  return (\n    <Box>\n      <CardLight>\n        <CardContent\n          sx={{\n            display: 'flex',\n            gap: 1,\n            justifyContent: 'space-between',\n            flexDirection: 'column',\n          }}\n        >\n          <Box display=\"flex\" justifyContent=\"space-between\">\n            <Typography\n              sx={{ fontWeight: 'bold' }}\n            >{t`constraintFilter.title`}</Typography>\n            <InfoTooltip\n              title={<Typography>{t`constraintFilter.tooltip`}</Typography>}\n            />\n          </Box>\n        </CardContent>\n        <Divider />\n        <Box display=\"flex\" flexDirection=\"column\" gap={0.5}>\n          <OptimizationTargetEditorList\n            statFilters={statFilters}\n            setStatFilters={setStatFilters}\n            disabled={disabled}\n          />\n        </Box>\n      </CardLight>\n    </Box>\n  )\n}\n","import Artifact from '../../../../Data/Artifacts/Artifact'\nimport { input } from '../../../../Formula'\nimport { computeUIData } from '../../../../Formula/api'\nimport { formulaString } from '../../../../Formula/debug'\nimport type { Data, NumNode } from '../../../../Formula/type'\nimport { constant, setReadNodeKeys } from '../../../../Formula/utils'\nimport type { ICachedArtifact } from '../../../../Types/artifact'\nimport { allMainStatKeys, allSubstatKeys } from '../../../../Types/artifact'\nimport { deepClone, objectKeyMap, objectMap } from '../../../../Util/Util'\nimport type {\n  ArtifactBuildData,\n  ArtifactsBySlot,\n  DynStat,\n} from '../../../../Solver/common'\n\nconst dynamic = setReadNodeKeys(\n  deepClone({ dyn: { ...input.art, ...input.artSet } })\n)\nexport const dynamicData = {\n  art: objectKeyMap(\n    [...allMainStatKeys, ...allSubstatKeys],\n    (key) => dynamic.dyn[key]\n  ),\n  artSet: objectMap(input.artSet, (_, key) => dynamic.dyn[key]),\n}\n\nexport function compactArtifacts(\n  arts: ICachedArtifact[],\n  mainStatAssumptionLevel: number,\n  allowPartial: boolean\n): ArtifactsBySlot {\n  const result: ArtifactsBySlot = {\n    base: {},\n    values: { flower: [], plume: [], goblet: [], circlet: [], sands: [] },\n  }\n  const keys = new Set<string>()\n\n  for (const art of arts) {\n    const mainStatVal = Artifact.mainStatValue(\n      art.mainStatKey,\n      art.rarity,\n      Math.max(Math.min(mainStatAssumptionLevel, art.rarity * 4), art.level)\n    )\n\n    const data: ArtifactBuildData = {\n      id: art.id,\n      set: art.setKey,\n      values: {\n        [art.setKey]: 1,\n        [art.mainStatKey]: art.mainStatKey.endsWith('_')\n          ? mainStatVal / 100\n          : mainStatVal,\n        ...Object.fromEntries(\n          art.substats.map((substat) => [\n            substat.key,\n            substat.key.endsWith('_')\n              ? substat.accurateValue / 100\n              : substat.accurateValue,\n          ])\n        ),\n      },\n    }\n    delete data.values['']\n    result.values[art.slotKey].push(data)\n    Object.keys(data.values).forEach((x) => keys.add(x))\n  }\n  result.base = objectKeyMap([...keys], (_) => 0)\n  if (allowPartial)\n    for (const value of Object.values(result.values))\n      value.push({ id: '', values: {} })\n  return result\n}\n\nexport function debugCompute(\n  nodes: NumNode[],\n  base: DynStat,\n  arts: ArtifactBuildData[]\n) {\n  const stats = { ...base }\n  for (const art of arts) {\n    for (const [key, value] of Object.entries(art.values)) {\n      stats[key] = (stats[key] ?? 0) + value\n    }\n  }\n  const data = {\n    dyn: Object.fromEntries(\n      Object.entries(stats).map(([key, value]) => [key, constant(value)])\n    ),\n  } as Data\n  const uiData = computeUIData([data])\n  return {\n    base,\n    arts,\n    stats,\n    data,\n    uiData,\n    nodes: nodes.map(formulaString),\n    results: nodes.map((node) => uiData.get(node)),\n  }\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { charKeyToLocCharKey } from '@genshin-optimizer/consts'\nimport {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  Close,\n  DeleteForever,\n  Science,\n  TrendingUp,\n} from '@mui/icons-material'\nimport NotificationsActiveIcon from '@mui/icons-material/NotificationsActive'\nimport NotificationsOffIcon from '@mui/icons-material/NotificationsOff'\nimport {\n  Alert,\n  Box,\n  Button,\n  ButtonGroup,\n  CardContent,\n  Divider,\n  Grid,\n  Link,\n  MenuItem,\n  Skeleton,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport React, {\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { Link as RouterLink, useLocation, useNavigate } from 'react-router-dom'\nimport ArtifactLevelSlider from '../../../../Components/Artifact/ArtifactLevelSlider'\nimport BootstrapTooltip from '../../../../Components/BootstrapTooltip'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport CharacterCard from '../../../../Components/Character/CharacterCard'\nimport DropdownButton from '../../../../Components/DropdownMenu/DropdownButton'\nimport {\n  HitModeToggle,\n  ReactionToggle,\n} from '../../../../Components/HitModeEditor'\nimport InfoTooltip from '../../../../Components/InfoTooltip'\nimport SolidToggleButtonGroup from '../../../../Components/SolidToggleButtonGroup'\nimport SqBadge from '../../../../Components/SqBadge'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../../Context/DataContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { GraphContext } from '../../../../Context/GraphContext'\nimport { OptimizationTargetContext } from '../../../../Context/OptimizationTargetContext'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { defThreads } from '../../../../Database/DataEntries/DisplayOptimizeEntry'\nimport { mergeData, uiDataForTeam } from '../../../../Formula/api'\nimport { optimize } from '../../../../Formula/optimization'\nimport type { NumNode } from '../../../../Formula/type'\nimport type { UIData } from '../../../../Formula/uiData'\nimport useCharacterReducer from '../../../../ReactHooks/useCharacterReducer'\nimport useCharSelectionCallback from '../../../../ReactHooks/useCharSelectionCallback'\nimport useDBMeta from '../../../../ReactHooks/useDBMeta'\nimport useForceUpdate from '../../../../ReactHooks/useForceUpdate'\nimport useGlobalError from '../../../../ReactHooks/useGlobalError'\nimport useMediaQueryUp from '../../../../ReactHooks/useMediaQueryUp'\nimport useTeamData, { getTeamData } from '../../../../ReactHooks/useTeamData'\nimport type { OptProblemInput } from '../../../../Solver'\nimport type { Build } from '../../../../Solver/common'\nimport { mergeBuilds, mergePlot } from '../../../../Solver/common'\nimport { GOSolver } from '../../../../Solver/GOSolver/GOSolver'\nimport type { ICachedArtifact } from '../../../../Types/artifact'\nimport { bulkCatTotal } from '../../../../Util/totalUtils'\nimport { objectKeyMap, objPathValue, range } from '../../../../Util/Util'\nimport { maxBuildsToShowList } from './Build'\nimport AllowChar from './Components/AllowChar'\nimport ArtifactSetConfig from './Components/ArtifactSetConfig'\nimport AssumeFullLevelToggle from './Components/AssumeFullLevelToggle'\nimport BonusStatsCard from './Components/BonusStatsCard'\nimport type { BuildStatus } from './Components/BuildAlert'\nimport BuildAlert from './Components/BuildAlert'\nimport BuildDisplayItem from './Components/BuildDisplayItem'\nimport ChartCard from './Components/ChartCard'\nimport ExcludeArt from './Components/ExcludeArt'\nimport MainStatSelectionCard from './Components/MainStatSelectionCard'\nimport OptimizationTargetSelector from './Components/OptimizationTargetSelector'\nimport StatFilterCard from './Components/StatFilterCard'\nimport { compactArtifacts, dynamicData } from './foreground'\nimport useBuildResult from './useBuildResult'\nimport useBuildSetting from './useBuildSetting'\n\nconst audio = new Audio('notification.mp3')\nexport default function TabBuild() {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey, compareData },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const { setChartData, graphBuilds, setGraphBuilds } = useContext(GraphContext)\n  const { gender } = useDBMeta()\n\n  const [notification, setnotification] = useState(false)\n  const notificationRef = useRef(false)\n  useEffect(() => {\n    notificationRef.current = notification\n  }, [notification])\n\n  const [buildStatus, setBuildStatus] = useState({\n    type: 'inactive',\n    tested: 0,\n    failed: 0,\n    skipped: 0,\n    total: 0,\n  } as BuildStatus)\n  const generatingBuilds = buildStatus.type !== 'inactive'\n\n  const [artsDirty, setArtsDirty] = useForceUpdate()\n\n  const [{ threads = defThreads }, setDisplayOptimize] = useState(\n    database.displayOptimize.get()\n  )\n  useEffect(\n    () => database.displayOptimize.follow((_r, to) => setDisplayOptimize(to)),\n    [database, setDisplayOptimize]\n  )\n\n  const maxWorkers = threads > defThreads ? defThreads : threads\n  const setMaxWorkers = useCallback(\n    (threads: number) => database.displayOptimize.set({ threads }),\n    [database]\n  )\n\n  const characterDispatch = useCharacterReducer(characterKey)\n  const onClickTeammate = useCharSelectionCallback()\n\n  // Clear state when changing characters\n  useEffect(() => {\n    setBuildStatus({\n      type: 'inactive',\n      tested: 0,\n      failed: 0,\n      skipped: 0,\n      total: 0,\n    })\n  }, [characterKey])\n\n  const noArtifact = useMemo(() => !database.arts.values.length, [database])\n\n  const { buildSetting, buildSettingDispatch } = useBuildSetting(characterKey)\n  const {\n    plotBase,\n    optimizationTarget,\n    mainStatAssumptionLevel,\n    allowPartial,\n    maxBuildsToShow,\n    levelLow,\n    levelHigh,\n  } = buildSetting\n  const {\n    buildResult: { builds, buildDate },\n    buildResultDispatch,\n  } = useBuildResult(characterKey)\n  const teamData = useTeamData(characterKey, mainStatAssumptionLevel)\n  const { characterSheet, target: data } =\n    teamData?.[characterKey as CharacterKey] ?? {}\n  const optimizationTargetNode =\n    optimizationTarget && objPathValue(data?.getDisplay(), optimizationTarget)\n  const isSM = ['xs', 'sm'].includes(useMediaQueryUp())\n\n  //register changes in artifact database\n  useEffect(\n    () => database.arts.followAny(setArtsDirty),\n    [setArtsDirty, database]\n  )\n\n  const deferredArtsDirty = useDeferredValue(artsDirty)\n  const deferredBuildSetting = useDeferredValue(buildSetting)\n  const filteredArts = useMemo(() => {\n    const {\n      mainStatKeys,\n      excludedLocations,\n      artExclusion,\n      levelLow,\n      levelHigh,\n      allowLocationsState,\n      useExcludedArts,\n    } = deferredArtsDirty && deferredBuildSetting\n\n    return database.arts.values.filter((art) => {\n      if (!useExcludedArts && artExclusion.includes(art.id)) return false\n      if (art.level < levelLow) return false\n      if (art.level > levelHigh) return false\n      const mainStats = mainStatKeys[art.slotKey]\n      if (mainStats?.length && !mainStats.includes(art.mainStatKey))\n        return false\n\n      const locKey = charKeyToLocCharKey(characterKey)\n      const unequippedStateAndEquippedElsewhere =\n        allowLocationsState === 'unequippedOnly' &&\n        art.location &&\n        art.location !== locKey\n      const customListStateAndNotOnList =\n        allowLocationsState === 'customList' &&\n        art.location &&\n        art.location !== locKey &&\n        excludedLocations.includes(art.location)\n      if (unequippedStateAndEquippedElsewhere || customListStateAndNotOnList)\n        return false\n\n      return true\n    })\n  }, [database, characterKey, deferredArtsDirty, deferredBuildSetting])\n\n  const filteredArtIdMap = useMemo(\n    () =>\n      objectKeyMap(\n        filteredArts.map(({ id }) => id),\n        (_) => true\n      ),\n    [filteredArts]\n  )\n  const { levelTotal, allowListTotal, excludedTotal } = useMemo(() => {\n    const catKeys = {\n      levelTotal: ['in'],\n      allowListTotal: ['in'],\n      excludedTotal: ['in'],\n    } as const\n    return bulkCatTotal(catKeys, (ctMap) =>\n      Object.entries(database.arts.data).forEach(([id, art]) => {\n        const { level, location } = art\n        const {\n          levelLow,\n          levelHigh,\n          excludedLocations,\n          allowLocationsState,\n          artExclusion,\n        } = deferredArtsDirty && deferredBuildSetting\n        if (level >= levelLow && level <= levelHigh) {\n          ctMap.levelTotal.in.total++\n          if (filteredArtIdMap[id]) ctMap.levelTotal.in.current++\n        }\n        const locKey = charKeyToLocCharKey(characterKey)\n        const allStateAndEquippedSomewhereElse =\n          allowLocationsState === 'all' && location && location !== locKey\n        const customListStateAndNotOnList =\n          allowLocationsState === 'customList' &&\n          location &&\n          location !== locKey &&\n          !excludedLocations.includes(location)\n        if (allStateAndEquippedSomewhereElse || customListStateAndNotOnList) {\n          ctMap.allowListTotal.in.total++\n          if (filteredArtIdMap[id]) ctMap.allowListTotal.in.current++\n        }\n        if (artExclusion.includes(id)) {\n          ctMap.excludedTotal.in.total++\n          if (filteredArtIdMap[id]) ctMap.excludedTotal.in.current++\n        }\n      })\n    )\n  }, [\n    characterKey,\n    database.arts.data,\n    deferredArtsDirty,\n    deferredBuildSetting,\n    filteredArtIdMap,\n  ])\n\n  const tabFocused = useRef(true)\n  useEffect(() => {\n    const onFocus = () => (tabFocused.current = true)\n    const onBlur = () => (tabFocused.current = false)\n    window.addEventListener('focus', onFocus)\n    window.addEventListener('blur', onBlur)\n    return () => {\n      window.removeEventListener('focus', onFocus)\n      window.removeEventListener('blur', onBlur)\n    }\n  }, [tabFocused])\n\n  // Provides a function to cancel the work\n  const cancelToken = useRef(() => {})\n  //terminate worker when component unmounts\n  useEffect(() => () => cancelToken.current(), [])\n  const throwGlobalError = useGlobalError()\n\n  const generateBuilds = useCallback(async () => {\n    const {\n      artSetExclusion,\n      plotBase,\n      statFilters,\n      optimizationTarget,\n      mainStatAssumptionLevel,\n      allowPartial,\n      maxBuildsToShow,\n    } = buildSetting\n    if (!characterKey || !optimizationTarget) return\n\n    const split = compactArtifacts(\n      filteredArts,\n      mainStatAssumptionLevel,\n      allowPartial\n    )\n\n    const teamData = getTeamData(\n      database,\n      characterKey,\n      mainStatAssumptionLevel,\n      []\n    )\n    if (!teamData) return\n    const workerData = uiDataForTeam(teamData.teamData, gender, characterKey)[\n      characterKey\n    ]?.target.data![0]\n    if (!workerData) return\n    Object.assign(workerData, mergeData([workerData, dynamicData])) // Mark art fields as dynamic\n    const unoptimizedOptimizationTargetNode = objPathValue(\n      workerData.display ?? {},\n      optimizationTarget\n    ) as NumNode | undefined\n    if (!unoptimizedOptimizationTargetNode) return\n    const targetNode = unoptimizedOptimizationTargetNode\n    const valueFilter: { value: NumNode; minimum: number }[] = Object.entries(\n      statFilters\n    )\n      .flatMap(([pathStr, settings]) =>\n        settings\n          .filter((setting) => !setting.disabled)\n          .map((setting) => {\n            const filterNode: NumNode = objPathValue(\n              workerData.display ?? {},\n              JSON.parse(pathStr)\n            )\n            const minimum =\n              filterNode.info?.unit === '%'\n                ? setting.value / 100\n                : setting.value // TODO: Conversion\n            return { value: filterNode, minimum: minimum }\n          })\n      )\n      .filter((x) => x.value && x.minimum > -Infinity)\n\n    setChartData(undefined)\n\n    const cancelled = new Promise<void>((r) => (cancelToken.current = r))\n\n    const unoptimizedNodes = [\n      ...valueFilter.map((x) => x.value),\n      unoptimizedOptimizationTargetNode,\n    ]\n    const minimum = [...valueFilter.map((x) => x.minimum), -Infinity]\n    const plotBaseNumNode: NumNode =\n      plotBase && objPathValue(workerData.display ?? {}, plotBase)\n    if (plotBaseNumNode) {\n      unoptimizedNodes.push(plotBaseNumNode)\n      minimum.push(-Infinity)\n    }\n\n    const nodes = optimize(\n      unoptimizedNodes,\n      workerData,\n      ({ path: [p] }) => p !== 'dyn'\n    )\n    const plotBaseNode = plotBaseNumNode ? nodes.pop() : undefined\n    const optimizationTargetNode = nodes.pop()!\n\n    const problem: OptProblemInput = {\n      arts: split,\n      optimizationTarget: optimizationTargetNode,\n      exclusion: artSetExclusion,\n      constraints: nodes.map((value, i) => ({ value, min: minimum[i] })),\n\n      topN: maxBuildsToShow,\n      plotBase: plotBaseNode,\n    }\n    const status: Omit<BuildStatus, 'type'> = {\n      tested: 0,\n      failed: 0,\n      skipped: 0,\n      total: 0,\n      startTime: performance.now(),\n    }\n    const statusUpdateTimer = setInterval(\n      () => setBuildStatus({ type: 'active', ...status }),\n      100\n    )\n\n    const cancellationError = new Error()\n    try {\n      const solver = new GOSolver(problem, status, maxWorkers)\n      cancelled.then(() => solver.cancel(cancellationError))\n\n      const results = await solver.solve()\n      solver.cancel() // Done using `solver`\n\n      cancelToken.current = () => {}\n\n      if (plotBaseNumNode) {\n        const plotData = mergePlot(results.map((x) => x.plotData!))\n        let data = Object.values(plotData)\n        if (targetNode.info?.unit === '%')\n          data = data.map(({ value, plot, artifactIds }) => ({\n            value: value * 100,\n            plot,\n            artifactIds,\n          })) as Build[]\n        if (plotBaseNumNode.info?.unit === '%')\n          data = data.map(({ value, plot, artifactIds }) => ({\n            value,\n            plot: (plot ?? 0) * 100,\n            artifactIds,\n          })) as Build[]\n        setChartData({\n          valueNode: targetNode,\n          plotNode: plotBaseNumNode,\n          data,\n        })\n      }\n      const builds = mergeBuilds(\n        results.map((x) => x.builds),\n        maxBuildsToShow\n      )\n      if (process.env.NODE_ENV === 'development')\n        console.log('Build Result', builds)\n\n      buildResultDispatch({\n        builds: builds.map((build) => build.artifactIds),\n        buildDate: Date.now(),\n      })\n\n      setTimeout(() => {\n        // Using a ref because a user can cancel the notification while the build is going.\n        if (results && notificationRef.current) {\n          audio.play()\n          if (!tabFocused.current)\n            setTimeout(() => window.alert(t`buildCompleted`), 1)\n        }\n      }, 100)\n    } catch (e) {\n      // Worker error, cancelled, printer catches on fire, etc.\n      if (e !== cancellationError) {\n        console.log('Failed to load worker')\n        console.log(e)\n        if (e instanceof Error) throwGlobalError(e)\n      }\n\n      cancelToken.current()\n      status.tested = 0\n      status.failed = 0\n      status.skipped = 0\n      status.total = 0\n    } finally {\n      clearInterval(statusUpdateTimer)\n      setBuildStatus({\n        type: 'inactive',\n        ...status,\n        finishTime: performance.now(),\n      })\n    }\n  }, [\n    buildSetting,\n    characterKey,\n    filteredArts,\n    database,\n    gender,\n    setChartData,\n    maxWorkers,\n    buildResultDispatch,\n    t,\n    throwGlobalError,\n  ])\n\n  const characterName = characterSheet?.name ?? 'Character Name'\n\n  const setPlotBase = useCallback(\n    (plotBase: string[] | undefined) => {\n      buildSettingDispatch({ plotBase })\n      setChartData(undefined)\n    },\n    [buildSettingDispatch, setChartData]\n  )\n  const dataContext: dataContextObj | undefined = useMemo(() => {\n    return data && teamData && { data, teamData }\n  }, [data, teamData])\n\n  const targetSelector = (\n    <OptimizationTargetSelector\n      optimizationTarget={optimizationTarget}\n      setTarget={(target) =>\n        buildSettingDispatch({ optimizationTarget: target })\n      }\n      disabled={!!generatingBuilds}\n    />\n  )\n\n  const getGraphBuildLabel = useCallback(\n    (index: number) => (\n      <Trans t={t} i18nKey=\"graphBuildLabel\" count={index + 1}>\n        Graph #{{ count: index + 1 }}\n      </Trans>\n    ),\n    [t]\n  )\n  const getNormBuildLabel = useCallback((index: number) => `#${index + 1}`, [])\n  return (\n    <Box display=\"flex\" flexDirection=\"column\" gap={1}>\n      {noArtifact && (\n        <Alert severity=\"warning\" variant=\"filled\">\n          <Trans t={t} i18nKey=\"noArtis\">\n            Oops! It looks like you haven't added any artifacts to GO yet! You\n            should go to the{' '}\n            <Link component={RouterLink} to=\"/artifacts\">\n              Artifacts\n            </Link>{' '}\n            page and add some!\n          </Trans>\n        </Alert>\n      )}\n      {/* Build Generator Editor */}\n      {dataContext && (\n        <DataContext.Provider value={dataContext}>\n          <Grid container spacing={1}>\n            {/* 1*/}\n            <Grid\n              item\n              xs={12}\n              sm={6}\n              lg={3}\n              display=\"flex\"\n              flexDirection=\"column\"\n              gap={1}\n            >\n              {/* character card */}\n              <Box>\n                <CharacterCard\n                  characterKey={characterKey}\n                  onClickTeammate={onClickTeammate}\n                />\n              </Box>\n              <BonusStatsCard />\n            </Grid>\n\n            {/* 2 */}\n            <Grid\n              item\n              xs={12}\n              sm={6}\n              lg={4}\n              display=\"flex\"\n              flexDirection=\"column\"\n              gap={1}\n            >\n              {/* Level Filter */}\n              <CardLight>\n                <CardContent sx={{ display: 'flex', gap: 1 }}>\n                  <Typography\n                    sx={{ fontWeight: 'bold' }}\n                  >{t`levelFilter`}</Typography>\n                  <SqBadge color=\"info\">{levelTotal.in}</SqBadge>\n                </CardContent>\n                <Divider />\n                <CardContent>\n                  <ArtifactLevelSlider\n                    levelLow={levelLow}\n                    levelHigh={levelHigh}\n                    setLow={(levelLow) => buildSettingDispatch({ levelLow })}\n                    setHigh={(levelHigh) => buildSettingDispatch({ levelHigh })}\n                    setBoth={(levelLow, levelHigh) =>\n                      buildSettingDispatch({ levelLow, levelHigh })\n                    }\n                    disabled={generatingBuilds}\n                  />\n                </CardContent>\n              </CardLight>\n\n              {/* Main Stat Filters */}\n              <CardLight>\n                <CardContent>\n                  <Typography\n                    sx={{ fontWeight: 'bold' }}\n                  >{t`mainStat.title`}</Typography>\n                </CardContent>\n                <Divider />\n                <CardContent>\n                  <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                    <AssumeFullLevelToggle\n                      mainStatAssumptionLevel={mainStatAssumptionLevel}\n                      setmainStatAssumptionLevel={(\n                        mainStatAssumptionLevel: number\n                      ) => buildSettingDispatch({ mainStatAssumptionLevel })}\n                      disabled={generatingBuilds}\n                    />\n                    <InfoTooltip\n                      title={\n                        <Box>\n                          <Typography variant=\"h6\">{t`mainStat.levelAssTooltip.title`}</Typography>\n                          <Typography>{t`mainStat.levelAssTooltip.desc`}</Typography>\n                        </Box>\n                      }\n                    />\n                  </Box>\n                </CardContent>\n                {/* main stat selector */}\n                <MainStatSelectionCard\n                  disabled={generatingBuilds}\n                  filteredArtIdMap={filteredArtIdMap}\n                />\n              </CardLight>\n            </Grid>\n\n            {/* 3 */}\n            <Grid\n              item\n              xs={12}\n              sm={6}\n              lg={5}\n              display=\"flex\"\n              flexDirection=\"column\"\n              gap={1}\n            >\n              <ArtifactSetConfig disabled={generatingBuilds} />\n\n              {/* use excluded */}\n              <ExcludeArt\n                disabled={generatingBuilds}\n                excludedTotal={excludedTotal.in}\n              />\n\n              <Button\n                fullWidth\n                startIcon={\n                  allowPartial ? <CheckBox /> : <CheckBoxOutlineBlank />\n                }\n                color={allowPartial ? 'success' : 'secondary'}\n                onClick={() =>\n                  buildSettingDispatch({ allowPartial: !allowPartial })\n                }\n                disabled={generatingBuilds}\n              >\n                {t`allowPartial`}\n              </Button>\n\n              {/* use equipped */}\n              <AllowChar\n                disabled={generatingBuilds}\n                allowListTotal={allowListTotal.in}\n              />\n\n              {/*Minimum Final Stat Filter */}\n              <StatFilterCard disabled={generatingBuilds} />\n            </Grid>\n          </Grid>\n          {/* Footer */}\n          {isSM && targetSelector}\n          <ButtonGroup>\n            {!isSM && targetSelector}\n            <DropdownButton\n              disabled={generatingBuilds || !characterKey}\n              title={\n                <Trans t={t} i18nKey=\"build\" count={maxBuildsToShow}>\n                  {{ count: maxBuildsToShow }} Builds\n                </Trans>\n              }\n            >\n              <MenuItem>\n                <Typography variant=\"caption\" color=\"info.main\">\n                  {t('buildDropdownDesc')}\n                </Typography>\n              </MenuItem>\n              <Divider />\n              {maxBuildsToShowList.map((v) => (\n                <MenuItem\n                  key={v}\n                  onClick={() => buildSettingDispatch({ maxBuildsToShow: v })}\n                >\n                  <Trans t={t} i18nKey=\"build\" count={v}>\n                    {{ count: v }} Builds\n                  </Trans>\n                </MenuItem>\n              ))}\n            </DropdownButton>\n            <DropdownButton\n              disabled={generatingBuilds || !characterKey}\n              sx={{ borderRadius: '4px 0px 0px 4px' }}\n              title={\n                <Trans t={t} i18nKey=\"thread\" count={maxWorkers}>\n                  {{ count: maxWorkers }} Threads\n                </Trans>\n              }\n            >\n              <MenuItem>\n                <Typography variant=\"caption\" color=\"info.main\">\n                  {t('threadDropdownDesc')}\n                </Typography>\n              </MenuItem>\n              <Divider />\n              {range(1, defThreads)\n                .reverse()\n                .map((v) => (\n                  <MenuItem key={v} onClick={() => setMaxWorkers(v)}>\n                    <Trans t={t} i18nKey=\"thread\" count={v}>\n                      {{ count: v }} Threads\n                    </Trans>\n                  </MenuItem>\n                ))}\n            </DropdownButton>\n            <BootstrapTooltip placement=\"top\" title={t`notifyTooltip`}>\n              <Button\n                sx={{ borderRadius: 0 }}\n                color=\"warning\"\n                onClick={() => setnotification((n) => !n)}\n              >\n                {notification ? (\n                  <NotificationsActiveIcon />\n                ) : (\n                  <NotificationsOffIcon />\n                )}\n              </Button>\n            </BootstrapTooltip>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={!optimizationTarget ? t('selectTargetFirst') : ''}\n            >\n              <span>\n                <Button\n                  disabled={\n                    !characterKey ||\n                    !optimizationTarget ||\n                    !optimizationTargetNode ||\n                    optimizationTargetNode.isEmpty\n                  }\n                  color={generatingBuilds ? 'error' : 'success'}\n                  onClick={\n                    generatingBuilds\n                      ? () => cancelToken.current()\n                      : generateBuilds\n                  }\n                  startIcon={generatingBuilds ? <Close /> : <TrendingUp />}\n                  sx={{ borderRadius: '0px 4px 4px 0px' }}\n                >\n                  {generatingBuilds\n                    ? t('generateButton.cancel')\n                    : t('generateButton.generateBuilds')}\n                </Button>\n              </span>\n            </BootstrapTooltip>\n          </ButtonGroup>\n          {!!characterKey && (\n            <BuildAlert\n              {...{ status: buildStatus, characterName, maxBuildsToShow }}\n            />\n          )}\n          <Box>\n            <ChartCard\n              disabled={generatingBuilds || !optimizationTarget}\n              plotBase={plotBase}\n              setPlotBase={setPlotBase}\n              showTooltip={!optimizationTarget}\n            />\n          </Box>\n          <CardLight>\n            <CardContent>\n              <Box display=\"flex\" alignItems=\"center\" gap={1} mb={1}>\n                <Typography sx={{ flexGrow: 1 }}>\n                  {builds ? (\n                    <span>\n                      Showing{' '}\n                      <strong>\n                        {builds.length + (graphBuilds ? graphBuilds.length : 0)}\n                      </strong>{' '}\n                      build generated for {characterName}.{' '}\n                      {!!buildDate && (\n                        <span>\n                          Build generated on:{' '}\n                          <strong>\n                            {new Date(buildDate).toLocaleString()}\n                          </strong>\n                        </span>\n                      )}\n                    </span>\n                  ) : (\n                    <span>Select a character to generate builds.</span>\n                  )}\n                </Typography>\n                <Button\n                  disabled={!builds.length}\n                  color=\"error\"\n                  onClick={() => {\n                    setGraphBuilds(undefined)\n                    buildResultDispatch({ builds: [], buildDate: 0 })\n                  }}\n                >\n                  Clear Builds\n                </Button>\n              </Box>\n              <Grid container display=\"flex\" spacing={1}>\n                <Grid item>\n                  <HitModeToggle size=\"small\" />\n                </Grid>\n                <Grid item>\n                  <ReactionToggle size=\"small\" />\n                </Grid>\n                <Grid item flexGrow={1} />\n                <Grid item>\n                  <SolidToggleButtonGroup\n                    exclusive\n                    value={compareData}\n                    onChange={(_e, v) => characterDispatch({ compareData: v })}\n                    size=\"small\"\n                  >\n                    <ToggleButton value={false} disabled={!compareData}>\n                      Show new builds\n                    </ToggleButton>\n                    <ToggleButton value={true} disabled={compareData}>\n                      Compare vs. equipped\n                    </ToggleButton>\n                  </SolidToggleButtonGroup>\n                </Grid>\n              </Grid>\n            </CardContent>\n          </CardLight>\n\n          <OptimizationTargetContext.Provider value={optimizationTarget}>\n            {graphBuilds && (\n              <BuildList\n                builds={graphBuilds}\n                characterKey={characterKey}\n                data={data}\n                compareData={compareData}\n                disabled={!!generatingBuilds}\n                getLabel={getGraphBuildLabel}\n                setBuilds={setGraphBuilds}\n              />\n            )}\n            <BuildList\n              builds={builds}\n              characterKey={characterKey}\n              data={data}\n              compareData={compareData}\n              disabled={!!generatingBuilds}\n              getLabel={getNormBuildLabel}\n            />\n          </OptimizationTargetContext.Provider>\n        </DataContext.Provider>\n      )}\n    </Box>\n  )\n}\n\nfunction BuildList({\n  builds,\n  setBuilds,\n  characterKey,\n  data,\n  compareData,\n  disabled,\n  getLabel,\n}: {\n  builds: string[][]\n  setBuilds?: (builds: string[][] | undefined) => void\n  characterKey?: '' | CharacterKey\n  data?: UIData\n  compareData: boolean\n  disabled: boolean\n  getLabel: (index: number) => Displayable\n}) {\n  const deleteBuild = useCallback(\n    (index: number) => {\n      if (setBuilds) {\n        const builds_ = [...builds]\n        builds_.splice(index, 1)\n        setBuilds(builds_)\n      }\n    },\n    [builds, setBuilds]\n  )\n  // Memoize the build list because calculating/rendering the build list is actually very expensive, which will cause longer optimization times.\n  const list = useMemo(\n    () => (\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={600} />}\n      >\n        {builds?.map(\n          (build, index) =>\n            characterKey &&\n            data && (\n              <DataContextWrapper\n                key={index + build.join()}\n                characterKey={characterKey}\n                build={build}\n                oldData={data}\n              >\n                <BuildItemWrapper\n                  index={index}\n                  label={getLabel(index)}\n                  build={build}\n                  compareData={compareData}\n                  disabled={disabled}\n                  deleteBuild={setBuilds ? deleteBuild : undefined}\n                />\n              </DataContextWrapper>\n            )\n        )}\n      </Suspense>\n    ),\n    [\n      builds,\n      characterKey,\n      data,\n      compareData,\n      disabled,\n      getLabel,\n      deleteBuild,\n      setBuilds,\n    ]\n  )\n  return list\n}\nfunction BuildItemWrapper({\n  index,\n  label,\n  build,\n  compareData,\n  disabled,\n  deleteBuild,\n}: {\n  index: number\n  label: Displayable\n  build: string[]\n  compareData: boolean\n  disabled: boolean\n  deleteBuild?: (index: number) => void\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const location = useLocation()\n  const navigate = useNavigate()\n  const toTC = useCallback(() => {\n    const paths = location.pathname.split('/')\n    paths.pop()\n    navigate(`${paths.join('/')}/theorycraft`, { state: { build } })\n  }, [navigate, build, location.pathname])\n\n  return (\n    <BuildDisplayItem\n      label={label}\n      compareBuild={compareData}\n      disabled={disabled}\n      extraButtonsLeft={\n        <>\n          <Button\n            color=\"info\"\n            size=\"small\"\n            startIcon={<Science />}\n            onClick={toTC}\n          >\n            {t('theorycraftButton')}\n          </Button>\n          {deleteBuild && (\n            <Button\n              color=\"error\"\n              size=\"small\"\n              startIcon={<DeleteForever />}\n              onClick={() => deleteBuild(index)}\n            >\n              {t('removeBuildButton')}\n            </Button>\n          )}\n        </>\n      }\n    />\n  )\n}\n\ntype Prop = {\n  children: React.ReactNode\n  characterKey: CharacterKey\n  build: string[]\n  oldData: UIData\n}\nfunction DataContextWrapper({ children, characterKey, build, oldData }: Prop) {\n  const { database } = useContext(DatabaseContext)\n  const {\n    buildSetting: { mainStatAssumptionLevel },\n  } = useBuildSetting(characterKey)\n  // Update the build when the build artifacts are changed.\n  const [dirty, setDirty] = useForceUpdate()\n  useEffect(\n    () => database.arts.followAny((id) => build.includes(id) && setDirty()),\n    [database, build, setDirty]\n  )\n  const buildsArts = useMemo(\n    () =>\n      dirty &&\n      (build\n        .map((i) => database.arts.get(i))\n        .filter((a) => a) as ICachedArtifact[]),\n    [dirty, build, database]\n  )\n  const teamData = useTeamData(\n    characterKey,\n    mainStatAssumptionLevel,\n    buildsArts\n  )\n  const providerValue = useMemo(() => {\n    const tdc = teamData?.[characterKey]\n    if (!tdc) return\n    return { data: tdc.target, teamData, oldData }\n  }, [teamData, oldData, characterKey])\n  if (!providerValue) return null\n  return (\n    <DataContext.Provider value={providerValue}>\n      {children}\n    </DataContext.Provider>\n  )\n}\n","import { useCallback, useState } from 'react'\n\n/* Hook to get a callback function for throwing\nsynchronous error from asynchronous code\nWhen this callback is used somewhere within an error boundary,\nit will trigger it, even if you are in an async block\n\n```\nconst throwError = useGlobalError()\nasync function foo() { throwError(new Error()) }\n```\n*/\nexport default function useGlobalError(): (e: Error) => void {\n  const [, setError] = useState()\n  return useCallback((e: Error) => {\n    setError(() => {\n      throw e\n    })\n  }, [])\n}\n","import type { CharacterKey, GenderKey } from '@genshin-optimizer/consts'\nimport Albedo from './Character_Albedo_Card.png'\nimport Alhaitham from './Character_Alhaitham_Card.jpg'\nimport Aloy from './Character_Aloy_Card.png'\nimport Amber from './Character_Amber_Card.jpg'\nimport AratakiItto from './Character_Arataki_Itto_Card.jpg'\nimport Barbara from './Character_Barbara_Card.jpg'\nimport Beidou from './Character_Beidou_Card.jpg'\nimport Bennett from './Character_Bennett_Card.jpg'\nimport Candace from './Character_Candace_Card.jpg'\nimport Chongyun from './Character_Chongyun_Card.jpg'\nimport Collei from './Character_Collei_Card.jpg'\nimport Cyno from './Character_Cyno_Card.jpg'\nimport Dehya from './Character_Dehya_Card.jpg'\nimport Diluc from './Character_Diluc_Card.jpg'\nimport Diona from './Character_Diona_Card.png'\nimport Dori from './Character_Dori_Card.jpg'\nimport Eula from './Character_Eula_Card.png'\nimport Faruzan from './Character_Faruzan_Card.jpg'\nimport Fischl from './Character_Fischl_Card.jpg'\nimport Ganyu from './Character_Ganyu_Card.png'\nimport Gorou from './Character_Gorou_Card.jpg'\nimport HuTao from './Character_Hu_Tao_Card.jpg'\nimport Jean from './Character_Jean_Card.jpg'\nimport Kaeya from './Character_Kaeya_Card.jpg'\nimport KamisatoAyaka from './Character_Kamisato_Ayaka_Card.png'\nimport KamisatoAyato from './Character_Kamisato_Ayato_Card.png'\nimport KaedeharaKazuha from './Character_Kazuha_Card.png'\nimport Keqing from './Character_Keqing_Card.jpg'\nimport Klee from './Character_Klee_Card.jpg'\nimport KujouSara from './Character_Kujou_Sara_Card.jpg'\nimport KukiShinobu from './Character_Kuki_Shinobu_Card.jpg'\nimport Layla from './Character_Layla_Card.jpeg'\nimport Lisa from './Character_Lisa_Card.jpg'\nimport Mika from './Character_Mika_Card.jpg'\nimport Mona from './Character_Mona_Card.jpg'\nimport Nahida from './Character_Nahida_Card.jpeg'\nimport Nilou from './Character_Nilou_Card.jpg'\nimport Ningguang from './Character_Ningguang_Card.jpg'\nimport Noelle from './Character_Noelle_Card.jpg'\nimport Qiqi from './Character_Qiqi_Card.jpg'\nimport RaidenShogun from './Character_Raiden_Shogun_Card.png'\nimport Razor from './Character_Razor_Card.jpg'\nimport Rosaria from './Character_Rosaria_Card.png'\nimport SangonomiyaKokomi from './Character_Sangonomiya_Kokomi_Card.jpg'\nimport Sayu from './Character_Sayu_Card.png'\nimport Shenhe from './Character_Shenhe_Card.jpg'\nimport ShikanoinHeizou from './Character_Shikanoin_Heizou_Card.png'\nimport Sucrose from './Character_Sucrose_Card.jpg'\nimport Tartaglia from './Character_Tartaglia_Card.png'\nimport Thoma from './Character_Thoma_Card.jpg'\nimport Tighnari from './Character_Tighnari_Card.jpg'\nimport Venti from './Character_Venti_Card.jpg'\nimport Wanderer from './Character_Wanderer_Card.jpg'\nimport Xiangling from './Character_Xiangling_Card.jpg'\nimport Xiao from './Character_Xiao_Card.jpg'\nimport Xingqiu from './Character_Xingqiu_Card.jpg'\nimport Xinyan from './Character_Xinyan_Card.jpg'\nimport YaeMiko from './Character_Yae_Miko_Card.png'\nimport Yanfei from './Character_Yanfei_Card.png'\nimport Yaoyao from './Character_Yaoyao_Card.jpg'\nimport Yelan from './Character_Yelan_Card.jpg'\nimport Yoimiya from './Character_Yoimiya_Card.png'\nimport YunJin from './Character_Yun_Jin_Card.jpg'\nimport Zhongli from './Character_Zhongli_Card.png'\nimport TravelerF from './Traveler_Female_Card.jpg'\nimport TravelerM from './Traveler_Male_Card.jpg'\n\nconst charCards = {\n  Albedo,\n  Alhaitham,\n  Aloy,\n  Amber,\n  AratakiItto,\n  Barbara,\n  Beidou,\n  Bennett,\n  Candace,\n  Chongyun,\n  Collei,\n  Cyno,\n  Dehya,\n  Diluc,\n  Diona,\n  Dori,\n  Eula,\n  Faruzan,\n  Fischl,\n  Ganyu,\n  Gorou,\n  HuTao,\n  Jean,\n  KaedeharaKazuha,\n  Kaeya,\n  KamisatoAyaka,\n  KamisatoAyato,\n  Keqing,\n  Klee,\n  KujouSara,\n  KukiShinobu,\n  Layla,\n  Lisa,\n  Mika,\n  Mona,\n  Nahida,\n  Nilou,\n  Ningguang,\n  Noelle,\n  Qiqi,\n  RaidenShogun,\n  Razor,\n  Rosaria,\n  SangonomiyaKokomi,\n  Sayu,\n  Shenhe,\n  ShikanoinHeizou,\n  Sucrose,\n  Tartaglia,\n  Thoma,\n  Tighnari,\n  TravelerF,\n  TravelerM,\n  Venti,\n  Wanderer,\n  Xiangling,\n  Xiao,\n  Xingqiu,\n  Xinyan,\n  YaeMiko,\n  Yanfei,\n  Yaoyao,\n  Yelan,\n  Yoimiya,\n  YunJin,\n  Zhongli,\n} as const\n\nexport function charCard(charKey: CharacterKey, gender: GenderKey): string {\n  switch (charKey) {\n    case 'TravelerAnemo':\n    case 'TravelerDendro':\n    case 'TravelerElectro':\n    case 'TravelerGeo':\n      return charCards[`Traveler${gender}`] ?? ''\n    default:\n      return charCards[charKey] ?? ''\n  }\n}\n","import { Close, Difference } from '@mui/icons-material'\nimport { Button, Skeleton, Tooltip, Typography } from '@mui/material'\nimport { Suspense, useContext, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport {\n  HitModeToggle,\n  ReactionToggle,\n} from '../../../../Components/HitModeEditor'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { DataContext } from '../../../../Context/DataContext'\nimport useBoolState from '../../../../ReactHooks/useBoolState'\nimport useTeamData from '../../../../ReactHooks/useTeamData'\nimport { objectMap } from '../../../../Util/Util'\nimport useBuildSetting from '../TabOptimize/useBuildSetting'\nimport BuildDisplayItem from '../TabOptimize/Components/BuildDisplayItem'\n\nexport default function CompareBuildButton({\n  artId,\n  weaponId,\n}: {\n  artId?: string\n  weaponId?: string\n}) {\n  const { t } = useTranslation('page_character')\n  const [show, onShow, onHide] = useBoolState(false)\n\n  return (\n    <>\n      <ModalWrapper\n        open={show}\n        onClose={onHide}\n        containerProps={{ maxWidth: 'xl' }}\n      >\n        <CompareContent artId={artId} weaponId={weaponId} onHide={onHide} />\n      </ModalWrapper>\n      <Tooltip\n        title={<Typography>{t`tabEquip.compare`}</Typography>}\n        placement=\"top\"\n        arrow\n      >\n        <Button color=\"info\" size=\"small\" onClick={onShow}>\n          <Difference />\n        </Button>\n      </Tooltip>\n    </>\n  )\n}\nfunction CompareContent({\n  artId,\n  weaponId,\n  onHide,\n}: {\n  artId?: string\n  weaponId?: string\n  onHide: () => void\n}) {\n  const { database } = useContext(DatabaseContext)\n  const {\n    character: { key: characterKey, equippedArtifacts },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { mainStatAssumptionLevel },\n  } = useBuildSetting(characterKey)\n  const { data: oldData } = useContext(DataContext)\n  const build = useMemo(() => {\n    const newArt = database.arts.get(artId ?? '')\n    const artmap = objectMap(equippedArtifacts, (id, slot) =>\n      slot === newArt?.slotKey ? newArt : database.arts.get(id)\n    )\n    return Object.values(artmap).filter((a) => a)\n  }, [database, equippedArtifacts, artId])\n  const teamData = useTeamData(\n    characterKey,\n    mainStatAssumptionLevel,\n    build,\n    weaponId ? database.weapons.get(weaponId) : undefined\n  )\n  const dataProviderValue = useMemo(\n    () =>\n      teamData && { data: teamData[characterKey]!.target, teamData, oldData },\n    [characterKey, teamData, oldData]\n  )\n  return (\n    <Suspense\n      fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={600} />}\n    >\n      {dataProviderValue && (\n        <DataContext.Provider value={dataProviderValue}>\n          <BuildDisplayItem\n            compareBuild={true}\n            extraButtonsLeft={\n              <>\n                <HitModeToggle size=\"small\" />\n                <ReactionToggle size=\"small\" />\n              </>\n            }\n            extraButtonsRight={\n              <Button size=\"small\" color=\"error\" onClick={onHide}>\n                <Close />\n              </Button>\n            }\n          />\n        </DataContext.Provider>\n      )}\n    </Suspense>\n  )\n}\n","import type { ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport {\n  Box,\n  CardContent,\n  Divider,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport {\n  lazy,\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport Assets from '../../../../Assets/Assets'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CloseButton from '../../../../Components/CloseButton'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport ArtifactCard from '../../../../PageArtifact/ArtifactCard'\nimport type { FilterOption } from '../../../../PageArtifact/ArtifactSort'\nimport {\n  artifactFilterConfigs,\n  initialFilterOption,\n} from '../../../../PageArtifact/ArtifactSort'\nimport useForceUpdate from '../../../../ReactHooks/useForceUpdate'\nimport useMediaQueryUp from '../../../../ReactHooks/useMediaQueryUp'\nimport { filterFunction } from '../../../../Util/SortByFilters'\nimport CompareBuildButton from './CompareBuildButton'\n\nconst numToShowMap = { xs: 2 * 3, sm: 2 * 3, md: 3 * 3, lg: 4 * 3, xl: 4 * 3 }\nconst ArtifactFilterDisplay = lazy(\n  () => import('../../../../Components/Artifact/ArtifactFilterDisplay')\n)\n\nexport default function ArtifactSwapModal({\n  onChangeId,\n  slotKey,\n  show,\n  onClose,\n}: {\n  onChangeId: (id: string) => void\n  slotKey: ArtifactSlotKey\n  show: boolean\n  onClose: () => void\n}) {\n  const { t } = useTranslation('page_character')\n  const { database } = useContext(DatabaseContext)\n  const clickHandler = useCallback(\n    (id) => {\n      onChangeId(id)\n      onClose()\n    },\n    [onChangeId, onClose]\n  )\n  const filterOptionReducer = useCallback(\n    (state, action) => ({ ...state, ...action, slotKeys: [slotKey] }),\n    [slotKey]\n  )\n\n  const [filterOption, filterOptionDispatch]: [\n    FilterOption,\n    (action: any) => void\n  ] = useReducer(filterOptionReducer, {\n    ...initialFilterOption(),\n    slotKeys: [slotKey],\n  })\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(() => {\n    return database.arts.followAny(forceUpdate)\n  }, [database, forceUpdate])\n\n  const brPt = useMediaQueryUp()\n\n  const filterConfigs = useMemo(() => artifactFilterConfigs(), [])\n  const artIdList = useMemo(() => {\n    const filterFunc = filterFunction(filterOption, filterConfigs)\n    return (\n      dbDirty &&\n      database.arts.values\n        .filter(filterFunc)\n        .map((art) => art.id)\n        .slice(0, numToShowMap[brPt])\n    )\n  }, [dbDirty, database, filterConfigs, filterOption, brPt])\n\n  return (\n    <ModalWrapper\n      open={show}\n      onClose={onClose}\n      containerProps={{ maxWidth: 'xl' }}\n    >\n      <CardDark>\n        <CardContent\n          sx={{\n            py: 1,\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <Typography variant=\"h6\">\n            {slotKey ? <ImgIcon src={Assets.slot[slotKey]} /> : null}{' '}\n            {t`tabEquip.swapArt`}\n          </Typography>\n          <CloseButton onClick={onClose} />\n        </CardContent>\n        <Divider />\n        <CardContent>\n          <Suspense\n            fallback={\n              <Skeleton variant=\"rectangular\" width=\"100%\" height={200} />\n            }\n          >\n            <ArtifactFilterDisplay\n              filterOption={filterOption}\n              filterOptionDispatch={filterOptionDispatch}\n              filteredIds={artIdList}\n              disableSlotFilter\n            />\n          </Suspense>\n          <Box mt={1}>\n            <Suspense\n              fallback={\n                <Skeleton variant=\"rectangular\" width=\"100%\" height={300} />\n              }\n            >\n              <Grid container spacing={1} columns={{ xs: 2, md: 3, lg: 4 }}>\n                {artIdList.map((id) => (\n                  <Grid item key={id} xs={1}>\n                    <ArtifactCard\n                      artifactId={id}\n                      extraButtons={<CompareBuildButton artId={id} />}\n                      onClick={clickHandler}\n                    />\n                  </Grid>\n                ))}\n              </Grid>\n            </Suspense>\n          </Box>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n","import type {\n  RarityKey,\n  WeaponKey,\n  WeaponTypeKey,\n} from '@genshin-optimizer/consts'\nimport { allRarityKeys } from '@genshin-optimizer/consts'\nimport { Add } from '@mui/icons-material'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  TextField,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport type { ChangeEvent } from 'react'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport Assets from '../../../../Assets/Assets'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CloseButton from '../../../../Components/CloseButton'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport SolidToggleButtonGroup from '../../../../Components/SolidToggleButtonGroup'\nimport WeaponSelectionModal from '../../../../Components/Weapon/WeaponSelectionModal'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport WeaponCard from '../../../../PageWeapon/WeaponCard'\nimport WeaponEditor from '../../../../PageWeapon/WeaponEditor'\nimport useForceUpdate from '../../../../ReactHooks/useForceUpdate'\nimport { handleMultiSelect } from '../../../../Util/MultiSelect'\nimport { filterFunction, sortFunction } from '../../../../Util/SortByFilters'\nimport {\n  weaponFilterConfigs,\n  weaponSortConfigs,\n  weaponSortMap,\n} from '../../../../Util/WeaponSort'\nimport { initialWeapon } from '../../../../Util/WeaponUtil'\nimport CompareBuildButton from './CompareBuildButton'\n\nconst rarityHandler = handleMultiSelect([...allRarityKeys])\n\nexport default function WeaponSwapModal({\n  onChangeId,\n  weaponTypeKey,\n  show,\n  onClose,\n}: {\n  onChangeId: (id: string) => void\n  weaponTypeKey: WeaponTypeKey\n  show: boolean\n  onClose: () => void\n}) {\n  const { t } = useTranslation([\n    'page_character',\n    'page_weapon',\n    'weaponNames_gen',\n  ])\n  const { database } = useContext(DatabaseContext)\n  const [newWeaponModalShow, setnewWeaponModalShow] = useState(false)\n  const clickHandler = useCallback(\n    (id: string) => {\n      onChangeId(id)\n      onClose()\n    },\n    [onChangeId, onClose]\n  )\n\n  const [editWeaponId, setEditWeaponId] = useState('')\n  const newWeapon = useCallback(\n    (weaponKey: WeaponKey) => {\n      setEditWeaponId(database.weapons.new(initialWeapon(weaponKey)))\n    },\n    [database, setEditWeaponId]\n  )\n  const resetEditWeapon = useCallback(() => setEditWeaponId(''), [])\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(\n    () => database.weapons.followAny(forceUpdate),\n    [forceUpdate, database]\n  )\n\n  const [rarity, setRarity] = useState<RarityKey[]>([5, 4, 3])\n  const [searchTerm, setSearchTerm] = useState('')\n  const deferredSearchTerm = useDeferredValue(searchTerm)\n\n  const weaponIdList = useMemo(\n    () =>\n      (dbDirty &&\n        database.weapons.values\n          .filter(\n            filterFunction(\n              { weaponType: weaponTypeKey, rarity, name: deferredSearchTerm },\n              weaponFilterConfigs()\n            )\n          )\n          .sort(\n            sortFunction(\n              weaponSortMap['level'] ?? [],\n              false,\n              weaponSortConfigs()\n            )\n          )\n          .map((weapon) => weapon.id)) ??\n      [],\n    [dbDirty, database, rarity, weaponTypeKey, deferredSearchTerm]\n  )\n\n  return (\n    <ModalWrapper open={show} onClose={onClose}>\n      <CardDark>\n        <Suspense fallback={false}>\n          <WeaponSelectionModal\n            show={newWeaponModalShow}\n            onHide={() => setnewWeaponModalShow(false)}\n            onSelect={newWeapon}\n            weaponTypeFilter={weaponTypeKey}\n          />\n        </Suspense>\n        {/* Editor/character detail display */}\n        <Suspense fallback={false}>\n          <WeaponEditor\n            weaponId={editWeaponId}\n            footer\n            onClose={resetEditWeapon}\n          />\n        </Suspense>\n        <CardContent sx={{ py: 1 }}>\n          <Grid container>\n            <Grid item flexGrow={1}>\n              <Typography variant=\"h6\">\n                {weaponTypeKey ? (\n                  <ImgIcon src={Assets.weaponTypes[weaponTypeKey]} />\n                ) : null}{' '}\n                {t`page_character:tabEquip.swapWeapon`}\n              </Typography>\n            </Grid>\n            <Grid item>\n              <CloseButton onClick={onClose} />\n            </Grid>\n          </Grid>\n        </CardContent>\n        <Divider />\n        <CardContent sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n          <Grid container spacing={1}>\n            <Grid item>\n              <SolidToggleButtonGroup\n                sx={{ height: '100%' }}\n                value={rarity}\n                size=\"small\"\n              >\n                {allRarityKeys.map((star) => (\n                  <ToggleButton\n                    key={star}\n                    value={star}\n                    onClick={() => setRarity(rarityHandler(rarity, star))}\n                  >\n                    <Box display=\"flex\">\n                      <strong>{star}</strong>\n                      <StarRoundedIcon />\n                    </Box>\n                  </ToggleButton>\n                ))}\n              </SolidToggleButtonGroup>\n            </Grid>\n            <Grid item flexGrow={1}>\n              <TextField\n                autoFocus\n                size=\"small\"\n                value={searchTerm}\n                onChange={(e: ChangeEvent<HTMLTextAreaElement>) =>\n                  setSearchTerm(e.target.value)\n                }\n                label={t('page_weapon:weaponName')}\n                sx={{ height: '100%' }}\n                InputProps={{\n                  sx: { height: '100%' },\n                }}\n              />\n            </Grid>\n          </Grid>\n          <Button\n            fullWidth\n            onClick={() => setnewWeaponModalShow(true)}\n            color=\"info\"\n            startIcon={<Add />}\n          >\n            {t('page_weapon:addWeapon')}\n          </Button>\n          <Grid container spacing={1}>\n            {weaponIdList.map((weaponId) => (\n              <Grid item key={weaponId} xs={6} sm={6} md={4} lg={3}>\n                <WeaponCard\n                  weaponId={weaponId}\n                  onClick={clickHandler}\n                  extraButtons={<CompareBuildButton weaponId={weaponId} />}\n                />\n              </Grid>\n            ))}\n          </Grid>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n","import type { ArtifactSlotKey, WeaponTypeKey } from '@genshin-optimizer/consts'\nimport { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport { Settings, SwapHoriz } from '@mui/icons-material'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  ListItem,\n  Stack,\n  Tooltip,\n  Typography,\n  useMediaQuery,\n  useTheme,\n} from '@mui/material'\nimport {\n  lazy,\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport SetEffectDisplay from '../../../../Components/Artifact/SetEffectDisplay'\nimport SlotIcon from '../../../../Components/Artifact/SlotIcon'\nimport SubstatToggle from '../../../../Components/Artifact/SubstatToggle'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport DocumentDisplay from '../../../../Components/DocumentDisplay'\nimport {\n  BasicFieldDisplay,\n  FieldDisplayList,\n} from '../../../../Components/FieldDisplay'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport PercentBadge from '../../../../Components/PercentBadge'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { dataSetEffects } from '../../../../Data/Artifacts'\nimport Artifact from '../../../../Data/Artifacts/Artifact'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { uiInput as input } from '../../../../Formula'\nimport ArtifactCard from '../../../../PageArtifact/ArtifactCard'\nimport WeaponCard from '../../../../PageWeapon/WeaponCard'\nimport useBoolState from '../../../../ReactHooks/useBoolState'\nimport useCharMeta from '../../../../ReactHooks/useCharMeta'\nimport { iconInlineProps } from '../../../../SVGIcons'\nimport { allSubstatKeys } from '../../../../Types/artifact'\nimport { charKeyToLocCharKey } from '../../../../Types/consts'\nimport type { IFieldDisplay } from '../../../../Types/fieldDisplay'\nimport ArtifactSwapModal from './ArtifactSwapModal'\nimport WeaponSwapModal from './WeaponSwapModal'\n\nconst WeaponEditor = lazy(() => import('../../../../PageWeapon/WeaponEditor'))\n\nexport default function EquipmentSection() {\n  const {\n    character: { equippedWeapon, key: characterKey },\n    characterSheet,\n  } = useContext(CharacterContext)\n  const { teamData, data } = useContext(DataContext)\n  const weaponSheet = teamData[characterKey]?.weaponSheet\n  const [weaponId, setweaponId] = useState('')\n  const showWeapon = useCallback(\n    () => setweaponId(equippedWeapon),\n    [equippedWeapon]\n  )\n  const hideWeapon = useCallback(() => setweaponId(''), [])\n\n  //triggers when character swap weapons\n  useEffect(() => {\n    if (weaponId && weaponId !== equippedWeapon) setweaponId(equippedWeapon)\n  }, [weaponId, equippedWeapon])\n\n  const theme = useTheme()\n  const breakpoint = useMediaQuery(theme.breakpoints.up('lg'))\n\n  const weaponDoc = useMemo(\n    () =>\n      weaponSheet &&\n      weaponSheet.document.length > 0 && (\n        <CardLight>\n          <Box p={1}>\n            <DocumentDisplay sections={weaponSheet.document} />\n          </Box>\n        </CardLight>\n      ),\n    [weaponSheet]\n  )\n  const { rvFilter } = useCharMeta(characterKey)\n  const deferredRvFilter = useDeferredValue(rvFilter)\n  const deferredRvSet = useMemo(\n    () => new Set(deferredRvFilter),\n    [deferredRvFilter]\n  )\n  return (\n    <Box>\n      <Suspense fallback={false}>\n        <WeaponEditor\n          weaponId={weaponId}\n          footer\n          onClose={hideWeapon}\n          extraButtons={\n            <LargeWeaponSwapButton\n              weaponTypeKey={characterSheet.weaponTypeKey}\n            />\n          }\n        />\n      </Suspense>\n      <Grid container spacing={1}>\n        {breakpoint && (\n          <Grid\n            item\n            xs={12}\n            md={12}\n            lg={3}\n            xl={3}\n            sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n          >\n            {weaponDoc && weaponDoc}\n            <ArtifactSectionCard />\n          </Grid>\n        )}\n        <Grid item xs={12} md={12} lg={9} xl={9} container spacing={1}>\n          <Grid\n            item\n            xs={12}\n            sm={6}\n            md={4}\n            display=\"flex\"\n            flexDirection=\"column\"\n            gap={1}\n          >\n            <WeaponCard\n              weaponId={equippedWeapon}\n              onEdit={showWeapon}\n              canEquip\n              extraButtons={\n                <WeaponSwapButton\n                  weaponTypeKey={characterSheet.weaponTypeKey}\n                />\n              }\n            />\n          </Grid>\n          {allArtifactSlotKeys.map((slotKey) => (\n            <Grid item xs={12} sm={6} md={4} key={slotKey}>\n              {data.get(input.art[slotKey].id).value ? (\n                <ArtifactCard\n                  artifactId={data.get(input.art[slotKey].id).value}\n                  effFilter={deferredRvSet}\n                  extraButtons={<ArtifactSwapButton slotKey={slotKey} />}\n                  editorProps={{}}\n                  canEquip\n                />\n              ) : (\n                <ArtSwapCard slotKey={slotKey} />\n              )}\n            </Grid>\n          ))}\n        </Grid>\n        {!breakpoint && (\n          <Grid item xs={12} md={12} xl={3} container spacing={1}>\n            {weaponDoc && (\n              <Grid item xs={12} md={6} lg={4}>\n                {weaponDoc}\n              </Grid>\n            )}\n            <Grid\n              item\n              xs={12}\n              md={6}\n              lg={4}\n              sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n            >\n              <ArtifactSectionCard />\n            </Grid>\n          </Grid>\n        )}\n      </Grid>\n    </Box>\n  )\n}\nfunction ArtSwapCard({ slotKey }: { slotKey: ArtifactSlotKey }) {\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  const { t } = useTranslation('artifact')\n  return (\n    <CardLight\n      sx={{\n        height: '100%',\n        width: '100%',\n        minHeight: 300,\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n    >\n      <CardContent>\n        <Typography>\n          <SlotIcon iconProps={iconInlineProps} slotKey={slotKey} />{' '}\n          {t(`slotName.${slotKey}`)}\n        </Typography>\n      </CardContent>\n      <Divider />\n      <Box\n        sx={{\n          flexGrow: 1,\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n        }}\n      >\n        <ArtifactSwapModal\n          slotKey={slotKey}\n          show={show}\n          onClose={onClose}\n          onChangeId={(id) =>\n            database.arts.set(id, {\n              location: charKeyToLocCharKey(characterKey),\n            })\n          }\n        />\n        <Button onClick={onOpen} color=\"info\" sx={{ borderRadius: '1em' }}>\n          <SwapHoriz sx={{ height: 100, width: 100 }} />\n        </Button>\n      </Box>\n    </CardLight>\n  )\n}\nfunction WeaponSwapButton({ weaponTypeKey }: { weaponTypeKey: WeaponTypeKey }) {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  return (\n    <>\n      <Tooltip\n        title={<Typography>{t`tabEquip.swapWeapon`}</Typography>}\n        placement=\"top\"\n        arrow\n      >\n        <Button color=\"info\" size=\"small\" onClick={onOpen}>\n          <SwapHoriz />\n        </Button>\n      </Tooltip>\n      <WeaponSwapModal\n        weaponTypeKey={weaponTypeKey}\n        onChangeId={(id) =>\n          database.weapons.set(id, {\n            location: charKeyToLocCharKey(characterKey),\n          })\n        }\n        show={show}\n        onClose={onClose}\n      />\n    </>\n  )\n}\nfunction LargeWeaponSwapButton({\n  weaponTypeKey,\n}: {\n  weaponTypeKey: WeaponTypeKey\n}) {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  return (\n    <>\n      <Button\n        color=\"info\"\n        onClick={onOpen}\n        startIcon={<SwapHoriz />}\n      >{t`tabEquip.swapWeapon`}</Button>\n      <WeaponSwapModal\n        weaponTypeKey={weaponTypeKey}\n        onChangeId={(id) =>\n          database.weapons.set(id, {\n            location: charKeyToLocCharKey(characterKey),\n          })\n        }\n        show={show}\n        onClose={onClose}\n      />\n    </>\n  )\n}\nfunction ArtifactSwapButton({ slotKey }: { slotKey: ArtifactSlotKey }) {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  return (\n    <>\n      <Tooltip\n        title={<Typography>{t`tabEquip.swapArt`}</Typography>}\n        placement=\"top\"\n        arrow\n      >\n        <Button color=\"info\" size=\"small\" onClick={onOpen}>\n          <SwapHoriz />\n        </Button>\n      </Tooltip>\n      <ArtifactSwapModal\n        slotKey={slotKey}\n        show={show}\n        onClose={onClose}\n        onChangeId={(id) =>\n          database.arts.set(id, { location: charKeyToLocCharKey(characterKey) })\n        }\n      />\n    </>\n  )\n}\nfunction ArtifactSectionCard() {\n  const { t } = useTranslation(['page_character', 'artifact'])\n  const { database } = useContext(DatabaseContext)\n  const {\n    character,\n    character: { key: characterKey, equippedArtifacts },\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const hasEquipped = useMemo(\n    () => !!Object.values(equippedArtifacts).filter((i) => i).length,\n    [equippedArtifacts]\n  )\n  const unequipArts = useCallback(() => {\n    if (!character) return\n    if (\n      !window.confirm(\n        'Do you want to move all currently equipped artifacts to inventory?'\n      )\n    )\n      return\n    Object.values(equippedArtifacts).forEach((aid) =>\n      database.arts.set(aid, { location: '' })\n    )\n  }, [character, database, equippedArtifacts])\n\n  const setEffects = useMemo(() => dataSetEffects(data), [data])\n  const { rvFilter } = useCharMeta(characterKey)\n  const setRVFilter = useCallback(\n    (rvFilter) => database.charMeta.set(characterKey, { rvFilter }),\n    [database, characterKey]\n  )\n\n  const [show, onShow, onHide] = useBoolState()\n  const deferredrvFilter = useDeferredValue(rvFilter)\n  const { rvField, rvmField } = useMemo(() => {\n    const {\n      currentEfficiency,\n      currentEfficiency_,\n      maxEfficiency,\n      maxEfficiency_,\n    } = Object.values(equippedArtifacts).reduce(\n      (a, artid) => {\n        const art = database.arts.get(artid)\n        if (art) {\n          const { currentEfficiency, maxEfficiency } =\n            Artifact.getArtifactEfficiency(art, new Set(deferredrvFilter))\n          const {\n            currentEfficiency: currentEfficiency_,\n            maxEfficiency: maxEfficiency_,\n          } = Artifact.getArtifactEfficiency(art, new Set(allSubstatKeys))\n          a.currentEfficiency = a.currentEfficiency + currentEfficiency\n          a.maxEfficiency = a.maxEfficiency + maxEfficiency\n\n          a.currentEfficiency_ = a.currentEfficiency_ + currentEfficiency_\n          a.maxEfficiency_ = a.maxEfficiency_ + maxEfficiency_\n        }\n        return a\n      },\n      {\n        currentEfficiency: 0,\n        currentEfficiency_: 0,\n        maxEfficiency: 0,\n        maxEfficiency_: 0,\n      }\n    )\n    const rvField: IFieldDisplay = {\n      text: t`artifact:editor.curSubEff`,\n      value: !(currentEfficiency - currentEfficiency_) ? (\n        <PercentBadge value={currentEfficiency} max={4500} valid />\n      ) : (\n        <span>\n          <PercentBadge value={currentEfficiency} max={4500} valid /> /{' '}\n          <PercentBadge value={currentEfficiency_} max={4500} valid />\n        </span>\n      ),\n    }\n    const rvmField: IFieldDisplay = {\n      text: t`artifact:editor.maxSubEff`,\n      canShow: () => !!(currentEfficiency_ - maxEfficiency_),\n      value: !(maxEfficiency - maxEfficiency_) ? (\n        <PercentBadge value={maxEfficiency} max={4500} valid />\n      ) : (\n        <span>\n          <PercentBadge value={maxEfficiency} max={4500} valid /> /{' '}\n          <PercentBadge value={maxEfficiency_} max={4500} valid />\n        </span>\n      ),\n    }\n    return { rvField, rvmField }\n  }, [t, deferredrvFilter, equippedArtifacts, database])\n\n  return (\n    <CardLight>\n      {hasEquipped && (\n        <Button\n          color=\"error\"\n          onClick={unequipArts}\n          fullWidth\n          sx={{ borderBottomRightRadius: 0, borderBottomLeftRadius: 0 }}\n        >{t`tabEquip.unequipArts`}</Button>\n      )}\n      <Box p={1}>\n        <Stack spacing={1}>\n          <CardDark>\n            <Button\n              fullWidth\n              color=\"info\"\n              startIcon={<Settings />}\n              sx={{ borderBottomLeftRadius: 0, borderBottomRightRadius: 0 }}\n              onClick={onShow}\n            >\n              RV Filter\n            </Button>\n            <ModalWrapper open={show} onClose={onHide}>\n              <CardDark>\n                <CardContent>\n                  <Typography\n                    textAlign=\"center\"\n                    gutterBottom\n                    variant=\"h6\"\n                  >{t`artifact:efficiencyFilter.title`}</Typography>\n                  <SubstatToggle\n                    selectedKeys={rvFilter}\n                    onChange={setRVFilter}\n                  />\n                </CardContent>\n              </CardDark>\n            </ModalWrapper>\n            <FieldDisplayList>\n              <BasicFieldDisplay field={rvField} component={ListItem} />\n              {rvmField?.canShow?.(data) && (\n                <BasicFieldDisplay field={rvmField} component={ListItem} />\n              )}\n            </FieldDisplayList>\n          </CardDark>\n          {setEffects &&\n            Object.entries(setEffects).flatMap(([setKey, setNumKeyArr]) =>\n              setNumKeyArr.map((setNumKey) => (\n                <CardDark\n                  key={setKey + setNumKey}\n                  sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}\n                >\n                  <SetEffectDisplay\n                    key={setKey + setNumKey}\n                    setKey={setKey}\n                    setNumKey={setNumKey}\n                  />\n                </CardDark>\n              ))\n            )}\n        </Stack>\n      </Box>\n    </CardLight>\n  )\n}\n","import { charCard } from '@genshin-optimizer/char-cards'\nimport type { AscensionKey, CharacterKey } from '@genshin-optimizer/consts'\nimport { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport { splash } from '@genshin-optimizer/silly-wisher'\nimport { Favorite, FavoriteBorder } from '@mui/icons-material'\nimport {\n  Badge,\n  Box,\n  CardActionArea,\n  Chip,\n  Grid,\n  IconButton,\n  Stack,\n  Typography,\n} from '@mui/material'\nimport { useCallback, useContext, useRef } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport Assets from '../../../../Assets/Assets'\nimport ArtifactCardNano from '../../../../Components/Artifact/ArtifactCardNano'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport CharacterCardPico, {\n  BlankCharacterCardPico,\n} from '../../../../Components/Character/CharacterCardPico'\nimport StatDisplayComponent from '../../../../Components/Character/StatDisplayComponent'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport SqBadge from '../../../../Components/SqBadge'\nimport { StarsDisplay } from '../../../../Components/StarDisplay'\nimport WeaponCardNano from '../../../../Components/Weapon/WeaponCardNano'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { SillyContext } from '../../../../Context/SillyContext'\nimport type { TalentSheetElementKey } from '../../../../Data/Characters/ICharacterSheet'\nimport { getLevelString } from '../../../../Data/LevelData'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { uiInput as input } from '../../../../Formula'\nimport { ElementIcon } from '../../../../KeyMap/StatIcon'\nimport useCharacterReducer from '../../../../ReactHooks/useCharacterReducer'\nimport useCharMeta from '../../../../ReactHooks/useCharMeta'\nimport useDBMeta from '../../../../ReactHooks/useDBMeta'\nimport { range } from '../../../../Util/Util'\nimport EquipmentSection from './EquipmentSection'\n\nexport default function TabOverview() {\n  const scrollRef = useRef<HTMLDivElement>()\n  const onScroll = useCallback(\n    () => scrollRef?.current?.scrollIntoView?.({ behavior: 'smooth' }),\n    [scrollRef]\n  )\n\n  return (\n    <Stack spacing={1}>\n      <Grid container spacing={1} sx={{ justifyContent: 'center' }}>\n        <Grid item xs={8} sm={5} md={4} lg={2.3}>\n          <CharacterProfileCard />\n        </Grid>\n        <Grid\n          item\n          xs={12}\n          sm={7}\n          md={8}\n          lg={9.7}\n          sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n        >\n          <EquipmentRow onClick={onScroll} />\n          <CardLight sx={{ flexGrow: 1, p: 1 }}>\n            <StatDisplayComponent />\n          </CardLight>\n        </Grid>\n      </Grid>\n      <Box ref={scrollRef}>\n        <EquipmentSection />\n      </Box>\n    </Stack>\n  )\n}\nfunction EquipmentRow({ onClick }: { onClick: () => void }) {\n  const {\n    character: { equippedWeapon },\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n\n  return (\n    <Grid container spacing={1} columns={{ xs: 2, sm: 2, md: 3, lg: 6, xl: 6 }}>\n      <Grid item xs={1}>\n        <WeaponCardNano\n          weaponId={equippedWeapon}\n          BGComponent={CardLight}\n          onClick={onClick}\n        />\n      </Grid>\n      {allArtifactSlotKeys.map((slotKey) => (\n        <Grid item key={slotKey} xs={1}>\n          <ArtifactCardNano\n            artifactId={data.get(input.art[slotKey].id).value}\n            slotKey={slotKey}\n            BGComponent={CardLight}\n            onClick={onClick}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n/* Image card with star and name and level */\nfunction CharacterProfileCard() {\n  const { silly } = useContext(SillyContext)\n  const {\n    characterSheet,\n    character: { key: characterKey, team },\n  } = useContext(CharacterContext)\n  const { gender } = useDBMeta()\n  const { data } = useContext(DataContext)\n  const characterDispatch = useCharacterReducer(characterKey)\n  const navigate = useNavigate()\n  const level = data.get(input.lvl).value\n  const ascension = data.get(input.asc).value as AscensionKey\n  const constellation = data.get(input.constellation).value\n  const tlvl = {\n    auto: data.get(input.total.auto).value,\n    skill: data.get(input.total.skill).value,\n    burst: data.get(input.total.burst).value,\n  }\n  const tBoost = {\n    auto: data.get(input.total.autoBoost).value,\n    skill: data.get(input.total.skillBoost).value,\n    burst: data.get(input.total.burstBoost).value,\n  }\n  const sillySplash = splash(characterKey, gender)\n  const card = charCard(characterKey, gender)\n\n  return (\n    <CardLight sx={{ height: '100%' }}>\n      {silly && sillySplash ? (\n        <SillyCoverArea src={sillySplash} level={level} ascension={ascension} />\n      ) : (\n        <CoverArea src={card} level={level} ascension={ascension} />\n      )}\n      <Box>\n        <CardActionArea sx={{ p: 1 }} onClick={() => navigate('talent')}>\n          <Grid container spacing={1} mt={-1}>\n            {(['auto', 'skill', 'burst'] as TalentSheetElementKey[]).map(\n              (tKey) => (\n                <Grid item xs={4} key={tKey}>\n                  <Badge\n                    badgeContent={tlvl[tKey]}\n                    color={tBoost[tKey] ? 'info' : 'secondary'}\n                    overlap=\"circular\"\n                    anchorOrigin={{\n                      vertical: 'bottom',\n                      horizontal: 'right',\n                    }}\n                    sx={{\n                      width: '100%',\n                      height: '100%',\n                      '& > .MuiBadge-badge': {\n                        fontSize: '1.25em',\n                        padding: '.25em .4em',\n                        borderRadius: '.5em',\n                        lineHeight: 1,\n                        height: '1.25em',\n                      },\n                    }}\n                  >\n                    <Box\n                      component=\"img\"\n                      src={characterSheet.getTalentOfKey(tKey)?.img}\n                      width=\"100%\"\n                      height=\"auto\"\n                    />\n                  </Badge>\n                </Grid>\n              )\n            )}\n          </Grid>\n        </CardActionArea>\n        <Typography sx={{ textAlign: 'center', mt: 1 }} variant=\"h6\">\n          {characterSheet.constellationName}\n        </Typography>\n        <Grid container spacing={1}>\n          {range(1, 6).map((i) => (\n            <Grid item xs={4} key={i}>\n              <CardActionArea\n                onClick={() =>\n                  characterDispatch({\n                    constellation: i === constellation ? i - 1 : i,\n                  })\n                }\n              >\n                <Box\n                  component=\"img\"\n                  src={\n                    characterSheet.getTalentOfKey(\n                      `constellation${i}` as TalentSheetElementKey\n                    )?.img\n                  }\n                  sx={{\n                    ...(constellation >= i\n                      ? {}\n                      : { filter: 'brightness(50%)' }),\n                  }}\n                  width=\"100%\"\n                  height=\"auto\"\n                />\n              </CardActionArea>\n            </Grid>\n          ))}\n        </Grid>\n        <CardActionArea sx={{ p: 1 }} onClick={() => navigate('teambuffs')}>\n          <Grid container columns={3} spacing={1}>\n            {range(0, 2).map((i) => (\n              <Grid key={i} item xs={1} height=\"100%\">\n                {team[i] ? (\n                  <CharacterCardPico characterKey={team[i] as CharacterKey} />\n                ) : (\n                  <BlankCharacterCardPico index={i} />\n                )}\n              </Grid>\n            ))}\n          </Grid>\n        </CardActionArea>\n      </Box>\n    </CardLight>\n  )\n}\nfunction SillyCoverArea({ src, level, ascension }) {\n  const { characterSheet } = useContext(CharacterContext)\n\n  return (\n    <Box sx={{ position: 'relative' }}>\n      <Box src={src} component=\"img\" width=\"100%\" height=\"auto\" />\n      <Box sx={{ width: '100%', height: '100%' }}>\n        <Box\n          sx={{\n            opacity: 0.85,\n            width: '100%',\n            display: 'flex',\n            justifyContent: 'center',\n            px: 1,\n          }}\n        >\n          <CharChip />\n        </Box>\n        <Typography\n          variant=\"h6\"\n          sx={{\n            width: '100%',\n            opacity: 0.75,\n            textAlign: 'center',\n          }}\n        >\n          <StarsDisplay stars={characterSheet.rarity} colored />\n        </Typography>\n        <FavoriteButton />\n        <LevelBadge level={level} ascension={ascension} />\n      </Box>\n    </Box>\n  )\n}\n\nfunction CoverArea({ src, level, ascension }) {\n  const { characterSheet } = useContext(CharacterContext)\n\n  return (\n    <Box sx={{ position: 'relative' }}>\n      <Box sx={{ position: 'absolute', width: '100%', height: '100%' }}>\n        <Typography\n          variant=\"h6\"\n          sx={{\n            position: 'absolute',\n            width: '100%',\n            left: '50%',\n            bottom: 0,\n            transform: 'translate(-50%, -50%)',\n            opacity: 0.75,\n            textAlign: 'center',\n          }}\n        >\n          <StarsDisplay stars={characterSheet.rarity} colored />\n        </Typography>\n        <Box\n          sx={{\n            position: 'absolute',\n            left: '50%',\n            bottom: '7%',\n            transform: 'translate(-50%, -50%)',\n            opacity: 0.85,\n            width: '100%',\n            display: 'flex',\n            justifyContent: 'center',\n            px: 1,\n          }}\n        >\n          <CharChip />\n        </Box>\n        <FavoriteButton />\n        <LevelBadge level={level} ascension={ascension} />\n      </Box>\n      <Box src={src} component=\"img\" width=\"100%\" height=\"auto\"></Box>\n    </Box>\n  )\n}\n\nfunction CharChip() {\n  const { characterSheet } = useContext(CharacterContext)\n  const charEle = characterSheet.elementKey\n  return (\n    <Chip\n      color={charEle}\n      sx={{ height: 'auto' }}\n      label={\n        <Typography\n          variant=\"h6\"\n          sx={{ display: 'flex', gap: 1, alignItems: 'center' }}\n        >\n          <ElementIcon ele={charEle} />\n          <Box sx={{ whiteSpace: 'normal', textAlign: 'center' }}>\n            {characterSheet.name}\n          </Box>\n          <ImgIcon src={Assets.weaponTypes?.[characterSheet.weaponTypeKey]} />\n        </Typography>\n      }\n    />\n  )\n}\nfunction LevelBadge({\n  level,\n  ascension,\n}: {\n  level: number\n  ascension: AscensionKey\n}) {\n  return (\n    <Typography\n      sx={{ p: 1, position: 'absolute', right: 0, top: 0, opacity: 0.8 }}\n    >\n      <SqBadge>{getLevelString(level, ascension)}</SqBadge>\n    </Typography>\n  )\n}\nfunction FavoriteButton() {\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const { favorite } = useCharMeta(characterKey)\n  return (\n    <Box sx={{ position: 'absolute', left: 0, top: 0 }}>\n      <IconButton\n        sx={{ p: 1 }}\n        color=\"error\"\n        onClick={() =>\n          database.charMeta.set(characterKey, { favorite: !favorite })\n        }\n      >\n        {favorite ? <Favorite /> : <FavoriteBorder />}\n      </IconButton>\n    </Box>\n  )\n}\n","import {\n  Box,\n  CardActionArea,\n  CardContent,\n  Grid,\n  MenuItem,\n  Typography,\n  useMediaQuery,\n  useTheme,\n} from '@mui/material'\nimport { useCallback, useContext, useMemo } from 'react'\nimport CardDark from '../../../Components/Card/CardDark'\nimport CardLight from '../../../Components/Card/CardLight'\nimport ConditionalWrapper from '../../../Components/ConditionalWrapper'\nimport DocumentDisplay from '../../../Components/DocumentDisplay'\nimport DropdownButton from '../../../Components/DropdownMenu/DropdownButton'\nimport { NodeFieldDisplay } from '../../../Components/FieldDisplay'\nimport { CharacterContext } from '../../../Context/CharacterContext'\nimport { DataContext } from '../../../Context/DataContext'\nimport type { TalentSheetElementKey } from '../../../Data/Characters/ICharacterSheet'\nimport { uiInput as input } from '../../../Formula'\nimport type { NumNode } from '../../../Formula/type'\nimport type { NodeDisplay } from '../../../Formula/uiData'\nimport useCharacterReducer from '../../../ReactHooks/useCharacterReducer'\nimport type { DocumentSection } from '../../../Types/sheet'\nimport { range } from '../../../Util/Util'\n\nconst talentSpacing = {\n  xs: 12,\n  sm: 6,\n  md: 4,\n}\n\nexport default function CharacterTalentPane() {\n  const { character, characterSheet } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const characterDispatch = useCharacterReducer(character.key)\n  const skillBurstList = [\n    ['auto', 'Normal/Charged Attack'],\n    ['skill', 'Elemental Skill'],\n    ['burst', 'Elemental Burst'],\n  ] as [TalentSheetElementKey, string][]\n  const passivesList: [\n    tKey: TalentSheetElementKey,\n    tText: string,\n    asc: number\n  ][] = [\n    ['passive1', 'Unlocked at Ascension 1', 1],\n    ['passive2', 'Unlocked at Ascension 4', 4],\n    ['passive3', 'Unlocked by Default', 0],\n  ]\n  const ascension = data.get(input.asc).value\n  const constellation = data.get(input.constellation).value\n\n  const theme = useTheme()\n  const grlg = useMediaQuery(theme.breakpoints.up('lg'))\n  const constellationCards = useMemo(\n    () =>\n      range(1, 6).map((i) => (\n        <SkillDisplayCard\n          talentKey={`constellation${i}` as TalentSheetElementKey}\n          subtitle={`Constellation Lv. ${i}`}\n          onClickTitle={() =>\n            characterDispatch({\n              constellation: i === constellation ? i - 1 : i,\n            })\n          }\n        />\n      )),\n    [constellation, characterDispatch]\n  )\n  return (\n    <>\n      <ReactionDisplay />\n      <Grid container spacing={1}>\n        {/* constellations for 4column */}\n        {grlg && (\n          <Grid\n            item\n            xs={12}\n            md={12}\n            lg={3}\n            sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n          >\n            <CardLight>\n              <CardContent>\n                <Typography variant=\"h6\" sx={{ textAlign: 'center' }}>\n                  Constellation Lv. {constellation}\n                </Typography>\n              </CardContent>\n            </CardLight>\n            {constellationCards.map((c, i) => (\n              <Box key={i} sx={{ opacity: constellation >= i + 1 ? 1 : 0.5 }}>\n                {c}\n              </Box>\n            ))}\n          </Grid>\n        )}\n        <Grid item xs={12} md={12} lg={9} container spacing={1}>\n          {/* auto, skill, burst */}\n          {skillBurstList.map(([tKey, tText]) => (\n            <Grid item key={tKey} {...talentSpacing}>\n              <SkillDisplayCard talentKey={tKey} subtitle={tText} />\n            </Grid>\n          ))}\n          {!!characterSheet.getTalentOfKey('sprint') && (\n            <Grid item {...talentSpacing}>\n              <SkillDisplayCard\n                talentKey=\"sprint\"\n                subtitle=\"Alternative Sprint\"\n              />\n            </Grid>\n          )}\n          {!!characterSheet.getTalentOfKey('passive') && (\n            <Grid item {...talentSpacing}>\n              <SkillDisplayCard talentKey=\"passive\" subtitle=\"Passive\" />\n            </Grid>\n          )}\n          {/* passives */}\n          {passivesList.map(([tKey, tText, asc]) => {\n            const enabled = ascension >= asc\n            if (!characterSheet.getTalentOfKey(tKey)) return null\n            return (\n              <Grid\n                item\n                key={tKey}\n                style={{ opacity: enabled ? 1 : 0.5 }}\n                {...talentSpacing}\n              >\n                <SkillDisplayCard talentKey={tKey} subtitle={tText} />\n              </Grid>\n            )\n          })}\n        </Grid>\n        {/* constellations for < 4 columns */}\n        {!grlg && (\n          <Grid item xs={12} md={12} lg={3} container spacing={1}>\n            <Grid item xs={12}>\n              <CardLight>\n                <CardContent>\n                  <Typography variant=\"h6\" sx={{ textAlign: 'center' }}>\n                    Constellation Lv. {constellation}\n                  </Typography>\n                </CardContent>\n              </CardLight>\n            </Grid>\n            {constellationCards.map((c, i) => (\n              <Grid\n                item\n                key={i}\n                sx={{ opacity: constellation >= i + 1 ? 1 : 0.5 }}\n                {...talentSpacing}\n              >\n                {c}\n              </Grid>\n            ))}\n          </Grid>\n        )}\n      </Grid>\n    </>\n  )\n}\nfunction ReactionDisplay() {\n  const { data } = useContext(DataContext)\n  const reaction = data.getDisplay().reaction as { [key: string]: NodeDisplay }\n  return (\n    <CardLight>\n      <CardContent>\n        <Grid container spacing={1}>\n          {Object.entries(reaction)\n            .filter(([_, node]) => !node.isEmpty)\n            .map(([key, node]) => {\n              return (\n                <Grid item key={key}>\n                  <CardDark>\n                    <CardContent sx={{ p: 1, '&:last-child': { pb: 1 } }}>\n                      <NodeFieldDisplay node={node} />\n                    </CardContent>\n                  </CardDark>\n                </Grid>\n              )\n            })}\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\n\nconst talentLimits = [1, 1, 2, 4, 6, 8, 10]\ntype SkillDisplayCardProps = {\n  talentKey: TalentSheetElementKey\n  subtitle: string\n  onClickTitle?: (any) => any\n}\nfunction SkillDisplayCard({\n  talentKey,\n  subtitle,\n  onClickTitle,\n}: SkillDisplayCardProps) {\n  const {\n    character: { talent },\n    characterSheet,\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n\n  const actionWrapperFunc = useCallback(\n    (children) => (\n      <CardActionArea onClick={onClickTitle}>{children}</CardActionArea>\n    ),\n    [onClickTitle]\n  )\n\n  const setTalentLevel = useCallback(\n    (tKey: TalentSheetElementKey, newTalentLevelKey: number) =>\n      characterDispatch({ talent: { ...talent, [tKey]: newTalentLevelKey } }),\n    [talent, characterDispatch]\n  )\n\n  let header: Displayable | null = null\n\n  if (talentKey in talent) {\n    const levelBoost = data.get(\n      input.total[`${talentKey}Boost`] as NumNode\n    ).value\n    const level = data.get(input.total[talentKey]).value\n    const asc = data.get(input.asc).value\n\n    header = (\n      <DropdownButton\n        fullWidth\n        title={`Talent Lv. ${level}`}\n        color={levelBoost ? 'info' : 'primary'}\n        sx={{ borderRadius: 0 }}\n      >\n        {range(1, talentLimits[asc]).map((i) => (\n          <MenuItem\n            key={i}\n            selected={talent[talentKey] === i}\n            disabled={talent[talentKey] === i}\n            onClick={() => setTalentLevel(talentKey, i)}\n          >\n            Talent Lv. {i + levelBoost}\n          </MenuItem>\n        ))}\n      </DropdownButton>\n    )\n  }\n  const talentSheet = characterSheet.getTalentOfKey(talentKey)\n\n  // Hide header if the header matches the current talent\n  const hideHeader = (section: DocumentSection): boolean => {\n    const headerAction = section.header?.action\n    if (headerAction && typeof headerAction !== 'string') {\n      const key: string = headerAction.props.children.props.key18\n      return key.includes(talentKey)\n    }\n    return false\n  }\n\n  return (\n    <CardLight sx={{ height: '100%' }}>\n      {header}\n      <CardContent>\n        <ConditionalWrapper\n          condition={!!onClickTitle}\n          wrapper={actionWrapperFunc}\n        >\n          <Grid container sx={{ flexWrap: 'nowrap' }}>\n            <Grid item>\n              <Box\n                component=\"img\"\n                src={talentSheet?.img}\n                sx={{ width: 60, height: 'auto' }}\n              />\n            </Grid>\n            <Grid item flexGrow={1} sx={{ pl: 1 }}>\n              <Typography variant=\"h6\">{talentSheet?.name}</Typography>\n              <Typography variant=\"subtitle1\">{subtitle}</Typography>\n            </Grid>\n          </Grid>\n        </ConditionalWrapper>\n        {/* Display document sections */}\n        {talentSheet?.sections ? (\n          <DocumentDisplay\n            sections={talentSheet.sections}\n            hideDesc\n            hideHeader={hideHeader}\n          />\n        ) : null}\n      </CardContent>\n    </CardLight>\n  )\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { PersonAdd } from '@mui/icons-material'\nimport type { AutocompleteProps } from '@mui/material'\nimport {\n  Box,\n  CardContent,\n  CardHeader,\n  Divider,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport { Suspense, useCallback, useContext, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CardLight from '../../../Components/Card/CardLight'\nimport CharacterCard from '../../../Components/Character/CharacterCard'\nimport ColorText from '../../../Components/ColoredText'\nimport DocumentDisplay from '../../../Components/DocumentDisplay'\nimport { NodeFieldDisplay } from '../../../Components/FieldDisplay'\nimport type { GeneralAutocompleteOption } from '../../../Components/GeneralAutocomplete'\nimport { GeneralAutocomplete } from '../../../Components/GeneralAutocomplete'\nimport CharIconSide from '../../../Components/Image/CharIconSide'\nimport { InfoTooltipInline } from '../../../Components/InfoTooltip'\nimport type { CharacterContextObj } from '../../../Context/CharacterContext'\nimport { CharacterContext } from '../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../Context/DataContext'\nimport { DataContext } from '../../../Context/DataContext'\nimport { SillyContext } from '../../../Context/SillyContext'\nimport { dataSetEffects, getArtSheet } from '../../../Data/Artifacts'\nimport { getCharSheet } from '../../../Data/Characters'\nimport { resonanceSheets } from '../../../Data/Resonance'\nimport { DatabaseContext } from '../../../Database/Database'\nimport type { NodeDisplay } from '../../../Formula/uiData'\nimport useCharSelectionCallback from '../../../ReactHooks/useCharSelectionCallback'\nimport useDBMeta from '../../../ReactHooks/useDBMeta'\nimport { charKeyToCharName } from '../../../Types/consts'\nimport { objPathValue, range } from '../../../Util/Util'\n\nexport default function TabTeambuffs() {\n  return (\n    <Box display=\"flex\" flexDirection=\"column\" gap={1} alignItems=\"stretch\">\n      <Grid container spacing={1}>\n        <Grid\n          item\n          xs={12}\n          md={6}\n          lg={3}\n          sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n        >\n          <TeamBuffDisplay />\n          <ResonanceDisplay />\n        </Grid>\n        {range(0, 2).map((i) => (\n          <Grid item xs={12} md={6} lg={3} key={i}>\n            <TeammateDisplay index={i} />\n          </Grid>\n        ))}\n      </Grid>\n    </Box>\n  )\n}\nexport function TeamBuffDisplay() {\n  const { data, oldData } = useContext(DataContext)\n  const teamBuffs = data.getTeamBuff()\n  const nodes: Array<[string[], NodeDisplay<number>]> = []\n  Object.entries(teamBuffs.total ?? {}).forEach(\n    ([key, node]) =>\n      !node.isEmpty && node.value !== 0 && nodes.push([['total', key], node])\n  )\n  Object.entries(teamBuffs.premod ?? {}).forEach(\n    ([key, node]) =>\n      !node.isEmpty && node.value !== 0 && nodes.push([['premod', key], node])\n  )\n  Object.entries(teamBuffs.enemy ?? {}).forEach(\n    ([key, node]) =>\n      !node.isEmpty &&\n      typeof node.value === 'number' &&\n      node.value !== 0 &&\n      nodes.push([['enemy', key], node as NodeDisplay<number>])\n  )\n  if (!nodes.length) return null\n  return (\n    <CardLight>\n      <CardContent>\n        <Typography>Team Buffs</Typography>\n      </CardContent>\n      <Divider />\n      <CardContent>\n        <Grid container>\n          {nodes.map(\n            ([path, n]) =>\n              n && (\n                <Grid item xs={12} key={JSON.stringify(n.info)}>\n                  <NodeFieldDisplay\n                    node={n}\n                    oldValue={objPathValue(oldData?.getTeamBuff(), path)?.value}\n                  />\n                </Grid>\n              )\n          )}\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction ResonanceDisplay() {\n  const { t } = useTranslation('page_character')\n  const { data } = useContext(DataContext)\n  const {\n    character: { team },\n  } = useContext(CharacterContext)\n  const teamCount = team.reduce((a, t) => a + (t ? 1 : 0), 1)\n  return (\n    <>\n      <CardLight>\n        <CardHeader\n          title={\n            <span>\n              {t('tabTeambuff.team_reso')}{' '}\n              <strong>\n                <ColorText color={teamCount >= 4 ? 'success' : 'warning'}>\n                  ({teamCount}/4)\n                </ColorText>\n              </strong>{' '}\n              <InfoTooltipInline\n                title={<Typography>{t`tabTeambuff.resonance_tip`}</Typography>}\n              />\n            </span>\n          }\n          titleTypographyProps={{ variant: 'subtitle2' }}\n        />\n      </CardLight>\n      {resonanceSheets.map((res, i) => (\n        <CardLight key={i} sx={{ opacity: res.canShow(data) ? 1 : 0.5 }}>\n          <CardHeader\n            title={\n              <span>\n                {res.name}{' '}\n                <InfoTooltipInline\n                  title={<Typography>{res.desc}</Typography>}\n                />\n              </span>\n            }\n            action={res.icon}\n            titleTypographyProps={{ variant: 'subtitle2' }}\n          />\n          {res.canShow(data) && <Divider />}\n          {res.canShow(data) && (\n            <CardContent>\n              <DocumentDisplay sections={res.sections} teamBuffOnly hideDesc />\n            </CardContent>\n          )}\n        </CardLight>\n      ))}\n    </>\n  )\n}\nfunction TeammateDisplay({ index }: { index: number }) {\n  const { teamData } = useContext(DataContext)\n  const { t } = useTranslation('page_character')\n  const {\n    character: active,\n    character: { key: activeCharacterKey },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const teamMateKey = active.team[index]\n  const team = useMemo(\n    () =>\n      [activeCharacterKey, ...active.team].filter((t, i) => i - 1 !== index),\n    [active.team, activeCharacterKey, index]\n  )\n  const onClickHandler = useCharSelectionCallback()\n  const setTeammate = useCallback(\n    (charKey: CharacterKey | '') =>\n      characterDispatch({ type: 'team', index, charKey }),\n    [index, characterDispatch]\n  )\n\n  const dataBundle = teamData[teamMateKey]\n  const teammateCharacterContext: CharacterContextObj | undefined = useMemo(\n    () =>\n      dataBundle && {\n        character: {\n          ...dataBundle.character,\n          conditional: active.teamConditional[teamMateKey] ?? {},\n        },\n        characterSheet: dataBundle.characterSheet,\n        characterDispatch: (state) => {\n          if (!teamMateKey) return\n          if (!('conditional' in state)) return\n          const { conditional } = state\n          if (!conditional) return\n          characterDispatch({\n            type: 'teamConditional',\n            teamMateKey: teamMateKey,\n            conditional,\n          })\n        },\n      },\n    [active, teamMateKey, dataBundle, characterDispatch]\n  )\n  const teamMateDataContext: dataContextObj | undefined = useMemo(\n    () =>\n      dataBundle && {\n        data: dataBundle.target,\n        teamData: teamData,\n      },\n    [dataBundle, teamData]\n  )\n  return (\n    <CardLight sx={{ overflow: 'visible' }}>\n      <TeammateAutocomplete\n        characterKey={teamMateKey}\n        team={team}\n        setChar={setTeammate}\n        label={t('teammate', { count: index + 1 })}\n      />\n      {teamMateKey && teammateCharacterContext && (\n        <CharacterContext.Provider value={teammateCharacterContext}>\n          {teamMateDataContext && (\n            <DataContext.Provider value={teamMateDataContext}>\n              <CharacterCard\n                characterKey={teamMateKey}\n                onClickHeader={onClickHandler}\n                // Need to wrap these elements with the providers for them to use the correct functions.\n                artifactChildren={\n                  <CharacterContext.Provider value={teammateCharacterContext}>\n                    <DataContext.Provider value={teamMateDataContext}>\n                      <CharArtifactCondDisplay />\n                    </DataContext.Provider>\n                  </CharacterContext.Provider>\n                }\n                weaponChildren={\n                  <CharacterContext.Provider value={teammateCharacterContext}>\n                    <DataContext.Provider value={teamMateDataContext}>\n                      <CharWeaponCondDisplay />\n                    </DataContext.Provider>\n                  </CharacterContext.Provider>\n                }\n                characterChildren={\n                  <CharacterContext.Provider value={teammateCharacterContext}>\n                    <DataContext.Provider value={teamMateDataContext}>\n                      <CharTalentCondDisplay />\n                    </DataContext.Provider>\n                  </CharacterContext.Provider>\n                }\n                isTeammateCard\n              />\n            </DataContext.Provider>\n          )}\n        </CharacterContext.Provider>\n      )}\n    </CardLight>\n  )\n}\nfunction CharArtifactCondDisplay() {\n  const { data } = useContext(DataContext)\n  const sections = useMemo(\n    () =>\n      Object.entries(dataSetEffects(data)).flatMap(([setKey, setNums]) =>\n        setNums.flatMap((sn) => getArtSheet(setKey).setEffectDocument(sn) ?? [])\n      ),\n    [data]\n  )\n  if (!sections) return null\n  return <DocumentDisplay sections={sections} teamBuffOnly={true} />\n}\nfunction CharWeaponCondDisplay() {\n  const {\n    character: { key: charKey },\n  } = useContext(CharacterContext)\n  const { teamData } = useContext(DataContext)\n  const weaponSheet = teamData[charKey]!.weaponSheet\n  if (!weaponSheet.document) return null\n  return <DocumentDisplay sections={weaponSheet.document} teamBuffOnly={true} />\n}\nfunction CharTalentCondDisplay() {\n  const {\n    character: { key: charKey },\n  } = useContext(CharacterContext)\n  const { teamData } = useContext(DataContext)\n  const characterSheet = teamData[charKey]!.characterSheet\n  const sections = Object.values(characterSheet.talent).flatMap(\n    (sts) => sts.sections\n  )\n  if (!sections) return null\n  return <DocumentDisplay sections={sections} teamBuffOnly={true} />\n}\n\nfunction TeammateAutocomplete({\n  characterKey,\n  team,\n  label,\n  setChar,\n  autoCompleteProps = {},\n}: {\n  characterKey: CharacterKey | ''\n  team: Array<CharacterKey | ''>\n  label: string\n  setChar: (k: CharacterKey | '') => void\n  autoCompleteProps?: Omit<\n    AutocompleteProps<\n      GeneralAutocompleteOption<CharacterKey | ''>,\n      false,\n      false,\n      false\n    >,\n    'renderInput' | 'onChange' | 'options'\n  >\n}) {\n  const { t } = useTranslation([\n    'sillyWisher_charNames',\n    'page_character',\n    'sheet_gen',\n    'charNames_gen',\n  ])\n  const { database } = useContext(DatabaseContext)\n  const { gender } = useDBMeta()\n  const { silly } = useContext(SillyContext)\n  const namesCB = useCallback(\n    (key: CharacterKey, silly: boolean): string =>\n      key.startsWith('Traveler')\n        ? `${t(\n            `${\n              silly ? 'sillyWisher_charNames' : 'charNames_gen'\n            }:${charKeyToCharName(key, gender)}`\n          )} (${t(\n            `sheet_gen:element.${getCharSheet(key, gender)?.elementKey}`\n          )})`\n        : t(`${silly ? 'sillyWisher_charNames' : 'charNames_gen'}:${key}`),\n    [t, gender]\n  )\n\n  const toImg = useCallback(\n    (key: CharacterKey | '') =>\n      key ? <CharIconSide characterKey={key} /> : <PersonAdd />,\n    []\n  ) //\n  const isFavorite = useCallback(\n    (key: CharacterKey) => database.charMeta.get(key).favorite,\n    [database]\n  )\n  const onDisable = useCallback(\n    ({ key }: { key: CharacterKey | '' }) =>\n      team.filter((t) => t && t !== characterKey).includes(key) ||\n      (key.startsWith('Traveler') &&\n        team.some((t) => t.startsWith('Traveler'))),\n    [team, characterKey]\n  )\n  const values = useMemo(\n    () =>\n      database.chars.keys\n        .map(\n          (v): GeneralAutocompleteOption<CharacterKey> => ({\n            key: v,\n            label: namesCB(v, silly),\n            favorite: isFavorite(v),\n            alternateNames: [namesCB(v, false)],\n          })\n        )\n        .sort((a, b) => {\n          if (a.favorite && !b.favorite) return -1\n          if (!a.favorite && b.favorite) return 1\n          return a.label.localeCompare(b.label)\n        }),\n    [database.chars.keys, namesCB, isFavorite, silly]\n  )\n  return (\n    <Suspense fallback={<Skeleton variant=\"text\" width={100} />}>\n      <GeneralAutocomplete\n        size=\"small\"\n        label={label}\n        options={values}\n        valueKey={characterKey}\n        onChange={(k) => setChar(k ?? '')}\n        getOptionDisabled={onDisable}\n        toImg={toImg}\n        {...autoCompleteProps}\n      />\n    </Suspense>\n  )\n}\n","import type {\n  ArtifactSetKey,\n  ArtifactSlotKey,\n  WeaponTypeKey,\n} from '@genshin-optimizer/consts'\nimport { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport { weaponAsset } from '@genshin-optimizer/g-assets'\nimport { CopyAll, DeleteForever, Info, Refresh } from '@mui/icons-material'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  CardHeader,\n  Divider,\n  Grid,\n  ListItem,\n  MenuItem,\n  Skeleton,\n  Slider,\n  Stack,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport React, {\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useLocation } from 'react-router-dom'\nimport ArtifactSetAutocomplete from '../../../../Components/Artifact/ArtifactSetAutocomplete'\nimport ArtifactSetTooltip from '../../../../Components/Artifact/ArtifactSetTooltip'\nimport SetEffectDisplay from '../../../../Components/Artifact/SetEffectDisplay'\nimport SlotIcon from '../../../../Components/Artifact/SlotIcon'\nimport BootstrapTooltip from '../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport StatDisplayComponent from '../../../../Components/Character/StatDisplayComponent'\nimport ColorText from '../../../../Components/ColoredText'\nimport CustomNumberInput from '../../../../Components/CustomNumberInput'\nimport DocumentDisplay from '../../../../Components/DocumentDisplay'\nimport DropdownButton from '../../../../Components/DropdownMenu/DropdownButton'\nimport {\n  FieldDisplayList,\n  NodeFieldDisplay,\n} from '../../../../Components/FieldDisplay'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport LevelSelect from '../../../../Components/LevelSelect'\nimport RefinementDropdown from '../../../../Components/RefinementDropdown'\nimport SolidToggleButtonGroup from '../../../../Components/SolidToggleButtonGroup'\nimport {\n  StatColoredWithUnit,\n  StatWithUnit,\n} from '../../../../Components/StatDisplay'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../../Context/DataContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { getArtSheet } from '../../../../Data/Artifacts'\nimport Artifact, { maxArtifactLevel } from '../../../../Data/Artifacts/Artifact'\nimport { artifactDefIcon } from '../../../../Data/Artifacts/ArtifactSheet'\nimport { getWeaponSheet } from '../../../../Data/Weapons'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { initCharTC } from '../../../../Database/DataManagers/CharacterTCData'\nimport { uiInput as input } from '../../../../Formula'\nimport { computeUIData, dataObjForWeapon } from '../../../../Formula/api'\nimport { constant, percent } from '../../../../Formula/utils'\nimport KeyMap, { cacheValueString } from '../../../../KeyMap'\nimport StatIcon from '../../../../KeyMap/StatIcon'\nimport useBoolState from '../../../../ReactHooks/useBoolState'\nimport useTeamData from '../../../../ReactHooks/useTeamData'\nimport { iconInlineProps } from '../../../../SVGIcons'\nimport type {\n  ICachedArtifact,\n  MainStatKey,\n  SubstatKey,\n} from '../../../../Types/artifact'\nimport type { ICharTC, ICharTCArtifactSlot } from '../../../../Types/character'\nimport type {\n  ArtifactRarity,\n  SetNum,\n  SubstatType,\n} from '../../../../Types/consts'\nimport { substatType } from '../../../../Types/consts'\nimport type { ICachedWeapon } from '../../../../Types/weapon'\nimport { deepClone, objectMap } from '../../../../Util/Util'\nimport { defaultInitialWeaponKey } from '../../../../Util/WeaponUtil'\nimport useCharTC from './useCharTC'\nconst WeaponSelectionModal = React.lazy(\n  () => import('../../../../Components/Weapon/WeaponSelectionModal')\n)\n\ntype ISet = Partial<Record<ArtifactSetKey, 1 | 2 | 4>>\nexport default function TabTheorycraft() {\n  const { database } = useContext(DatabaseContext)\n  const { data: oldData } = useContext(DataContext)\n  const {\n    character,\n    character: { key: characterKey, compareData },\n    characterSheet,\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const data = useCharTC(\n    characterKey,\n    defaultInitialWeaponKey(characterSheet.weaponTypeKey)\n  )\n  const setData = useCallback(\n    (data: ICharTC) => database.charTCs.set(characterKey, data),\n    [characterKey, database]\n  )\n  const resetData = useCallback(() => {\n    setData(initCharTC(defaultInitialWeaponKey(characterSheet.weaponTypeKey)))\n  }, [setData, characterSheet])\n  const setWeapon = useCallback(\n    (action: Partial<ICharTC['weapon']>) => {\n      setData({ ...data, weapon: { ...data.weapon, ...action } })\n    },\n    [setData, data]\n  )\n\n  const copyFrom = useCallback(\n    (eWeapon: ICachedWeapon, build: ICachedArtifact[]) => {\n      const newData = initCharTC(eWeapon.key)\n      newData.artifact.substats.type = data.artifact.substats.type\n\n      newData.weapon.level = eWeapon.level\n      newData.weapon.ascension = eWeapon.ascension\n      newData.weapon.refinement = eWeapon.refinement\n\n      const sets = {}\n      build.forEach((art) => {\n        if (!art) return\n        const { slotKey, setKey, substats, mainStatKey, level, rarity } = art\n        newData.artifact.slots[slotKey].level = level\n        newData.artifact.slots[slotKey].statKey = mainStatKey\n        newData.artifact.slots[slotKey].rarity = rarity\n        sets[setKey] = (sets[setKey] ?? 0) + 1\n        substats.forEach((substat) => {\n          if (substat.key)\n            newData.artifact.substats.stats[substat.key] =\n              (newData.artifact.substats.stats[substat.key] ?? 0) +\n              substat.accurateValue\n        })\n      })\n      newData.artifact.sets = Object.fromEntries(\n        Object.entries(sets)\n          .map(([key, value]) => [\n            key,\n            value === 3\n              ? 2\n              : value === 5\n              ? 4\n              : value === 1 && !(key as string).startsWith('PrayersFor')\n              ? 0\n              : value,\n          ])\n          .filter(([, value]) => value)\n      )\n      setData(newData)\n    },\n    [data, setData]\n  )\n  const location = useLocation()\n  const { build: locBuild } = (location.state as\n    | { build: string[] }\n    | undefined) ?? { build: undefined }\n  useEffect(() => {\n    if (!locBuild) return\n    const eWeapon = database.weapons.get(character.equippedWeapon)!\n    copyFrom(\n      eWeapon,\n      locBuild.map((i) => database.arts.get(i)!)\n    )\n    // WARNING: if copyFrom is included, it will cause a render loop due to its setData <---> data\n    // eslint-disable-next-line\n  }, [locBuild, database])\n\n  const copyFromEquipped = useCallback(() => {\n    const eWeapon = database.weapons.get(character.equippedWeapon)!\n    copyFrom(\n      eWeapon,\n      Object.values(character.equippedArtifacts)\n        .map((a) => database.arts.get(a)!)\n        .filter((a) => a)\n    )\n  }, [\n    database,\n    character.equippedArtifacts,\n    character.equippedWeapon,\n    copyFrom,\n  ])\n\n  const weapon: ICachedWeapon = useMemo(() => {\n    return {\n      ...data.weapon,\n      location: '',\n      lock: false,\n      id: '',\n    }\n  }, [data])\n  const setArtifact = useCallback(\n    (artifact: ICharTC['artifact']) => {\n      const data_ = deepClone(data)\n      data_.artifact = artifact\n      setData(data_)\n    },\n    [data, setData]\n  )\n\n  const setSubstatsType = useCallback(\n    (t: SubstatType) => {\n      const data_ = deepClone(data)\n      data_.artifact.substats.type = t\n      setData(data_)\n    },\n    [data, setData]\n  )\n\n  const setSubstats = useCallback(\n    (setSubstats: Record<SubstatKey, number>) => {\n      const data_ = deepClone(data)\n      data_.artifact.substats.stats = setSubstats\n      setData(data_)\n    },\n    [data, setData]\n  )\n\n  const deferredData = useDeferredValue(data)\n  const overriderArtData = useMemo(() => {\n    const stats = { ...deferredData.artifact.substats.stats }\n    Object.values(deferredData.artifact.slots).forEach(\n      ({ statKey, rarity, level }) =>\n        (stats[statKey] =\n          (stats[statKey] ?? 0) +\n          Artifact.mainStatValue(statKey, rarity, level))\n    )\n    return {\n      art: objectMap(stats, (v, k) =>\n        k.endsWith('_') ? percent(v / 100) : constant(v)\n      ),\n      artSet: objectMap(deferredData.artifact.sets, (v) => constant(v)),\n    }\n  }, [deferredData])\n\n  const overrideWeapon: ICachedWeapon = useMemo(\n    () => ({\n      id: '',\n      location: '',\n      key: data.weapon.key,\n      level: data.weapon.level,\n      ascension: data.weapon.ascension,\n      refinement: data.weapon.refinement,\n      lock: false,\n    }),\n    [data]\n  )\n  const teamData = useTeamData(\n    characterKey,\n    0,\n    overriderArtData,\n    overrideWeapon\n  )\n\n  const { target: charUIData } = teamData?.[characterKey] ?? {}\n\n  const dataContextValue: dataContextObj | undefined = useMemo(() => {\n    if (!teamData || !charUIData) return undefined\n    return {\n      data: charUIData,\n      teamData,\n    }\n  }, [charUIData, teamData])\n  const dataContextValueWithOld: dataContextObj | undefined = useMemo(() => {\n    if (!dataContextValue) return undefined\n    return {\n      ...dataContextValue,\n      oldData: compareData ? oldData : undefined,\n    }\n  }, [dataContextValue, compareData, oldData])\n  return (\n    <Stack spacing={1}>\n      <CardLight>\n        <Box sx={{ display: 'flex', gap: 1, p: 1 }}>\n          <Box sx={{ flexGrow: 1, display: 'flex', gap: 1 }}>\n            <Button\n              color=\"info\"\n              onClick={copyFromEquipped}\n              startIcon={<CopyAll />}\n            >\n              Copy from equipped\n            </Button>\n            <Button color=\"error\" onClick={resetData} startIcon={<Refresh />}>\n              Reset\n            </Button>\n          </Box>\n          <SolidToggleButtonGroup\n            exclusive\n            value={compareData}\n            onChange={(e, v) => characterDispatch({ compareData: v })}\n            size=\"small\"\n          >\n            <ToggleButton value={false} disabled={!compareData}>\n              Show TC stats\n            </ToggleButton>\n            <ToggleButton value={true} disabled={compareData}>\n              Compare vs. equipped\n            </ToggleButton>\n          </SolidToggleButtonGroup>\n        </Box>\n      </CardLight>\n      {dataContextValue ? (\n        <DataContext.Provider value={dataContextValue}>\n          <Grid container spacing={1} sx={{ justifyContent: 'center' }}>\n            <Grid item sx={{ flexGrow: -1 }}>\n              <WeaponEditorCard\n                weapon={weapon}\n                setWeapon={setWeapon}\n                weaponTypeKey={characterSheet.weaponTypeKey}\n              />\n              <ArtifactMainLevelCard\n                artifactData={data.artifact}\n                setArtifactData={setArtifact}\n              />\n            </Grid>\n            <Grid item sx={{ flexGrow: 1 }}>\n              <ArtifactSubCard\n                substats={data.artifact.substats.stats}\n                setSubstats={setSubstats}\n                substatsType={data.artifact.substats.type}\n                setSubstatsType={setSubstatsType}\n                mainStatKeys={Object.values(data.artifact.slots).map(\n                  (s) => s.statKey\n                )}\n              />\n            </Grid>\n          </Grid>\n        </DataContext.Provider>\n      ) : (\n        <Skeleton variant=\"rectangular\" width=\"100%\" height={500} />\n      )}\n      <CardLight sx={{ flexGrow: 1, p: 1 }}>\n        {dataContextValueWithOld ? (\n          <DataContext.Provider value={dataContextValueWithOld}>\n            <StatDisplayComponent />\n          </DataContext.Provider>\n        ) : (\n          <Skeleton variant=\"rectangular\" width=\"100%\" height={500} />\n        )}\n      </CardLight>\n    </Stack>\n  )\n}\n\nfunction WeaponEditorCard({\n  weapon,\n  setWeapon,\n  weaponTypeKey,\n}: {\n  weapon: ICachedWeapon\n  weaponTypeKey: WeaponTypeKey\n  setWeapon: (action: Partial<ICharTC['weapon']>) => void\n}) {\n  const { key, level = 0, refinement = 1, ascension = 0 } = weapon\n  const weaponSheet = getWeaponSheet(key)\n  const [show, onShow, onHide] = useBoolState()\n  const { data } = useContext(DataContext)\n  const weaponUIData = useMemo(\n    () => weapon && computeUIData([weaponSheet.data, dataObjForWeapon(weapon)]),\n    [weaponSheet, weapon]\n  )\n  return (\n    <CardLight sx={{ p: 1, mb: 1 }}>\n      <WeaponSelectionModal\n        ascension={ascension}\n        show={show}\n        onHide={onHide}\n        onSelect={(k) => setWeapon({ key: k })}\n        weaponTypeFilter={weaponTypeKey}\n      />\n      <Box display=\"flex\" flexDirection=\"column\" gap={1}>\n        <Box display=\"flex\" gap={1}>\n          <Box\n            className={`grad-${weaponSheet.rarity}star`}\n            component=\"img\"\n            src={weaponAsset(weapon.key, ascension >= 2)}\n            sx={{\n              flexshrink: 1,\n              flexBasis: 0,\n              maxWidth: '30%',\n              borderRadius: 1,\n            }}\n          />\n          <Stack spacing={1} flexGrow={1}>\n            <Button\n              fullWidth\n              color=\"info\"\n              sx={{ flexGrow: 1 }}\n              onClick={onShow}\n            >\n              <Box sx={{ maxWidth: '10em' }}>{weaponSheet?.name}</Box>\n            </Button>\n            {weaponSheet.hasRefinement && (\n              <RefinementDropdown\n                refinement={refinement}\n                setRefinement={(r) => setWeapon({ refinement: r })}\n              />\n            )}\n          </Stack>\n        </Box>\n        <LevelSelect\n          level={level}\n          ascension={ascension}\n          setBoth={setWeapon}\n          useLow={!weaponSheet.hasRefinement}\n        />\n        <CardDark>\n          <CardHeader\n            title={'Main Stats'}\n            titleTypographyProps={{ variant: 'subtitle2' }}\n          />\n          <Divider />\n          {weaponUIData && (\n            <FieldDisplayList>\n              {[input.weapon.main, input.weapon.sub, input.weapon.sub2].map(\n                (node) => {\n                  const n = weaponUIData.get(node)\n                  if (n.isEmpty || !n.value) return null\n                  return (\n                    <NodeFieldDisplay\n                      key={JSON.stringify(n.info)}\n                      node={n}\n                      component={ListItem}\n                    />\n                  )\n                }\n              )}\n            </FieldDisplayList>\n          )}\n        </CardDark>\n        {data && weaponSheet?.document && (\n          <DocumentDisplay sections={weaponSheet.document} />\n        )}\n      </Box>\n    </CardLight>\n  )\n}\n\nfunction ArtifactMainLevelCard({\n  artifactData,\n  setArtifactData,\n}: {\n  artifactData: ICharTC['artifact']\n  setArtifactData: (a: ICharTC['artifact']) => void\n}) {\n  const setSlot = useCallback(\n    (slotKey: ArtifactSlotKey) => (slot: ICharTCArtifactSlot) => {\n      const artifactData_ = deepClone(artifactData)\n      artifactData_.slots[slotKey] = slot\n      setArtifactData(artifactData_)\n    },\n    [artifactData, setArtifactData]\n  )\n\n  const setArtSet = useCallback(\n    (artSet: ISet) => {\n      const artifactData_ = deepClone(artifactData)\n      artifactData_.sets = artSet\n      setArtifactData(artifactData_)\n    },\n    [artifactData, setArtifactData]\n  )\n\n  return (\n    <Stack spacing={1}>\n      <CardLight sx={{ p: 1 }}>\n        <Stack spacing={1}>\n          {allArtifactSlotKeys.map((s) => (\n            <ArtifactMainLevelSlot\n              key={s}\n              slotKey={s}\n              slot={artifactData.slots[s]}\n              setSlot={setSlot(s)}\n            />\n          ))}\n        </Stack>\n      </CardLight>\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={200} />}\n      >\n        <ArtifactSetsEditor artSet={artifactData.sets} setArtSet={setArtSet} />\n      </Suspense>\n    </Stack>\n  )\n}\nfunction ArtifactMainLevelSlot({\n  slotKey,\n  slot,\n  setSlot: setSlotProp,\n}: {\n  slotKey: ArtifactSlotKey\n  slot: ICharTCArtifactSlot\n  setSlot: (s: ICharTCArtifactSlot) => void\n}) {\n  const { level, statKey, rarity } = slot\n  const keys = Artifact.slotMainStats(slotKey)\n  const setSlot = useCallback(\n    (action: Partial<ICharTCArtifactSlot>) => {\n      setSlotProp({ ...slot, ...action })\n    },\n    [slot, setSlotProp]\n  )\n  const setRarity = useCallback(\n    (r: ArtifactRarity) => {\n      const mLvl = maxArtifactLevel[r] ?? 0\n      if (level > mLvl) setSlot({ rarity: r, level: mLvl })\n      else setSlot({ rarity: r })\n    },\n    [level, setSlot]\n  )\n\n  return (\n    <Box\n      display=\"flex\"\n      gap={1}\n      justifyContent=\"space-between\"\n      alignItems=\"center\"\n    >\n      <SlotIcon slotKey={slotKey} />\n      <CardDark\n        sx={{ height: '100%', minWidth: '5em', flexGrow: 1, display: 'flex' }}\n      >\n        {keys.length === 1 ? (\n          <Box\n            p={1}\n            justifyContent=\"center\"\n            alignItems=\"center\"\n            width=\"100%\"\n            display=\"flex\"\n            gap={1}\n          >\n            <StatIcon statKey={keys[0]} iconProps={iconInlineProps} />{' '}\n            {KeyMap.getStr(keys[0])}\n          </Box>\n        ) : (\n          <DropdownButton\n            sx={{ px: 0 }}\n            fullWidth\n            title={<StatWithUnit statKey={statKey} />}\n            color={KeyMap.getVariant(statKey) ?? 'success'}\n          >\n            {keys.map((msk) => (\n              <MenuItem\n                key={msk}\n                disabled={statKey === msk}\n                onClick={() => setSlot({ statKey: msk })}\n              >\n                <StatColoredWithUnit statKey={msk} />\n              </MenuItem>\n            ))}\n          </DropdownButton>\n        )}\n      </CardDark>\n      <DropdownButton\n        sx={{ px: 0 }}\n        title={\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n            {rarity} <StarRoundedIcon fontSize=\"inherit\" />\n          </Box>\n        }\n      >\n        {[5, 4, 3].map((r) => (\n          <MenuItem\n            key={r}\n            disabled={rarity === r}\n            onClick={() => setRarity(r as ArtifactRarity)}\n          >\n            <Box sx={{ display: 'flex', alignItems: 'center' }}>\n              {r} <StarRoundedIcon fontSize=\"inherit\" />\n            </Box>\n          </MenuItem>\n        ))}\n      </DropdownButton>\n      <CustomNumberInput\n        startAdornment=\"+\"\n        value={level}\n        color={Artifact.levelVariant(level)}\n        onChange={(l) => l !== undefined && setSlot({ level: l })}\n        sx={{ borderRadius: 1, pl: 1, my: 0, height: '100%' }}\n        inputProps={{ sx: { pl: 0.5, width: '2em' }, max: 20, min: 0 }}\n      />\n      <CardDark sx={{ height: '100%', minWidth: '4em' }}>\n        <Box p={1} textAlign=\"center\">{`${cacheValueString(\n          Artifact.mainStatValue(statKey, rarity, level),\n          KeyMap.unit(statKey)\n        )}${KeyMap.unit(statKey)}`}</Box>\n      </CardDark>\n    </Box>\n  )\n}\n\nfunction ArtifactSetsEditor({\n  artSet,\n  setArtSet,\n}: {\n  artSet: ISet\n  setArtSet(artSet: ISet)\n}) {\n  const setSet = useCallback(\n    (setKey: ArtifactSetKey | '') => {\n      if (!setKey) return\n      setArtSet({\n        ...artSet,\n        [setKey]: parseInt(Object.keys(getArtSheet(setKey).setEffects)[0]),\n      })\n    },\n    [artSet, setArtSet]\n  )\n\n  const setValue = useCallback(\n    (setKey: ArtifactSetKey) => (value: 1 | 2 | 4) =>\n      setArtSet({ ...artSet, [setKey]: value }),\n    [artSet, setArtSet]\n  )\n  const deleteValue = useCallback(\n    (setKey: ArtifactSetKey) => () => {\n      const { [setKey]: _, ...rest } = artSet\n      setArtSet({ ...rest })\n    },\n    [artSet, setArtSet]\n  )\n\n  const remaining = 5 - Object.values(artSet).reduce((a, b) => a + b, 0)\n\n  return (\n    <Stack spacing={1} sx={{ flexGrow: 1 }}>\n      {Object.entries(artSet).map(([setKey, value]) => (\n        <ArtifactSetEditor\n          key={setKey}\n          setKey={setKey}\n          value={value}\n          setValue={setValue(setKey)}\n          deleteValue={deleteValue(setKey)}\n          remaining={remaining}\n        />\n      ))}\n      <CardLight sx={{ flexGrow: 1, overflow: 'visible' }}>\n        <ArtifactSetAutocomplete\n          artSetKey={''}\n          setArtSetKey={setSet}\n          label={'New Artifact Set'}\n          getOptionDisabled={({ key }) =>\n            Object.keys(artSet).includes(key as ArtifactSetKey) ||\n            !key ||\n            Object.keys(getArtSheet(key).setEffects).every(\n              (n) => parseInt(n) > remaining\n            )\n          }\n        />\n      </CardLight>\n    </Stack>\n  )\n}\nfunction ArtifactSetEditor({\n  setKey,\n  value,\n  setValue,\n  deleteValue,\n  remaining,\n}: {\n  setKey: ArtifactSetKey\n  value: 1 | 2 | 4\n  setValue: (v: 1 | 2 | 4) => void\n  deleteValue: () => void\n  remaining: number\n}) {\n  const artifactSheet = getArtSheet(setKey)\n\n  /* Assumes that all conditionals are from 4-Set. needs to change if there are 2-Set conditionals */\n  const set4CondNums = useMemo(() => {\n    if (value < 4) return []\n    return Object.keys(artifactSheet.setEffects).filter((setNumKey) =>\n      artifactSheet.setEffects[setNumKey]?.document.some(\n        (doc) => 'states' in doc\n      )\n    )\n  }, [artifactSheet, value])\n\n  return (\n    <CardLight>\n      <Box display=\"flex\">\n        <ArtifactSetTooltip artifactSheet={artifactSheet} numInSet={value}>\n          <Box flexGrow={1} p={1} display=\"flex\" gap={1} alignItems=\"center\">\n            <ImgIcon size={2} src={artifactDefIcon(setKey)} />\n            <Box>{artifactSheet.setName}</Box>\n            <Info />\n          </Box>\n        </ArtifactSetTooltip>\n        <ButtonGroup>\n          <DropdownButton\n            size=\"small\"\n            title={<Box whiteSpace=\"nowrap\">{value}-set</Box>}\n          >\n            {Object.keys(artifactSheet.setEffects)\n              .map((setKey) => parseInt(setKey))\n              .map((setKey) => (\n                <MenuItem\n                  key={setKey}\n                  disabled={value === setKey || setKey > remaining + value}\n                  onClick={() => setValue(setKey as 1 | 2 | 4)}\n                >\n                  {setKey}-set\n                </MenuItem>\n              ))}\n          </DropdownButton>\n          <Button color=\"error\" size=\"small\" onClick={deleteValue}>\n            <DeleteForever />\n          </Button>\n        </ButtonGroup>\n      </Box>\n      {!!set4CondNums.length && (\n        <Stack spacing={1} sx={{ p: 1 }}>\n          {set4CondNums.map((setNumKey) => (\n            <SetEffectDisplay\n              key={setNumKey}\n              setKey={setKey}\n              setNumKey={parseInt(setNumKey) as SetNum}\n              hideHeader\n              conditionalsOnly\n            />\n          ))}\n        </Stack>\n      )}\n    </CardLight>\n  )\n}\nfunction ArtifactSubCard({\n  substats,\n  setSubstats,\n  substatsType,\n  setSubstatsType,\n  mainStatKeys,\n}: {\n  substats: Record<SubstatKey, number>\n  setSubstats: (substats: Record<SubstatKey, number>) => void\n  substatsType: SubstatType\n  setSubstatsType: (t: SubstatType) => void\n  mainStatKeys: MainStatKey[]\n}) {\n  const setValue = useCallback(\n    (key: SubstatKey) => (v: number) => setSubstats({ ...substats, [key]: v }),\n    [substats, setSubstats]\n  )\n  const { t } = useTranslation('page_character')\n  const rv =\n    Object.entries(substats).reduce(\n      (t, [k, v]) => t + v / Artifact.substatValue(k),\n      0\n    ) * 100\n  const rolls = Object.entries(substats).reduce(\n    (t, [k, v]) => t + v / Artifact.substatValue(k, undefined, substatsType),\n    0\n  )\n  return (\n    <CardLight sx={{ p: 1, height: '100%' }}>\n      <Box sx={{ mb: 1, display: 'flex', gap: 1 }}>\n        <DropdownButton\n          fullWidth\n          title={t(`tabTheorycraft.substatType.${substatsType}`)}\n        >\n          {substatType.map((st) => (\n            <MenuItem\n              key={st}\n              disabled={substatsType === st}\n              onClick={() => setSubstatsType(st)}\n            >\n              {t(`tabTheorycraft.substatType.${st}`)}\n            </MenuItem>\n          ))}\n        </DropdownButton>\n        <BootstrapTooltip\n          title={<Typography>{t`tabTheorycraft.maxTotalRolls`}</Typography>}\n          placement=\"top\"\n        >\n          <CardDark\n            sx={{\n              textAlign: 'center',\n              py: 0.5,\n              px: 1,\n              minWidth: '15em',\n              whiteSpace: 'nowrap',\n              display: 'flex',\n              gap: 2,\n              justifyContent: 'flex-end',\n              alignItems: 'center',\n            }}\n          >\n            <ColorText color={rolls > 45 ? 'warning' : undefined}>\n              Rolls: <strong>{rolls.toFixed(0)}</strong>\n            </ColorText>\n            <ColorText color={rolls > 45 ? 'warning' : undefined}>\n              RV: <strong>{rv.toFixed(1)}%</strong>\n            </ColorText>\n          </CardDark>\n        </BootstrapTooltip>\n      </Box>\n      <Stack spacing={1}>\n        {Object.entries(substats).map(([k, v]) => (\n          <ArtifactSubstatEditor\n            key={k}\n            statKey={k}\n            value={v}\n            setValue={setValue(k)}\n            substatsType={substatsType}\n            mainStatKeys={mainStatKeys}\n          />\n        ))}\n      </Stack>\n    </CardLight>\n  )\n}\nfunction ArtifactSubstatEditor({\n  statKey,\n  value,\n  setValue,\n  substatsType,\n  mainStatKeys,\n}: {\n  statKey: SubstatKey\n  value: number\n  setValue: (v: number) => void\n  substatsType: SubstatType\n  mainStatKeys: MainStatKey[]\n}) {\n  const { t } = useTranslation('page_character')\n  const substatValue = Artifact.substatValue(statKey, 5, substatsType)\n  const [rolls, setRolls] = useState(() => value / substatValue)\n  useEffect(() => setRolls(value / substatValue), [value, substatValue])\n\n  const unit = KeyMap.unit(statKey)\n  const displayValue = rolls * substatValue\n\n  const rv = ((rolls * substatValue) / Artifact.substatValue(statKey)) * 100\n  const numMains = mainStatKeys.reduce(\n    (t, ms) => t + (ms === statKey ? 1 : 0),\n    0\n  )\n  const maxRolls = (5 - numMains) * 6\n  // 0.0001 to nudge float comparasion\n  const invalid = rolls - 0.0001 > maxRolls\n  const setRValue = useCallback(\n    (r: number) => setValue(r * substatValue),\n    [setValue, substatValue]\n  )\n\n  return (\n    <Stack spacing={0.5}>\n      <Box\n        display=\"flex\"\n        gap={1}\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n      >\n        <CardDark\n          sx={{\n            p: 0.5,\n            minWidth: '11em',\n            flexGrow: 1,\n            display: 'flex',\n            gap: 1,\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <StatIcon statKey={statKey} iconProps={{ fontSize: 'inherit' }} />\n          {KeyMap.getStr(statKey)}\n          {KeyMap.unit(statKey)}\n        </CardDark>\n        <BootstrapTooltip\n          title={\n            <Typography>\n              {t(\n                numMains\n                  ? `tabTheorycraft.maxRollsMain`\n                  : `tabTheorycraft.maxRolls`,\n                { value: maxRolls }\n              )}\n            </Typography>\n          }\n          placement=\"top\"\n        >\n          <CardDark sx={{ textAlign: 'center', p: 0.5, minWidth: '8em' }}>\n            <ColorText color={invalid ? 'warning' : undefined}>\n              RV: <strong>{rv.toFixed(1)}%</strong>\n            </ColorText>\n          </CardDark>\n        </BootstrapTooltip>\n      </Box>\n      <Box\n        display=\"flex\"\n        gap={1}\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n      >\n        <CustomNumberInput\n          color={displayValue ? 'success' : 'primary'}\n          float={KeyMap.unit(statKey) === '%'}\n          endAdornment={\n            KeyMap.unit(statKey) || <Box width=\"1em\" component=\"span\" />\n          }\n          value={parseFloat(displayValue.toFixed(2))}\n          onChange={(v) => v !== undefined && setValue(v)}\n          sx={{ borderRadius: 1, px: 1, height: '100%', width: '6em' }}\n          inputProps={{ sx: { textAlign: 'right' }, min: 0 }}\n        />\n        <CardDark\n          sx={{\n            px: 2,\n            flexGrow: 1,\n            display: 'flex',\n            gap: 1,\n            alignItems: 'center',\n            justifyContent: 'center',\n            overflow: 'visible',\n          }}\n        >\n          <Slider\n            size=\"small\"\n            value={rolls}\n            max={maxRolls}\n            min={0}\n            step={1}\n            marks\n            valueLabelDisplay=\"auto\"\n            onChange={(e, v) => setRolls(v as number)}\n            onChangeCommitted={(e, v) => setRValue(v as number)}\n          />\n        </CardDark>\n        <CustomNumberInput\n          color={value ? (invalid ? 'warning' : 'success') : 'primary'}\n          float\n          startAdornment={\n            <Box\n              sx={{\n                whiteSpace: 'nowrap',\n                width: '7em',\n                display: 'flex',\n                justifyContent: 'space-between',\n              }}\n            >\n              <span>\n                {cacheValueString(substatValue, unit)}\n                {unit}\n              </span>\n              <span>x</span>\n            </Box>\n          }\n          value={parseFloat(rolls.toFixed(2))}\n          onChange={(v) => v !== undefined && setValue(v * substatValue)}\n          sx={{ borderRadius: 1, px: 1, my: 0, height: '100%', width: '7em' }}\n          inputProps={{ sx: { textAlign: 'right', pr: 0.5 }, min: 0, step: 1 }}\n        />\n      </Box>\n    </Stack>\n  )\n}\n","import { useContext, useEffect, useState } from 'react'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport type { CharacterKey, WeaponKey } from '../../../../Types/consts'\n\nexport default function useCharTC(\n  characterKey: CharacterKey,\n  defWeapon: WeaponKey\n) {\n  const { database } = useContext(DatabaseContext)\n  const [charTC, setCharTC] = useState(() =>\n    database.charTCs.getWithInit(characterKey, defWeapon)\n  )\n  useEffect(\n    () => setCharTC(database.charTCs.getWithInit(characterKey, defWeapon)),\n    [database, characterKey, defWeapon]\n  )\n  useEffect(\n    () =>\n      characterKey\n        ? database.charTCs.follow(\n            characterKey,\n            (k, r, v) => r === 'update' && setCharTC(v)\n          )\n        : undefined,\n    [characterKey, setCharTC, database]\n  )\n  return charTC\n}\n","import type { TravelerKey } from '@genshin-optimizer/consts'\nimport { allElementKeys } from '@genshin-optimizer/consts'\nimport { MenuItem } from '@mui/material'\nimport { useContext } from 'react'\nimport ColorText from '../../Components/ColoredText'\nimport DropdownButton from '../../Components/DropdownMenu/DropdownButton'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport { stg } from '../../Data/SheetUtil'\nimport useCharSelectionCallback from '../../ReactHooks/useCharSelectionCallback'\nimport { travelerElements, TravelerToElement } from '../../Types/consts'\n\nexport default function TravelerElementSelect() {\n  const { character } = useContext(CharacterContext)\n  const { key } = character\n  const setCharacter = useCharSelectionCallback()\n  if (!key.startsWith('Traveler')) return null\n\n  const elementKey = allElementKeys.find((e) => key.toLowerCase().includes(e))\n  if (!elementKey) return null\n\n  return (\n    <DropdownButton\n      color={elementKey}\n      title={<strong>{stg(`element.${elementKey}`)}</strong>}\n    >\n      {travelerElements.map((eleKey) => (\n        <MenuItem\n          key={eleKey}\n          selected={elementKey === eleKey}\n          disabled={elementKey === eleKey}\n          onClick={() =>\n            setCharacter(TravelerToElement(key as TravelerKey, eleKey))\n          }\n        >\n          <strong>\n            <ColorText color={eleKey}>{stg(`element.${eleKey}`)}</ColorText>\n          </strong>\n        </MenuItem>\n      ))}\n    </DropdownButton>\n  )\n}\n","import { Female, Male } from '@mui/icons-material'\nimport { Button } from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport { DatabaseContext } from '../../Database/Database'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\n\nexport default function TravelerGenderSelect() {\n  const { t } = useTranslation('ui')\n  const { database } = useContext(DatabaseContext)\n  const { character } = useContext(CharacterContext)\n  const { key } = character\n  const { gender } = useDBMeta()\n  const toggleGender = useCallback(\n    () => database.dbMeta.set({ gender: gender === 'F' ? 'M' : 'F' }),\n    [gender, database]\n  )\n  if (!key.startsWith('Traveler')) return null\n  return (\n    <Button\n      onClick={toggleGender}\n      startIcon={gender === 'F' ? <Female /> : <Male />}\n    >\n      <strong>{t(`gender.${gender}`)}</strong>{' '}\n    </Button>\n  )\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport {\n  BarChart,\n  Calculate,\n  FactCheck,\n  Groups,\n  Person,\n  Science,\n  TrendingUp,\n} from '@mui/icons-material'\nimport { Box, Button, CardContent, Skeleton, Tab, Tabs } from '@mui/material'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport {\n  Link as RouterLink,\n  Navigate,\n  Route,\n  Routes,\n  useMatch,\n  useNavigate,\n  useParams,\n} from 'react-router-dom'\nimport CardDark from '../../Components/Card/CardDark'\nimport CardLight from '../../Components/Card/CardLight'\nimport CloseButton from '../../Components/CloseButton'\nimport {\n  HitModeToggle,\n  InfusionAuraDropdown,\n  ReactionToggle,\n} from '../../Components/HitModeEditor'\nimport LevelSelect from '../../Components/LevelSelect'\nimport SqBadge from '../../Components/SqBadge'\nimport type { CharacterContextObj } from '../../Context/CharacterContext'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport type { dataContextObj } from '../../Context/DataContext'\nimport { DataContext } from '../../Context/DataContext'\nimport {\n  FormulaDataContext,\n  FormulaDataWrapper,\n} from '../../Context/FormulaDataContext'\nimport type { ChartData, GraphContextObj } from '../../Context/GraphContext'\nimport { GraphContext } from '../../Context/GraphContext'\nimport { SillyContext } from '../../Context/SillyContext'\nimport { getCharSheet } from '../../Data/Characters'\nimport { DatabaseContext } from '../../Database/Database'\nimport useBoolState from '../../ReactHooks/useBoolState'\nimport useCharacter from '../../ReactHooks/useCharacter'\nimport useCharacterReducer from '../../ReactHooks/useCharacterReducer'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\nimport useTeamData from '../../ReactHooks/useTeamData'\nimport useTitle from '../../ReactHooks/useTitle'\nimport { charKeyToCharName } from '../../Types/consts'\nimport { CustomMultiTargetButton } from '../CustomMultiTarget'\nimport CharSelectButton from './CharSelectButton'\nimport FormulaModal from './FormulaModal'\nimport StatModal from './StatModal'\nimport TabBuild from './Tabs/TabOptimize'\nimport TabOverview from './Tabs/TabOverview'\nimport TabTalent from './Tabs/TabTalent'\nimport TabTeambuffs from './Tabs/TabTeambuffs'\nimport TabTheorycraft from './Tabs/TabTheorycraft'\nimport TravelerElementSelect from './TravelerElementSelect'\nimport TravelerGenderSelect from './TravelerGenderSelect'\n\nexport default function CharacterDisplay() {\n  const navigate = useNavigate()\n  const { database } = useContext(DatabaseContext)\n  const onClose = useCallback(() => navigate('/characters'), [navigate])\n  const { characterKey } = useParams<{ characterKey?: CharacterKey }>()\n  const invalidKey = !database.chars.keys.includes(characterKey as CharacterKey)\n  if (invalidKey) return <Navigate to=\"/characters\" />\n\n  return (\n    <Box my={1} display=\"flex\" flexDirection=\"column\" gap={1}>\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={1000} />}\n      >\n        {characterKey && (\n          <CharacterDisplayCard\n            key={characterKey}\n            characterKey={characterKey}\n            onClose={onClose}\n          />\n        )}\n      </Suspense>\n    </Box>\n  )\n}\n\ntype CharacterDisplayCardProps = {\n  characterKey: CharacterKey\n  onClose?: () => void\n}\nfunction CharacterDisplayCard({\n  characterKey,\n  onClose,\n}: CharacterDisplayCardProps) {\n  const { silly } = useContext(SillyContext)\n  const character = useCharacter(characterKey)\n  const { gender } = useDBMeta()\n  const characterSheet = getCharSheet(characterKey, gender)\n  const teamData = useTeamData(characterKey)\n  const { target: charUIData } = teamData?.[characterKey] ?? {}\n  const {\n    params: { tab = 'overview' },\n  } = useMatch({ path: '/characters/:charKey/:tab', end: false }) ?? {\n    params: { tab: 'overview' },\n  }\n  const { t } = useTranslation([\n    'sillyWisher_charNames',\n    'charNames_gen',\n    'page_character',\n  ])\n\n  useTitle(\n    useMemo(\n      () =>\n        `${t(\n          `${\n            silly ? 'sillyWisher_charNames' : 'charNames_gen'\n          }:${charKeyToCharName(characterKey, gender)}`\n        )} - ${t(`page_character:tabs.${tab}`)}`,\n      [t, silly, characterKey, gender, tab]\n    )\n  )\n\n  const characterDispatch = useCharacterReducer(character?.key ?? '')\n\n  const dataContextValue: dataContextObj | undefined = useMemo(() => {\n    if (!teamData || !charUIData) return undefined\n    return {\n      data: charUIData,\n      teamData,\n      oldData: undefined,\n    }\n  }, [charUIData, teamData])\n\n  const characterContextValue: CharacterContextObj | undefined = useMemo(() => {\n    if (!character || !characterSheet) return undefined\n    return {\n      character,\n      characterSheet,\n      characterDispatch,\n    }\n  }, [character, characterSheet, characterDispatch])\n\n  const [chartData, setChartData] = useState(undefined as ChartData | undefined)\n  const [graphBuilds, setGraphBuilds] = useState<string[][]>()\n  const graphContextValue: GraphContextObj | undefined = useMemo(() => {\n    return {\n      chartData,\n      setChartData,\n      graphBuilds,\n      setGraphBuilds,\n    }\n  }, [chartData, graphBuilds])\n\n  // Clear state when switching characters\n  useEffect(() => {\n    setChartData(undefined)\n    setGraphBuilds(undefined)\n  }, [characterKey])\n\n  return (\n    <CardDark>\n      {dataContextValue && characterContextValue && graphContextValue ? (\n        <CharacterContext.Provider value={characterContextValue}>\n          <DataContext.Provider value={dataContextValue}>\n            <GraphContext.Provider value={graphContextValue}>\n              <FormulaDataWrapper>\n                <CardContent\n                  sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n                >\n                  <Box display=\"flex\">\n                    <Box display=\"flex\" gap={1} flexWrap=\"wrap\" flexGrow={1}>\n                      <CharSelectButton />\n                      <TravelerElementSelect />\n                      <TravelerGenderSelect />\n                      <DetailStatButton />\n                      <CustomMultiTargetButton />\n                      <FormulasButton />\n                    </Box>\n                    {!!onClose && <CloseButton onClick={onClose} />}\n                  </Box>\n                  <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                    {character && (\n                      <LevelSelect\n                        level={character.level}\n                        ascension={character.ascension}\n                        setBoth={characterDispatch}\n                      />\n                    )}\n                    <HitModeToggle size=\"small\" />\n                    <InfusionAuraDropdown />\n                    <ReactionToggle size=\"small\" />\n                  </Box>\n                  <CardLight>\n                    <TabNav tab={tab} />\n                  </CardLight>\n                  <CharacterPanel />\n                  <CardLight>\n                    <TabNav tab={tab} />\n                  </CardLight>\n                </CardContent>\n              </FormulaDataWrapper>\n            </GraphContext.Provider>\n          </DataContext.Provider>\n        </CharacterContext.Provider>\n      ) : (\n        <Skeleton variant=\"rectangular\" width=\"100%\" height={1000} />\n      )}\n    </CardDark>\n  )\n}\nfunction CharacterPanel() {\n  return (\n    <Suspense\n      fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={500} />}\n    >\n      <Routes>\n        {/* Character Panel */}\n        <Route index element={<TabOverview />} />\n        <Route path=\"/talent\" element={<TabTalent />} />\n        <Route path=\"/teambuffs\" element={<TabTeambuffs />} />\n        <Route path=\"/optimize\" element={<TabBuild />} />\n        <Route path=\"/theorycraft\" element={<TabTheorycraft />} />\n      </Routes>\n    </Suspense>\n  )\n}\nfunction TabNav({ tab }: { tab: string }) {\n  const { t } = useTranslation('page_character')\n  return (\n    <Tabs\n      value={tab}\n      variant=\"scrollable\"\n      allowScrollButtonsMobile\n      sx={{\n        '& .MuiTab-root:hover': {\n          transition: 'background-color 0.25s ease',\n          backgroundColor: 'rgba(255,255,255,0.1)',\n        },\n      }}\n    >\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"overview\"\n        label={t('tabs.overview')}\n        icon={<Person />}\n        component={RouterLink}\n        to=\"\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"talent\"\n        label={t('tabs.talent')}\n        icon={<FactCheck />}\n        component={RouterLink}\n        to=\"talent\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"teambuffs\"\n        label={t('tabs.teambuffs')}\n        icon={<Groups />}\n        component={RouterLink}\n        to=\"teambuffs\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"optimize\"\n        label={t('tabs.optimize')}\n        icon={<TrendingUp />}\n        component={RouterLink}\n        to=\"optimize\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"theorycraft\"\n        label={t('tabs.theorycraft')}\n        icon={<Science />}\n        component={RouterLink}\n        to=\"theorycraft\"\n      />\n    </Tabs>\n  )\n}\n\nfunction DetailStatButton() {\n  const { t } = useTranslation('page_character')\n  const [open, onOpen, onClose] = useBoolState()\n  const {\n    character: { bonusStats },\n  } = useContext(CharacterContext)\n  const bStatsNum = Object.keys(bonusStats).length\n  return (\n    <>\n      <Button color=\"info\" startIcon={<BarChart />} onClick={onOpen}>\n        {t`addStats.title`}\n        {!!bStatsNum && (\n          <SqBadge sx={{ ml: 1 }} color=\"success\">\n            {bStatsNum}\n          </SqBadge>\n        )}\n      </Button>\n      <StatModal open={open} onClose={onClose} />\n    </>\n  )\n}\nfunction FormulasButton() {\n  const { onModalOpen } = useContext(FormulaDataContext)\n  return (\n    <>\n      <Button color=\"info\" startIcon={<Calculate />} onClick={onModalOpen}>\n        Formulas {'&'} Calcs\n      </Button>\n      <FormulaModal />\n    </>\n  )\n}\n"],"names":["GraphContext","createContext","CharacterSelectionModal","React","CharSelectButton","useTranslation","characterSheet","character","key","characterKey","useContext","CharacterContext","showModal","setshowModal","useState","setCharacter","useCharSelectionCallback","Suspense","fallback","show","onHide","onSelect","Button","color","onClick","startIcon","CharIconSide","name","t","FormulaModal","modalOpen","FormulaDataContext","setFormulaData","onCloseHandler","useCallback","undefined","ModalWrapper","open","onClose","CardDark","CardHeader","title","action","CloseButton","CardContent","sx","pt","CalculationDisplay","data","DataContext","contextData","sections","getDisplaySections","Skeleton","variant","width","height","Box","mr","mb","map","Nodes","FormulaCalc","displayNs","sectionKey","database","DatabaseContext","header","useMemo","getDisplayHeader","Object","entries","every","_","node","isEmpty","icon","CardLight","CardHeaderCustom","avatar","ImgIcon","size","src","SqBadge","Divider","FormulaAccordian","contextNode","expanded","setExpanded","handleChange","e","isExpanded","scrollRef","useRef","useEffect","setTimeout","current","scrollIntoView","behavior","Accordion","bgcolor","onChange","ref","AccordionSummary","expandIcon","ExpandMore","Typography","info","nodeVStr","allAmpReactions","display","ml","AmpReactionModeText","reaction","trigger","subVariant","AccordionDetails","formulas","subform","i","component","styled","props","other","IconButton","theme","expand","transform","marginLeft","transition","transitions","create","duration","shortest","FlexButtonGroup","ButtonGroup","StatInput","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset","restProps","TextButton","px","CustomNumberInput","flexBasis","flexGrow","inputProps","textAlign","float","endAdornment","flexShrink","Replay","EnemyExpandCard","characterDispatch","setexpanded","toggle","eLvlNode","get","input","eDefRed","eDefIgn","enemyOverride","gap","alignItems","flexWrap","Chip","label","allElementWithPhyKeys","element","EnemyResText","justifyContent","Collapse","in","timeout","unmountOnExit","EnemyEditor","immune","isFinite","ele","iconProps","iconInlineProps","content","bsProps","xs","md","eLvl","enemyLevel","enemyDefIgn_","enemyDefRed_","Grid","container","spacing","item","fullWidth","href","target","rel","palette","contentLight","main","KeyMap","type","statKey","eleKey","val","elementImmunity","Number","MAX_VALUE","Infinity","CheckBox","CheckBoxOutlineBlank","cols","lg","StatModal","Stack","BonusStatsEditor","MainStatsCards","keys","allInputPremodKeys","wrapperFunc","bonusStats","setFilter","columns","Alert","severity","i18nKey","StatEditorList","statKeys","statFilters","setStatFilters","mainSubKeys","mainReadNodes","k","mainEditKeys","otherStatKeys","allEleDmgKeys","allEleResKeys","miscStatkeys","includes","StatDisplayContent","nodes","extra","oldData","FieldDisplay","rn","ListItem","oldValue","JSON","stringify","specialNode","charEle","elementKey","isMelee","otherStatReadNodes","filter","n","miscStatReadNodes","StatDisplayCard","length","py","OptimizationTargetContext","reaffine","arts","forceRename","affineNodes","Set","topLevelAffine","visit","isAffine","add","operands","forEach","op","has","dynKeys","forEachNodes","f","operation","path","nonConst","assertUnreachable","base","nextDynKey","affine","affineMap","Map","customRead","accu","reaffineArt","stat","values","constantFold","dyn","objectMap","constant","fromEntries","v","result","mapFormulas","objectKeyMap","allSlotKeys","slot","id","set","offsets","baseValue","pruneOrder","numTop","exclusion","progress","allowRainbow","rainbow","noSwitchIn","noSwitchOut","list","newList","art","count","otherBetterEqual","otherMaybeBetter","some","otherBetter","canSwitch","pruneArtRange","minimum","baseRange","x","min","max","wrap","artRanges","computeArtRange","otherArtRanges","addArtRange","a","read","newRange","computeNodeRange","pruneNodeRange","nodeRange","operandRanges","threshold","pass","fail","newOperands","op1","op2","ranges","range","reads","Error","computeMinMax","allOperations","reduce","c","sum","NaN","minMaxes","Math","FIFO","head","tail","this","push","pop","reverse","WorkerCoordinator","constructor","workers","prio","callback","commands","workDone","_workers","cancel","cancelled","notifyNonEmpty","p","worker","onmessage","onMessage","onerror","onError","w","Promise","resolve","rej","catch","terminate","async","processingInput","command","find","hasCommand","race","res","all","then","postMessage","message","msg","resultType","broadcast","notifiedBroadcast","GOSolver","problem","status","numWorker","super","Array","fill","Worker","URL","r","interim","finalizedResults","total","maxIterateSize","topN","buildValues","preprocess","execute","plotBase","optimizationTarget","constraints","minimums","maxValues","thres","pruneExclusion","forced","should","deps","newArts","newNodes","pruneAll","optimize","optTarget","tested","failed","skipped","oldThreshold","sort","b","splice","useBuildSetting","buildSetting","setBuildSetting","buildSettings","follow","buildSettingDispatch","CharListMode","AllowChar","allowListTotal","t_pc","silly","SillyContext","excludedLocations","allowLocationsState","onOpen","useBoolState","dbDirty","forceUpdate","useForceUpdate","deferredDbDirty","useDeferredValue","searchTerm","setSearchTerm","deferredSearchTerm","elementKeys","setElementKeys","allElementKeys","deferredElementKeys","weaponTypeKeys","setWeaponTypeKeys","allWeaponTypeKeys","deferredWeaponTypeKeys","charKeyMap","from","chars","ck","filterFunction","weaponType","characterFilterConfigs","locList","ck1","c1","ck2","c2","choosec1","choosec2","c1f","charMeta","favorite","c2f","art1","equippedArtifacts","art2","localeCompare","charKeyToLocCharKey","elementTotals","weaponTypeTotals","locListTotals","catKeys","bulkCatTotal","ctMap","sheet","getCharSheet","gender","weaponTypeKey","locKey","allowed","excluded","followAny","mouseUpDetected","setMouseUpDetected","allowAll","disallowAll","concat","setState","_e","state","toggleList","lkList","lkArray","newExcludedLocations","lk","onMouseUp","useTot","charactersAllowed","stateBadgeColor","containerProps","maxWidth","draggable","InfoTooltip","pb","SolidToggleButtonGroup","exclusive","baseColor","allAllowLocationsState","s","ToggleButton","TextField","autoFocus","InputProps","WeaponToggle","totals","ElementToggle","opacity","SelectItemGrid","ShowChart","borderRadius","minWidth","Settings","charList","setCharList","charListMode","setCharListMode","sm","xl","SelectItem","selected","char","LocationToCharacterKey","onMouseEnter","buttons","ToggleToAllow","ToggleToExclude","onMouseDown","mode","disableTooltip","borderColor","borderWidth","borderStyle","fontSize","allArtifactSlotKeys","SlotIcon","slotKey","CharacterCardPico","SetEffectDisplay","setKey","setNumKey","hideHeader","conditionalsOnly","getArtSheet","document","setEffectDocument","section","flexDirection","DocumentDisplay","ArtifactSetConfig","dataContext","conditional","artSetExclusion","setOpen","artKeysByRarity","setKeysByRarities","flatMap","sets","artKeys","artSlotCount","getNumSlots","allowRainbow2","allowRainbow4","allowTotals","artifactCondCount","allArtifactSetKeys","fakeDataContextObj","UIData","artSet","resetArtConds","tconditional","setAllExclusion","setnum","exclude","artSetExclusion_","deepClone","Block","AllSetAllowExcludeCard","allowTotal","setNum","gutterBottom","handleArtSetExclusion","endIcon","ArtifactSetCard","slotCount","large","charAt","indexOf","setExclusionSet","allow4","slots","set4CondNums","setEffects","doc","exclude2","exclude4","className","rarity","artifactDefIcon","mx","ns","StarRounded","Translate","key18","paddingTop","parseInt","tot","levels","AssumeFullLevelToggle","mainStatAssumptionLevel","setmainStatAssumptionLevel","DropdownButton","lvl","MenuItem","BonusStatsCard","bonusStatsKeys","fontWeight","Monospace","fontFamily","BorderLinearProgress","LinearProgress","BuildAlert","startTime","finishTime","characterName","hasTotal","generatingBuilds","unskipped","testedString","toLocaleString","unskippedString","skippedText","durationString","timeStringMs","round","performance","now","subtitle","toFixed","LocationIcon","useDBMeta","BootstrapTooltip","placement","sideMargin","StatWithUnit","disableIcon","StatIcon","StatColoredWithUnit","ArtifactCardNano","artifactId","pSlotKey","showLocation","BGComponent","useArtifact","actionWrapperFunc","CardActionArea","useTheme","Assets","level","mainStatKey","substats","location","mainStatLevel","mainStatUnit","alpha","secondary","ConditionalWrapper","condition","wrapper","position","ArtifactTooltip","artifactAsset","m","maxHeight","pointerEvents","Artifact","BusinessCenter","overflow","bottom","backgroundColor","disableInteractive","lineHeight","style","padding","cacheValueString","SubstatDisplay","numRolls","rolls","rollColor","clamp","unit","alignContent","StatDisplayComponent","Masonry","Section","displayNsReads","nodeKey","emphasize","WeaponCardNano","weaponId","weapon","useWeapon","weaponSheet","getWeaponSheet","computeUIData","dataObjForWeapon","refinement","WeaponNameTooltip","weaponAsset","ascension","WeaponSheet","hasRefinement","WeaponStat","ArtifactSetBadges","artifacts","currentlyEquipped","setToSlots","arti","acc","curr","_k1","slotarr1","_k2","slotarr2","slotarr","ArtifactSetBadge","artifactSheet","numInSet","setActive","ArtifactSetTooltip","BuildDisplayItem","compareBuild","extraButtonsRight","extraButtonsLeft","newOld","setNewOld","close","equipBuild","window","confirm","aid","oldAid","weapons","statProviderContext","dataContext_","artifactIdsBySlot","artiId","artNanos","oldId","newId","CompareArtifactModal","Checkroom","onEquip","newLoc","ArtifactCard","canEquip","editorProps","disableSet","disableSlot","extraButtons","ExcludeButton","ChevronRight","ExcludeEquipButton","locationKey","artExclusion","toggleArr","arrow","useBuildResult","buildResult","setBuildResult","buildResultDispatch","CustomDot","cx","cy","payload","selectedPoint","radiusSelected","radiusUnselected","colorSelected","colorUnselected","shape","isSelected","y","CustomShape","stroke","points","CustomTooltip","xLabel","xUnit","yLabel","yUnit","setSelectedPoint","addBuildToList","tooltipProps","artifactsBySlot","artifactIds","artiObj","clickAwayHandler","generLabel","generBuildNumber","graphLabel","graphBuildNumber","active","ClickAwayListener","onClickAway","stopPropagation","direction","ArtifactCardPico","artifactObj","valueString","highlighted","EnhancedPoint","trueY","ChartCard","setPlotBase","showTooltip","chartData","showDownload","setshowDownload","showMin","setshowMin","graphBuilds","builds","generatedBuilds","sliderLow","setSliderLow","sliderHigh","setSliderHigh","setSlider","TypeError","l","h","displayData","downloadData","sliderMin","sliderMax","currentBuild","plot","enhancedDatum","datumBuildMap","isCurrentBuild","aId","console","log","graphBuildIndex","findIndex","build","generBuildIndex","minimumData","point","last","allData","plotBaseNode","objPathValue","getDisplay","buttonText","OptimizationTargetSelector","setTarget","defaultText","Download","ReadOnlyTextArea","Chart","plotNode","valueNode","Slider","marks","onChangeCommitted","step","valueLabelDisplay","valueLabelFormat","optTargetColor","highlightedColor","currentColor","lineColor","setGraphBuilds","chartOnClick","chartX","chartY","clickedX","clickedY","nearestDomPtData","querySelectorAll","domPtA","domPtB","aChartX","aChartY","dataset","aDistance","sqrt","bChartX","bChartY","d","xValue","yValue","getNearestPoint","xLabelValue","getLabelFromNode","yLabelValue","ResponsiveContainer","ComposedChart","cursor","CartesianGrid","strokeDasharray","XAxis","dataKey","scale","domain","tick","tickFormatter","Label","dy","YAxis","allowDecimals","angle","dx","Tooltip","wrapperStyle","Legend","Line","connectNulls","strokeWidth","isAnimationActive","dot","activeDot","Scatter","textSuffix","ExcludeArt","excludedTotal","useExcludedArts","numExcludedArt","showSel","onOpenSel","onCloseSel","onDelSelect","toggleArtExclusion","ArtifactSelectModal","Add","whiteSpace","totalStr","numToShowMap","filterOptionReducer","clickHandler","filterOption","filterOptionDispatch","useReducer","initialFilterOption","brPt","useMediaQueryUp","filterConfigs","artifactFilterConfigs","artIdList","filterFunc","slice","ArtifactFilterDisplay","filteredIds","mt","artifactsSlotsToSelectMainStats","MainStatSelectionCard","filteredArtIdMap","mainStatKeys","mainStatSlotTots","slotTots","flowerMainStatTots","plumeMainStatTots","sandsMainStatTots","gobletMainStatTots","circletMainStatTots","catTotals","flower","plume","sands","goblet","circlet","FlowerIcon","HpIcon","hp","orientation","flexItem","PlumeIcon","AtkIcon","atk","selectedMainKeys","mainKeys","mainKeysHandler","handleMultiSelect","OptimizationTargetEditorList","oldPath","oldIndex","statFilters_","oldPathStr","oldFilterArr","pathStr","filterArr","delTarget","index","setTargetValue","setTargetDisabled","settings","setting","OptimizationTargetEditorItem","parse","setValue","setDisabled","buttonStyle","buildConstraintNode","isPercent","showEmptyTargets","DeleteForever","StatFilterCard","dynamic","setReadNodeKeys","dynamicData","allMainStatKeys","allSubstatKeys","audio","Audio","TabBuild","compareData","setChartData","notification","setnotification","notificationRef","buildStatus","setBuildStatus","artsDirty","setArtsDirty","threads","defThreads","setDisplayOptimize","displayOptimize","_r","to","maxWorkers","setMaxWorkers","useCharacterReducer","onClickTeammate","noArtifact","allowPartial","maxBuildsToShow","levelLow","levelHigh","buildDate","teamData","useTeamData","optimizationTargetNode","isSM","deferredArtsDirty","deferredBuildSetting","filteredArts","mainStats","unequippedStateAndEquippedElsewhere","customListStateAndNotOnList","levelTotal","allStateAndEquippedSomewhereElse","tabFocused","onFocus","onBlur","addEventListener","removeEventListener","cancelToken","throwGlobalError","setError","useGlobalError","generateBuilds","split","mainStatVal","endsWith","substat","accurateValue","compactArtifacts","getTeamData","workerData","uiDataForTeam","assign","mergeData","unoptimizedOptimizationTargetNode","targetNode","valueFilter","filterNode","unoptimizedNodes","plotBaseNumNode","statusUpdateTimer","setInterval","cancellationError","solver","results","solve","plotData","plots","mergePlot","maxNum","mergeBuilds","process","Date","play","alert","clearInterval","targetSelector","getGraphBuildLabel","getNormBuildLabel","Link","RouterLink","CharacterCard","ArtifactLevelSlider","setLow","setHigh","setBoth","maxBuildsToShowList","NotificationsActive","NotificationsOff","Close","TrendingUp","Provider","BuildList","getLabel","setBuilds","deleteBuild","builds_","DataContextWrapper","BuildItemWrapper","join","useLocation","navigate","useNavigate","toTC","paths","pathname","Science","dirty","setDirty","buildsArts","providerValue","tdc","charCards","Albedo","Alhaitham","Aloy","Amber","AratakiItto","Barbara","Beidou","Bennett","Candace","Chongyun","Collei","Cyno","Dehya","Diluc","Diona","Dori","Eula","Faruzan","Fischl","Ganyu","Gorou","HuTao","Jean","KaedeharaKazuha","Kaeya","KamisatoAyaka","KamisatoAyato","Keqing","Klee","KujouSara","KukiShinobu","Layla","Lisa","Mika","Mona","Nahida","Nilou","Ningguang","Noelle","Qiqi","RaidenShogun","Razor","Rosaria","SangonomiyaKokomi","Sayu","Shenhe","ShikanoinHeizou","Sucrose","Tartaglia","Thoma","Tighnari","TravelerF","TravelerM","Venti","Wanderer","Xiangling","Xiao","Xingqiu","Xinyan","YaeMiko","Yanfei","Yaoyao","Yelan","Yoimiya","YunJin","Zhongli","CompareBuildButton","artId","onShow","CompareContent","Difference","newArt","artmap","dataProviderValue","lazy","ArtifactSwapModal","onChangeId","slotKeys","disableSlotFilter","rarityHandler","allRarityKeys","WeaponSwapModal","newWeaponModalShow","setnewWeaponModalShow","editWeaponId","setEditWeaponId","newWeapon","weaponKey","new","initialWeapon","resetEditWeapon","setRarity","weaponIdList","weaponFilterConfigs","sortFunction","weaponSortMap","weaponSortConfigs","WeaponSelectionModal","weaponTypeFilter","WeaponEditor","footer","star","WeaponCard","EquipmentSection","equippedWeapon","setweaponId","showWeapon","hideWeapon","breakpoint","useMediaQuery","breakpoints","up","weaponDoc","rvFilter","useCharMeta","deferredRvFilter","deferredRvSet","LargeWeaponSwapButton","ArtifactSectionCard","onEdit","WeaponSwapButton","effFilter","ArtifactSwapButton","ArtSwapCard","minHeight","SwapHoriz","hasEquipped","unequipArts","dataSetEffects","setRVFilter","deferredrvFilter","rvField","rvmField","currentEfficiency","currentEfficiency_","maxEfficiency","maxEfficiency_","artid","text","PercentBadge","valid","canShow","borderBottomRightRadius","borderBottomLeftRadius","SubstatToggle","selectedKeys","field","setNumKeyArr","TabOverview","onScroll","CharacterProfileCard","EquipmentRow","team","constellation","tlvl","auto","skill","burst","tBoost","sillySplash","splash","card","charKey","charCard","SillyCoverArea","CoverArea","tKey","Badge","badgeContent","overlap","anchorOrigin","vertical","horizontal","getTalentOfKey","img","constellationName","CharChip","stars","colored","FavoriteButton","LevelBadge","left","right","top","getLevelString","Favorite","FavoriteBorder","talentSpacing","CharacterTalentPane","grlg","constellationCards","SkillDisplayCard","talentKey","onClickTitle","ReactionDisplay","tText","asc","enabled","talentLimits","talent","setTalentLevel","newTalentLevelKey","levelBoost","talentSheet","pl","hideDesc","headerAction","TabTeambuffs","TeamBuffDisplay","ResonanceDisplay","TeammateDisplay","teamBuffs","getTeamBuff","premod","enemy","teamCount","titleTypographyProps","resonanceSheets","desc","teamBuffOnly","activeCharacterKey","teamMateKey","onClickHandler","setTeammate","dataBundle","teammateCharacterContext","teamConditional","teamMateDataContext","TeammateAutocomplete","setChar","onClickHeader","artifactChildren","CharArtifactCondDisplay","weaponChildren","CharWeaponCondDisplay","characterChildren","CharTalentCondDisplay","isTeammateCard","setNums","sn","sts","autoCompleteProps","namesCB","startsWith","charKeyToCharName","toImg","PersonAdd","isFavorite","onDisable","alternateNames","GeneralAutocomplete","options","valueKey","getOptionDisabled","TabTheorycraft","defWeapon","charTC","setCharTC","charTCs","getWithInit","useCharTC","defaultInitialWeaponKey","setData","resetData","initCharTC","setWeapon","copyFrom","eWeapon","newData","artifact","stats","locBuild","copyFromEquipped","lock","setArtifact","data_","setSubstatsType","setSubstats","deferredData","overriderArtData","overrideWeapon","charUIData","dataContextValue","dataContextValueWithOld","CopyAll","Refresh","WeaponEditorCard","ArtifactMainLevelCard","artifactData","setArtifactData","ArtifactSubCard","substatsType","weaponUIData","flexshrink","RefinementDropdown","setRefinement","LevelSelect","useLow","setSlot","artifactData_","setArtSet","ArtifactMainLevelSlot","ArtifactSetsEditor","setSlotProp","mLvl","maxArtifactLevel","msk","startAdornment","my","setSet","deleteValue","rest","remaining","ArtifactSetEditor","ArtifactSetAutocomplete","artSetKey","setArtSetKey","setName","Info","rv","substatType","st","ArtifactSubstatEditor","substatValue","setRolls","displayValue","numMains","ms","maxRolls","invalid","setRValue","parseFloat","pr","TravelerElementSelect","toLowerCase","stg","travelerElements","TravelerToElement","TravelerGenderSelect","toggleGender","dbMeta","Female","Male","CharacterDisplay","useParams","CharacterDisplayCard","useCharacter","params","tab","useMatch","end","useTitle","characterContextValue","graphContextValue","DetailStatButton","CustomMultiTarget","FormulasButton","TabNav","CharacterPanel","Tabs","allowScrollButtonsMobile","Tab","Person","FactCheck","Groups","bStatsNum","BarChart","onModalOpen","Calculate"],"sourceRoot":""}