{"version":3,"file":"485.812e2f5e593a6f1a.js","mappings":"qGAEA,MAYA,GAZkBA,E,SAAAA,IAAO,MAAPA,EAAc,EAAGC,YAAY,CAC7CC,QAAS,eACTC,MAAO,OACPC,OAAS,QACTC,WAAY,EACZC,cAAe,cACfC,UAAWN,EAAMO,SAAS,GAC1BC,WAAYR,EAAMO,SAAS,MAC3BE,YAAaT,EAAMO,SAAS,GAC5BG,aAAcV,EAAMO,SAAS,M,kBCFhB,SAASI,GAAmB,UACzCC,EAAS,QACTC,EAAO,aACPC,EAAY,SACZC,IAEA,OACEH,EACIC,EAAQE,GACRD,EACAA,EAAaC,GACbA,CAER,C,sFCnBO,MAAMC,EAAe,EAC1BC,MAAAA,EAAQ,EACRC,QAAAA,GAAU,EACVC,OAAAA,GAAS,MAMT,QAAC,IAAS,CAACC,MAAOF,EAAU,eAAYG,EAAU,SAC/C,IAAIC,MAAML,GAAOM,QAAQC,KAAI,CAACC,EAAGC,KAChC,QAAC,IAAe,CAEdC,SAAUR,EAAS,eAAYE,EAC/BO,GAAIT,EAAS,CAAEd,cAAe,iBAAegB,GAFxCK,M,kVCAN,MAAMG,GAAeC,EAAAA,EAAAA,eAAc,CAAC,G,6JCN3C,MAAMC,EAA0BC,EAAAA,MAC9B,IAAM,yDAGO,SAASC,IAAmB,MACzC,MAAM,IAAQC,EAAAA,EAAAA,IAAe,mBACvB,eACJC,EACAC,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACRC,EAAWC,IAAgBC,EAAAA,EAAAA,WAAS,IACrC,OAAEC,IAAWC,EAAAA,EAAAA,KACbC,GAAeC,EAAAA,EAAAA,KACrB,OACE,yBACE,QAAC,EAAAC,SAAQ,CAACC,UAAU,EAAM,UACxB,QAAClB,EAAuB,CACtBmB,KAAMT,EACNU,OAAQ,IAAMT,GAAa,GAC3BU,SAAUN,OAGd,QAACO,EAAA,EAAM,CACLjC,MAAM,OACNkC,QAAS,IAAMZ,GAAa,GAC5Ba,WACE,QAACC,EAAA,EAAS,CAACC,KAAKC,EAAAA,EAAAA,IAAepB,EAAc,WAAYM,KAC1D,SAEoB,OAFpB,EAEc,MAAdT,OAAc,EAAdA,EAAgBwB,MAAI,EAAIC,EAAE,uBAInC,C,+JCDe,SAASC,KACtB,MAAM,UAAEC,IAAcvB,EAAAA,EAAAA,YAAWwB,EAAAA,IAC3B,eAAEC,IAAmBzB,EAAAA,EAAAA,YAAWwB,EAAAA,GAChCE,GAAiBC,EAAAA,EAAAA,cACrB,IAAoB,MAAdF,OAAc,EAAdA,OAAiB3C,OAAWA,IAClC,CAAC2C,IAEH,OACE,QAACG,GAAA,EAAY,CAACC,OAAQN,EAAWO,QAASJ,EAAe,UACvD,QAACK,EAAA,EAAQ,YACP,QAACC,EAAA,EAAU,CACTC,MAAM,0BACNC,QAAQ,QAACC,EAAA,EAAW,CAACpB,QAASW,OAEhC,QAACU,EAAA,EAAW,CAAC/C,GAAI,CAAEgD,GAAI,GAAI,UACzB,QAACC,GAAkB,UAK7B,CAEA,SAASA,KACP,MAAM,KAAEC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,IACpBD,KAAME,IAAgBzC,EAAAA,EAAAA,YAAWwB,EAAAA,GACnCkB,GAAWC,EAAAA,GAAAA,GAA8B,MAAXF,EAAAA,EAAeF,GACnD,OACE,QAAC,EAAA9B,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAS,UAExE,QAACkF,EAAA,EAAG,CAACzD,GAAI,CAAE0D,IAAK,EAAGC,IAAK,GAAI,SACzBN,EAASzD,KAAI,EAAEa,EAAKmD,MACnB,QAACC,GAAW,CAAWC,UAAWF,EAAOG,WAAYtD,GAAnCA,QAK5B,CACA,SAASoD,IAAY,WACnBE,EAAU,UACVD,IAKA,MAAM,KAAEZ,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,IACtB,SAAEa,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACxBf,KAAME,IAAgBzC,EAAAA,EAAAA,YAAWwB,EAAAA,GACnC+B,GAASC,EAAAA,EAAAA,UACb,KAAMC,EAAAA,GAAAA,GAA4B,MAAXhB,EAAAA,EAAeF,EAAMa,EAAYC,IACxD,CAACA,EAAUZ,EAAaF,EAAMa,IAEhC,IAAKG,EAAQ,OAAO,KACpB,GAAIG,OAAOC,QAAQR,GAAWS,OAAM,EAAE1E,EAAG2E,KAAUA,EAAKC,UAAU,OAAO,KACzE,MAAM,MAAE7B,EAAK,KAAE8B,EAAI,OAAE7B,GAAWqB,EAChC,OACE,QAACS,EAAA,EAAS,CAAC3E,GAAI,CAAE2D,GAAI,GAAI,WACvB,QAACiB,GAAA,EAAgB,CACfC,OAAQH,IAAQ,QAACI,GAAA,EAAO,CAACC,KAAM,EAAGlD,IAAK6C,IACvC9B,MAAOA,EACPC,OAAQA,IAAU,QAACmC,EAAA,EAAO,UAAEnC,OAE9B,QAACoC,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,UACTsB,OAAOC,QAAQR,GAAWlE,KACzB,EAAEa,EAAK+D,MACJA,EAAKC,UAAW,QAACS,GAAgB,CAAWV,KAAMA,GAAX/D,SAKpD,CACA,SAASyE,IAAiB,KAAEV,IAC1B,MAAQA,KAAMW,IAAgBxE,EAAAA,EAAAA,YAAWwB,EAAAA,IAClCiD,EAAUC,IAAetE,EAAAA,EAAAA,WAAS,GACnCuE,GAAehD,EAAAA,EAAAA,cACnB,CAACiD,EAAyBC,IAAwBH,EAAYG,IAC9D,IAEIC,GACJC,EAAAA,EAAAA,UAUF,OARAC,EAAAA,EAAAA,YAAU,KACJnB,IAASW,GACXS,YACE,kBAAe,MAATH,GAAkB,OAAT,EAATA,EAAWI,UAAuB,MAAlC,EAAoBC,oBAAX,EAAT,EAAoBA,eAAiB,CAAEC,SAAU,UAAW,GAClE,IACD,GACF,CAACN,EAAWjB,EAAMW,KAGnB,QAACa,EAAA,EAAS,CACRhG,GAAI,CAAEiG,QAAS,oBACfb,SAAUZ,IAASW,GAAeC,EAClCc,SAAUZ,EACVa,IAAKV,EAAU,WAEf,QAACW,EAAA,EAAgB,CAACC,YAAY,QAACC,EAAA,EAAU,IAAI,WAC3C,QAACC,EAAA,EAAU,YACT,QAAC,KAAS,CAAC/G,MAAOgF,EAAKgC,KAAKhD,QAAQ,SAAEgB,EAAKgC,KAAKzE,OAAkB,KAClE,4BAAS0E,EAAAA,GAAAA,GAASjC,QAEnBkC,EAAAA,GAAAA,SAAyBlC,EAAKgC,KAAKhD,WAClC,QAACC,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,eAAgBsI,GAAI,OAAQjD,GAAI,GAAI,UACtD,QAACkD,EAAA,EAAmB,CAClBC,SAAUrC,EAAKgC,KAAKhD,QACpBsD,QACEtC,EAAKgC,KAAKO,mBAMpB,QAACC,EAAA,EAAgB,UACdxC,EAAKyC,SAASrH,KAAI,CAACsH,EAASpH,KAC3B,QAACyG,EAAA,EAAU,CAASY,UAAU,MAAK,SAChCD,GADcpH,SAO3B,C,oOClJA,IAXqB3B,EAAAA,GAAAA,KAAQiJ,IAC3B,MAAmBC,GAAK,QAAKD,EAAK,IAClC,OAAO,QAACE,GAAA,EAAU,iBAAKD,GAAS,GAFblJ,EAGlB,EAAGC,QAAOmJ,aAAa,CACxBC,UAAYD,EAA0B,iBAAjB,eACrB3I,WAAY,OACZ6I,WAAarJ,EAAcsJ,YAAYC,OAAO,YAAa,CACzDC,SAAWxJ,EAAcsJ,YAAYE,SAASC,e,yJCO5CC,IAAkB3J,EAAAA,GAAAA,IAAO4J,GAAAA,EAAP5J,CAAoB,CAC1CE,QAAS,SAGI,SAAS2J,GAAU,GAWf,IAXe,KAChCjG,EAAI,SACJ5C,EAAQ,MACR8I,EAAK,YACLC,EAAW,aACXC,EAAe,EAAC,cAChBC,EAAa,QACbC,GAAU,EAAK,SACfC,GAAW,EAAK,QAChBC,GAEe,EADZC,GAAS,cAEZ,OACE,QAACV,GAAe,iBAAKU,EAAS,WAC3BrJ,GACD,QAACsJ,GAAA,EAAU,CAACzI,GAAI,CAAE0I,GAAI,GAAI,SAAE3G,KAC5B,QAAC4G,GAAA,GAAmC,CAClC3I,GAAI,CAAE4I,UAAW,OAAQC,SAAU,GAAI,UAEvC,QAACF,GAAA,GAAiB,CAChB3I,GAAI,CAAE0I,GAAI,GACVI,WAAY,CACV9I,GAAI,CAAE+I,UAAW,UAEnBC,MAAOX,EACPH,YAAaA,EACbD,MAAOA,EACP/B,SAAUkC,EACVE,SAAUA,EACVW,aAAcZ,EAAU,SAAM5I,OAGlC,QAACgC,EAAA,EAAM,CACLzB,GAAI,CAAEkJ,WAAY,GAClBnE,KAAK,QACLvF,MAAM,QACNkC,QAAS,IAAO6G,EAAUA,IAAYH,EAAcD,GACpDG,SAAUA,GAAYL,IAAUE,EAAa,UAE7C,QAACgB,GAAA,EAAM,SAIf,C,eCpCO,SAASC,KACd,MAAM,EAAEpH,IAAM1B,EAAAA,EAAAA,IAAe,OACvB,kBAAE+I,IAAsB1I,EAAAA,EAAAA,YAAWC,EAAAA,IACnC,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,IACrBiC,EAAUkE,IAAevI,EAAAA,EAAAA,WAAS,GACnCwI,GAASjH,EAAAA,EAAAA,cACb,IAAMgH,GAAalE,IACnB,CAACkE,EAAalE,IAEVoE,EAAWtG,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,OACpBC,EAAUzG,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,QACnBE,EAAU1G,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,QACnBnB,GAAUjG,EAAAA,EAAAA,cACd,IAAM+G,EAAkB,CAAEQ,cAAe,CAAC,KAC1C,CAACR,IAGH,OACE,QAAC1E,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,CACV/C,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGC,WAAY,SAAUC,SAAU,QAAS,WAExE,QAACC,GAAA,EAAI,CACHlF,KAAK,QACLvF,MAAM,UACN0K,OACE,0BACGV,EAAShD,KAAKzE,KAAK,KAAC,2BAASyH,EAASvB,aAI5CkC,GAAAA,GAAAA,KAA2BC,IAC1B,QAAC7D,EAAA,EAAU,WACT,QAAC8D,GAAY,CAACD,QAASA,KADRA,MAInB,QAAC7D,EAAA,EAAU,WAAC,aAAUE,EAAAA,GAAAA,GAASkD,OAC/B,QAACpD,EAAA,EAAU,WAAC,eAAYE,EAAAA,GAAAA,GAASmD,OACjC,QAACnG,EAAA,EAAG,CAACoF,SAAU,EAAGxK,QAAQ,OAAOiM,eAAe,WAAWR,IAAK,EAAE,WAChE,QAACrI,EAAA,EAAM,CACLsD,KAAK,QACLvF,MAAM,QACNkC,QAAS6G,EACT5G,WAAW,QAACwH,GAAA,EAAM,IAAI,SACtBnH,EAAC,UAAC,aACJ,QAAC,GAAY,CACXuF,OAAQnC,EACR1D,QAAS6H,EACT,gBAAenE,EACf,aAAW,YACXL,KAAK,QACL/E,GAAI,CAAEpB,WAAY,GAAI,UAEtB,QAAC0H,EAAA,EAAU,aAIjB,QAACiE,GAAA,EAAQ,CAACC,GAAIpF,EAAUqF,QAAQ,OAAOC,eAAa,YAClD,QAAC3H,EAAA,EAAW,CAAC/C,GAAI,CAAEgD,GAAI,GAAI,UACzB,QAAC2H,GAAW,UAKtB,CAEO,SAASN,IAAa,QAAED,IAC7B,MAAM,KAAElH,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBqB,EAAOtB,EAAKuG,IAAIC,GAAAA,GAAAA,MAAa,GAAEU,WAC/BQ,GAAUC,SAASrG,EAAKyD,OACxBvD,GAAO,QAAC,KAAW,CAACoG,IAAKV,EAASW,UAAWC,GAAAA,IAC7CC,EAAUL,GACd,0BAAOlG,EAAK,SAEZ,0BACGA,EAAK,KAAC,4BAAS+B,EAAAA,GAAAA,GAASjC,QAG7B,OAAO,QAAC,KAAS,CAAChF,MAAO4K,EAAQ,SAAEa,GACrC,CAEO,SAASN,IAAY,QAC1BO,EAAU,CAAEC,GAAI,GAAIC,GAAI,KAGvB,UACD,MACE5K,WAAW,cAAEqJ,GAAe,kBAC5BR,IACE1I,EAAAA,EAAAA,YAAWC,EAAAA,IACT,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GAGtBkI,EAA+B,OAA3B,EAAGxB,EAAcyB,YAAU,EAAIpI,EAAKuG,IAAIC,GAAAA,GAAAA,KAAWzB,MACvD0B,EAAoC,OAA7B,EAAGE,EAAc0B,cAAY,EAAI,EACxC3B,EAAoC,OAA7B,EAAGC,EAAc2B,cAAY,EAAI,EAC9C,OACE,QAACC,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,WACzB,QAAC8M,GAAA,GAAI,eAACE,MAAI,GAAKT,EAAO,WACpB,QAACzJ,EAAA,EAAM,CACLmK,WAAS,EACT5L,GAAI,CAAEzB,OAAQ,QACdwG,KAAK,QACLoC,UAAU,IACV3H,MAAM,UACNqM,KAAK,2EACLC,OAAO,SACPC,IAAI,aAAY,SACjB,iFAKH,QAACN,GAAA,GAAI,eAACE,MAAI,GAAKT,EAAO,WACpB,QAAClD,GAAS,CACRhI,GAAI,CAAEiG,QAAUjE,GAAMA,EAAEgK,QAAQC,aAAaC,KAAM5N,MAAO,QAC1DyD,MAAM,sBAAIoK,GAAAA,GAAAA,IAAW,gBACrBlE,MAAOoD,EACPnD,YAAaiE,GAAAA,GAAAA,OAAc,cAC3BhE,aAAcjF,EAAKuG,IAAIC,GAAAA,GAAAA,KAAWzB,MAClCG,cAAgBH,GACdoB,EAAkB,CAChB+C,KAAM,gBACNC,QAAS,aACTpE,UAGJM,QAAS,IACPc,EAAkB,CAChB+C,KAAM,gBACNC,QAAS,aACTpE,WAAOxI,SAKd0K,GAAAA,GAAAA,KAA2BmC,IAC1B,MAAMD,EAAW,GAAEC,cACbC,EAAM1C,EAAcwC,GACpBG,EAAkBD,IAAQE,OAAOC,UACvC,OACE,QAACjB,GAAA,GAAI,eAACE,MAAI,GAAkBT,EAAO,WACjC,QAAClD,GAAS,CACRhI,GAAI,CACFiG,QAAUjE,GAAMA,EAAEgK,QAAQC,aAAaC,KACvC5N,MAAO,QAETyD,MACE,QAAC,KAAS,CAACvC,MAAO8M,EAAO,UACvB,sBAAIH,GAAAA,GAAAA,IAAWE,OAGnBpE,WACUxI,IAAR8M,EAAqBC,EAAkBG,IAAWJ,EAAO,GAE3DrE,YAAasE,EAAkB,KAAOL,GAAAA,GAAAA,OAAcE,GACpDlE,aAjEO,GAkEPC,cAAgBH,GACdoB,EAAkB,CAAE+C,KAAM,gBAAiBC,UAASpE,UAEtDK,SAAUkE,EACVnE,SAAO,YAEP,QAAC5G,EAAA,EAAM,CACLjC,MAAO8M,EACP5K,QAAS,IACP2H,EAAkB,CAChB+C,KAAM,gBACNC,UACApE,MAAOuE,EA9EN,GA8EqCC,OAAOC,YAGjD/K,UACE6K,GAAkB,QAACI,GAAA,EAAQ,KAAM,QAACC,GAAA,EAAoB,IACvD,SACF,iBAlCWP,EAsCT,KAGX,QAACb,GAAA,GAAI,eAACE,MAAI,GAAKT,EAAO,WACpB,QAAClD,GAAS,CACRhI,GAAI,CAAEiG,QAAUjE,GAAMA,EAAEgK,QAAQC,aAAaC,KAAM5N,MAAO,QAC1DyD,MAAM,sBAAIoK,GAAAA,GAAAA,IAAW,kBACrBlE,MAAO0B,EACPzB,YAAaiE,GAAAA,GAAAA,OAAc,gBAC3BhE,aAAc,EACdC,cAAgBH,GACdoB,EAAkB,CAChB+C,KAAM,gBACNC,QAAS,eACTpE,UAGJI,SAAO,QAGX,QAACoD,GAAA,GAAI,eAACE,MAAI,GAAKT,EAAO,WACpB,QAAClD,GAAS,CACRhI,GAAI,CAAEiG,QAAUjE,GAAMA,EAAEgK,QAAQC,aAAaC,KAAM5N,MAAO,QAC1DyD,MAAM,sBAAIoK,GAAAA,GAAAA,IAAW,kBACrBlE,MAAO2B,EACP1B,YAAaiE,GAAAA,GAAAA,OAAc,gBAC3BhE,aAAc,EACdC,cAAgBH,GACdoB,EAAkB,CAChB+C,KAAM,gBACNC,QAAS,eACTpE,UAGJI,SAAO,QAGX,QAACoD,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAG,UAChB,0BAAO,wKAQf,C,2CClOA,MAAM2B,GAAO,CACX3B,GAAI,EACJC,GAAI,EACJ2B,GAAI,GAGS,SAASC,IAAU,KAAExK,EAAI,QAAEC,IACxC,MAAM,EAAET,IAAM1B,EAAAA,EAAAA,IAAe,kBAC7B,OACE,QAACiC,GAAA,EAAY,CAACC,KAAMA,EAAMC,QAASA,EAAQ,UACzC,QAACC,EAAA,EAAQ,YACP,QAACC,EAAA,EAAU,CACTC,MAAOZ,EAAC,UAAC,mBACTa,QAAQ,QAACC,EAAA,EAAW,CAACpB,QAASe,OAEhC,QAACM,EAAA,EAAW,CAAC/C,GAAI,CAAEgD,GAAI,GAAI,UACzB,QAACiK,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAACuO,GAAgB,KACjB,QAAC9D,GAAe,KAChB,QAAC+D,GAAc,aAM3B,CACA,MAAMxN,GAAO,IAAIyN,GAAAA,IACXC,GAAc,CAAC9H,EAAgB9E,KACnC,QAACgL,GAAA,GAAI,CAACE,MAAI,EAAWR,GAAI,EAAE,SACxB5F,GADa9E,GAIlB,SAASyM,KACP,MAAM,EAAElL,IAAM1B,EAAAA,EAAAA,IAAe,mBAE3BE,WAAW,WAAE8M,GAAY,kBACzBjE,IACE1I,EAAAA,EAAAA,YAAWC,EAAAA,GACT2M,GAAYjL,EAAAA,EAAAA,cACfgL,GAAejE,EAAkB,CAAEiE,gBACpC,CAACjE,IAEH,OACE,QAAC1E,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,CAAC/C,GAAI,CAAE3B,QAAS,QAAS,UACnC,QAACoN,GAAA,GAAI,CAACC,WAAS,EAAC8B,QAASV,GAAM9M,GAAI,CAAEgD,GAAI,GAAKrE,QAAS,EAAE,WACvD,QAAC8M,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAG,UAChB,QAACsC,GAAA,EAAK,CAACC,SAAS,OAAOlK,QAAQ,SAAQ,UACrC,QAAC,KAAK,CAACmK,QAAS,gBAAiB3L,EAAGA,EAAE,UAAC,oJAGH,KAClC,aAAG6J,KAAK,6DAA4D,SAAC,wBAEhE,IAAI,+BAKf,QAAC+B,GAAA,EAAc,CACbC,SAAUlO,GACVmO,YAAaR,EACbS,eAAgBR,EAChBF,YAAaA,WAMzB,CAEA,MACMW,GAAc,CAClB,SACA,YACA,WACA,YACA,SAEIC,GAAgB,CARA,KAAM,MAAO,SAQQD,IAAapO,KACrDsO,GAAMxE,GAAAA,GAAAA,MAAYwE,KAEfC,GAAe,CACnB,OACA,MACA,MACA,KACA,OACA,SACGH,IAGCI,GAAgB,IACjBC,GAAAA,MACAC,GAAAA,GACH,UACA,WACA,UACA,UAGIC,GAAenB,GAAAA,GAAAA,QAClBc,IACGC,GAAmCK,SAASN,KAC5CE,GAAoCI,SAASN,KAGnD,SAASO,IAAmB,MAC1BC,EAAK,MACLC,IAKA,MAAM,KAAEzL,EAAI,QAAE0L,IAAYjO,EAAAA,EAAAA,YAAWwC,EAAAA,GACrC,OACE,QAAC0L,GAAA,GAAgB,WACdH,EAAM9O,KAAKkP,IAAE,aACZ,QAAC,MAAgB,CACf3H,UAAW4H,GAAAA,GAEXvK,KAAMtB,EAAKuG,IAAIqF,GACfE,SAAiB,MAAPJ,GAAgB,OAAT,EAAPA,EAASnF,IAAIqF,SAAN,EAAP,EAAkB7G,OAFvBgH,KAAKC,UAAUJ,EAAGtI,MAGvB,IAEHmI,IAGP,CAEA,SAASxB,KACP,MAAM,eAAE5M,IAAmBI,EAAAA,EAAAA,YAAWC,EAAAA,IAChC,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBgM,EAAcjM,EAAKuG,IAAIC,GAAAA,GAAAA,SACvB0F,EAAU7O,EAAe8O,WACzBC,EAAU/O,EAAe+O,UAEzBC,GAAqBpL,EAAAA,EAAAA,UAAQ,IACnBiK,GACXoB,QAAQtB,IACHA,EAAEM,SAASY,KACXE,GAAWpB,EAAEM,SAAS,aAAoB,KAG/C5O,KAAKsO,GAAMxE,GAAAA,GAAAA,MAAYwE,KAEbsB,QAAQC,KAAQvM,EAAKuG,IAAIgG,GAAGxH,SACxC,CAAC/E,EAAMkM,EAASE,IAEbI,GAAoBvL,EAAAA,EAAAA,UACxB,IACEoK,GAAa3O,KAAKsO,GAAMxE,GAAAA,GAAAA,MAAYwE,KAAIsB,QAAQC,GAAMvM,EAAKuG,IAAIgG,GAAGxH,SACpE,CAAC/E,IAGH,OACE,QAACyB,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,WACV,QAAC0I,GAAA,GAAI,CAACC,WAAS,EAAC8B,QAASV,GAAMnO,QAAS,EAAE,WACxC,QAAC8M,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACwE,GAAe,CAAC/M,MAAM,aAAY,UACjC,QAAC6L,GAAkB,CACjBC,MAAOT,GACPU,MACEQ,IACE,QAACJ,GAAA,GAAQ,CACP/O,GAAI,CAAE3B,QAAS,OAAQiM,eAAgB,iBAAkB,WAEzD,2BACE,sBAAG,aAAa,KAChB,QAAC,KAAS,CAAC9K,MAAO2P,EAAY3I,KAAKhD,QAAQ,UACxC2L,EAAY3I,KAAK9B,KAAK,IAAEyK,EAAY3I,KAAKzE,YAG9C,0BAAO0E,EAAAA,GAAAA,GAAS0I,eAO5B,QAAC1D,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACwE,GAAe,CAAC/M,MAAM,cAAa,UAClC,QAAC6L,GAAkB,CAACC,MAAOa,UAG5BG,EAAkBE,SACnB,QAACnE,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACwE,GAAe,CAAC/M,MAAM,aAAY,UACjC,QAAC6L,GAAkB,CAACC,MAAOgB,cAQ3C,CACA,SAASC,IAAgB,MAAE/M,EAAK,SAAEzD,IAChC,OACE,QAACuD,EAAA,EAAQ,YACP,QAACK,EAAA,EAAW,CAAC/C,GAAI,CAAE6P,GAAI,GAAI,UACzB,QAACpM,EAAA,EAAG,CAACpF,QAAQ,OAAOiM,eAAe,gBAAe,UAChD,QAAC/D,EAAA,EAAU,CAAC/C,QAAQ,YAAW,SAAEZ,QAGpCzD,IAGP,C,8JC7OO,MAAM2Q,IAA4B5P,EAAAA,EAAAA,oBACvCT,G,wGCkGF,SAASsQ,GACPrB,EACAsB,EACAC,GAAc,GAEd,MAAMC,EAAc,IAAIC,IACtBC,EAAiB,IAAID,IAEvB,SAASE,EAAM7L,EAAe8L,GACxBA,EAAUJ,EAAYK,IAAI/L,GAE5BA,EAAKgM,SAASC,SACXC,GAAOR,EAAYS,IAAID,IAAON,EAAeG,IAAIG,IAExD,CAEA,MAAME,EAAU,IAAIT,IA2CpB,IAzCAU,EAAAA,GAAAA,IACEnC,GACC7O,QACAiR,IACC,MAAM,UAAEC,GAAcD,EACtB,OAAQC,GACN,IAAK,OACHH,EAAQL,IAAIO,EAAEE,KAAK,IACnBX,EAAMS,GAAG,GACT,MACF,IAAK,MACHT,EACES,EACAA,EAAEN,SAASjM,OAAOmM,GAAOR,EAAYS,IAAID,MAE3C,MACF,IAAK,MAAO,CACV,MAAMO,EAAWH,EAAEN,SAAShB,QAAQkB,GAAwB,UAAjBA,EAAGK,YAC9CV,EACES,EACoB,IAApBG,EAASrB,QACc,IAApBqB,EAASrB,QAAgBM,EAAYS,IAAIM,EAAS,KAEvD,KACF,CACA,IAAK,QACHZ,EAAMS,GAAG,GACT,MACF,IAAK,MACL,IAAK,YACL,IAAK,WACL,IAAK,MACL,IAAK,MACHT,EAAMS,GAAG,GACT,MACF,SACEI,EAAAA,GAAAA,IAAkBH,GAAU,IAMlC,IAAIX,GAAgB7L,OAClB,EAAGwM,eAA8B,SAAdA,GAAsC,UAAdA,KAE7C1M,OAAO1E,KAAKqQ,EAAKmB,MAAMvB,SAAWgB,EAAQ7L,KAE1C,MAAO,CAAE2J,QAAOsB,QAElB,IAAInK,GAAW,EACf,SAASuL,IACP,KAAOR,EAAQD,IAAK,MAAI9K,KACxB,MAAQ,GAAEA,GACZ,CAEA6I,EAAM+B,SAASjM,GAAS0L,EAAYS,IAAInM,IAAS4L,EAAeG,IAAI/L,KACpE,MAAM6M,EAAS,IAAIjB,GAAgBZ,QAAQsB,GAAsB,UAAhBA,EAAEC,YAC7CO,EAAY,IAAIC,IACpBF,EAAOzR,KAAK4E,GAAS,CACnBA,EACCyL,GAAkC,SAAnBzL,EAAKuM,WAAyC,QAAjBvM,EAAKwM,KAAK,GAC/C,kBACCQ,EAAAA,GAAAA,IAAW,CAAC,MAAQ,GAAEJ,QAAkB,CAAAK,KAAM,QADnDjN,MAUR,SAASkN,EAAYC,GACnB,MAAMC,GAASC,EAAAA,GAAAA,IACb,IAAIP,EAAU3R,QACd,CACEmS,KAAKC,EAAAA,GAAAA,IAAUJ,GAAO1J,IAAU+J,EAAAA,GAAAA,IAAS/J,OAE1CpI,IAAM,IAET,OAAOwE,OAAO4N,YACZ,IAAIX,EAAUM,UAAUhS,KAAI,CAACsS,EAAGpS,IAAM,CACpCoS,EAAElB,KAAK,GACNY,EAAO9R,GAA4BmI,SAG1C,CACA,MAAMkK,EAAS,CACbzD,MAtBFA,GAAQ0D,EAAAA,GAAAA,IACN1D,GACCoC,IAAC,aAAqB,OAArB,EAAKQ,EAAU7H,IAAIqH,IAAE,EAAIA,CAAC,IAC3BA,GAAMA,IAoBPd,KAAM,CACJmB,KAAMO,EAAY1B,EAAKmB,MACvBS,QAAQS,EAAAA,GAAAA,GAAaC,EAAAA,IAAcC,GACjCvC,EAAK4B,OAAOW,GAAM3S,KAAI,EAAG4S,KAAIC,MAAKb,aAAa,CAC7CY,KACAC,MACAb,OAAQF,EAAYE,WAKtBc,EAAUrO,OAAOC,QAAQoN,EAAY,CAAC,IAC5C,IAAK,MAAM1B,KAAQ3L,OAAOuN,OAAOO,EAAOnC,KAAK4B,QAC3C,IAAK,MAAM,OAAEA,KAAY5B,EACvB,IAAK,MAAOvP,EAAKkS,KAAcD,EAASd,EAAOnR,IAAQkS,EAC3D,OAAOR,CACT,CAEA,SAASS,GACP5C,EACA6C,EACAC,GACiB,MACjB,IAAIC,GAAW,EAQf,MAAMC,IAAiC,OAAlB,EAACF,EAAUG,UAAV,EAAmBrD,QACvCjQ,EAAO0E,OAAO1E,KAAKqQ,EAAKmB,MACpB+B,EAAa,IAAI/C,IACrB9L,OAAOC,QAAQwO,GACZtD,QAAO,EAAE3P,EAAGqS,KAAOA,EAAEtC,SACrBhQ,KAAI,EAAEsO,KAAOA,KAEZiF,EAAc,IAAIhD,IACtB9L,OAAOC,QAAQwO,GACZtD,QAAO,EAAE3P,EAAGqS,KAAOA,EAAE1D,SAAS,KAAO0D,EAAE1D,SAAS,KAChD5O,KAAI,EAAEsO,KAAOA,KAEZ0D,GAASS,EAAAA,GAAAA,GAAaC,EAAAA,IAAcC,IACxC,MAAMa,EAAOpD,EAAK4B,OAAOW,GACnBc,EAAUD,EAAK5D,QAAQ8D,IAC3B,IAAIC,EAAQ,EACZ,OAAOH,EAAK7O,OAAO8C,IACjB,MAAMmM,EAAmB7T,EAAK4E,OAC3B2J,IAAC,eAAqB,OAAhB,EAAC7G,EAAMuK,OAAO1D,IAAE,EAAI,KAAoB,OAAnB,EAAMoF,EAAI1B,OAAO1D,IAAE,EAAI,EAAE,IAEjDuF,EAAmB9T,EAAK+T,MAC3BxF,IAAC,eAAqB,OAAhB,EAAC7G,EAAMuK,OAAO1D,IAAE,EAAI,IAAmB,OAAlB,EAAKoF,EAAI1B,OAAO1D,IAAE,EAAI,EAAE,IAEhDyF,EACJH,IAAqBC,GAAoBpM,EAAMmL,GAAKc,EAAId,IACpDoB,EACHZ,IACEE,EAAWvC,IAAItJ,EAAMoL,OACrBU,EAAYxC,IAAI2C,EAAIb,MACvBa,EAAIb,MAAQpL,EAAMoL,IAEpB,OADIkB,GAAeC,GAAWL,IACvBA,EAAQV,CAAM,GACrB,IAGJ,OADIQ,EAAQzD,SAAWwD,EAAKxD,SAAQmD,GAAW,GACxCM,CAAO,IAEhB,OAAON,EAAW,CAAE5B,KAAMnB,EAAKmB,KAAMS,UAAW5B,CAClD,CAEA,SAAS6D,GACPnF,EACAsB,EACA8D,GAEA,MAAMC,EAAY1P,OAAO4N,YACvB5N,OAAOC,QAAQ0L,EAAKmB,MAAMvR,KAAI,EAAEa,EAAKuT,KAAO,CAACvT,EAAK,CAAEwT,IAAKD,EAAGE,IAAKF,OAE7DG,EAAO,CAAEnE,QACf,OAAa,CACX,MAAMoE,GAAY/B,EAAAA,GAAAA,GAAaC,EAAAA,IAAcC,GAC3C8B,GAAgBF,EAAKnE,KAAK4B,OAAOW,MAE7B+B,GAAiBjC,EAAAA,GAAAA,GAAaC,EAAAA,IAAc7R,GAChD8T,GACElQ,OAAOC,QAAQ8P,GACZxU,KAAK4U,GAAOA,EAAE,KAAO/T,EAAMsT,EAAYS,EAAE,KACzChF,QAAQwE,GAAMA,OAIrB,IAAIjB,GAAW,EACf,MAAMnB,GAASS,EAAAA,GAAAA,GAAaC,EAAAA,IAAcC,IACxC,MAAMJ,EAASgC,EAAKnE,KAAK4B,OAAOW,GAAM/C,QAAQ8D,IAC5C,MAAMmB,EAAOF,GAAY,CAACF,GAAgB,CAACf,IAAOgB,EAAe/B,KAC3DmC,EAAWC,GAAiBjG,EAAO+F,GACzC,OAAO/F,EAAMnK,OACX,CAACC,EAAM1E,KAAC,aAAK4U,EAASjL,IAAIjF,GAAO0P,MAAkB,OAAf,EAAKJ,EAAQhU,IAAE,GAAK6M,IAAS,GAClE,IAGH,OADIwF,EAAOvC,SAAWuE,EAAKnE,KAAK4B,OAAOW,GAAM3C,SAAQmD,GAAW,GACzDZ,CAAM,IAEf,IAAKY,EAAU,MACfoB,EAAKnE,KAAO,CAAEmB,KAAMgD,EAAKnE,KAAKmB,KAAMS,SACtC,CACA,OAAOuC,EAAKnE,IACd,CACA,SAAS4E,GAAelG,EAAkBsB,GACxC,MAOM6E,EAAYF,GAAiBjG,EAJrB6F,GAAY,CAHRlQ,OAAO4N,YACvB5N,OAAOC,QAAQ0L,EAAKmB,MAAMvR,KAAI,EAAEa,EAAKuT,KAAO,CAACvT,EAAK,CAAEwT,IAAKD,EAAGE,IAAKF,UAI9D3P,OAAOuN,OAAO5B,EAAK4B,QAAQhS,KAAKgS,GAAWyC,GAAgBzC,QAIhE,OAAOQ,EAAAA,GAAAA,IACL1D,GACCoC,IACC,CACE,MAAM,IAAEmD,EAAG,IAAEC,GAAQW,EAAUpL,IAAIqH,GACnC,GAAImD,IAAQC,EAAK,OAAOlC,EAAAA,GAAAA,IAASiC,EACnC,CACA,MAAM,UAAElD,GAAcD,EAChBgE,EAAgBhE,EAAEN,SAAS5Q,KAAKoU,GAAMa,EAAUpL,IAAIuK,KAC1D,OAAQjD,GACN,IAAK,YAAa,CAChB,MAAO9I,EAAO8M,EAAWC,EAAMC,GAAQH,EACvC,GAAI7M,EAAMgM,KAAOc,EAAUb,IAAK,OAAOpD,EAAEN,SAAS,GAC7C,GAAIvI,EAAMiM,IAAMa,EAAUd,IAAK,OAAOnD,EAAEN,SAAS,GACtD,GACEwE,EAAKd,MAAQc,EAAKf,KAClBgB,EAAKf,MAAQe,EAAKhB,KAClBe,EAAKf,MAAQgB,EAAKhB,KAClBpJ,SAASmK,EAAKf,KAEd,OAAOjC,EAAAA,GAAAA,IAASgD,EAAKd,KACvB,KACF,CACA,IAAK,MAAO,CACV,MAAMgB,EAAcpE,EAAEN,SAAShB,QAAO,CAAC3P,EAAGC,KACxC,MAAMqV,EAAML,EAAchV,GAC1B,OAAOgV,EAAcvQ,OAAO6Q,GAAQD,EAAIlB,KAAOmB,EAAIlB,KAAI,IAEzD,GAAIgB,EAAYtF,OAASkF,EAAclF,OACrC,OAAOqE,EAAAA,GAAAA,OAAOiB,GAChB,KACF,CACA,IAAK,MAAO,CACV,MAAMA,EAAcpE,EAAEN,SAAShB,QAAO,CAAC3P,EAAGC,KACxC,MAAMqV,EAAML,EAAchV,GAC1B,OAAOgV,EAAcvQ,OAAO6Q,GAAQD,EAAIjB,KAAOkB,EAAInB,KAAI,IAEzD,GAAIiB,EAAYtF,OAASkF,EAAclF,OACrC,OAAOsE,EAAAA,GAAAA,OAAOgB,GAChB,KACF,EAEF,OAAOpE,CAAC,IAETA,GAAMA,GAEX,CACA,SAASyD,GAAYc,GACnB,MAAMlD,EAAoB,CAAC,EAS3B,OARAkD,EAAO5E,SAAS6E,IACdjR,OAAOC,QAAQgR,GAAO7E,SAAQ,EAAEhQ,EAAKwH,MAC/BkK,EAAO1R,IACT0R,EAAO1R,GAAKwT,KAAOhM,EAAMgM,IACzB9B,EAAO1R,GAAKyT,KAAOjM,EAAMiM,KACpB/B,EAAO1R,GAAO,OAAH,UAAQwH,EAAO,GACjC,IAEGkK,CACT,CACA,SAASkC,GAAgBrE,GACvB,MAAMmC,EAAoB,CAAC,EAkB3B,OAjBInC,EAAKJ,SACPvL,OAAO1E,KAAKqQ,EAAK,GAAG4B,QACjBpC,QAAQ/O,GAAQuP,EAAKzL,OAAO+O,GAAQA,EAAI1B,OAAOnR,OAC/CgQ,SACEhQ,GACE0R,EAAO1R,GAAO,CAAEwT,IAAKjE,EAAK,GAAG4B,OAAOnR,GAAMyT,IAAKlE,EAAK,GAAG4B,OAAOnR,MAErEuP,EAAKS,SAAQ,EAAGmB,aACd,IAAK,MAAOnR,EAAKwH,KAAU5D,OAAOC,QAAQsN,GACnCO,EAAO1R,IAEN0R,EAAO1R,GAAKyT,IAAMjM,IAAOkK,EAAO1R,GAAKyT,IAAMjM,GAC3CkK,EAAO1R,GAAKwT,IAAMhM,IAAOkK,EAAO1R,GAAKwT,IAAMhM,IAH/BkK,EAAO1R,GAAO,CAAEwT,IAAK,EAAGC,IAAKjM,EAKjD,KAGGkK,CACT,CAUO,SAASwC,GACdjG,EACA6G,GAEA,MAAMD,EAAQ,IAAI/D,IAyElB,OAvEAV,EAAAA,GAAAA,IACEnC,GACC7O,QACAiR,IAAM,MACL,MAAM,UAAEC,GAAcD,EAChBN,EAAWM,EAAEN,SAAS5Q,KAAK8Q,GAAO4E,EAAM7L,IAAIiH,KAClD,IAAI7K,EACJ,OAAQkL,GACN,IAAK,OACH,GAAkB,QAAdD,EAAEE,KAAK,GACT,MAAM,IAAIwE,MACP,sBAAqB1E,EAAEE,8BAE5BnL,EAA0B,OAAnB,EAAG0P,EAAMzE,EAAEE,KAAK,KAAG,EAAI,CAAEiD,IAAK,EAAGC,IAAK,GAC7C,MACF,IAAK,QACHrO,EAAU4P,GAAc,CAAC3E,EAAE7I,QAC3B,MACF,IAAK,MACL,IAAK,MACL,IAAK,MACHpC,EAAU,CACRoO,IAAKyB,GAAAA,GAAc3E,GAAWP,EAAS5Q,KAAKoU,GAAMA,EAAEC,OACpDC,IAAKwB,GAAAA,GAAc3E,GAAWP,EAAS5Q,KAAKoU,GAAMA,EAAEE,QAEtD,MACF,IAAK,MACHrO,EAAU,CACRoO,IAAKyB,GAAAA,GAAc3E,GAAW,CAACP,EAAS,GAAG0D,MAC3CA,IAAKwB,GAAAA,GAAc3E,GAAW,CAACP,EAAS,GAAGyD,OAE7C,MACF,IAAK,MACHpO,EAAU2K,EAASmF,QAAO,CAAClE,EAAM5L,IAC/B4P,GAAc,CACZhE,EAAKwC,IAAMpO,EAAQoO,IACnBxC,EAAKwC,IAAMpO,EAAQqO,IACnBzC,EAAKyC,IAAMrO,EAAQoO,IACnBxC,EAAKyC,IAAMrO,EAAQqO,QAGvB,MACF,IAAK,YACqCrO,EAApC2K,EAAS,GAAGyD,KAAOzD,EAAS,GAAG0D,IAAe1D,EAAS,GAClDA,EAAS,GAAG0D,IAAM1D,EAAS,GAAGyD,IAAezD,EAAS,GAChDiF,GAAc,GAAI,CAACjF,EAAS,GAAIA,EAAS,KACxD,MACF,IAAK,WAAY,CACf,MAAOwD,EAAG4B,GAAKpF,EACbqF,EAAM,CAAE5B,IAAKD,EAAEC,IAAM2B,EAAE3B,IAAKC,IAAKF,EAAEE,IAAM0B,EAAE1B,KAE3CrO,EADEgQ,EAAI5B,KAAO,GAAK4B,EAAI3B,KAAO,EAE3BF,EAAEC,KAAO,GAAKD,EAAEE,KAAO,EACnB,CAAED,IAAK6B,IAAK5B,IAAK4B,KACjB,CAAE7B,KAAMtH,IAAUuH,IAAKvH,KAGnB8I,GAAc,CACtBzB,EAAEC,IAAM4B,EAAI5B,IACZD,EAAEC,IAAM4B,EAAI3B,IACZF,EAAEE,IAAM2B,EAAI5B,IACZD,EAAEE,IAAM2B,EAAI3B,MAEhB,KACF,CACA,SACEhD,EAAAA,GAAAA,IAAkBH,GAEtBuE,EAAM7C,IAAI3B,EAAGjL,EAAQ,IAGlByP,CACT,CACA,SAASG,GACP7D,EACAmE,EAA8B,IAE9B,MAAM7B,EAAM8B,KAAK9B,OAAOtC,KAAWmE,EAASnW,KAAKoU,GAAMA,EAAEE,OAEzD,MAAO,CAAED,IADG+B,KAAK/B,OAAOrC,KAAWmE,EAASnW,KAAKoU,GAAMA,EAAEC,OAC3CC,MAChB,CCncO,MAAM+B,GAAQ,mBAEnBC,KAAY,GAAE,KACdC,KAAY,EAAE,CAEVvG,aACF,OAAOwG,KAAKF,KAAKtG,OAASwG,KAAKD,KAAKvG,MACtC,CACAyG,KAAKrU,GACHoU,KAAKD,KAAKE,KAAKrU,EACjB,CACAsU,MAGE,OAFKF,KAAKF,KAAKtG,QAAUwG,KAAKD,KAAKvG,UAChCwG,KAAKF,KAAME,KAAKD,MAAQ,CAACC,KAAKD,KAAKI,UAAWH,KAAKF,OAC/CE,KAAKF,KAAKI,KACnB,E,qjBC/DK,MAAME,GAeXC,YACEC,EACAC,EACAC,GACA,KAfFD,UAAI,OACJE,cAAQ,OACRH,aAAO,OACPI,SAAoC,IAAIvF,IAAK,KAC7CwF,cAAQ,OAERC,YAAM,OACNC,eAAS,OACTL,cAAQ,OACRM,oBAAc,EAOZd,KAAKS,SAAWF,EAAK/W,KAAKC,GAAM,IAAIoW,KACpCG,KAAKO,KAAO,IAAIpF,IAAIoF,EAAK/W,KAAI,CAACuX,EAAGrX,IAAM,CAACqX,EAAGrX,MAC3CsW,KAAKQ,SAAWA,EAEhBF,EAAQjG,SAAS2G,IACfA,EAAOC,UAAarD,GAAMoC,KAAKkB,UAAUtD,EAAE9Q,KAAMkU,GACjDA,EAAOG,QAAWhS,GAAM6Q,KAAKoB,QAAQjS,EAAE,IAEzC6Q,KAAKW,SAAWL,EAChBN,KAAKM,QAAUA,EAAQ9W,KAAK6X,GAAMC,QAAQC,QAAQF,KAClDrB,KAAKY,OAAS,OACdZ,KAAKa,UAAY,IAAIS,SAAe,CAAC7X,EAAG+X,IAASxB,KAAKY,OAASY,IAC/DxB,KAAKa,UAAUY,OAAOhY,GAAM6W,EAAQjG,SAASgH,GAAMA,EAAEK,eACvD,CAUAC,cAAclB,GAAsD,WAClE,MAAMmB,EAAmBD,iBAAY,oBACnC,QAAoC,EAApC,E,sRAAA,CAA4BlB,GAAQ,uCAAnBoB,EAAO,QAAc,EAAK1H,IAAI0H,EAAQ,0FACzD,CAFyBF,GAIzB,OAAa,OACX,MAAME,EAA6C,OAAtC,EAAG7B,KAAKS,SAASqB,MAAMlE,GAAMA,EAAEpE,eAAO,EAAnC,EAAqC0G,MACrD,QAAgB7W,IAAZwY,EAAuB,CACzB,MAAME,QAAmBT,QAAQU,KAAK,CACpC,IAAIV,SACDW,GAASjC,KAAKc,eAAiB,IAAMmB,GAAI,KAE5CX,QAAQY,IAAI,IAAIlC,KAAKM,QAASsB,IAAkBO,MAAM1Y,IAAM,IAC5DuW,KAAKa,YAIP,GADAb,KAAKc,oBAAiBzX,EAClB0Y,EAAY,SAChB,KACF,CAEA,MAAM,EAAErY,EAAC,EAAE2X,SAAYC,QAAQU,KAAK,IAC/BhC,KAAKM,QAAQ9W,KAAI,CAAC6X,EAAG3X,IAAM2X,EAAEc,MAAMd,IAAC,CAAQ3X,IAAG2X,UAClDrB,KAAKa,YAEPb,KAAKM,QAAQ5W,GAAK,IAAI4X,SAASW,GAAQjC,KAAKU,SAASrE,IAAIgF,GAAG,IAAMY,EAAIZ,OACtEA,EAAEe,YAAYP,EAChB,CACF,CAEAT,QAAQjS,GACN6Q,KAAKY,OAAO,IAAIxB,MAAO,iBAAgBjQ,EAAEkT,WAC3C,CACAnB,UAAUoB,EAAyBtB,QACb3X,IAAhBiZ,EAAIT,QAAuB7B,KAAK7F,IAAImI,GACZ,SAAnBA,EAAIC,WAAuBvC,KAAKU,SAASrN,IAAI2N,EAAlBhB,GAC/BA,KAAKQ,SAAS8B,EAAKtB,EAC1B,CAEA7G,IAAI0H,GAAkB,MACpB,MAAMtB,EAAOP,KAAKO,KAAKlN,IAAIwO,EAAQA,SACnC7B,KAAKS,SAASF,GAAMN,KAAK4B,GACN,OAAnB,EAAA7B,KAAKc,iBAAL,OAAAd,KACF,CAEAwC,UAAUX,GACR7B,KAAKW,SAAStG,SAASgH,GAAMA,EAAEe,YAAYP,IAC7C,CAEAY,kBAAkBZ,GAChB7B,KAAKM,QAAUN,KAAKM,QAAQ9W,KAAKwX,GAC/BA,EAAOmB,MACJd,GACC,IAAIC,SAASW,IACXjC,KAAKU,SAASrE,IAAIgF,GAAG,IAAMY,EAAIZ,IAAG,QAI1CrB,KAAKW,SAAStG,SAASgH,GAAMA,EAAEe,YAAYP,IAC7C,EC3FK,MAAMa,WAAiBtC,GAQ5BC,YACEsC,EACAC,EACAC,GAKAC,MAHgBxZ,MAAMuZ,GACnBE,KAAKrD,KACLlW,KAAKC,GAAM,IAAIuZ,OAAO,IAAIC,IAAI,qBAClB,CAAC,UAAW,QAAS,UAAU,CAACC,EAAG7B,KAChD,OAAQ6B,EAAEX,YACR,IAAK,UACHvC,KAAKmD,QAAQD,EAAG7B,GAChB,MACF,IAAK,WACHrB,KAAKoD,iBAAiBnD,KAAKiD,GAC3B,MACF,IAAK,QACHlD,KAAK4C,OAAOS,MAAQH,EAAE/F,MACtB,MACF,IAAK,MACH6C,KAAKoB,QAAQ8B,GACR,IAET,KA9BII,eAAiB,KAAU,KAC3BV,YAAM,OACNlG,eAAS,OACT6G,UAAI,OACJC,iBAAW,OACXJ,iBAAqC,GA0B3C,MAAM,UAAE1G,EAAS,KAAE6G,GAASZ,EAC5B3C,KAAK4C,OAASA,EACd5C,KAAKtD,UAAYA,EACjBsD,KAAKuD,KAAOA,EACZvD,KAAK4C,OAAOS,MAAQ3D,IACpBM,KAAKwD,YAAcla,MAAMia,GAAMR,KAAK,CAAE1B,OAAGhY,EAAkB8M,KAAMI,MAEjEyJ,KAAKyC,kBAAkBzC,KAAKyD,WAAWd,GACzC,CAEAhB,cACE,MAAM,UAAEjF,EAAS,eAAE4G,GAAmBtD,KAKtC,OAJAA,KAAKoD,iBAAmB,SAClBpD,KAAK0D,QAAQ,CAAC,CAAE7B,QAAS,QAASnF,YAAW4G,oBACnDtD,KAAKyC,kBAAkB,CAAEZ,QAAS,mBAC5B7B,KAAK0D,QAAQ,IACZ1D,KAAKoD,gBACd,CAEAK,YAAW,SACTE,EAAQ,mBACRC,EAAkB,KAClBhK,EAAI,KACJ2J,EAAI,UACJ7G,EAAS,YACTmH,IAIA,IAAIvL,EAAQ,KAFZuL,EAAcA,EAAYzK,QAAQwE,GAAMA,EAAEC,KAAOtH,OAErB/M,KAAKoU,GAAMA,EAAE/L,QAAQ+R,GACjD,MAAME,EAAW,IAAID,EAAYra,KAAKoU,GAAMA,EAAEC,OAAOtH,KACjDoN,IACFrL,EAAM2H,KAAK0D,GACXG,EAAS7D,MAAM1J,MAGjB+B,EHXG,SACLA,EACAoE,GAEA,MAAMqH,EAAkD,CAAC,EACzD,IAAK,MAAO1Z,EAAK8E,KAAMlB,OAAOC,QAAQwO,GAC/BvN,EAAEiJ,SAAS,KAChB2L,EAAU1Z,GAAO8E,EAAEiJ,SAAS,GAAK,EAAI,GAEvC,OAAO4D,EAAAA,GAAAA,IACL1D,GACCoC,GAAMA,IACNA,IACC,GAAoB,cAAhBA,EAAEC,UAA2B,OAAOD,EAExC,MAAOoB,EAAGlQ,EAAGgT,EAAMC,GAAQnE,EAAEN,SAC7B,GAAoB,SAAhB0B,EAAEnB,WAAwC,UAAhB/O,EAAE+O,UAAuB,CACrD,MAAMtQ,EAAMyR,EAAElB,KAAKkB,EAAElB,KAAKpB,OAAS,GACjCwK,EAAQpY,EAAEiG,MACZ,GAAIxH,KAAO0Z,EAAW,CAEpB,GADoBA,EAAU1Z,GACpB2Z,EAAO,OAAOnF,EACxB,GAAc,IAAVmF,GAAetH,EAAUrS,GAAM+N,SAAS,GAC1C,OAAOuG,EAAAA,GAAAA,IAAU7C,EAAG,EAAG8C,EAAMC,EACjC,CACF,CACA,OAAOnE,CAAC,GAGd,CGlBYuJ,CAAe3L,EAAOoE,KAC1BpE,QAAOsB,QHnER,SACLtB,EACAoF,EACA9D,EACA6C,EACAC,EACAwH,GAEA,IAAIC,EAASD,EAEb,MAAME,EACQ,CAAE5F,gBAAgB,GAD1B4F,EAEW,CAAE5F,gBAAgB,GAF7B4F,EAGY,CAAEzK,UAAU,GAHxByK,EAIM,CAAE5H,YAAY,EAAMiB,eAAe,EAAMe,gBAAgB,GAErE,IAAIrB,EAAQ,EACZ,KAAOlP,OAAOuN,OAAO2I,GAAQ7G,MAAMM,GAAMA,KAAMT,IAAU,IAAI,CAC3D,GAAIgH,EAAO3H,WAAY,QACd2H,EAAO3H,WACd,MAAM6H,EAAU7H,GAAW5C,EAAM6C,EAAQC,GACrC9C,IAASyK,IACXzK,EAAOyK,EACPF,EAAS,OAAH,UAAQA,EAAWC,GAE7B,CACA,GAAID,EAAO1G,cAAe,QACjB0G,EAAO1G,cACd,MAAM4G,EAAU5G,GAAcnF,EAAOsB,EAAM8D,GACvC9D,IAASyK,IACXzK,EAAOyK,EACPF,EAAS,OAAH,UAAQA,EAAWC,GAE7B,CACA,GAAID,EAAO3F,eAAgB,QAClB2F,EAAO3F,eACd,MAAM8F,EAAW9F,GAAelG,EAAOsB,GACnCtB,IAAUgM,IACZhM,EAAQgM,EACRH,EAAS,OAAH,UAAQA,EAAWC,GAE7B,CACA,GAAID,EAAOxK,SAAU,QACZwK,EAAOxK,SACd,MAAQrB,MAAOgM,EAAU1K,KAAMyK,GAAY1K,GAASrB,EAAOsB,GACvDtB,IAAUgM,GAAY1K,IAASyK,IACjC/L,EAAQgM,EACR1K,EAAOyK,EACPF,EAAS,OAAH,UAAQA,EAAWC,GAE7B,CACF,CACA,MAAO,CAAE9L,QAAOsB,OAClB,CGcwB2K,CAASjM,EAAOwL,EAAUlK,EAAM2J,EAAM7G,EAAW,CACnE/C,UAAU,EACV8D,eAAe,EACfe,gBAAgB,EAChBhC,YAAY,KAEdlE,GAAQkM,EAAAA,GAAAA,IAASlM,EAAO,CAAC,GAAI7O,IAAM,IAE/Bka,IAAUA,EAAWrL,EAAM4H,OAG/B,MAAO,CACL2B,QAAS,QACTjI,OACA6K,UALgBnM,EAAM4H,MAMtByD,WACAJ,OACAM,YAAavL,EAAM9O,KAAI,CAACqI,EAAOnI,KAAM,CAAGmI,QAAOgM,IAAKiG,EAASpa,OAEjE,CAGQyZ,QAAQD,EAAYlC,GAK1B,GAJAhB,KAAK4C,OAAO8B,QAAUxB,EAAEwB,OACxB1E,KAAK4C,OAAO+B,QAAUzB,EAAEyB,OACxB3E,KAAK4C,OAAOgC,SAAW1B,EAAE0B,QAErB1B,EAAEM,YAAa,SACjB,MAAM,KAAED,GAASvD,KACf6E,EAA6C,OAAjC,EAAG7E,KAAKwD,YAAYD,EAAO,GAAGpN,KAAG,GAAKI,IAEpDyJ,KAAKwD,YAAYpK,QAAO,EAAGiI,OAAQA,IAAML,IACzChB,KAAKwD,YAAYvD,QACZiD,EAAEM,YAAYha,KAAK2M,IAAG,CAAQkL,EAAGL,EAAS7K,WAE/C6J,KAAKwD,YAAYsB,MAAK,CAAC1G,EAAG2G,IAAMA,EAAE5O,IAAMiI,EAAEjI,MAAK6O,OAAOzB,GAEtD,MAAM5E,EAA0C,OAAjC,EAAGqB,KAAKwD,YAAYD,EAAO,GAAGpN,KAAG,GAAKI,IACjDsO,IAAiBlG,GACnBqB,KAAKwC,UAAU,CAAEX,QAAS,YAAalD,aAC3C,CACF,E,kJCtHa,SAASsG,GAAgB3a,GACtC,MAAM,SAAEsD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzBqX,EAAcC,IAAmBxa,EAAAA,EAAAA,WAAS,IAC/CiD,EAASwX,cAAc/R,IAAI/I,MAE7BiF,EAAAA,EAAAA,YACE,IAAM4V,EAAgBvX,EAASwX,cAAc/R,IAAI/I,KACjD,CAACsD,EAAUtD,KAEbiF,EAAAA,EAAAA,YACE,IACE3B,EAASwX,cAAcC,OACrB/a,GACA,CAACwN,EAAGoL,EAAGpH,IAAY,WAANoH,GAAkBiC,EAAgBrJ,MAEnD,CAACxR,EAAc6a,EAAiBvX,IAQlC,MAAO,CAAEsX,aAAcA,EAA8BI,sBANxBpZ,EAAAA,EAAAA,cAC1BO,GACCnC,GAAgBsD,EAASwX,cAAc/I,IAAI/R,EAAcmC,IAC3D,CAACnC,EAAcsD,IAInB,C,wBC2BgD,IAE3C2X,GAKU,SAASC,IAAU,SAChCtT,GAAW,EAAK,eAChBuT,IAKA,MAAM,EAAE7Z,IAAM1B,EAAAA,EAAAA,IAAe,4BACrB0B,EAAG8Z,IAASxb,EAAAA,EAAAA,IAAe,mBAEjCE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,kBAAES,EAAiB,oBAAEC,GAAqB,qBACxDN,GACEL,GAAgB3a,IACd,SAAEsD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB3C,EAAM2a,EAAQxZ,IAAWyZ,EAAAA,EAAAA,IAAa,IACtCC,EAASC,IAAeC,EAAAA,GAAAA,KACzBC,GAAkBC,EAAAA,EAAAA,kBAAiBJ,IAElCK,EAAYC,IAAiB1b,EAAAA,EAAAA,UAAS,IACvC2b,GAAqBH,EAAAA,EAAAA,kBAAiBC,IACrCG,EAAaC,IAAkB7b,EAAAA,EAAAA,UAAS,IAAI8b,GAAAA,KAC7CC,GAAsBP,EAAAA,EAAAA,kBAAiBI,IACtCI,EAAgBC,IAAqBjc,EAAAA,EAAAA,UAAS,IAAIkc,GAAAA,KACnDC,GAAyBX,EAAAA,EAAAA,kBAAiBQ,GAE1CI,GAAmDhZ,EAAAA,EAAAA,UACvD,IACEmY,GACAjY,OAAO4N,YACLvS,MAAM0d,KACJ,IAAIjN,IACF9L,OAAOC,QAAQN,EAASqZ,MAAMna,MAC3BsM,QAAO,EAAE8N,KAAQA,IAAO5c,IACxB8O,QAAO,EAAE8N,MACRC,EAAAA,GAAAA,GACE,CACEnT,QAAS0S,EACTU,WAAYN,EACZnb,KAAM2a,IAERe,EAAAA,GAAAA,IAAuBzZ,GANzBuZ,CAOED,SAKd,CACEhB,EACAtY,EACA8Y,EACAI,EACAR,EACAhc,IAIEgd,EAAUrZ,OAAOC,QAAQ6Y,GAC5BjC,MAAK,EAAEyC,EAAKC,IAAMC,EAAKC,MAEtB,MAAOC,EAAUC,GAAY,EAAE,EAAG,GAC5BC,EAAMja,EAASka,SAASzU,IAAIkU,GAAKQ,SACjCC,EAAMpa,EAASka,SAASzU,IAAIoU,GAAKM,SACvC,GAAIF,IAAQG,EAAK,OAAOL,EACnB,GAAIK,IAAQH,EAAK,OAAOD,EAE7B,MAAMK,EAAOha,OAAOuN,OAAOgM,EAAGU,mBAAmB9O,QAAQgD,GAAOA,IAAI5C,OAC9D2O,EAAOla,OAAOuN,OAAOkM,EAAGQ,mBAAmB9O,QAAQgD,GAAOA,IAAI5C,OACpE,OAAIyO,EAAOE,EAAaR,EACfQ,EAAOF,EAAaL,EACtBL,EAAIa,cAAcX,EAAI,IAE9Bje,KAAI,EAAE0d,MAAQmB,EAAAA,GAAAA,IAAoBnB,MAE/B,cAAEoB,EAAa,iBAAEC,EAAgB,cAAEC,IAAkBza,EAAAA,EAAAA,UAAQ,KACjE,MAAM0a,EAAU,CACdH,cAAe,IAAI7B,GAAAA,IACnB8B,iBAAkB,IAAI1B,GAAAA,IACtB2B,cAAe,CAAC,UAAW,aAE7B,OAAOE,EAAAA,GAAAA,GAAaD,GAAUE,GAC5B1a,OAAOC,QAAQN,EAASqZ,MAAMna,MAC3BsM,QAAO,EAAE8N,KAAQA,IAAO5c,IACxB+P,SAAQ,EAAE6M,MACT,MAAM0B,GAAQC,EAAAA,EAAAA,GAAa3B,EAAItZ,EAAShD,QAClCsL,EAAS0S,EAAM3P,WACrB0P,EAAML,cAAcpS,GAAQmN,QACxB0D,EAAWG,IAAKyB,EAAML,cAAcpS,GAAQzG,UAEhD,MAAMqZ,EAAgBF,EAAME,cAC5BH,EAAMJ,iBAAiBO,GAAezF,QAClC0D,EAAWG,IAAKyB,EAAMJ,iBAAiBO,GAAerZ,UAE1D,MAAMsZ,GAASV,EAAAA,GAAAA,IAAoBnB,GAC/BI,EAAQlP,SAAS2Q,KACnBJ,EAAMH,cAAcQ,QAAQ3F,QAC5BsF,EAAMH,cAAcS,SAAS5F,QACxBsC,EAAkBvN,SAAS2Q,GAE3BJ,EAAMH,cAAcS,SAASxZ,UADhCkZ,EAAMH,cAAcQ,QAAQvZ,UAEhC,KAEL,GACA,CACDsX,EACAzc,EACAsD,EAASqZ,MAAMna,KACfc,EAAShD,OACT+a,EACA2B,KAGF/X,EAAAA,EAAAA,YACE,IAAM3B,EAASka,SAASoB,WAAWzf,GAAMuc,OACzC,CAACA,EAAapY,KAEhB2B,EAAAA,EAAAA,YACE,IAAM3B,EAASqZ,MAAMiC,WAAWzf,GAAMuc,OACtC,CAACA,EAAapY,IAGhB,MAAOub,EAAiBC,IAAsBze,EAAAA,EAAAA,WAAS,GAEjD0e,GAAWnd,EAAAA,EAAAA,cACf,IACEoZ,EAAqB,CACnBK,kBAAmBA,EAAkBvM,QAClC/O,IAASid,EAAQlP,SAAS/N,KAE7Bub,oBAAqB,gBAEzB,CAACN,EAAsBK,EAAmB2B,IAEtCgC,GAAcpd,EAAAA,EAAAA,cAClB,IACEoZ,EAAqB,CACnBK,kBAAmBrc,MAAM0d,KACvB,IAAIjN,IAAI4L,EAAkB4D,OAAOjC,KAEnC1B,oBAAqB,gBAEzB,CAACN,EAAsBK,EAAmB2B,IAGtCkC,GAAWtd,EAAAA,EAAAA,cACf,CAACud,EAAgBC,IACfpE,EAAqB,CAAEM,oBAAqB8D,KAC9C,CAACpE,IAGGqE,GAAazd,EAAAA,EAAAA,cAChB0d,IACC,MAAMC,EAAU,IAAID,GACdE,EAAuBD,EAC1BzQ,QAAQ2Q,IAAQpE,EAAkBvN,SAAS2R,KAC3CR,OAAO5D,EAAkBvM,QAAQ2Q,IAAQF,EAAQzR,SAAS2R,MAC7DzE,EAAqB,CACnBK,kBAAmBmE,EACnBlE,oBAAqB,cACrB,GAEJ,CAACD,EAAmBL,IAGhB0E,GAAY9d,EAAAA,EAAAA,cAAY,IAAMkd,GAAmB,IAAO,IAExD/F,EAAQzV,EAASqZ,MAAM1d,KAAKiQ,OAAS,EACrCyQ,EAAS5G,EAAQsC,EAAkBnM,OAEnC0Q,GACoB,QAAxBtE,EACIvC,EACwB,eAAxBuC,EAJWqE,IAAW5G,EAAQ4G,EAAU,GAAEA,KAAU5G,IAMpD,EACA8G,GACoB,QAAxBvE,EACI,UACwB,eAAxBA,EACA,OACA,YAEN,OACE,QAACvY,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAE,WAEzB,QAACvH,GAAA,EAAY,CACXC,KAAMlB,EACNmB,QAASA,EACT+d,eAAgB,CAAEC,SAAU,MAC5BC,WAAW,EACXN,UAAWA,EAAU,UAErB,QAAC1d,EAAA,EAAQ,YAEP,QAACK,EAAA,EAAW,WACV,QAACU,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAGC,WAAW,SAAQ,WAC7C,QAACxD,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAExB,EAAC,UAAC,yBAC5B,QAAC2e,GAAA,EAAW,CACV/d,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,6BAExB,QAACyB,EAAA,EAAG,CAACoF,SAAU,KACf,QAAC/F,EAAA,EAAW,CAACpB,QAASe,EAASsC,KAAK,gBAGxC,QAACE,EAAA,EAAO,KAER,QAAClC,EAAA,EAAW,CAAC/C,GAAI,CAAE4gB,GAAI,GAAI,UACzB,QAAC3T,GAAA,EAAK,CAACnD,IAAK,EAAE,WAEZ,QAACrG,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAGE,SAAS,OAAM,WACzC,QAAC6W,GAAA,EAAsB,CACrBC,WAAS,EACTC,UAAU,YACVhc,KAAK,QACLkD,MAAO+T,EACP9V,SAAU0Z,EAAS,SAElBoB,GAAAA,GAAAA,KAA4BC,IAC3B,QAACC,GAAA,EAAY,CAEXjZ,MAAOgZ,EACP3Y,SAAU0T,IAAwBiF,GAAK3Y,EAAS,SAE/CtG,EAAG,sBAAqBif,MAJpBA,QAQX,QAACE,GAAA,EAAS,CACRC,WAAS,EACTnZ,MAAOuU,EACPtW,SAAWX,GACTkX,EAAclX,EAAEuG,OAAO7D,OAEzBiC,MAAO4R,EAAK,iBACZ/W,KAAK,QACL/E,GAAI,CAAEzB,OAAQ,QACd8iB,WAAY,CACVrhB,GAAI,CAAEzB,OAAQ,eAKpB,QAACkF,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAGE,SAAS,OAAM,WACzC,QAACsX,GAAA,EAAY,CACXthB,GAAI,CAAEzB,OAAQ,QACd2H,SAAU8W,EACV/U,MAAOiV,EACPqE,OAAQ5C,EACR5Z,KAAK,WAEP,QAACyc,GAAA,EAAa,CACZxhB,GAAI,CAAEzB,OAAQ,QACd2H,SAAU0W,EACV3U,MAAO6U,EACPyE,OAAQ7C,EACR3Z,KAAK,mBAMb,QAAChC,EAAA,EAAW,CACV/C,GAAI,CAAEyhB,QAAiC,eAAxBzF,EAAuC,EAAI,IAAM,WAEhE,QAACvQ,GAAA,GAAI,CAACC,WAAS,EAACkV,GAAI,EAAG9W,IAAK,EAAGE,SAAS,SAAQ,WAC9C,QAACyB,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAAC1J,EAAA,EAAM,CAACjC,MAAM,UAAUoM,WAAS,EAAClK,QAAS+d,EAAS,UACjDzd,EAAC,UAAC,iCACH,QAACgD,EAAA,EAAO,CAAChF,GAAI,CAAE2G,GAAI,GAAI,UACrB,2BAASiY,EAAcQ,kBAI7B,QAAC3T,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAAC1J,EAAA,EAAM,CAACmK,WAAS,EAACpM,MAAM,QAAQkC,QAASge,EAAY,UAClD1d,EAAC,UAAC,oCACH,QAACgD,EAAA,EAAO,CAAChF,GAAI,CAAE2G,GAAI,GAAI,UACrB,2BAASiY,EAAcS,sBAK/B,QAACqC,GAAc,CACbhE,QAASA,EACT3B,kBAAmBA,EACnBwD,gBAAiBA,EACjBC,mBAAoBA,EACpBO,WAAYA,aAOpB,QAACpb,EAAA,EAAS,CAAC3E,GAAI,CAAE3B,QAAS,OAAQC,MAAO,QAAS,WAChD,QAACyE,EAAA,EAAW,CAAC/C,GAAI,CAAE6I,SAAU,GAAI,UAC/B,QAACoE,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAAC4H,EAAA,EAAU,WACT,2BAASvE,EAAE,0BAEb,QAACuE,EAAA,EAAU,WACRvE,EAAE,0BAA2B,KAC9B,QAACgD,EAAA,EAAO,CAACxF,MAAO+gB,GAAgB,SAC7Bve,EAAG,sBAAqBga,WAG7B,QAACzV,EAAA,EAAU,WACRvE,EAAE,qBAAsB,KACzB,QAACgD,EAAA,EAAO,CAACxF,MAAM,UAAS,UACrB8gB,GAAkB,KAAC,QAACqB,GAAA,EAAa,iBAAK3W,GAAAA,IACtChJ,EAAE,+BAGP,QAACuE,EAAA,EAAU,WACRvE,EAAE,qBAAsB,KACzB,QAACgD,EAAA,EAAO,CAACxF,MAAM,UAAS,UACrBqc,EAAe,KAAC,QAAC8F,GAAA,EAAa,iBAAK3W,GAAAA,IACnChJ,EAAE,oCAKX,QAACP,EAAA,EAAM,CACLzB,GAAI,CAAE4hB,aAAc,EAAG1Y,WAAY,EAAG2Y,SAAU,IAChDngB,QAASua,EACT3T,SAAUA,EACV9I,MAAM,OAAM,UAEZ,QAACsiB,GAAA,EAAY,WAKvB,CAEA,SAASJ,IAAe,QACtBhE,EAAO,kBACP3B,EAAiB,gBACjBwD,EAAe,mBACfC,EAAkB,WAClBO,IAQA,MAAOgC,EAAUC,IAAejhB,EAAAA,EAAAA,UAAS,IAAIoP,MACtC8R,EAAcC,IAAmBnhB,EAAAA,EAAAA,YAWxC,OAVA4E,EAAAA,EAAAA,YAAU,KACJ4Z,IACFC,GAAmB,GACfuC,EAAShd,KAAO,IAClBgb,EAAWgC,GACXC,EAAY,IAAI7R,KAChB+R,OAAgBziB,IAEpB,GACC,CAACsiB,EAAUC,EAAaxC,EAAoBD,EAAiBQ,KAE9D,QAACtU,GAAA,GAAI,CACHC,WAAS,EACT/M,QAAS,EACT6O,QAAS,CAAErC,GAAI,EAAGgX,GAAI,EAAG/W,GAAI,GAAI2B,GAAI,GAAIqV,GAAI,IAAK,SAEjD1E,EAAQ9d,KAAKugB,IACZ,QAAC1U,GAAA,GAAI,CAACE,MAAI,EAAUR,GAAI,EAAE,UACxB,QAACkX,GAAU,CACTlD,OAAQgB,EACR4B,SAAUA,EACVE,aAAcA,EACdD,YAAaA,EACbE,gBAAiBA,EACjBI,UAAWvG,EAAkBvN,SAAS2R,MAP1BA,MAaxB,CAEA,SAASkC,IAAW,OAClBlD,EAAM,SACNmD,EAAQ,SACRP,EAAQ,aACRE,EAAY,YACZD,EAAW,gBACXE,IASA,MAAM,SAAEle,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1Bse,EAAOve,EAASqZ,MAAM5T,IAAIzF,EAASqZ,MAAMmF,uBAAuBrD,IAChEsD,GAAengB,EAAAA,EAAAA,cAClBiD,GAEe,IAAdA,EAAEmd,UAEAT,IAAiBtG,GAAagH,gBAAkBL,GAC/CL,IAAiBtG,GAAaiH,iBAAmBN,IACpDN,EAAY,IAAI7R,IAAI,IAAI4R,IAAWxR,IAAI4O,KACzC,CAAC8C,EAAcK,EAAUN,EAAaD,EAAU5C,IAE5C0D,GAAcvgB,EAAAA,EAAAA,cAAY,KAC9B,MAAMwgB,EAAOR,EACT3G,GAAaiH,gBACbjH,GAAagH,cACjBT,EAAgBY,GAChBd,EAAY,IAAI7R,IAAI,IAAI4R,IAAWxR,IAAI4O,GAAQ,GAC9C,CAACmD,EAAUJ,EAAiBF,EAAaD,EAAU5C,IAChD4D,GAAiB5e,EAAAA,EAAAA,UAAQ,IAAwB,IAAlB4d,EAAShd,MAAY,CAACgd,EAAShd,OAC9Dqa,EAEHkD,KAEGL,IAAiBtG,GAAaiH,iBAAmBb,EAASpR,IAAIwO,KAGjE8C,IAAiBtG,GAAagH,eAAiBZ,EAASpR,IAAIwO,GACzDnf,EAAK,CACTyhB,QAASrC,OAAU3f,EAAY,GAC/BujB,YAAa5D,EAAU,mBAAqB,mBAC5C6D,YAAa,MACbC,YAAa,QACbtB,aAAc,OAEV3W,GAAU9G,EAAAA,EAAAA,UACd,KACE,QAACV,EAAA,EAAG,CACF1D,SAAS,SACT1B,QAAQ,OACRiM,eAAe,gBACf6M,EAAG,GAAI,SAENgM,GAAAA,GAAAA,KAAyBlC,IACxB,QAACmC,GAAA,EAAQ,CAEPC,QAASpC,EACTlW,UAAW,CACThL,SAAU,UACVC,GAAI,CAAEyhB,QAAa,MAAJc,GAAAA,EAAMjE,kBAAkB2C,QAAKxhB,EAAY,MAJrDwhB,QAUb,CAAK,MAAJsB,OAAI,EAAJA,EAAMjE,oBAET,OACE,QAAC3Z,EAAA,EAAS,CAAC3E,GAAIA,EAAG,WAChB,QAACsjB,GAAA,EAAiB,CAChB5iB,aAAcsD,EAASqZ,MAAMmF,uBAAuBrD,GACpD0D,YAAaA,EACbJ,aAAcA,EACdM,eAAgBA,IAEjB9X,IAGP,EAxdiB,SAAZ0Q,GAAAA,EAAAA,EAAY,iCAAZA,EAAAA,EAAY,sCAAZA,KAAAA,GAAY,K,oDC9CF,SAAS4H,IAAiB,OACvCC,EAAM,UACNC,EAAS,WACTC,GAAa,EAAK,iBAClBC,GAAmB,IACZ,MACP,MAAM3E,GAAQ4E,EAAAA,GAAAA,IAAYJ,GAEpBK,EAAWF,EAEkB,OAFF,EAC7B3E,EACG8E,kBAAkBL,SAAU,EAD/B,EAEIjU,QAAQuU,GAAY,WAAYA,IACpC/E,EAAM8E,kBAAkBL,GAC5B,OACE,QAAChgB,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAAQ,SACvCH,GACC,QAACI,GAAA,EAAe,CAAC5gB,SAAUwgB,EAAUH,WAAYA,IAC/C,MAGV,C,wFCgBe,SAASQ,IAAkB,SACxC5b,IAGC,QACD,MAAM,EAAEtG,IAAM1B,EAAAA,EAAAA,IAAe,CAAC,0BAA2B,UACnD6jB,GAAcxjB,EAAAA,EAAAA,YAAWwC,EAAAA,IACzB,SAAEa,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAE9BzD,WAAaC,IAAKC,EAAY,YAAE0jB,GAAa,kBAC7C/a,IACE1I,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,gBAAE+I,GAAiB,qBACjC3I,GACEL,GAAgB3a,IACb8B,EAAM8hB,IAAWvjB,EAAAA,EAAAA,WAAS,GAC3Bkb,GAAS3Z,EAAAA,EAAAA,cAAY,IAAMgiB,GAAQ,IAAO,CAACA,IAC3C7hB,GAAUH,EAAAA,EAAAA,cAAY,IAAMgiB,GAAQ,IAAQ,CAACA,KAE5CnI,EAASC,IAAeC,EAAAA,GAAAA,MAC/B1W,EAAAA,EAAAA,YAAU,IAAM3B,EAASgM,KAAKsP,UAAUlD,IAAc,CAACpY,EAAUoY,IAEjE,MAAMmI,GAAkBpgB,EAAAA,EAAAA,UACtB,IACEE,OAAOC,QAAQkgB,GAAAA,IACZjO,UACAkO,SAAQ,EAAE,CAAEC,KAAUA,IACtBlV,QAAQ/O,IAASA,EAAI+N,SAAS,cACnC,KAEI,QAAEmW,EAAO,aAAEC,IAAiBzgB,EAAAA,EAAAA,UAAQ,KACxC,MAAMygB,GAAevS,EAAAA,GAAAA,GAAakS,GAAkB1kB,IAClDwS,EAAAA,GAAAA,GAAa8Q,GAAAA,IAAsBtjB,GAAM,MAE3CmE,EAASgM,KAAK4B,OAAOnB,SAClB6C,GACCsR,EAAatR,EAAIkQ,SAAWoB,EAAatR,EAAIkQ,QAAQlQ,EAAI+P,aAE7D,MAAMsB,EAAU,IAAIJ,GAAiBrJ,MACnC,CAAC1G,EAAG2G,MACA0J,GAAYD,EAAapQ,IAAM,KAC/BqQ,GAAYD,EAAazJ,IAAM,KAErC,OAAOgB,GAAW,CAAEwI,UAASC,eAAc,GAC1C,CAACzI,EAASnY,EAAUugB,IAEjBO,IAAwC,OAAxB,EAACT,EAAgBpR,UAAhB,EAAyBzE,SAAS,IACnDuW,IAAwC,OAAxB,EAACV,EAAgBpR,UAAhB,EAAyBzE,SAAS,KAEnD,YAAEwW,IAAgB7gB,EAAAA,EAAAA,UAAQ,KAEvB2a,EAAAA,GAAAA,GADS,CAAEkG,YAAa,CAAC,IAAK,OACPjG,GAC5BwF,EAAgB9T,SAAS+S,IAAW,QAClCzE,EAAMiG,YAAY,GAAKvL,QACK,OAAxB,EAAC4K,EAAgBb,KAAhB,EAAyBhV,SAAS,IACrCuQ,EAAMiG,YAAY,GAAKnf,UAEzBkZ,EAAMiG,YAAY,GAAKvL,QACK,OAAxB,EAAC4K,EAAgBb,KAAhB,EAAyBhV,SAAS,IACrCuQ,EAAMiG,YAAY,GAAKnf,SACzB,OAGH,CAAC0e,EAAiBF,IACfY,GAAoB9gB,EAAAA,EAAAA,UACxB,IACEE,OAAO1E,KAAKykB,GAAa5U,QACtBtB,IAAC,aACAgX,GAAAA,GAAAA,SAA4BhX,MAC1B7J,OAAO1E,KAAmB,OAAf,EAACykB,EAAYlW,IAAE,EAAI,CAAC,GAAG0B,MAAM,IAC5CA,QACJ,CAACwU,IAEGe,GAAqBhhB,EAAAA,EAAAA,UACzB,IAAM,OAAN,UACKggB,EAAW,CACdjhB,KAAM,IAAIkiB,GAAAA,EAAO,OAAD,UAETjB,EAAYjhB,KAAKA,KAAK,GAAE,CAC3BmiB,QAAQhT,EAAAA,GAAAA,GAAa6S,GAAAA,IAAqBrlB,IAAMmS,EAAAA,GAAAA,IAAS,YAE3DvS,MAGJ,CAAC0kB,IAEGmB,GAAgBhjB,EAAAA,EAAAA,cAAY,KAChC,MAAMijB,EAAelhB,OAAO4N,YAC1B5N,OAAOC,QAAQ8f,GAAa5U,QAC1B,EAAEtB,MAAQgX,GAAAA,GAAAA,SAA4BhX,MAG1C7E,EAAkB,CAAE+a,YAAamB,GAAe,GAC/C,CAACnB,EAAa/a,IACXmc,GAAkBljB,EAAAA,EAAAA,cACtB,CAACmjB,EAAgBC,GAAU,KACzB,MAAMC,GAAmBC,EAAAA,GAAAA,IAAUvB,GACnCE,EAAgB9T,SAASvC,IAAM,MACzBwX,EACFC,EAAiBzX,GAAK,IAAwB,OAAvB,EAAIyX,EAAiBzX,IAAE,EAAI,GAAKuX,GAChDE,EAAiBzX,KACxByX,EAAiBzX,GAAKyX,EAAiBzX,GAAGsB,QAAQC,GAAMA,IAAMgW,IAAO,IAEzE/J,EAAqB,CAAE2I,gBAAiBsB,GAAmB,GAE7D,CAACpB,EAAiBF,EAAiB3I,IAGrC,OACE,yBAEE,QAAC/W,EAAA,EAAS,CAAC3E,GAAI,CAAE3B,QAAS,OAAQC,MAAO,QAAS,WAChD,QAACyE,EAAA,EAAW,CAAC/C,GAAI,CAAE6I,SAAU,GAAI,WAC/B,QAACtC,EAAA,EAAU,WACT,2BAASvE,EAAC,UAAC,4BAEb,QAACiL,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAAC4H,EAAA,EAAU,WACRvE,EAAC,UAAC,4BAA0B,KAC7B,QAACgD,EAAA,EAAO,CAACxF,MAAOylB,EAAoB,UAAY,UAAU,UACvDA,EAAkB,IAAEjjB,EAAE,+BAG3B,QAACuE,EAAA,EAAU,WACRvE,EAAC,UAAC,eAAa,KAChB,QAACgD,EAAA,EAAO,CAACxF,MAAM,UAAS,UACrBwlB,EAAY,GAAK,KAAC,QAACrD,GAAA,EAAa,iBAAK3W,GAAAA,IAAoB,IACzDhJ,EAAE,+BAGP,QAACuE,EAAA,EAAU,WACRvE,EAAC,UAAC,eAAa,KAChB,QAACgD,EAAA,EAAO,CAACxF,MAAM,UAAS,UACrBwlB,EAAY,GAAK,KAAC,QAACrD,GAAA,EAAa,iBAAK3W,GAAAA,IAAoB,IACzDhJ,EAAE,+BAGP,QAACuE,EAAA,EAAU,WACRvE,EAAC,UAAC,0BAAwB,KAC3B,QAACgD,EAAA,EAAO,CAACxF,MAAOslB,EAAgB,UAAY,YAAY,UACrDA,GACC,QAACnD,GAAA,EAAa,iBAAK3W,GAAAA,KAEnB,QAAC6a,GAAA,EAAS,iBAAK7a,GAAAA,IACd,IACF8Z,EAAgB9iB,EAAE,wBAA0B,kBAGjD,QAACuE,EAAA,EAAU,WACRvE,EAAC,UAAC,0BAAwB,KAC3B,QAACgD,EAAA,EAAO,CAACxF,MAAOulB,EAAgB,UAAY,YAAY,UACrDA,GACC,QAACpD,GAAA,EAAa,iBAAK3W,GAAAA,KAEnB,QAAC6a,GAAA,EAAS,iBAAK7a,GAAAA,IACd,IACF+Z,EAAgB/iB,EAAE,wBAA0B,wBAKrD,QAACP,EAAA,EAAM,CACLC,QAASua,EACT3T,SAAUA,EACV9I,MAAM,OACNQ,GAAI,CAAE4hB,aAAc,EAAG1Y,WAAY,EAAG2Y,SAAU,IAAK,UAErD,QAACC,GAAA,EAAY,UAKjB,QAACvf,GAAA,EAAY,CAACC,KAAMA,EAAMC,QAASA,EAAQ,UACzC,QAACC,EAAA,EAAQ,YACP,QAACK,EAAA,EAAW,CACV/C,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGQ,eAAgB,iBAAkB,WAEjE,QAAC/D,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAExB,EAAC,UAAC,0BAC5B,QAACc,EAAA,EAAW,CAACpB,QAASe,QAExB,QAACwC,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,YACV,QAAC4B,EAAA,EAAS,CAAC3E,GAAI,CAAE2D,GAAI,GAAI,UACvB,QAACZ,EAAA,EAAW,YACV,QAACU,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAE,WACzB,QAACvD,EAAA,EAAU,WACT,2BAASvE,EAAC,UAAC,0CAEb,QAACuE,EAAA,EAAU,CAACvG,GAAI,CAAE6I,SAAU,GAAI,UAC9B,QAAC7D,EAAA,EAAO,CAACxF,MAAOylB,EAAoB,UAAY,UAAU,UACvDA,EAAkB,IAAEjjB,EAAE,+BAG3B,QAACP,EAAA,EAAM,CACLsD,KAAK,QACLrD,QAAS4jB,EACT9lB,MAAM,QACNmC,WAAW,QAACwH,GAAA,EAAM,IAAI,SACtBnH,EAAC,UAAC,2CAEN,QAACuE,EAAA,EAAU,UAAEvE,EAAC,UAAC,4CAGnB,QAAC2C,EAAA,EAAS,CAAC3E,GAAI,CAAE2D,GAAI,GAAI,UACvB,QAACZ,EAAA,EAAW,YACV,QAACwD,EAAA,EAAU,CAACvG,GAAI,CAAE6I,SAAU,GAAI,UAC9B,4BACE,QAAC,KAAK,CACJ7G,EAAGA,EACH2L,QAAQ,wCAAuC,UAChD,gBACe,KACd,QAAC,KAAS,CAACnO,MAAM,UAAS,UAAC,WAEzB,QAACmiB,GAAA,EAAa,iBAAK3W,GAAAA,OACR,IAAI,IACf,KACF,QAAC,KAAS,CAACxL,MAAM,YAAYgE,QAAQ,QAAO,UAAC,YAE3C,QAACqiB,GAAA,EAAS,iBAAK7a,GAAAA,eAKvB,QAACzE,EAAA,EAAU,WACT,QAAC,KAAK,CAACvE,EAAGA,EAAG2L,QAAQ,wCAAuC,UAAC,kGAEtB,2BAAQ,MAAU,oBAC3C,2BAAQ,MAAU,6BAGlC,QAACpH,EAAA,EAAU,WACT,QAAC,KAAK,CAACvE,EAAGA,EAAG2L,QAAQ,uCAAsC,WACzD,4BACE,QAAC,KAAS,CAACnO,MAAM,YAAYgE,QAAQ,QAAO,UAAC,aAE3C,QAACqiB,GAAA,EAAS,iBAAK7a,GAAAA,IAAmB,cAE5B,IAAI,8BACc,KAC5B,6BACE,QAAC,KAAS,CAACxL,MAAM,YAAYgE,QAAQ,QAAO,SAAC,OAEjC,SAEJ,IAAI,MACV,KACJ,6BACE,QAAC,KAAS,CAAChE,MAAM,YAAYgE,QAAQ,QAAO,SAAC,QAEjC,QAEL,UAIb,QAAC+C,EAAA,EAAU,WACT,QAAC,KAAK,CAACvE,EAAGA,EAAG2L,QAAQ,uCAAsC,WACzD,4BACE,QAAC,KAAS,CAACnO,MAAM,YAAYgE,QAAQ,QAAO,UAAC,aAE3C,QAACqiB,GAAA,EAAS,iBAAK7a,GAAAA,IAAmB,cAE5B,IAAI,8BACc,KAC5B,6BACE,QAAC,KAAS,CAACxL,MAAM,YAAYgE,QAAQ,QAAO,SAAC,SAEjC,OAEJ,IAAI,MACV,KACJ,4BACE,QAAC,KAAS,CAAChE,MAAM,YAAYgE,QAAQ,QAAO,SAAC,YAGtC,UAIb,QAAC+C,EAAA,EAAU,WACT,QAAC,KAAK,CAACvE,EAAGA,EAAG2L,QAAQ,wCAAuC,WAC1D,4BACE,QAAC,KAAS,CAACnO,MAAM,YAAYgE,QAAQ,QAAO,UAAC,aAE3C,QAACqiB,GAAA,EAAS,iBAAK7a,GAAAA,IAAmB,kBAE5B,IAAI,0CAC0B,KACxC,4BAAQ,MAEN,QAAC,KAAS,CAACxL,MAAM,YAAYgE,QAAQ,QAAO,SAAC,WAGrC,IAAI,MACV,KACJ,4BAAQ,OAEN,QAAC,KAAS,CAAChE,MAAM,YAAYgE,QAAQ,QAAO,SAAC,UAGtC,UAIb,QAAC+C,EAAA,EAAU,WACT,QAAC,KAAK,CAACvE,EAAGA,EAAG2L,QAAQ,wCAAuC,WAC1D,4BACE,QAAC,KAAS,CAACnO,MAAM,YAAYgE,QAAQ,QAAO,UAAC,aAE3C,QAACqiB,GAAA,EAAS,iBAAK7a,GAAAA,IAAmB,kBAE5B,IAAI,uCACuB,KACrC,4BACE,QAAC,KAAS,CAACxL,MAAM,YAAYgE,QAAQ,QAAO,SAAC,YAGtC,eAMjB,QAACiI,GAAA,GAAI,CACHC,WAAS,EACT8B,QAAS,CAAErC,GAAI,EAAG4B,GAAI,GACtB/M,GAAI,CAAE2D,GAAI,GACVhF,QAAS,EAAE,WAEX,QAAC8M,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAAC2a,GAAsB,CACrBC,WAAYf,EAAY,GACxBgB,OAAQ,EACRR,gBAAiBA,OAGrB,QAAC/Z,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAAC2a,GAAsB,CACrBC,WAAYf,EAAY,GACxBgB,OAAQ,EACRR,gBAAiBA,OAGrB,QAAC/Z,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACxG,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,YACV,QAACwD,EAAA,EAAU,CAAC0f,cAAY,YACtB,4BACE,QAAC,KAAK,CAACjkB,EAAGA,EAAG2L,QAAQ,2BAA0B,WAC7C,QAAC,KAAS,CAACnO,MAAM,UAAS,UAAC,UACnB,QAACmiB,GAAA,EAAa,iBAAK3W,GAAAA,OACd,IAAI,IACf,KACF,QAAC,KAAS,CAACxL,MAAM,YAAYgE,QAAQ,QAAO,UAAC,YACnC,QAACqiB,GAAA,EAAS,iBAAK7a,GAAAA,OACZ,IAAI,yBAKvB,QAACvH,EAAA,EAAG,CACFzD,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WAEzD,QAACrI,EAAA,EAAM,CACLmK,WAAS,EACTlK,QAAS,IACPga,EAAqB,CACnB2I,iBAAiB6B,EAAAA,GAAAA,IACf7B,EACA,UACA,KAIN7kB,MAAOslB,EAAgB,UAAY,YACnCnjB,UACGmjB,GAGC,QAAClY,GAAA,EAAQ,KAFT,QAACC,GAAA,EAAoB,IAKzBsZ,QACErB,GAAgB,QAACnD,GAAA,EAAa,KAAM,QAACkE,GAAA,EAAS,IAC/C,SACD7jB,EAAC,UAAC,6BACJ,QAACP,EAAA,EAAM,CACLmK,WAAS,EACTlK,QAAS,IACPga,EAAqB,CACnB2I,iBAAiB6B,EAAAA,GAAAA,IACf7B,EACA,UACA,KAIN7kB,MAAOulB,EAAgB,UAAY,YACnCpjB,UACGojB,GAGC,QAACnY,GAAA,EAAQ,KAFT,QAACC,GAAA,EAAoB,IAKzBsZ,QACEpB,GAAgB,QAACpD,GAAA,EAAa,KAAM,QAACkE,GAAA,EAAS,IAC/C,SACD7jB,EAAC,UAAC,0CAMd,QAACyJ,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAG6O,QAAS,CAAErC,GAAI,EAAG4B,GAAI,GAAI,SACnD4X,EAAQ/kB,KAAK4jB,IACZ,QAAC4C,GAAe,CAEd5C,OAAQA,EACR2B,mBAAoBA,EACpBkB,UAAWzB,EAAapB,IAHnBA,WAQb,QAACve,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,CAAC/C,GAAI,CAAE6P,GAAI,GAAI,UACzB,QAAC/M,EAAA,EAAW,CAACwjB,OAAK,EAAC5kB,QAASe,aAMxC,CACA,SAASqjB,IAAuB,WAC9BC,EAAU,OACVC,EAAM,gBACNR,IAMA,MAAM,EAAExjB,IAAM1B,EAAAA,EAAAA,IAAe,CAAC,0BAA2B,UACzD,OACE,QAACqE,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,YACV,QAACwD,EAAA,EAAU,CAAC0f,cAAY,aACtB,2BAASjkB,EAAG,SAAQgkB,UAAuB,KAC3C,QAAChhB,EAAA,EAAO,CAACxF,MAAM,UAAS,UACrBumB,EAAW,KAAC,QAACpE,GAAA,EAAa,iBAAK3W,GAAAA,IAAoB,IACnDhJ,EAAE,+BAGP,QAACyB,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WAC5D,QAACrI,EAAA,EAAM,CACLmK,WAAS,EACTtD,SAC2B,MAAzByd,EAAWQ,OAAO,KAA2C,IAA7BR,EAAWS,QAAQ,KAErD9kB,QAAS,IAAM8jB,EAAgBQ,GAAQ,GACvCxmB,MAAM,UACNmC,WAAW,QAACggB,GAAA,EAAa,IAAI,SAE5B3f,EAAG,wBAAuBgkB,WAE7B,QAACvkB,EAAA,EAAM,CACLmK,WAAS,EACTtD,SAAmC,MAAzByd,EAAWQ,OAAO,GAC5B7kB,QAAS,IAAM8jB,EAAgBQ,GAAQ,GACvCxmB,MAAM,YACNmC,WAAW,QAACkkB,GAAA,EAAS,IAAI,SAExB7jB,EAAG,0BAAyBgkB,iBAMzC,CACA,SAASI,IAAgB,OACvB5C,EAAM,mBACN2B,EAAkB,UAClBkB,IAKC,QACD,MAAM,EAAErkB,IAAM1B,EAAAA,EAAAA,IAAe,UAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,aAAE0a,EAAY,qBAAEI,GAAyBL,GAAgB3a,IACzD,gBAAE2jB,GAAoB/I,EACtBmL,EAA2C,OAA5B,EAAkB,MAAfpC,OAAe,EAAfA,EAAkBb,IAAO,EAAI,GAC/CkD,GAAUD,EAAgBjY,SAAS,GACnCmY,EAAQ9B,GAAYwB,GACpBrH,GAAQ4E,EAAAA,GAAAA,IAAYJ,GAEpBoD,GAAeziB,EAAAA,EAAAA,UAAQ,IACtBuiB,EACEriB,OAAO1E,KAAKqf,EAAM6H,YAAYrX,QAAQiU,IAAS,aACzB,OADyB,EACpDzE,EAAM6H,WAAWpD,SAAU,EAA3B,EAA6BI,SAASnQ,MAAMoT,GAAQ,WAAYA,GAAI,IAFlD,IAInB,CAAC9H,EAAM6H,WAAYH,IAChBK,EAAWN,EAAgBjY,SAAS,GACpCwY,EAAWP,EAAgBjY,SAAS,GAC1C,OACE,QAAC/C,GAAA,GAAI,CAACE,MAAI,EAAcR,GAAI,EAAE,UAC5B,QAACxG,EAAA,EAAS,CACR3E,GAAI,CAAEzB,OAAQ,OAAQkjB,QAASkF,EAAQ,EAAI,WAAQlnB,GAAY,WAE/D,QAACgE,EAAA,EAAG,CACFwjB,UAAY,QAAOjI,EAAMkI,OAAO,SAChC5oB,MAAM,OACN0B,GAAI,CAAE3B,QAAS,QAAS,WAExB,QAACoF,EAAA,EAAG,CACF0D,UAAU,MACVtF,KAAKslB,EAAAA,GAAAA,IAAgB3D,GACrBxjB,GAAI,CAAEzB,OAAQ,IAAKD,MAAO,OAAQ8oB,IAAK,MAEzC,QAAC3jB,EAAA,EAAG,CACFzD,GAAI,CACF6I,SAAU,EACVH,GAAI,EACJrK,QAAS,OACT2lB,cAAe,SACf1Z,eAAgB,UAChB,WAEF,QAAC/D,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAY,OAAZ,EAAEwb,EAAMjd,MAAI,EAAI,MACxC,QAAC0B,EAAA,EAAG,WAEF,QAAC8C,EAAA,EAAU,CAAC/C,QAAQ,YAAW,UAC5Bwb,EAAMkI,OAAOtnB,KAAI,CAACynB,EAAIvnB,KACrB,QAAC2D,EAAA,EAAG,CACF0D,UAAU,OACVnH,GAAI,CAAE3B,QAAS,cAAe0L,WAAY,UAAW,UAGpDsd,EAAG,KAAC,QAACC,GAAA,EAAe,CAACvnB,SAAS,YAAa,IAC3CD,EAAIkf,EAAMkI,OAAOtX,OAAS,EAAI,KAAO,OAHjCyX,KAKL,KACJ,QAAC1G,GAAA,EAAiB,CAChB/d,OACE,QAACa,EAAA,EAAG,YACF,QAAC8C,EAAA,EAAU,WACT,QAACvB,EAAA,EAAO,CAACxF,MAAM,UAAS,SAAEwC,EAAC,UAAC,cAE9B,QAACuE,EAAA,EAAU,WACT,QAACghB,GAAA,EAAS,CACRF,GAAK,YAAW7D,QAChBgE,MAAO,oBAGX,QAAC/jB,EAAA,EAAG,CACFgkB,WAAY,EACZznB,GAAI,CAAEyhB,QAASgF,EAAgBjY,SAAS,GAAK,GAAM,GAAI,WAEvD,QAACjI,EAAA,EAAU,WACT,QAACvB,EAAA,EAAO,CAACxF,MAAM,UAAS,SAAEwC,EAAC,UAAC,cAE9B,QAACuE,EAAA,EAAU,WACT,QAACghB,GAAA,EAAS,CACRF,GAAK,YAAW7D,QAChBgE,MAAO,iCASvB,QAAC/jB,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,GAAI,SAClCzF,OAAOC,QAAQ+hB,GAAWzmB,KAAI,EAAEyjB,EAAS9P,MACxC,QAAChN,EAAA,EAAU,CAETvG,GAAI,CAAE6I,SAAU,GAChBrF,QAAQ,YAAW,UAEnB,QAACwB,EAAA,EAAO,CACNhF,GAAI,CAAE1B,MAAO,QACbkB,MAAO+T,EAAQ,UAAY,YAAY,WAEvC,QAAC6P,GAAA,EAAQ,CAACC,QAASA,EAAStY,UAAWC,GAAAA,IAAoB,IAC1DuI,MATE8P,cAgBf,QAACtb,GAAA,EAAW,CAAC/H,GAAI,CAAE,kBAAmB,CAAE4hB,aAAc,IAAOhW,WAAS,aACpE,QAACnK,EAAA,EAAM,CACLE,UAAWolB,GAAW,QAACla,GAAA,EAAoB,KAAM,QAACD,GAAA,EAAQ,IAC1DlL,QAAS,IACPga,EAAqB,CACnB2I,iBAAiB6B,EAAAA,GAAAA,IACf7B,EACAb,EACA,KAINhkB,MAAOunB,EAAW,YAAc,UAChCZ,QAASY,GAAW,QAAClB,GAAA,EAAS,KAAM,QAAClE,GAAA,EAAa,IAAI,SACtD3f,EAAC,UAAC,YACJ,QAACP,EAAA,EAAM,CACLE,UAAWqlB,GAAW,QAACna,GAAA,EAAoB,KAAM,QAACD,GAAA,EAAQ,IAC1DlL,QAAS,IACPga,EAAqB,CACnB2I,iBAAiB6B,EAAAA,GAAAA,IACf7B,EACAb,EACA,KAINhkB,MAAOwnB,EAAW,YAAc,UAChCb,QAASa,GAAW,QAACnB,GAAA,EAAS,KAAM,QAAClE,GAAA,EAAa,IAAI,SACtD3f,EAAC,UAAC,gBAGH4kB,EAAahX,SACd,QAACzM,EAAA,WAAoB,CAAC8E,MAAOkd,EAAmB,UAC9C,QAACpiB,EAAA,EAAW,CACV/C,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,SAExD8c,EAAahnB,KAAK6jB,IACjB,QAACF,GAAgB,CAEfC,OAAQA,EACRC,UAAWiE,SAASjE,GACpBC,YAAU,EACVC,kBAAgB,GAJXF,aA7HHD,EA0IpB,CAEA,SAASqB,GAAYwB,GACnB,OAAOhiB,OAAOuN,OAAOyU,GAAW1Q,QAAO,CAACgS,EAAKzV,IAAMyV,GAAOzV,EAAI,EAAI,IAAI,EACxE,CCzrBA,MAAM0V,GAAS,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,IAClB,SAASC,IAAsB,wBAC5CC,EAA0B,EAAC,2BAC3BC,EAA0B,SAC1Bzf,IAEA,MAAM,EAAEtG,IAAM1B,EAAAA,EAAAA,IAAe,2BAC7B,OACE,QAAC0nB,GAAA,EAAc,CACbpc,WAAS,EACTpM,MAAOsoB,EAA0B,UAAY,UAC7Cxf,SAAUA,EACV1F,MACEklB,EACI9lB,EAAE,6BAA8B,CAAEimB,IAAKH,IACvC9lB,EAAE,6BACP,SAEA4lB,GAAOhoB,KAAKqoB,IACX,QAACC,GAAA,EAAQ,CAAWxmB,QAAS,IAAMqmB,EAA2BE,GAAK,SAChEA,EACGjmB,EAAE,6BAA8B,CAAEimB,QAClCjmB,EAAE,8BAHOimB,MAQvB,C,eCrBe,SAASE,KACtB,MAAM,EAAEnmB,IAAM1B,EAAAA,EAAAA,IAAe,4BAE3BE,WAAW,WAAE8M,KACX3M,EAAAA,EAAAA,YAAWC,EAAAA,IACT,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBilB,EAAiB/jB,OAAO1E,KAAK2N,GACnC,IAAK8a,EAAexY,OAAQ,OAAO,KACnC,MAAMlB,EAAQ0Z,EAAexoB,KAAKsO,GAChChL,EAAKuG,IAAIC,GAAAA,GAAAA,YAAkBwE,MAE7B,OACE,QAACvJ,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,WACV,QAACwD,EAAA,EAAU,CACTvG,GAAI,CAAEqoB,WAAY,QAAS,SAC3BrmB,EAAC,UAAC,0BAEN,QAACiD,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,UACT2L,EAAM9O,KAAK6P,IACV,QAAC,MAAgB,CAA8BjL,KAAMiL,GAA9BR,KAAKC,UAAUO,EAAEjJ,aAKlD,C,4BChCO,MAWD8hB,IAAYnqB,EAAAA,GAAAA,IAAO,SAAPA,CAAiB,CACjCoqB,WAAY,cAGRC,IAAuBrqB,EAAAA,GAAAA,IAAOsqB,GAAAA,EAAPtqB,EAAuB,KAAM,CACxDI,OAAQ,GACRqjB,aAAc,MAED,SAAS8G,IACtB1P,QAAQ,KAAE5M,EAAI,OAAE0O,EAAQC,OAAQlb,EAAC,QAAEmb,EAAO,MAAEvB,EAAK,UAAEkP,EAAS,WAAEC,GAAY,cAC1EC,IAKA,MAAMC,EAAWje,SAAS4O,GAEpBsP,EAA4B,aAAT3c,EACnB4c,EAAYvP,EAAQuB,EAEpBiO,GAAe,QAACX,GAAS,UAAExN,EAAOoO,mBAClCC,GAAkB,QAACb,GAAS,UAAEU,EAAUE,mBACxCE,IAAgBpO,IACpB,0BAAM,KACH,uBAAI,QAACsN,GAAS,UAAEtN,EAAQkO,qBAAkC,eAIzDG,GACJ,QAACf,GAAS,WACPgB,EAAAA,GAAAA,IACCtT,KAAKuT,OAAiB,MAAVX,EAAAA,EAAcY,YAAYC,QAAmB,MAATd,EAAAA,EAAa7S,SAMnE,IAEI/C,EAFAnQ,EAAQ,GACR8mB,EAAW,GAGf,GAAIX,EACFhW,EAAqB,IAAT+H,EAAgBkO,EAC5BpmB,GACE,QAAC2D,EAAA,EAAU,WAAC,0BACc0iB,EACvBH,GAAW,wBAAE,IAAEK,UAAsB1pB,EAAU,mDACvB,sBAAIopB,IAAkB,KAAGO,KAGtDM,GAAW,QAACnjB,EAAA,EAAU,WAAC,iBAAe8iB,SACjC,MAAIvO,EAASE,GAUlB,OAAO,KATPjI,EAAW,IACXnQ,GACE,QAAC2D,EAAA,EAAU,WAAC,wBACY0iB,EAAa,mDACtB,sBAAIJ,IAAkB,KAAGO,KAG1CM,GAAW,QAACnjB,EAAA,EAAU,WAAC,mBAAiB8iB,IAG1C,CAEA,OACE,QAAC5b,GAAA,EAAK,CACJC,SA9BU,UA+BVlK,QAAQ,SACRxD,GAAI,CACF,sBAAuB,CACrB6I,SAAU,IAEZ,UAEDjG,EACA8mB,OACajqB,IAAbsT,IACC,QAACtH,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAGoL,WAAW,SAAQ,UAC5C+e,IACC,QAACrd,GAAA,GAAI,CAACE,MAAI,YACR,QAACpF,EAAA,EAAU,UAAG,GAAEwM,EAAS4W,QAAQ,WAGrC,QAACle,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,EAAE,UACrB,QAAC2f,GAAoB,CACnBhlB,QAASslB,EAAW,cAAgB,gBACpC7gB,MAAO8K,EACPvT,MAAM,mBAOpB,C,oJCrGe,SAASoqB,IAAa,aACnClpB,IAIA,MAAM,OAAEM,IAAWC,EAAAA,EAAAA,KACbV,GAAiB0e,EAAAA,EAAAA,GAAave,EAAcM,GAClD,OAAKT,GAEH,QAACspB,GAAA,EAAgB,CACfC,UAAU,YACVlnB,OAAO,QAAC2D,EAAA,EAAU,UAAEhG,EAAewB,OAAmB,UAEtD,QAACgoB,GAAA,EAAY,CACXloB,KAAKC,EAAAA,EAAAA,IAAepB,EAAc,WAAYM,GAC9C+D,KAAM,EACNilB,YAAU,MATY,IAa9B,C,gBCrBO,SAASC,IAAa,QAC3B5d,EAAO,YACP6d,GAAc,IAKd,OACE,QAACzmB,EAAA,EAAG,CAAC0D,UAAU,OAAO9I,QAAQ,OAAO0L,WAAW,SAASD,IAAK,EAAE,WAC5DogB,IACA,QAACC,GAAA,EAAQ,CAAC9d,QAASA,EAAStB,UAAWC,GAAAA,KAEzC,0BACGmB,GAAAA,GAAAA,IAAWE,GACXF,GAAAA,GAAAA,KAAYE,QAIrB,CACO,SAAS+d,IAAoB,QAClC/d,EAAO,YACP6d,GAAc,IAKd,OACE,QAAC,KAAS,CAAC1qB,MAAO2M,GAAAA,GAAAA,WAAkBE,GAAS,UAC3C,QAAC4d,GAAY,CAAC5d,QAASA,EAAS6d,YAAaA,KAGnD,C,gBCAe,SAASG,IAAiB,WACvCC,EACAjH,QAASkH,EAAQ,wBACjBzC,EAA0B,EAAC,aAC3B0C,GAAe,EAAK,QACpB9oB,EAAO,YACP+oB,EAAc/nB,EAAAA,IACP,MACP,MAAM4Q,GAAMoX,EAAAA,GAAAA,GAAYJ,IAClB,SAAEtmB,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1B0mB,GAAoBroB,EAAAA,EAAAA,cACvBnD,IACC,QAACyrB,GAAA,EAAc,CAAClpB,QAASA,EAAS1B,GAAI,CAAEzB,OAAQ,QAAS,SACtDY,KAGL,CAACuC,IAEGtD,GAAQysB,EAAAA,GAAAA,KACd,IAAKvX,EACH,OACE,QAACmX,EAAW,CACVzqB,GAAI,CACF3B,QAAS,OACTE,OAAQ,OACRwL,WAAY,SACZO,eAAgB,UAChB,UAEF,QAAC7G,EAAA,EAAG,CACF0D,UAAU,MACVtF,IAAKipB,GAAAA,EAAAA,KAAYP,GACjBvqB,GAAI,CAAE1B,MAAO,MAAOC,OAAQ,OAAQkjB,QAAS,QAKrD,MAAM,QAAE4B,EAAO,OAAE6D,EAAM,MAAE6D,EAAK,YAAEC,EAAW,SAAEC,EAAQ,SAAEC,GAAa5X,EAC9D6X,EAAgBnV,KAAK9B,IACzB8B,KAAK/B,IAAI6T,EAAkC,EAATZ,GAClC6D,GAEIK,EAAejf,GAAAA,GAAAA,KAAY6e,GAC3B5gB,EAAUD,GAAAA,GAAAA,MAA4BW,GAC1CwI,EAAI0X,YAAYxc,SAAS1D,KAErBtL,EAAQ4K,GACVihB,EAAAA,GAAAA,IAAMjtB,EAAM4N,QAAQ5B,GAAS8B,KAAM,KACnCmf,EAAAA,GAAAA,IAAMjtB,EAAM4N,QAAQsf,UAAUpf,KAAM,IACxC,OACE,QAACue,EAAW,CAACzqB,GAAI,CAAEzB,OAAQ,QAAS,UAClC,QAACQ,GAAA,EAAkB,CAACC,YAAa0C,EAASzC,QAAS0rB,EAAkB,UACnE,QAAClnB,EAAA,EAAG,CAACpF,QAAQ,OAAOE,OAAO,OAAM,WAC/B,QAACkF,EAAA,EAAG,CACFwjB,UAAY,QAAOC,QACnBlnB,GAAI,CACFurB,SAAU,WACV1iB,SAAU,EACVxK,QAAS,OACT2lB,cAAe,SACfja,WAAY,SACZO,eAAgB,UAChB,WAEF,QAACkhB,GAAA,EAAe,CAAClY,IAAKA,EAAI,UACxB,QAAC7P,EAAA,EAAG,CACF0D,UAAU,MACVtF,KAAK4pB,EAAAA,EAAAA,IAAcnY,EAAIkQ,OAAQH,GAC/BrjB,GAAI,CAAE0rB,GAAI,EAAGC,UAAW,OAAQlL,SAAU,aAG9C,QAAChd,EAAA,EAAG,CACFzD,GAAI,CACFurB,SAAU,WACVjtB,MAAO,OACPC,OAAQ,OACR4Y,EAAG,GACHsK,QAAS,IACTpjB,QAAS,OACTiM,eAAgB,gBAChBshB,cAAe,QACf,WAEF,QAAC3hB,GAAA,EAAI,CACHlF,KAAK,QACLmF,OAAO,2BAAU,KAAI6gB,MACrBvrB,MAAOqsB,GAAAA,GAAAA,aAAsBd,KAE9BP,IACC,QAACvgB,GAAA,EAAI,CACHlF,KAAK,QACLmF,MACEghB,GACE,QAACtB,GAAY,CACXlpB,aACEwqB,GACAlnB,EAASqZ,MAAMmF,uBAAuB0I,MAI1C,QAACY,GAAA,EAAc,IAGnBtsB,MAAO,YACPQ,GAAI,CACF+rB,SAAU,UACV,iBAAkB,CAChBA,SAAU,kBAOpB,QAAC9hB,GAAA,EAAI,CACHlF,KAAK,QACL/E,GAAI,CACFurB,SAAU,WACVS,OAAQ,EACRroB,GAAI,EACJsoB,gBAAiBzsB,EACjB2X,EAAG,GAELzS,MACE,QAACmlB,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OACE,QAAC2D,EAAA,EAAU,WACT,QAAC6jB,GAAmB,CAAC/d,QAAS2e,MAGlCkB,oBAAkB,YAElB,QAACzoB,EAAA,EAAG,CAACjF,WAAY,EAAE,UACjB,QAAC2rB,GAAA,EAAQ,CACP9d,QAAS2e,EACTjgB,UAAW,CAAEohB,MAAO,CAAEC,QAAS,cAKvCliB,OACE,QAAC3D,EAAA,EAAU,CAACvG,GAAI,CAAEonB,IAAK,IAAM,UAC3B,QAAC,KAAS,CACR5nB,MAAO2rB,IAAkBJ,EAAQ,eAAYtrB,EAAU,WAEtD4sB,EAAAA,GAAAA,IAKE,OALc,EACfR,GAAAA,GAAAA,cACEb,EACA9D,EACAiE,IACD,EAAI,EACLhf,GAAAA,GAAAA,KAAY6e,IAEbI,aAOX,QAAC3nB,EAAA,EAAG,CACFpF,QAAQ,OACR2lB,cAAc,SACd1Z,eAAe,gBACftK,GAAI,CAAEmX,EAAG,GAAI,SAEZ8T,EAASrrB,KAAI,CAAC+R,EAAsB7R,KACnC,QAACwsB,GAAc,CAAoB3a,KAAMA,GAApB7R,EAAI6R,EAAKlR,eAO5C,CACA,SAAS6rB,IAAe,KAAE3a,IAAkC,QAC1D,IAAKA,EAAK1J,MAAO,OAAO,KACxB,MAAMskB,EAA6B,OAArB,EAAa,OAAb,EAAG5a,EAAK6a,YAAK,EAAV,EAAY5c,QAAM,EAAI,EACjC6c,EAAa,QAAMC,EAAAA,GAAAA,IAAMH,EAAU,EAAG,KACtCI,EAAOxgB,GAAAA,GAAAA,KAAYwF,EAAKlR,KAC9B,OACE,QAACgD,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAG8iB,aAAa,SAAQ,UAC/C,QAACrmB,EAAA,EAAU,CACTvG,GAAI,CAAE6I,SAAU,EAAGxK,QAAS,OAAQyL,IAAK,GAAKC,WAAY,UAC1DvK,MAAQ+sB,EAAY,GAAEE,SAAmB,aACzCtlB,UAAU,OAAM,WAEhB,QAAC0iB,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OACE,QAAC2D,EAAA,EAAU,UACRoL,EAAKlR,MAAO,QAAC2pB,GAAmB,CAAC/d,QAASsF,EAAKlR,QAGpDyrB,oBAAkB,YAElB,QAACzoB,EAAA,EAAG,CAACjF,WAAY,EAAE,UACjB,QAAC2rB,GAAA,EAAQ,CAAC9d,QAASsF,EAAKlR,IAAKsK,UAAW,CAAEhL,SAAU,kBAGxD,yBAAQ,IAAEssB,EAAAA,GAAAA,IACR1a,EAAK1J,MACLkE,GAAAA,GAAAA,KAAYwF,EAAKlR,QACfksB,UAIZ,C,gBCrOe,SAASE,KACtB,MAAM,KAAE3pB,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBE,GAAWc,EAAAA,EAAAA,UACf,KACEb,EAAAA,GAAAA,GAAmBJ,GAAMsM,QAAO,EAAE,CAAE6X,KAClChjB,OAAOuN,OAAOyV,GAAI3T,MAAMjE,IAAOA,EAAEhL,aAErC,CAACvB,IAEH,OACE,QAACO,EAAA,EAAG,CAACzD,GAAI,CAAE0D,IAAK,EAAGC,IAAK,GAAI,UAC1B,QAACmpB,GAAA,GAAO,CAACtf,QAAS,CAAErC,GAAI,EAAGgX,GAAI,EAAG/W,GAAI,EAAGgX,GAAI,GAAKzjB,QAAS,EAAE,SAC1D0E,EAASzD,KAAI,EAAEa,EAAKmD,MACnB,QAACmpB,GAAO,CAAWjpB,UAAWF,EAAOG,WAAYtD,GAAnCA,QAKxB,CAEA,SAASssB,IAAQ,UACfjpB,EAAS,WACTC,IAKA,MAAMiW,GAAqBrZ,EAAAA,EAAAA,YAAWmP,KAChC,KAAE5M,EAAI,QAAE0L,IAAYjO,EAAAA,EAAAA,YAAWwC,EAAAA,IAC/B,SAAEa,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1BC,GAASC,EAAAA,EAAAA,UACb,KAAMC,EAAAA,GAAAA,GAAiBlB,EAAMa,EAAYC,IACzC,CAACA,EAAUd,EAAMa,IAEbipB,GAAiB7oB,EAAAA,EAAAA,UACrB,KACE4N,EAAAA,GAAAA,IAAUjO,GAAW,CAAC2L,EAAGwd,KACvBzb,EAAAA,GAAAA,IAAW,CAAC,UAAWzN,EAAYkpB,OAEvC,CAACnpB,EAAWC,IAEd,IAAKG,EAAQ,OAAO,QAACxB,EAAA,EAAQ,IAE7B,MAAM,MAAEE,EAAK,KAAE8B,EAAI,OAAE7B,GAAWqB,EAChC,OACE,QAACxB,EAAA,EAAQ,YACP,QAACkC,GAAA,EAAgB,CACfC,OAAQH,IAAQ,QAACI,GAAA,EAAO,CAACC,KAAM,EAAGlD,IAAK6C,IACvC9B,MAAOA,EACPC,OAAQA,IAAU,QAACmC,EAAA,EAAO,UAAEnC,OAE9B,QAACoC,EAAA,EAAO,KACR,QAAC4J,GAAA,GAAgB,CAAC7O,GAAI,CAAE0rB,EAAG,GAAI,SAC5BrnB,OAAOC,QAAQR,GAAWlE,KAAI,EAAEqtB,EAASxd,MACxC,QAAC,MAAgB,CAEfjL,KAAMiL,EACNT,SACEJ,EAAUA,EAAQnF,IAAIujB,EAAeC,IAAWhlB,WAAQxI,EAE1D0H,UAAW4H,GAAAA,GACXme,UACEje,KAAKC,UAAU8K,KACf/K,KAAKC,UAAU,CAACnL,EAAYkpB,KARzBA,SAejB,C,mDC9De,SAASE,IAAe,SACrCC,EAAQ,aACR5C,GAAe,EAAK,QACpB9oB,EAAO,YACP+oB,EAAc/nB,EAAAA,IAEd,MAAM,SAAEsB,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1BopB,GAASC,EAAAA,GAAAA,GAAUF,GACnBG,GAAoB,MAANF,OAAM,EAANA,EAAQ5sB,OAAO+sB,EAAAA,GAAAA,IAAeH,EAAO5sB,KACnDkqB,GAAoBroB,EAAAA,EAAAA,cACvBnD,IACC,QAACyrB,GAAA,EAAc,CAAC5qB,GAAI,CAAEzB,OAAQ,QAAUmD,QAASA,EAAQ,SACtDvC,KAGL,CAACuC,IAEG0jB,GAASjhB,EAAAA,EAAAA,UACb,IACEopB,GACAF,IACAI,EAAAA,GAAAA,IAAc,CAACF,EAAYrqB,MAAMwqB,EAAAA,GAAAA,IAAiBL,MACpD,CAACE,EAAaF,IAEhB,IAAKA,IAAWE,IAAgBnI,EAC9B,OACE,QAACqF,EAAW,CAACzqB,GAAI,CAAEzB,OAAQ,QAAS,UAClC,QAACgF,EAAA,EAAQ,CACPC,QAAQ,cACRxD,GAAI,CAAE1B,MAAO,OAAQC,OAAQ,YAIrC,MAAM,WAAEovB,EAAU,SAAEzC,GAAamC,EACjC,OACE,QAAC5C,EAAW,CAACzqB,GAAI,CAAEzB,OAAQ,QAAS,UAClC,QAACQ,GAAA,EAAkB,CAACC,YAAa0C,EAASzC,QAAS0rB,EAAkB,UACnE,QAAClnB,EAAA,EAAG,CAACpF,QAAQ,OAAOE,OAAO,OAAOwL,WAAW,UAAS,WACpD,QAACtG,EAAA,EAAG,CACFwjB,UAAY,QAAOsG,EAAYrG,aAC/BlnB,GAAI,CACFzB,OAAQ,OACRgtB,SAAU,WACV1iB,SAAU,EACVxK,QAAS,OACT2lB,cAAe,SACfja,WAAY,SACZO,eAAgB,YAChB,WAEF,QAACsjB,GAAA,EAAiB,CAAC5O,MAAOuO,EAAY,UACpC,QAAC9pB,EAAA,EAAG,CACF0D,UAAU,MACVtF,KAAKgsB,EAAAA,EAAAA,IAAYR,EAAO5sB,IAAK4sB,EAAOS,WAAa,GACjD9tB,GAAI,CAAEonB,IAAK,EAAGuE,UAAW,OAAQlL,SAAU,aAG/C,QAAChd,EAAA,EAAG,CACFzD,GAAI,CACFurB,SAAU,WACVjtB,MAAO,OACPC,OAAQ,OACR4Y,EAAG,GACHsK,QAAS,IACTpjB,QAAS,OACTiM,eAAgB,gBAChBshB,cAAe,QACf,WAEF,QAAC3hB,GAAA,EAAI,CACHlF,KAAK,QACLmF,OAAO,2BAAS6jB,GAAAA,EAAAA,eAA2BV,KAC3C7tB,MAAM,YAEPgrB,IACC,QAACvgB,GAAA,EAAI,CACHlF,KAAK,QACLmF,MACEghB,GACE,QAACtB,GAAY,CACXlpB,aAAcsD,EAASqZ,MAAMmF,uBAC3B0I,MAIJ,QAACY,GAAA,EAAc,IAGnBtsB,MAAO,YACPQ,GAAI,CACF+rB,SAAU,UACV,iBAAkB,CAChBA,SAAU,kBAMpB,QAACtoB,EAAA,EAAG,CACFzD,GAAI,CACFurB,SAAU,WACVjtB,MAAO,OACPC,OAAQ,OACR4Y,EAAG,GACHsK,QAAS,IACTpjB,QAAS,OACTiM,eAAgB,WAChBP,WAAY,YACZ,SAEDwjB,EAAYS,gBACX,QAAC/jB,GAAA,EAAI,CACHlF,KAAK,QACLvF,MAAM,OACN0K,OAAO,4BAAQ,IAAEyjB,aAKzB,QAAClqB,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAAShkB,GAAI,CAAEmX,EAAG,GAAI,WACtD,QAAC8W,GAAU,CAACzpB,KAAM4gB,EAAO3b,IAAIC,GAAAA,GAAAA,OAAAA,SAC7B,QAACukB,GAAU,CAACzpB,KAAM4gB,EAAO3b,IAAIC,GAAAA,GAAAA,OAAAA,gBAMzC,CACA,SAASukB,IAAW,KAAEzpB,IACpB,OAAKA,EAAKgC,KAAKzE,MAEb,QAAC0B,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAG8iB,aAAa,SAAQ,UAC/C,QAACrmB,EAAA,EAAU,CACTvG,GAAI,CAAE6I,SAAU,EAAGxK,QAAS,OAAQyL,IAAK,GACzC3C,UAAU,OAAM,WAEhB,QAAC0iB,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OAAO,QAAC2D,EAAA,EAAU,UAAE/B,EAAKgC,KAAKzE,OAC9BmqB,oBAAkB,YAElB,yBAAO1nB,EAAKgC,KAAK9B,UAEnB,0BAAO+B,EAAAA,GAAAA,GAASjC,UAdM,IAkB9B,C,4BC9JO,SAAS0pB,IAAkB,UAChCC,EAAS,kBACTC,GAAoB,IAEpB,MAAMC,GACJlqB,EAAAA,EAAAA,UACE,IACEgqB,EACG3e,QAAQ8e,GAASA,IACjB3Y,QAAO,CAAC4Y,EAAKC,KACZD,EAAIC,EAAKhL,QACL+K,EAAIC,EAAKhL,QAAQnN,KAAKmY,EAAKnL,SAC1BkL,EAAIC,EAAKhL,QAAU,CAACgL,EAAKnL,SACvBkL,IACN,CAAC,IACR,CAACJ,IAEL,OACE,uBACG9pB,OAAOC,QAAQ+pB,GACbnT,MACC,EAAEuT,EAAKC,IAAYC,EAAKC,KACtBA,EAAShf,OAAS8e,EAAS9e,SAE9BhQ,KAAI,EAAEa,EAAKouB,MACV,QAACC,GAAgB,CAEftL,OAAQ/iB,EACR2tB,kBAAmBA,EACnBS,QAASA,GAHJpuB,MAQjB,CACA,SAASquB,IAAiB,OACxBtL,EAAM,kBACN4K,GAAoB,EAAK,QACzBS,IAKC,MACD,MAAME,GAAgBnL,EAAAA,GAAAA,IAAYJ,GAC5BwL,EAAWH,EAAQjf,OACnBqf,EAAY5qB,OAAO1E,KAAKovB,EAAclI,YACzCjnB,KAAK4jB,GAAWkE,SAASlE,KACzBhU,QAAQwW,GAAWA,GAAUgJ,IAChC,OACE,QAACvrB,EAAA,EAAG,WACF,QAACyrB,GAAA,EAAkB,CAACH,cAAeA,EAAeC,SAAUA,EAAS,UACnE,QAAChqB,EAAA,EAAO,CACNhF,GAAI,CAAEzB,OAAQ,QACdiB,MAAO4uB,EAAoB,UAAY,UAAU,UAEjD,QAAC7nB,EAAA,EAAU,WACRsoB,EAAQjvB,KAAKyjB,IACZ,QAACD,GAAA,EAAQ,CAEPC,QAASA,EACTtY,UAAWC,GAAAA,GAFNqY,KAIL,IACe,OADZ,EACN0L,EAAchtB,MAAI,EAAI,GACtBktB,EAAUrvB,KAAI,CAAC6P,EAAG3P,KACjB,QAACkF,EAAA,EAAO,CAAChF,GAAI,CAAE2G,GAAI,IAAwBnH,MAAM,UAAS,SACvDiQ,GAD4B,GAAKA,EAAI3P,aAStD,C,kBCnCe,SAASqvB,IAAiB,MACvCjlB,EAAK,aACLklB,EAAY,kBACZC,EAAiB,iBACjBC,EAAgB,SAChBhnB,IAEA,MACE9H,WAAaC,IAAKC,EAAY,kBAAE4d,KAC9B3d,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,wBAAEwM,EAAuB,oBAAE9L,IACvCX,GAAgB3a,IACd,SAAEsD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1BkgB,GAAcxjB,EAAAA,EAAAA,YAAWwC,EAAAA,IAEzB,KAAED,EAAI,QAAE0L,GAAYuV,GACnBoL,EAAQC,IAAazuB,EAAAA,EAAAA,eAAStB,GAC/BgwB,GAAQntB,EAAAA,EAAAA,cAAY,IAAMktB,OAAU/vB,IAAY,CAAC+vB,IAEjDE,GAAaptB,EAAAA,EAAAA,cAAY,KAC7B,IAAKqtB,OAAOC,QAAQ,sDAClB,OACF,MAAMrN,EAAOve,EAASqZ,MAAM5T,IAAI/I,GAChC,IAAK6hB,EAAM,OACXY,GAAAA,GAAAA,SAA6BlC,IAC3B,MAAM4O,EAAM3sB,EAAKuG,IAAIC,GAAAA,GAAAA,IAAUuX,GAAGzO,IAAIvK,MACtC,GAAI4nB,EACF7rB,EAASgM,KAAKyC,IAAIod,EAAK,CAAE3E,UAAUzM,EAAAA,GAAAA,IAAoB/d,SACpD,CACH,MAAMovB,EAASvN,EAAKjE,kBAAkB2C,GAClC6O,GAAU9rB,EAASgM,KAAKvG,IAAIqmB,IAC9B9rB,EAASgM,KAAKyC,IAAIqd,EAAQ,CAAE5E,SAAU,IAC1C,KAEF,MAAMmC,EAASnqB,EAAKuG,IAAIC,GAAAA,GAAAA,OAAAA,IAAiBzB,MACrColB,GACFrpB,EAAS+rB,QAAQtd,IAAI4a,EAAQ,CAC3BnC,UAAUzM,EAAAA,GAAAA,IAAoB/d,IAC9B,GACH,CAACA,EAAcwC,EAAMc,IAElBgsB,GAAsB7rB,EAAAA,EAAAA,UAAQ,KAClC,MAAM8rB,EAAe,OAAH,UAAQ9L,GAE1B,OADKiL,IAAca,EAAarhB,aAAUnP,GACnCwwB,CAAY,GAClB,CAAC9L,EAAaiL,IAEXc,GAAoB/rB,EAAAA,EAAAA,UACxB,IACEE,OAAO4N,YACLkR,GAAAA,GAAAA,KAAyBE,GAAY,CACnCA,EACAngB,EAAKuG,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,WAGtC,CAAC/E,IAEGirB,GAAYhqB,EAAAA,EAAAA,UAChB,IACE+rB,GACC7rB,OAAOuN,OAAOse,GACZtwB,KAAKuwB,GAAmBnsB,EAASgM,KAAKvG,IAAI0mB,KAC1C3gB,QAAQ8e,GAASA,KACtB,CAAC4B,EAAmBlsB,EAASgM,OAIzBogB,GAAWjsB,EAAAA,EAAAA,UACf,IACEgf,GAAAA,GAAAA,KAAyBE,IACvB,QAAC5X,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACkf,GAAgB,CACfG,cAAY,EACZnH,QAASA,EACTiH,WAAY4F,EAAkB7M,GAC9ByE,wBAAyBA,EACzBpmB,QAAS,KACP,MAAM2uB,EAAQ/R,EAAkB+E,GAC1BiN,EAAQJ,EAAkB7M,GAChCmM,EAAU,CAAEa,MAAOA,IAAUC,EAAQD,OAAQ5wB,EAAW6wB,SAAQ,KAT/CjN,MAc3B,CAACmM,EAAWlR,EAAmBwJ,EAAyBoI,IAG1D,IAAKthB,EAAS,OAAO,KACrB,MAAMwf,EACJjL,GAAAA,GAAAA,OACGE,GACC6M,EAAkB7M,KAAazU,EAAQnF,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,SACjE/E,EAAKuG,IAAIC,GAAAA,GAAAA,OAAAA,IAAiBzB,QAAU2G,EAAQnF,IAAIC,GAAAA,GAAAA,OAAAA,IAAiBzB,MAExE,OACE,QAACtD,EAAA,EAAS,WACR,QAAC,EAAAvD,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAQ,UAEtEgxB,IACC,QAACgB,GAAoB,CACnBhB,OAAQA,EACRzH,wBAAyBA,EACzBrlB,QAASgtB,EACTzT,oBAAqBA,KAGzB,QAACjZ,EAAA,EAAW,YACV,QAACU,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAG9J,GAAI,CAAE4gB,GAAI,GAAK5W,SAAS,OAAM,eAC7CvK,IAAVyK,IACC,QAAClF,EAAA,EAAO,CAACxF,MAAM,OAAM,UACnB,QAAC+G,EAAA,EAAU,WACT,4BACG2D,EACAkkB,EAAoB,cAAgB,WAK7C,QAACF,GAAiB,CAChBC,UAAWA,EACXC,kBAAmBA,KAErB,QAAC3qB,EAAA,EAAG,CACFzD,GAAI,CAAE6I,SAAU,EAAGxK,QAAS,OAAQiM,eAAgB,cAErDglB,GACD,QAAC7tB,EAAA,EAAM,CACLsD,KAAK,QACLvF,MAAM,UACNkC,QAASguB,EACTpnB,SAAUA,GAAY8lB,EACtBzsB,WAAW,QAAC6uB,GAAA,EAAS,IAAI,SAC1B,gBAGAnB,MAEH,QAAC5jB,GAAA,GAAI,CACHC,WAAS,EACT/M,QAAS,EACTqB,GAAI,CAAE4gB,GAAI,GACVpT,QAAS,CAAErC,GAAI,EAAGgX,GAAI,EAAG/W,GAAI,EAAG2B,GAAI,GAAI,WAExC,QAACtB,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACgiB,GAAc,CACb3C,cAAY,EACZ4C,SAAUlqB,EAAKuG,IAAIC,GAAAA,GAAAA,OAAAA,IAAiBzB,UAGvCmoB,MAEH,QAACjtB,EAAA,WAAoB,CAAC8E,MAAO+nB,EAAoB,UAC/C,QAACnD,GAAoB,aAMjC,CAEA,SAAS0D,IACPhB,QAAQ,MAAEe,EAAK,MAAED,GAAO,wBACxBvI,EAAuB,QACvBrlB,EAAO,oBACPuZ,IAMC,QACD,MAAM,SAAEhY,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAE9BzD,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,GACT6vB,GAAUnuB,EAAAA,EAAAA,cAAY,KAEvBqtB,OAAOC,QAAQ,2DAGlB5rB,EAASgM,KAAKyC,IAAI6d,EAAO,CAAEpF,UAAUzM,EAAAA,GAAAA,IAAoB/d,KACzD+B,IAAS,GACR,CAAC6tB,EAAOtsB,EAAUtD,EAAc+B,IAC7BiuB,EAA2C,OAArC,EAA2B,OAA3B,EAAG1sB,EAASgM,KAAKvG,IAAI6mB,SAAM,EAAxB,EAA0BpF,UAAQ,EAAI,GACrD,OACE,QAAC3oB,GAAA,EAAY,CACXC,OAAQ8tB,EACR7tB,QAASA,EACT+d,eAAgB,CAAEC,SAAU4P,EAAQ,KAAO,MAAO,UAElD,QAAC3tB,EAAA,EAAQ,WACP,QAACK,EAAA,EAAW,CACV/C,GAAI,CACF3B,QAAS,OACTiM,eAAgB,SAChBP,WAAY,UACZD,IAAK,GACL,UAEDumB,IACC,QAAC5sB,EAAA,EAAG,CAACoe,SAAU,IAAI,UACjB,QAAC8O,GAAA,EAAY,CACXrG,WAAY+F,EACZvI,wBAAyBA,EACzB8I,UAAQ,EACRC,YAAa,CAAEC,YAAY,EAAMC,aAAa,GAC9CC,cAAc,QAACC,GAAa,CAACze,GAAI6d,QAItCA,IAAS,QAAC5sB,EAAA,EAAG,CAACpF,QAAQ,OAAOwK,SAAU,IACvCwnB,IACC,QAAC5sB,EAAA,EAAG,CAACpF,QAAQ,OAAO0L,WAAW,SAASO,eAAe,SAAQ,UAC7D,QAAC7I,EAAA,EAAM,CAACC,QAAS+uB,EAASzwB,GAAI,CAAE3B,QAAS,QAAS,UAChD,QAAC6yB,GAAA,EAAY,CAAClxB,GAAI,CAAED,SAAU,UAInCswB,IAAS,QAAC5sB,EAAA,EAAG,CAACpF,QAAQ,OAAOwK,SAAU,KACxC,QAACpF,EAAA,EAAG,CAACoe,SAAU,IAAKxjB,QAAQ,OAAO2lB,cAAc,SAASla,IAAK,EAAE,WAC/D,QAAC6mB,GAAA,EAAY,CACXrG,WAAYgG,EACZxI,wBAAyBA,EACzB8I,UAAQ,EACRC,YAAa,CAAEC,YAAY,EAAMC,aAAa,GAC9CC,cAAc,QAACC,GAAa,CAACze,GAAI8d,MAElCI,GACCA,KAAWjS,EAAAA,GAAAA,IAAoB/d,IACP,QAAxBsb,IACE,QAACmV,GAAkB,CAACC,YAAaV,aAOjD,CACA,SAASO,IAAc,GAAEze,IACvB,MAAM,IAAQlS,EAAAA,EAAAA,IAAe,4BAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,aAAE+V,GAAc,qBAC9B3V,GACEL,GAAgB3a,GACd2e,EAAWgS,EAAa7iB,SAASgE,GACjCjJ,GAASjH,EAAAA,EAAAA,cACb,IAAMoZ,EAAqB,CAAE2V,cAAcC,EAAAA,GAAAA,IAAUD,EAAc7e,MACnE,CAACA,EAAI6e,EAAc3V,IAGrB,OACE,QAACmO,GAAA,EAAgB,CACfjnB,OACE,QAACa,EAAA,EAAG,YACF,QAAC8C,EAAA,EAAU,UAAEvE,EAAC,UAAC,qCACf,QAACuE,EAAA,EAAU,WACT,QAAC,KAAS,CAAC/G,MAAO6f,EAAW,QAAU,UAAU,SAC9Crd,EAAEqd,EAAW,sBAAwB,8BAK9CyK,UAAU,MACVyH,OAAK,YAEL,QAAC9vB,EAAA,EAAM,CACLC,QAAS6H,EACT/J,MAAO6f,EAAW,QAAU,UAC5Bta,KAAK,QAAO,SAEXsa,GAAW,QAACwG,GAAA,EAAS,KAAM,QAAClE,GAAA,EAAa,OAIlD,CACA,SAASwP,IAAmB,YAC1BC,IAIA,MAAM,IAAQ9wB,EAAAA,EAAAA,IAAe,4BAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAEoD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1B1D,GAAiB0e,EAAAA,EAAAA,GACrBjb,EAASqZ,MAAMmF,uBAAuB4O,KAGtC9V,cAAc,kBAAES,GAAmB,qBACnCL,GACEL,GAAgB3a,GACd2e,EAAWtD,EAAkBvN,SAAS4iB,GACtC7nB,GAASjH,EAAAA,EAAAA,cACb,IACEoZ,EAAqB,CACnBK,mBAAmBuV,EAAAA,GAAAA,IAAUvV,EAAmBqV,MAEpD,CAACA,EAAarV,EAAmBL,IAGnC,OACE,QAACja,EAAA,EAAM,CACLC,QAAS6H,EACT/J,MAAO6f,EAAW,YAAc,UAChCta,KAAK,QACLpD,UAAW0d,GAAW,QAAC,KAAwB,KAAM,QAAC,KAAY,IAAI,UAEtE,0BACGrd,EAAC,UAAC,2BAAwB,KAAC,2BAASzB,EAAewB,WAI5D,C,+JC/We,SAASyvB,GAAe9wB,GACrC,MAAM,SAAEsD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzBwtB,EAAaC,IAAkB3wB,EAAAA,EAAAA,WAAS,IAC7CiD,EAASytB,YAAYhoB,IAAI/I,MAE3BiF,EAAAA,EAAAA,YACE,IAAM+rB,EAAe1tB,EAASytB,YAAYhoB,IAAI/I,KAC9C,CAACsD,EAAUtD,KAEbiF,EAAAA,EAAAA,YACE,IACE3B,EAASytB,YAAYhW,OACnB/a,GACA,CAACwN,EAAGoL,EAAGpH,IAAY,WAANoH,GAAkBoY,EAAexf,MAElD,CAACxR,EAAcgxB,EAAgB1tB,IAQjC,MAAO,CAAEytB,cAAaE,qBANMrvB,EAAAA,EAAAA,cACzBO,GACCnC,GAAgBsD,EAASytB,YAAYhf,IAAI/R,EAAcmC,IACzD,CAACnC,EAAcsD,IAInB,C,gBChBe,SAAS4tB,IAAU,GAChCC,EAAE,GACFC,EAAE,QACFC,EAAO,cACPC,EAAa,eACbC,EAAiB,EAAC,iBAClBC,EAAmB,EAAC,cACpBC,EAAgB,MAAK,gBACrBC,EAAe,MACfC,EAAQ,WAER,IAAKR,IAAOC,IAAOC,EACjB,OAAO,KAGT,MAAMO,EACJN,GACAA,EAAche,IAAM+d,EAAQ/d,GAC5Bge,EAAcO,IAAMR,EAAQQ,EAE9B,OACE,aACEtL,UAAU,aACV,eAAc4K,EACd,eAAcC,EACd,eAAcC,EAAQ/d,EACtB,eAAc+d,EAAQQ,EACtB,cAAaD,EAAaJ,EAAmBD,EAAe,SAE1DK,GAUA,yBACE,QAACE,GAAW,CACVhgB,GAAG,sBACH6f,MAAOA,EACPR,GAAIA,EACJC,GAAIA,EACJxY,EAAG2Y,EAAiB,EACpB9Y,KAAMgZ,KAER,QAACK,GAAW,CACVhgB,GAAG,oBACH6f,MAAOA,EACPR,GAAIA,EACJC,GAAIA,EACJxY,EAAG2Y,EACH9Y,KAAK,OACLsZ,OAAQN,QAzBZ,QAACK,GAAW,CACVhgB,GAAG,wBACH6f,MAAOA,EACPR,GAAIA,EACJC,GAAIA,EACJxY,EAAG4Y,EACH/Y,KAAMiZ,KAyBhB,CACA,SAASI,IAAY,MACnBH,EAAK,GACL7f,EAAE,GACFqf,EAAE,GACFC,EAAE,EACFxY,EAAC,KACDH,EAAI,OACJsZ,IAUA,OAAQJ,GACN,IAAK,SACH,OACE,kBAAQ7f,GAAIA,EAAIqf,GAAIA,EAAIC,GAAIA,EAAIxY,EAAGA,EAAGH,KAAMA,EAAMsZ,OAAQA,IAE9D,IAAK,SACH,OACE,gBACEjgB,GAAIA,EACJwB,EAAG6d,EAAKvY,EACRiZ,EAAGT,EAAKxY,EACRhb,MAAW,EAAJgb,EACP/a,OAAY,EAAJ+a,EACRH,KAAMA,EACNsZ,OAAQA,IAGd,IAAK,UACH,OACE,mBACEjgB,GAAIA,EACJkgB,OAAS,GAAEb,KAAMC,EAAS,IAAJxY,KAAWuY,EAAS,IAAJvY,KAAWwY,KAAMD,KACrDC,EAAS,IAAJxY,KACHuY,EAAS,IAAJvY,KAAWwY,IACpB3Y,KAAMA,EACNsZ,OAAQA,IAIlB,C,6HCrFe,SAASE,GAAc,GASf,IATe,OACpCC,EAAM,MACNC,EAAK,OACLC,EAAM,MACNC,EAAK,cACLf,EAAa,iBACbgB,EAAgB,eAChBC,GAEmB,EADhBC,GAAY,cAEf,MAAM,SAAElvB,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,KAAEf,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,IACtB,EAAEnB,IAAM1B,EAAAA,EAAAA,IAAe,2BAEvB6yB,GAAuDhvB,EAAAA,EAAAA,UAC3D,IACE6tB,GACAA,EAAcoB,aACd/uB,OAAO4N,YACL+f,EAAcoB,YACXxzB,KAAK4S,IACJ,MAAM6gB,EAAUrvB,EAASgM,KAAKvG,IAAI+I,GAClC,MAAO,CAAQ,MAAP6gB,OAAO,EAAPA,EAAShQ,QAASgQ,EAAQ,IAEnC7jB,QAAQ8e,GAASA,MAExB,CAACtqB,EAASgM,KAAMgiB,IAEZsB,GAAmBhxB,EAAAA,EAAAA,cACtBiD,IAGKA,EAAEuG,OAAO0G,GAAGhE,SAAS,gBACrBjJ,EAAEuG,OAAO0G,GAAGhE,SAAS,mBAGvBwkB,OAAiBvzB,EACnB,GAEF,CAACuzB,IAGG5E,EACJ+E,GACAhQ,GAAAA,GAAAA,OACGE,IAAO,aACkB,OAAxB,EAAA8P,EAAgB9P,SAAQ,EAAxB,EAA0B7Q,MAAOtP,EAAKuG,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,KAAK,IAGtEsrB,GAAapvB,EAAAA,EAAAA,UACjB,SACsC1E,KAAvB,MAAbuyB,OAAa,EAAbA,EAAewB,mBACd,IAAgB,MAAbxB,OAAa,EAAbA,EAAewB,oBACrB,CAACxB,IAEGyB,GAAatvB,EAAAA,EAAAA,UACjB,SACsC1E,KAAvB,MAAbuyB,OAAa,EAAbA,EAAe0B,oBACb,QAAC,KAAK,CACJ1xB,EAAGA,EACH2L,QAAQ,kBACR4F,MAAoB,MAAbye,OAAa,EAAbA,EAAe0B,iBAAiB,UACxC,UACS,CAAEngB,OAAoB,MAAbye,OAAa,EAAbA,EAAe0B,kBAAmB,OAGzD,CAAC1B,EAAehwB,IAGlB,OAAIkxB,EAAaS,QAAU3B,GAEvB,QAAC4B,GAAA,EAAiB,CAACC,YAAaP,EAAiB,UAC/C,QAAC5wB,EAAA,EAAQ,CACP1C,GAAI,CAAE6hB,SAAU,QAASpB,SAAU,SACnC/e,QAAU6D,GAAMA,EAAEuuB,kBAAkB,UAEpC,QAAC/wB,EAAA,EAAW,WACV,QAACkK,GAAA,EAAK,CAACnD,IAAK,EAAE,WACZ,QAACmD,GAAA,EAAK,CAAC8mB,UAAU,MAAMhqB,WAAW,QAAQD,IAAK,EAAE,WAC/C,QAACmD,GAAA,EAAK,CAACtO,QAAS,GAAKkK,SAAU,GAAG,UAC/BulB,IACC,QAACppB,EAAA,EAAO,CAACxF,MAAM,OAAM,UACnB,2BAASwC,EAAE,8BAGduxB,IAAc,QAACvuB,EAAA,EAAO,CAACxF,MAAM,OAAM,SAAE+zB,IACrCE,IAAc,QAACzuB,EAAA,EAAO,CAACxF,MAAM,OAAM,SAAEi0B,KACtC,QAAC,EAAAryB,SAAQ,CAACC,UAAU,QAACkC,EAAA,EAAQ,CAACjF,MAAO,IAAKC,OAAQ,KAAO,UACvD,QAAC2vB,GAAiB,CAChBC,UAAW9pB,OAAOuN,OAAOuhB,GACzB/E,kBAAmBA,UAIzB,QAAC3iB,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,KACrB,QAAC/F,EAAA,EAAW,CAACpB,QAAS,IAAMsxB,OAAiBvzB,SAE/C,QAACgM,GAAA,GAAI,CAACC,WAAS,EAACqoB,UAAU,MAAMp1B,QAAS,IAAM6O,QAAS,EAAE,SACvD2V,GAAAA,GAAAA,KAAyB1iB,IACxB,QAACgL,GAAA,GAAI,CAACE,MAAI,EAAWR,GAAI,EAAE,UACzB,QAAC,EAAA/J,SAAQ,CAACC,UAAU,QAACkC,EAAA,EAAQ,CAACjF,MAAO,GAAIC,OAAQ,KAAO,UACtD,QAACy1B,GAAA,EAAgB,CACfC,YAAad,EAAgB1yB,GAC7B4iB,QAAS5iB,OAJCA,QAUpB,QAAC8F,EAAA,EAAU,YACT,2BAASqsB,IAAgB,IAAE,KAC1BsB,EAAAA,GAAAA,IACW,MAAVrB,EAAgBb,EAAche,EAAI,IAAMge,EAAche,EACtD6e,OAGJ,QAACtsB,EAAA,EAAU,YACT,2BAASusB,IAAgB,IAAE,KAC1BoB,EAAAA,GAAAA,IACW,MAAVnB,EAAgBf,EAAcO,EAAI,IAAMP,EAAcO,EACtDQ,OAGJ,QAAClJ,GAAA,EAAgB,CACfjnB,MACEovB,EAAcmC,YACVnyB,EAAE,8BACF,GAEN8nB,UAAU,MAAK,UAEf,0BACE,QAACroB,EAAA,EAAM,CACLzB,GAAI,CAAE1B,MAAO,QACbgK,cAA8C7I,KAAvB,MAAbuyB,OAAa,EAAbA,EAAe0B,kBACzBl0B,MAAM,OACNkC,QAAS,IAAMuxB,EAAejB,EAAcoB,aAAa,SAExDpxB,EAAE,iCAWd,IACT,CC1Le,MAAMoyB,GAUZ3d,YAAYzC,EAAWue,EAAWa,GAAuB,KATzDpf,OAAC,OACDqgB,WAAK,OACLjB,iBAAW,OACXnf,SAAG,OACHpO,aAAO,OACPsuB,iBAAW,OACXX,sBAAgB,OAChBE,sBAAgB,EAGrBtd,KAAKpC,EAAIA,EACToC,KAAKie,MAAQ9B,EACbnc,KAAKgd,YAAcA,CACrB,CAEWb,QACT,OAAQnc,KAAKie,OAASje,KAAKvQ,SAAWuQ,KAAK+d,WAC7C,CACW5B,MAAEA,GACXnc,KAAKie,MAAQ9B,CACf,E,iCCyCa,SAAS+B,IAAU,SAChCva,EAAQ,YACRwa,EAAW,SACXjsB,GAAW,EAAK,YAChBksB,GAAc,IAEd,MAAM,EAAExyB,IAAM1B,EAAAA,EAAAA,IAAe,CAAC,0BAA2B,QACnD,KAAE4C,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,IACtB,UAAEsxB,IAAc9zB,EAAAA,EAAAA,YAAWV,IAC1By0B,EAAcC,IAAmB5zB,EAAAA,EAAAA,WAAS,IAC1C6zB,EAASC,IAAc9zB,EAAAA,EAAAA,WAAS,IACjC,YAAE+zB,IAAgBn0B,EAAAA,EAAAA,YAAWV,IAEjCO,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IAEb6wB,aAAesD,OAAQC,IACrBxD,GAAe9wB,IAEZu0B,EAAWC,IAAgBn0B,EAAAA,EAAAA,WAAU4L,MACrCwoB,EAAYC,IAAiBr0B,EAAAA,EAAAA,UAAS4L,KACvC0oB,GAAY/yB,EAAAA,EAAAA,cAChB,CAACud,EAAa5X,KACZ,GAAqB,iBAAVA,EAAoB,MAAM,IAAIqtB,UACzC,MAAOC,EAAGC,GAAKvtB,EACfitB,EAAaK,GACbH,EAAcI,EAAE,GAElB,CAACN,EAAcE,KAEjBzvB,EAAAA,EAAAA,YAAU,KACRuvB,GAAcvoB,KACdyoB,EAAczoB,IAAS,GACtB,CAAC8nB,IAEJ,MAAM,YAAEgB,EAAW,aAAEC,EAAY,UAAEC,EAAS,UAAEC,IAAczxB,EAAAA,EAAAA,UAAQ,KAAM,QACxE,IAAKswB,EAAW,MAAO,CAAEgB,YAAa,KAAMC,aAAc,MAC1D,IAAIC,EAAYhpB,IACZipB,GAAajpB,IACjB,MAAMkpB,EAAe1S,GAAAA,GAAAA,KAClBE,IAAO,aAA2C,OAA3C,EAAS,MAAJngB,OAAI,EAAJA,EAAMuG,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,OAAK,EAAI,EAAE,IAGrDyqB,EAAS+B,EAAUvxB,KACtBtD,KAAI,EAAGqI,MAAOsqB,EAAGuD,KAAM9hB,EAAGof,kBACzB,QAAU3zB,IAANuU,EAAiB,OAAO,KACxBA,EAAI2hB,IAAWA,EAAY3hB,GAC3BA,EAAI4hB,IAAWA,EAAY5hB,GAC/B,MAAM+hB,EAA+B,IAAI3B,GACvCpgB,EACAue,EACAa,GAEI4C,GAAgB3jB,EAAAA,GAAAA,GAAa+gB,GAAcvzB,IAAM,IAEjDo2B,EAAiBJ,EAAatxB,OAAO2xB,GAAQF,EAAcE,KAC7DD,IACFF,EAAclwB,QAAU0sB,EAExBwD,EAAcxD,OAAI9yB,EAElB02B,QAAQC,IAAIL,IAGd,MAAMM,EAA6B,MAAXvB,OAAW,EAAXA,EAAawB,WAAWC,GAC9CA,EAAMhyB,OAAO2xB,GAAQF,EAAcE,YAEbz2B,IAApB42B,IAAsD,IAArBA,IAE/BJ,GAAgBE,QAAQC,IAAIL,QACJt2B,IAAxBs2B,EAAc1B,QAChB0B,EAAc5B,YAAc5B,EAE5BwD,EAAcxD,OAAI9yB,GAEpBs2B,EAAcrC,iBAAmB2C,EAAkB,EAC/CJ,GAAgBE,QAAQC,IAAIL,IAGlC,MAAMS,EAAkBxB,EAAgBsB,WAAWC,GACjDA,EAAMhyB,OAAO2xB,GAAQF,EAAcE,OAcrC,OAZyB,IAArBM,IAEEP,GAAgBE,QAAQC,IAAIL,QACJt2B,IAAxBs2B,EAAc1B,QAChB0B,EAAc5B,YAAc5B,EAE5BwD,EAAcxD,OAAI9yB,GAEpBs2B,EAAcvC,iBAAmBgD,EAAkB,EAC/CP,GAAgBE,QAAQC,IAAIL,IAG3BA,CAAa,IAErBvmB,QAAQxM,GAAgD,OAAPA,IACjDkY,MAAK,CAAC1G,EAAG2G,IAAM3G,EAAER,EAAImH,EAAEnH,IAEpByiB,EAA+B,GACrC,IAAK,MAAMC,KAAShE,EAAQ,CAC1B,IAAIiE,EACJ,KAAQA,EAAOF,EAAYngB,OACzB,GAAIqgB,EAAKpE,EAAImE,EAAMnE,EAAG,CACpBkE,EAAYpgB,KAAKsgB,GACjB,KACF,CAEFF,EAAYpgB,KAAKqgB,EACnB,EAMkB,OAAd,EAAAD,EAAY,SAAE,EAAd,EAAgBziB,MAAe,OAAd,EAAK0e,EAAO,SAAE,EAAT,EAAW1e,KAAG0e,EAAO,GAAGze,IAAMwiB,EAAY,GAAGlE,GACvEkE,EAAYhmB,SAASzN,IACnBA,EAAGiR,IAAMjR,EAAGuvB,CAAC,IAGf,MAAMmD,EAAe,CACnB5hB,QAAS2iB,EAAY72B,KAAK82B,GAAU,CAACA,EAAM1iB,EAAG0iB,EAAMnE,KACpDqE,QAASlE,EAAO9yB,KAAK82B,GAAU,CAACA,EAAM1iB,EAAG0iB,EAAMnE,MAEjD,MAAO,CACLkD,YAAa/C,EAAOljB,QACjBxM,GAAOA,GAAMA,EAAGgR,GAAKihB,GAAajyB,EAAGgR,GAAKmhB,IAE7CO,eACAC,YACAC,YACD,GACA,CAACnB,EAAWO,EAAiB9xB,EAAM4xB,EAAaG,EAAWE,IAExD0B,EAAe9c,IAAY+c,EAAAA,GAAAA,IAAiB,MAAJ5zB,OAAI,EAAJA,EAAM6zB,aAAchd,GAG5Did,EACFh1B,EAHkB+X,KAAc8c,GAAgBA,EAAapyB,SAG3D,uDACA,4DAEN,OACE,QAACE,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,WACV,QAAC0I,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAGoL,WAAW,SAAQ,WAC7C,QAAC0B,GAAA,GAAI,CAACE,MAAI,YACR,QAACpF,EAAA,EAAU,UAAEvE,EAAC,UAAC,oBAEjB,QAACyJ,GAAA,GAAI,CAACE,MAAI,YACR,QAACke,GAAA,EAAgB,CACfC,UAAU,MACVlnB,MACE4xB,EACIxyB,EAAE,6CACF,GACL,UAED,0BACE,QAACi1B,GAAA,EAA0B,CACzBjd,mBAAoBD,EACpBmd,UAAYprB,GAAWyoB,EAAYzoB,GACnCqrB,YAAaH,EACb1uB,SAAUA,WAKlB,QAACmD,GAAA,GAAI,CAACE,MAAI,YACR,QAACke,GAAA,EAAgB,CACfjnB,MAAQmX,EAAgB/X,EAAE,YAAP,GACnB8nB,UAAU,MAAK,UAEf,0BACE,QAACroB,EAAA,EAAM,CACLjC,MAAM,QACNkC,QAAS,IAAM6yB,OAAY90B,GAC3B6I,UAAWyR,GAAYzR,EAAS,UAEhC,QAACa,GAAA,EAAM,aAKf,QAACsC,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,EAAE,UACrB,QAAC8X,GAAA,EAAW,CACVmJ,UAAU,MACVlnB,MAAOZ,EAAE,8CAGV0zB,IACD,QAACjqB,GAAA,GAAI,CAACE,MAAI,YACR,QAAClK,EAAA,EAAM,CACLsD,KAAK,QACLpD,UAAWizB,GAAU,QAAChoB,GAAA,EAAQ,KAAM,QAACC,GAAA,EAAoB,IACzDrN,MAAOo1B,EAAU,UAAY,YAC7BlzB,QAAS,IAAMmzB,GAAYD,GAAS,SACpC5yB,EAAC,UAAC,8BAGL0zB,IACD,QAACjqB,GAAA,GAAI,CAACE,MAAI,YACR,QAAClK,EAAA,EAAM,CACLsD,KAAK,QACLvF,MAAM,OACNmC,WAAW,QAACy1B,GAAA,EAAQ,IACpB11B,QAAS,IAAMizB,GAAiBD,GAAc,SAC9C1yB,EAAC,UAAC,kCAKXyzB,GAAeA,EAAY7lB,SAAU,QAAC3K,EAAA,EAAO,IAC7CwvB,GAAagB,GAAeA,EAAY7lB,SACvC,QAAC7M,EAAA,EAAW,YACV,QAACwH,GAAA,EAAQ,CAACC,KAAMkrB,GAAgBhB,EAAa,UAC3C,QAAChyB,EAAA,EAAQ,CAAC1C,GAAI,CAAE2D,GAAI,GAAI,UACtB,QAACZ,EAAA,EAAW,YACV,QAACwD,EAAA,EAAU,UAAC,cACZ,QAAC8wB,GAAA,EAAgB,CACfpvB,MAAOgH,KAAKC,UAAsB,MAAZwmB,OAAY,EAAZA,EAAc5hB,YAEtC,QAACvN,EAAA,EAAU,UAAC,cACZ,QAAC8wB,GAAA,EAAgB,CACfpvB,MAAOgH,KAAKC,UAAsB,MAAZwmB,OAAY,EAAZA,EAAckB,mBAK5C,QAACU,GAAK,CACJ7B,YAAaA,EACb8B,SAAU9C,EAAU8C,SACpBC,UAAW/C,EAAU+C,UACrB5C,QAASA,IAEVa,EAAY7lB,OAAS,IACpB,QAAC6nB,GAAA,GAAM,CACLC,OAAK,EACLzvB,MAAO,CAACgtB,EAAWE,GACnBjvB,SAAUmvB,EACVsC,kBAAmBtC,EACnBphB,IAAK0hB,EACLzhB,IAAK0hB,EACLgC,MAAOhC,EAAYD,GAAa,GAChCkC,kBAAkB,OAClBC,iBAAmBroB,IAAC,eAClBykB,EAAAA,GAAAA,IACoC,OAAX,OAAvB,EAAAO,EAAU8C,SAAS/wB,WAAI,EAAvB,EAAyBmmB,MAAeld,EAAI,IAAMA,EAC3B,OAD4B,EACnDglB,EAAU8C,SAAS/wB,WAAI,EAAvB,EAAyBmmB,KAC1B,EAEH3sB,GAAI,CAAE2G,GAAI,KAAMrI,MAAO,cAOrC,CAEA,MAAMy5B,GAAiB,UACjBC,GAAmB,OACnBC,GAAe,UACfC,GAAY,UAClB,SAASZ,IAAM,YACb7B,EAAW,SACX8B,EAAQ,UACRC,EAAS,QACT5C,IAMC,YACD,MAAM,YAAEE,EAAW,eAAEqD,IAAmBx3B,EAAAA,EAAAA,YAAWV,IAC7C,EAAE+B,IAAM1B,EAAAA,EAAAA,IAAe,4BACtB0xB,EAAegB,IAAoBjyB,EAAAA,EAAAA,YACpCkyB,GAAiB3wB,EAAAA,EAAAA,cACpBi0B,IACC4B,EAAe,IAAgB,MAAXrD,EAAAA,EAAe,GAAKyB,IACxCvD,OAAiBvzB,EAAU,GAE7B,CAAC04B,EAAgBrD,IAEbsD,GAAe91B,EAAAA,EAAAA,cAClB8E,IACKA,GAASA,EAAMixB,QAAUjxB,EAAMkxB,QACjCtF,EA0JR,SACEuF,EACAC,EACAzjB,EACA7R,GAEA,MAAMu1B,EAAmB/4B,MAAM0d,KAC7ByG,SAAS6U,iBAAwB,gBACjC/iB,QAAO,CAACgjB,EAAQC,KAChB,MAAQP,OAAQQ,EAASP,OAAQQ,GAAYH,EAAOI,QAC9CC,EAAYhjB,KAAKijB,MACpBV,EAAWM,IAAY,GAAKL,EAAWM,IAAY,IAE9CT,OAAQa,EAASZ,OAAQa,GAAYP,EAAOG,QAIpD,OAAOC,GAHWhjB,KAAKijB,MACpBV,EAAWW,IAAY,GAAKV,EAAWW,IAAY,GAEtBR,EAASC,CAAM,IACrC,QAOZ,OAJiB5iB,KAAKijB,MACnBV,EAAWE,EAAiBJ,SAAW,GACrCG,EAAWC,EAAiBH,SAAW,GAE1BvjB,EACd7R,EAAKgV,MACFkhB,GACCA,EAAEplB,KAAOykB,EAAiBY,QAAUD,EAAE7G,KAAOkG,EAAiBa,cAElE75B,CACN,CAxLU85B,CAAgBnyB,EAAMixB,OAAQjxB,EAAMkxB,OAAQ,GAAI7C,GACjD,GAEL,CAACzC,EAAkByC,IAIf+D,EAAcC,GAAiBlC,EAAUv1B,GACzC03B,EAAcD,GAAiBjC,EAAWx1B,GAEhD,OACE,QAAC23B,GAAA,EAAmB,CAACr7B,MAAM,OAAOC,OAAQ,IAAI,UAC5C,QAACq7B,GAAA,EAAa,CACZpnB,GAAG,iBACHtP,KAAMuyB,EACN/zB,QAAS02B,EACTjM,MAAO,CAAE0N,OAAQ,WAAY,WAE7B,QAACC,GAAA,EAAa,CAACC,gBAAgB,SAC/B,QAACC,GAAA,EAAK,CACJC,QAAQ,IACRC,MAAM,SACNvN,KAAmB,OAAf,EAAE4K,EAAS/wB,WAAI,EAAb,EAAemmB,KACrBwN,OAAQ,CAAC,OAAQ,QACjBC,KAAM,CAAEjhB,KAAM,SACd/M,KAAK,SACLiuB,cAAgB5qB,GAAOA,EAAI,IAAQA,EAAEka,UAAYla,EAAEka,QAAQ,GAC3Dzf,OACE,QAACowB,GAAA,EAAK,CAACnhB,KAAK,QAAQohB,GAAI,GAAG,SACxBf,IAGLj7B,OAAQ,MAEV,QAACi8B,GAAA,EAAK,CACJz4B,KAAK,MACLo4B,OAAQ,CAAC,OAAQ,QACjBxN,KAAoB,OAAhB,EAAE6K,EAAUhxB,WAAI,EAAd,EAAgBmmB,KACtB8N,eAAe,EACfL,KAAM,CAAEjhB,KAAM,SACd/M,KAAK,SACLlC,OACE,QAACowB,GAAA,EAAK,CAACnhB,KAAK,QAAQuhB,OAAQ,GAAIC,IAAK,GAAG,SACrCjB,IAGLp7B,MAAO,OAET,QAACs8B,GAAA,EAAO,CACN3vB,SACE,QAAC0nB,GAAa,CACZC,OAAQ4G,EACR3G,MAAoB,OAAf,EAAE0E,EAAS/wB,WAAI,EAAb,EAAemmB,KACtBmG,OAAQ4G,EACR3G,MAAqB,OAAhB,EAAEyE,EAAUhxB,WAAI,EAAd,EAAgBmmB,KACvBqF,cAAeA,EACfgB,iBAAkBA,EAClBC,eAAgBA,IAGpBnsB,QAAQ,QACR+zB,aAAc,CAAEjP,cAAe,OAAQiO,OAAQ,QAC/CA,QAAQ,KAEV,QAACiB,GAAA,EAAM,CACL/I,QAAS,IACH6C,EACA,CACE,CACEpiB,GAAI,MACJvK,MAAOjG,EAAC,UAAC,uBACToK,KAAM,OACN5M,MAAO04B,KAGX,GACJ,CACE1lB,GAAI,QACJvK,MAAOjG,EAAC,UAAC,4BACToK,KAAM,SACN5M,MAAOu4B,IAET,CACEvlB,GAAI,cACJvK,MAAOjG,EAAC,UAAC,8BACToK,KAAM,SACN5M,MAAOw4B,IAET,CACExlB,GAAI,UACJvK,MAAOjG,EAAC,UAAC,yBACToK,KAAM,UACN5M,MAAOy4B,OAIZrD,IACC,QAACmG,GAAA,EAAI,CACHd,QAAQ,MACRxH,OAAQyF,GACR9rB,KAAK,aACL4uB,cAAY,EACZC,YAAa,EACbC,mBAAmB,EACnBC,KAAK,EACLC,WAAW,KAGf,QAACC,GAAA,EAAO,CACNpB,QAAQ,QACRiB,mBAAmB,EACnB7I,OACE,QAACT,GAAS,CACRI,cAAeA,EACfI,gBAAiB2F,QAIvB,QAACsD,GAAA,EAAO,CACNpB,QAAQ,cACRiB,mBAAmB,EACnB7I,OACE,QAACT,GAAS,CACRS,MAAM,SACNL,cAAeA,EACfI,gBAAiB4F,QAIvB,QAACqD,GAAA,EAAO,CACNpB,QAAQ,UACRiB,mBAAmB,EACnB7I,OACE,QAACT,GAAS,CACRS,MAAM,UACNL,cAAeA,EACfI,gBAAiB6F,WAO/B,CA2CA,SAASwB,GAAiBj1B,EAAexC,GAAc,kBACrD,MAAkC,iBAAX,OAAhB,EAAOwC,EAAKgC,WAAI,EAAT,EAAWzE,MACrByC,EAAKgC,KAAKzE,KACT,GAAEC,EAAG,GAAW,OAAX,EAAEwC,EAAKgC,OAAU,OAAN,EAAT,EAAWzE,WAAF,EAAT,EAAiBqF,MAAMigB,MAAe,OAAX,EAAE7iB,EAAKgC,OAAU,OAAN,EAAT,EAAWzE,WAAF,EAAT,EAAiBqF,MAAMogB,WACjD,OAAT,EAAAhjB,EAAKgC,OAAL,EAAW80B,WAAc,IAAY,OAAX,EAAE92B,EAAKgC,WAAI,EAAT,EAAW80B,aAAe,IAE9D,C,iEClfe,SAASC,IAAW,SACjCjzB,GAAW,EAAK,cAChBkzB,IAKA,MAAM,EAAEx5B,IAAM1B,EAAAA,EAAAA,IAAe,4BAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,aAAE+V,EAAY,gBAAEoK,GAAiB,qBAC/C/f,GACEL,GAAgB3a,IACbY,EAAM2a,EAAQxZ,IAAWyZ,EAAAA,EAAAA,IAAa,GACvCwf,EAAiBrK,EAAazhB,QAC7B+rB,EAASC,EAAWC,IAAc3f,EAAAA,EAAAA,IAAa,GAChD1a,GAAWc,EAAAA,EAAAA,cACdkQ,IACCkJ,EAAqB,CACnB2V,aAAc,IAAIA,EAAc7e,GAChCipB,iBAAiB,GACjB,GAEJ,CAAC/f,EAAsB2V,IAEnByK,GAAcx5B,EAAAA,EAAAA,cACjBkQ,IACCkJ,EAAqB,CACnB2V,aAAcA,EAAa7hB,QAAQ1P,GAAMA,IAAM0S,IAC/CipB,iBAAiB,GACjB,GAEJ,CAAC/f,EAAsB2V,IAEnB0K,GAAqBz5B,EAAAA,EAAAA,cACzB,IAAMoZ,EAAqB,CAAE+f,iBAAkBA,KAC/C,CAAC/f,EAAsB+f,IAEzB,OACE,yBAEE,QAACl5B,GAAA,EAAY,CACXC,KAAMlB,EACNmB,QAASA,EACT+d,eAAgB,CAAEC,SAAU,MAAO,UAEnC,QAAC/d,EAAA,EAAQ,YACP,QAACK,EAAA,EAAW,WACV,QAACU,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAGC,WAAW,SAAQ,WAC7C,QAACxD,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAExB,EAAC,UAAC,gCAC5B,QAAC2e,GAAA,EAAW,CACV/d,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,kCAExB,QAACyB,EAAA,EAAG,CAACoF,SAAU,KACf,QAAC/F,EAAA,EAAW,CAACpB,QAASe,EAASsC,KAAK,gBAGxC,QAACE,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,YACV,QAACi5B,GAAmB,CAClB16B,KAAMq6B,EACNl5B,QAASo5B,EACTr6B,SAAUA,EACV6vB,aAAcA,KAEhB,QAAC5vB,EAAA,EAAM,CACLmK,WAAS,EACTlK,QAASk6B,EACTp8B,MAAM,OACNQ,GAAI,CAAE2D,GAAI,GACVhC,WAAW,QAACs6B,GAAA,EAAO,IAAI,SACvBj6B,EAAC,UAAC,0BACD05B,IACD,QAAC/2B,EAAA,EAAS,CAAC3E,GAAI,CAAE2D,GAAI,GAAI,UACvB,QAAC4C,EAAA,EAAU,CAACwC,UAAU,SAAQ,SAAE/G,EAAC,UAAC,gCAGtC,QAACyJ,GAAA,GAAI,CACHC,WAAS,EACT8B,QAAS,CAAErC,GAAI,EAAGC,GAAI,EAAG2B,GAAI,EAAGqV,GAAI,GACpCzjB,QAAS,EAAE,SAEV0yB,EAAazxB,KAAK4S,IACjB,QAAC/G,GAAA,GAAI,CAACE,MAAI,EAAUR,GAAI,EAAE,UACxB,QAACkf,GAAgB,CACfC,WAAY9X,EACZ6Q,QAAQ,SACRoH,YAAa9lB,EAAAA,EACbjD,QAAS,IAAMo6B,EAAYtpB,GAC3BgY,cAAY,KANAhY,gBAgB1B,QAACzK,GAAA,EAAW,CAAC/H,GAAI,CAAE3B,QAAS,OAAQC,MAAO,QAAS,WAClD,QAACmD,EAAA,EAAM,CACLC,QAASq6B,EACTzzB,SAAUA,EACV3G,UACE85B,GAAkB,QAAC,KAAY,KAAM,QAAC,KAAwB,IAEhEj8B,MAAOi8B,EAAkB,UAAY,YACrCz7B,GAAI,CAAE6I,SAAU,GAAI,UAEpB,QAACpF,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,GAAI,WACnC,QAACrG,EAAA,EAAG,UAAEzB,EAAE,6BACR,QAACgD,EAAA,EAAO,CAAChF,GAAI,CAAEk8B,WAAY,UAAW,SACnCT,GACC,QAAC,KAAK,CAACz5B,EAAGA,EAAG2L,QAAQ,sBAAqB,UAAC,SAClC,CAAEwuB,SAAUX,GAA+B,0BAIpD,QAAC,KAAK,CAACx5B,EAAGA,EAAG2L,QAAQ,oBAAoB4F,MAAOmoB,EAAe,UAC5D,CAAEnoB,MAAOmoB,GAAgC,qCAOpD,QAACj6B,EAAA,EAAM,CACLjC,MAAM,OACNkC,QAASua,EACT3T,SAAUA,EACVtI,GAAI,CAAEkJ,WAAY,GAAI,UAEtB,QAAC4Y,GAAA,EAAY,WAKvB,CAEA,MAAMsa,GAAe,CAAEjxB,GAAI,EAAOgX,GAAI,EAAO/W,GAAI,EAAO2B,GAAI,GAAOqV,GAAI,IACjEia,GAAsB,CAACvc,EAAOjd,IAAW,OAAL,UAAWid,EAAUjd,GAC/D,SAASm5B,IAAoB,SAC3Bx6B,EAAQ,KACRF,EAAI,QACJmB,EAAO,aACP4uB,IAOA,MAAM,EAAErvB,IAAM1B,EAAAA,EAAAA,IAAe,4BACvB,SAAE0D,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1Bq4B,GAAeh6B,EAAAA,EAAAA,cAClBkQ,IACChR,EAASgR,GACT/P,GAAS,GAEX,CAACjB,EAAUiB,KAGN85B,EAAcC,IAAwBC,EAAAA,EAAAA,YAC3CJ,IACAK,EAAAA,GAAAA,QAGKvgB,EAASC,IAAeC,EAAAA,GAAAA,MAC/B1W,EAAAA,EAAAA,YAAU,IACD3B,EAASgM,KAAKsP,UAAUlD,IAC9B,CAACpY,EAAUoY,IAEd,MAAMugB,GAAOC,EAAAA,GAAAA,KAEPC,GAAgB14B,EAAAA,EAAAA,UAAQ,KAAM24B,EAAAA,GAAAA,OAAyB,IACvDC,GAAY54B,EAAAA,EAAAA,UAAQ,KACxB,MAAM64B,GAAazf,EAAAA,GAAAA,GAAegf,EAAcM,GAChD,OACE1gB,GACAnY,EAASgM,KAAK4B,OACXpC,OAAOwtB,GACPp9B,KAAK0T,GAAQA,EAAId,KACjBhD,QAAQgD,IAAQ6e,EAAa7iB,SAASgE,KACtCyqB,MAAM,EAAGb,GAAaO,GAAM,GAEhC,CAACxgB,EAASnY,EAAU64B,EAAeN,EAAcI,EAAMtL,IAE1D,OACE,QAAC9uB,GAAA,EAAY,CACXC,KAAMlB,EACNmB,QAASA,EACT+d,eAAgB,CAAEC,SAAU,MAAO,UAEnC,QAAC/d,EAAA,EAAQ,YACP,QAACK,EAAA,EAAW,CACV/C,GAAI,CACF6P,GAAI,EACJxR,QAAS,OACTiM,eAAgB,gBAChBP,WAAY,UACZ,WAEF,QAACxD,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAExB,EAAC,UAAC,yBAC5B,QAACc,EAAA,EAAW,CAACpB,QAASe,QAExB,QAACwC,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,YACV,QAAC,EAAA3B,SAAQ,CACPC,UACE,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MACtD,UAED,QAAC2+B,GAAA,QAAqB,CACpBX,aAAcA,EACdC,qBAAsBA,EACtBW,YAAaJ,OAGjB,QAACt5B,EAAA,EAAG,CAAC25B,GAAI,EAAE,UACT,QAAC,EAAAh8B,SAAQ,CACPC,UACE,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MACtD,UAED,QAACkN,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAG6O,QAAS,CAAErC,GAAI,EAAGC,GAAI,EAAG2B,GAAI,GAAI,SAC1DgwB,EAAUn9B,KAAK4S,IACd,QAAC/G,GAAA,GAAI,CAACE,MAAI,EAAUR,GAAI,EAAE,UACxB,QAACwlB,GAAA,EAAY,CAACrG,WAAY9X,EAAI9Q,QAAS46B,KADzB9pB,kBAWlC,C,+DC/PO,MAAM6qB,GAAkC,CAC7C,QACA,SACA,WAGa,SAASC,IAAsB,SAC5Ch1B,GAAW,EAAK,iBAChBi1B,IAKA,MAAM,EAAEv7B,IAAM1B,EAAAA,EAAAA,IAAe,aAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,aAAEkiB,GAAc,qBAC9B9hB,GACEL,GAAgB3a,IACd,SAAEsD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,iBAAEw5B,EAAgB,SAAEC,IAAav5B,EAAAA,EAAAA,UAAQ,KAC7C,MAAM0a,EAAU,CACd8e,mBAAoB9R,GAAAA,GAAAA,cAAuB,UAC3C+R,kBAAmB/R,GAAAA,GAAAA,cAAuB,SAC1CgS,kBAAmBhS,GAAAA,GAAAA,cAAuB,SAC1CiS,mBAAoBjS,GAAAA,GAAAA,cAAuB,UAC3CkS,oBAAqBlS,GAAAA,GAAAA,cAAuB,WAC5C6R,SAAUL,IAENW,GAAYlf,EAAAA,GAAAA,GAAaD,GAAUE,GACvC1a,OAAOC,QAAQN,EAASgM,KAAK9M,MAAMuN,SAAQ,EAAE+B,EAAIc,MAC/C,MAAM,QAAE+P,EAAO,YAAE2H,GAAgB1X,EAE9B+pB,GAAsD7uB,SACrD6U,KAGFtE,EAAM2e,SAASra,GAAS5J,QACpB8jB,EAAiB/qB,IAAKuM,EAAM2e,SAASra,GAASxd,WAEpDkZ,EAAO,GAAEsE,iBAAuB2H,GAAavR,QACzC8jB,EAAiB/qB,IACnBuM,EAAO,GAAEsE,iBAAuB2H,GAAanlB,SAAS,MAG5D,MAAO,CACL43B,iBAAkB,CAChBQ,OAAQD,EAAUL,mBAClBO,MAAOF,EAAUJ,kBACjBO,MAAOH,EAAUH,kBACjBO,OAAQJ,EAAUF,mBAClBO,QAASL,EAAUD,qBAErBL,SAAUM,EAAUN,SACrB,GACA,CAAC15B,EAAUu5B,IAEd,OACE,QAAC95B,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAAQ,WACxC,QAAC/e,EAAA,EAAO,KACR,QAACxB,EAAA,EAAG,CAACpF,QAAQ,OAAM,WACjB,QAAC0E,EAAA,EAAW,CAAC/C,GAAI,CAAE6I,SAAU,GAAI,UAC/B,QAACpF,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGC,WAAY,UAAW,WACzD,QAAC8f,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAG,qBAAgC,UAEvD,QAACs8B,GAAA,EAAU,CAACv+B,SAAS,eAEvB,QAAC0D,EAAA,EAAG,CAACoF,SAAU,EAAE,UACf,QAAC7D,EAAA,EAAO,CAACxF,MAAM,OAAM,WACnB,QAAC++B,GAAA,EAAM,iBAAKvzB,GAAAA,IAAmB,IAAEyyB,EAAiBQ,OAAOO,cAKjE,QAACv5B,EAAA,EAAO,CAACw5B,YAAY,WAAWC,UAAQ,KACxC,QAAC37B,EAAA,EAAW,CAAC/C,GAAI,CAAE6I,SAAU,GAAI,UAC/B,QAACpF,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGC,WAAY,UAAW,WACzD,QAAC8f,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAG,oBAA+B,UAEtD,QAAC28B,GAAA,EAAS,CAAC5+B,SAAS,eAEtB,QAAC0D,EAAA,EAAG,CAACoF,SAAU,EAAE,UACf,QAAC7D,EAAA,EAAO,CAACxF,MAAM,OAAM,WACnB,QAACo/B,GAAA,EAAO,iBAAK5zB,GAAAA,IAAmB,IAAEyyB,EAAiBS,MAAMW,iBAMlExB,GAAgCz9B,KAAKyjB,IACpC,MAAMyb,EAAmBtB,EAAana,GAChC0b,EAAWlT,GAAAA,GAAAA,cAAuBxI,GAClC2b,GAAkBC,EAAAA,GAAAA,GAAkB,IAAIF,IAC9C,OACE,QAACt7B,EAAA,EAAG,YACF,QAACwB,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,CAAC/C,GAAI,CAAEgD,GAAI,EAAG4d,GAAI,GAAI,WAChC,QAACnd,EAAA,EAAG,CACFzD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGC,WAAY,SAAU6W,GAAI,GAAI,WAE7D,QAACiJ,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAG,YAAWqhB,OAAyB,UAE3D,QAAC5f,EAAA,EAAG,CAACjF,WAAY,EAAE,UACjB,QAAC4kB,GAAA,EAAQ,CACPC,QAASA,EACTtY,UAAW,CAAEhL,SAAU,kBAI7B,QAAC0D,EAAA,EAAG,CAACoF,SAAU,EAAE,UACf,QAAC7D,EAAA,EAAO,CAACxF,MAAM,OAAM,SAAEk+B,EAASra,WAGpC,QAAC5X,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,SACxBogC,EAASn/B,KAAI,CAACorB,EAAalrB,KAC1B,MAAMsK,EAAUD,GAAAA,GAAAA,MAA4BW,GAC1CkgB,EAAYxc,SAAS1D,KAEjBtL,EAAQs/B,EAAiBtwB,SAASwc,GAC7B,MAAP5gB,EAAAA,EAAW,UACX,YACJ,OACE,QAACqB,GAAA,GAAI,CACHE,MAAI,EAEJ9C,SAAU,EACVsC,GACGrL,EAAI,GAAiB,WAAZujB,GAAqC,WAAZA,EAC/B,OACA5jB,EACL,UAED,QAACoqB,GAAA,EAAgB,CACfC,UAAU,MACVlnB,OACE,QAAC2D,EAAA,EAAU,WACT,4BACE,QAAC6jB,GAAmB,CAAC/d,QAAS2e,QAIpCkB,oBAAkB,YAElB,QAACzqB,EAAA,EAAM,CACLmK,WAAS,EACT7G,KAAK,QACLvF,MAAOA,EACPQ,GAAI,CACFzB,OAAQ,OACRqtB,cAAetjB,EAAW,YAAS7I,EACnCo6B,OAAQvxB,EAAW,YAAS7I,GAE9BkC,WAAW,QAACwoB,GAAA,EAAQ,CAAC9d,QAAS2e,IAC9BtpB,QAAS,IACPga,EAAqB,CACnB8hB,aAAc,OAAF,UACPA,EAAY,CACf,CAACna,GAAU2b,EACTF,EACA9T,OAIP,SAEAyS,EAAiBpa,GAAS2H,QAzC1BA,EA4CA,WA5EP3H,EAiFJ,MAKhB,CC5Le,SAAS6b,IAA6B,YACnDpxB,EAAW,eACXC,EAAc,SACdzF,GAAW,IAEX,MAAM4uB,GAAY50B,EAAAA,EAAAA,cAChB,CAAC0O,EAAgBmuB,EAAoBC,KAAsB,MACzD,MAAMC,EAAe,OAAH,UAAQvxB,GACpBwxB,EAAarwB,KAAKC,UAAUiwB,GAC5BI,EAAeJ,EAAU,IAAIrxB,EAAYwxB,SAAgB7/B,EACzD+/B,EAAUvwB,KAAKC,UAAU8B,GACzByuB,EAAY,IAAyB,OAAxB,EAAI3xB,EAAY0xB,IAAQ,EAAI,SAE9B//B,IAAb2/B,GAA0BG,EAC5BE,EAAUppB,KAAKkpB,EAAaH,IACzBK,EAAUppB,KAAK,CAAEpO,MAAO,EAAGK,UAAU,IAC1C+2B,EAAaG,GAAWC,OAEPhgC,IAAb2/B,GAA0BG,IAC5BA,EAAankB,OAAOgkB,EAAU,GAC1BG,EAAa3vB,OAAQyvB,EAAaC,GAAcC,SACxCF,EAAaC,IAE3BvxB,EAAe,OAAD,UAAMsxB,GAAe,GAErC,CAACtxB,EAAgBD,IAGb4xB,GAAYp9B,EAAAA,EAAAA,cAChB,CAAC0O,EAAgB2uB,KACf,MAAMN,EAAe,OAAH,UAAQvxB,GACpB0xB,EAAUvwB,KAAKC,UAAU8B,GACzByuB,EAAY,IAAI3xB,EAAY0xB,IAClCC,EAAUrkB,OAAOukB,EAAO,GACpBF,EAAU7vB,OAAQyvB,EAAaG,GAAWC,SAClCJ,EAAaG,GACzBzxB,EAAe,OAAD,UAAMsxB,GAAe,GAErC,CAACtxB,EAAgBD,IAGb8xB,GAAiBt9B,EAAAA,EAAAA,cACrB,CAAC0O,EAAgB2uB,EAAe13B,KAC9B,MAAMo3B,EAAe,OAAH,UAAQvxB,GACpB0xB,EAAUvwB,KAAKC,UAAU8B,GACzByuB,EAAY,IAAI3xB,EAAY0xB,IAClCC,EAAUE,GAAS,OAAH,UAAQF,EAAUE,GAAQ,CAAA13B,UAC1Co3B,EAAaG,GAAWC,EACxB1xB,EAAe,OAAD,UAAMsxB,GAAe,GAErC,CAACtxB,EAAgBD,IAGb+xB,GAAoBv9B,EAAAA,EAAAA,cACxB,CAAC0O,EAAgB2uB,EAAer3B,KAC9B,MAAM+2B,EAAe,OAAH,UAAQvxB,GACpB0xB,EAAUvwB,KAAKC,UAAU8B,GACzByuB,EAAY,IAAI3xB,EAAY0xB,IAClCC,EAAUE,GAAS,OAAH,UAAQF,EAAUE,GAAQ,CAAAr3B,aAC1C+2B,EAAaG,GAAWC,EACxB1xB,EAAe,OAAD,UAAMsxB,GAAe,GAErC,CAACtxB,EAAgBD,IAGnB,OACE,wBACGzJ,OAAOC,QAAQwJ,GAAa2W,SAAQ,EAAE+a,EAASM,KACtC,MAARA,OAAQ,EAARA,EAAUlgC,KAAI,CAACmgC,EAASJ,KACtB,QAACK,GAA4B,CAC3BhvB,KAAM/B,KAAKgxB,MAAMT,GACjBO,QAASA,EACTJ,MAAOA,EACPzI,UAAWA,EACXwI,UAAWA,EACXQ,SAAUN,EACVO,YAAaN,EACbv3B,SAAUA,GACLk3B,EAAUG,QAIrB,QAACK,GAA4B,CAC3B9I,UAAWA,EACXwI,UAAWA,EACXQ,SAAUN,EACVO,YAAaN,EACbv3B,SAAUA,MAIlB,CAYA,SAAS03B,IAA6B,KACpChvB,EAAI,QACJ+uB,EAAO,MACPJ,EAAK,UACLzI,EAAS,UACTwI,EAAS,SACTQ,EAAQ,YACRC,EAAW,SACX73B,IACoC,MACpC,MAAM,EAAEtG,IAAM1B,EAAAA,EAAAA,IAAe,4BACvB,KAAE4C,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtB+C,GAAW5D,EAAAA,EAAAA,cACdiK,GACCyE,QAAkBvR,IAAVkgC,GAAuBO,EAASlvB,EAAM2uB,EAAU,MAAHpzB,EAAAA,EAAO,IAC9D,CAAC2zB,EAAUlvB,EAAM2uB,IAEbS,EAAc,CAAEjpB,EAAG,EAAGvO,UAAW,GAAIC,SAAU,EAAGK,WAAY,GAE9Dm3B,GAAmCvJ,EAAAA,GAAAA,IACvC5zB,EAAK6zB,aACD,MAAJ/lB,EAAAA,EAAQ,IAEJsvB,EAAgD,OAAjB,MAAnBD,GAAyB,OAAN,EAAnBA,EAAqB75B,WAAF,EAAnB,EAA2BmmB,MAE7C,OACE,QAAC5kB,GAAA,EAAW,CACV/H,GAAI,CAAE,4BAA6B,CAAE6hB,SAAU,IAAMvjB,MAAO,QAAS,YAElEyhC,KAAa/uB,QAAkBvR,IAAVkgC,IACtB,QAACl+B,EAAA,EAAM,CACLzB,GAAIogC,EACJ5gC,MAAOugC,EAAQz3B,SAAW,YAAc,UACxC5G,QAAS,IAAMy+B,EAAYnvB,EAAM2uB,GAAQI,EAAQz3B,UACjDA,SAAUA,EAAS,SAElBy3B,EAAQz3B,UAAW,QAACuE,GAAA,EAAoB,KAAM,QAACD,GAAA,EAAQ,OAG5D,QAACqqB,GAAA,EAA0B,CACzBsJ,kBAAgB,EAChBvmB,mBAAoBhJ,EACpBkmB,UAAYprB,GAAWorB,EAAUprB,EAAQkF,EAAM2uB,GAC/CxI,YAAan1B,EAAE,uCAEjB,QAAC2G,GAAA,GAAmC,CAAC3I,GAAI,CAAE4I,UAAW,IAAKC,SAAU,GAAI,UACvE,QAACF,GAAA,GAAiB,CAChBK,OAAK,EACLV,UAAW0I,GAAQ1I,EACnBL,MAAc,MAAP83B,OAAO,EAAPA,EAAS93B,MAChBC,YAAY,aACZhC,SAAUA,EACVlG,GAAI,CAAE0I,GAAI,GACVI,WAAY,CAAE9I,GAAI,CAAE+I,UAAW,UAC/BE,aAAcq3B,EAAY,SAAM7gC,QAGjCuR,QAAkBvR,IAAVkgC,IACT,QAACl+B,EAAA,EAAM,CACLzB,GAAIogC,EACJ5gC,MAAM,QACNkC,QAAS,IAAMg+B,EAAU1uB,EAAM2uB,GAC/Br3B,SAAUA,EAAS,UAEnB,QAACk4B,GAAA,EAAa,CAACzgC,SAAS,cAKlC,C,kBC5Le,SAAS0gC,IAAe,SACrCn4B,GAAW,IAIX,MAAM,IAAQhI,EAAAA,EAAAA,IAAe,4BAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,YAAExN,GAAa,qBAC7B4N,GACEL,GAAgB3a,GACdqN,GAAiBzL,EAAAA,EAAAA,cACpBwL,GAA6B4N,EAAqB,CAAE5N,iBACrD,CAAC4N,IAGH,OACE,QAACjY,EAAA,EAAG,WACF,QAACkB,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,CACV/C,GAAI,CACF3B,QAAS,OACTyL,IAAK,EACLQ,eAAgB,gBAChB0Z,cAAe,UACf,UAEF,QAACvgB,EAAA,EAAG,CAACpF,QAAQ,OAAOiM,eAAe,gBAAe,WAChD,QAAC/D,EAAA,EAAU,CACTvG,GAAI,CAAEqoB,WAAY,QAAS,SAC3BrmB,EAAC,UAAC,8BACJ,QAAC2e,GAAA,EAAW,CACV/d,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,uCAI5B,QAACiD,EAAA,EAAO,KACR,QAACxB,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAASla,IAAK,GAAI,UAClD,QAACo1B,GAA4B,CAC3BpxB,YAAaA,EACbC,eAAgBA,EAChBzF,SAAUA,UAMtB,C,gBC5CA,MAAMo4B,IAAUC,EAAAA,GAAAA,KACd/a,EAAAA,GAAAA,IAAU,CAAE9T,IAAK,OAAF,UAAOpI,GAAAA,GAAAA,IAAcA,GAAAA,GAAAA,WAEzBk3B,GAAc,CACzBttB,KAAKjB,EAAAA,GAAAA,GACH,IAAIwuB,GAAAA,MAAoBC,GAAAA,KACvBrgC,GAAQigC,GAAQ5uB,IAAIrR,KAEvB4kB,QAAQtT,EAAAA,GAAAA,IAAUrI,GAAAA,GAAAA,QAAc,CAAC7J,EAAGY,IAAQigC,GAAQ5uB,IAAIrR,M,iCCqE1D,MAAMsgC,GAAQ,IAAIC,MAAM,oBACT,SAASC,KAAW,QACjC,MAAM,EAAEj/B,IAAM1B,EAAAA,EAAAA,IAAe,4BAE3BE,WAAaC,IAAKC,EAAY,YAAEwgC,KAC9BvgC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAEoD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,aAAEk9B,EAAY,YAAErM,EAAW,eAAEqD,IAAmBx3B,EAAAA,EAAAA,YAAWV,IAC3D,OAAEe,IAAWC,EAAAA,EAAAA,MAEZmgC,EAAcC,IAAmBtgC,EAAAA,EAAAA,WAAS,GAC3CugC,GAAkB57B,EAAAA,EAAAA,SAAO,IAC/BC,EAAAA,EAAAA,YAAU,KACR27B,EAAgBz7B,QAAUu7B,CAAY,GACrC,CAACA,IAEJ,MAAOG,EAAaC,IAAkBzgC,EAAAA,EAAAA,UAAS,CAC7CqL,KAAM,WACN0O,OAAQ,EACRC,OAAQ,EACRC,QAAS,EACTvB,MAAO,IAEHsP,EAAwC,aAArBwY,EAAYn1B,MAE9Bq1B,EAAWC,IAAgBrlB,EAAAA,GAAAA,OAE3B,QAAEslB,EAAUC,GAAAA,GAAcC,IAAsB9gC,EAAAA,EAAAA,UACrDiD,EAAS89B,gBAAgBr4B,QAE3B9D,EAAAA,EAAAA,YACE,IAAM3B,EAAS89B,gBAAgBrmB,QAAO,CAACsmB,EAAIC,IAAOH,EAAmBG,MACrE,CAACh+B,EAAU69B,IAGb,MAAMI,EAAaN,EAAUC,GAAAA,EAAaA,GAAAA,EAAaD,EACjDO,GAAgB5/B,EAAAA,EAAAA,cACnBq/B,GAAoB39B,EAAS89B,gBAAgBrvB,IAAI,CAAEkvB,aACpD,CAAC39B,IAGGqF,GAAoB84B,EAAAA,EAAAA,GAAoBzhC,GACxC0hC,GAAkBjhC,EAAAA,EAAAA,MAGxBwE,EAAAA,EAAAA,YAAU,KACR67B,EAAe,CACbp1B,KAAM,WACN0O,OAAQ,EACRC,OAAQ,EACRC,QAAS,EACTvB,MAAO,GACP,GACD,CAAC/Y,IAEJ,MAAM2hC,GAAal+B,EAAAA,EAAAA,UAAQ,KAAOH,EAASgM,KAAK4B,OAAOhC,QAAQ,CAAC5L,KAE1D,aAAEsX,EAAY,qBAAEI,GAAyBL,GAAgB3a,IACzD,SACJqZ,EAAQ,mBACRC,EAAkB,wBAClB8N,EAAuB,aACvBwa,EAAY,gBACZC,EAAe,SACfC,EAAQ,UACRC,IACEnnB,GAEFmW,aAAa,OAAEsD,GAAM,UAAE2N,IAAW,oBAClC/Q,IACEH,GAAe9wB,GACbiiC,IAAWC,EAAAA,EAAAA,GAAYliC,EAAconB,IACrC,eAAEvnB,GAAgBuL,OAAQ5I,IACU,OADJ,EAC5B,MAARy/B,QAAQ,EAARA,GAAWjiC,IAA6B,EAAI,CAAC,EACzCmiC,GACJ7oB,IAAsB8c,EAAAA,GAAAA,IAAiB,MAAJ5zB,QAAI,EAAJA,GAAM6zB,aAAc/c,GACnD8oB,GAAO,CAAC,KAAM,MAAMt0B,UAASouB,EAAAA,GAAAA,OAGnCj3B,EAAAA,EAAAA,YACE,IAAM3B,EAASgM,KAAKsP,UAAUoiB,IAC9B,CAACA,EAAc19B,IAGjB,MAAM++B,IAAoBxmB,EAAAA,EAAAA,kBAAiBklB,GACrCuB,IAAuBzmB,EAAAA,EAAAA,kBAAiBjB,GACxC2nB,IAAe9+B,EAAAA,EAAAA,UAAQ,KAC3B,MAAM,aACJq5B,EAAY,kBACZzhB,EAAiB,aACjBsV,EAAY,SACZmR,EAAQ,UACRC,EAAS,oBACTzmB,EAAmB,gBACnByf,GACEsH,IAAqBC,GAEzB,OAAOh/B,EAASgM,KAAK4B,OAAOpC,QAAQ8D,IAClC,IAAKmoB,GAAmBpK,EAAa7iB,SAAS8E,EAAId,IAAK,OAAO,EAC9D,GAAIc,EAAIyX,MAAQyX,EAAU,OAAO,EACjC,GAAIlvB,EAAIyX,MAAQ0X,EAAW,OAAO,EAClC,MAAMS,EAAY1F,EAAalqB,EAAI+P,SACnC,GAAa,MAAT6f,GAAAA,EAAWtzB,SAAWszB,EAAU10B,SAAS8E,EAAI0X,aAC/C,OAAO,EAET,MAAM7L,GAASV,EAAAA,GAAAA,IAAoB/d,GAC7ByiC,EACoB,mBAAxBnnB,GACA1I,EAAI4X,UACJ5X,EAAI4X,WAAa/L,EACbikB,EACoB,eAAxBpnB,GACA1I,EAAI4X,UACJ5X,EAAI4X,WAAa/L,GACjBpD,EAAkBvN,SAAS8E,EAAI4X,UACjC,OAAIiY,IAAuCC,CAGhC,GACX,GACD,CAACp/B,EAAUtD,EAAcqiC,GAAmBC,KAEzCzF,IAAmBp5B,EAAAA,EAAAA,UACvB,KACEkO,EAAAA,GAAAA,GACE4wB,GAAarjC,KAAI,EAAG4S,QAASA,KAC5B3S,IAAM,KAEX,CAACojC,MAEG,WAAEI,GAAU,eAAExnB,GAAc,cAAE2f,KAAkBr3B,EAAAA,EAAAA,UAAQ,KAMrD2a,EAAAA,GAAAA,GALS,CACdukB,WAAY,CAAC,MACbxnB,eAAgB,CAAC,MACjB2f,cAAe,CAAC,QAEYzc,GAC5B1a,OAAOC,QAAQN,EAASgM,KAAK9M,MAAMuN,SAAQ,EAAE+B,EAAIc,MAC/C,MAAM,MAAEyX,EAAK,SAAEG,GAAa5X,GACtB,SACJkvB,EAAQ,UACRC,EAAS,kBACT1mB,EAAiB,oBACjBC,EAAmB,aACnBqV,GACE0R,IAAqBC,GACrBjY,GAASyX,GAAYzX,GAAS0X,IAChC1jB,EAAMskB,WAAW74B,GAAGiP,QAChB8jB,GAAiB/qB,IAAKuM,EAAMskB,WAAW74B,GAAG3E,WAEhD,MAAMsZ,GAASV,EAAAA,GAAAA,IAAoB/d,GAC7B4iC,EACoB,QAAxBtnB,GAAiCkP,GAAYA,IAAa/L,EACtDikB,EACoB,eAAxBpnB,GACAkP,GACAA,IAAa/L,IACZpD,EAAkBvN,SAAS0c,IAC1BoY,GAAoCF,KACtCrkB,EAAMlD,eAAerR,GAAGiP,QACpB8jB,GAAiB/qB,IAAKuM,EAAMlD,eAAerR,GAAG3E,WAEhDwrB,EAAa7iB,SAASgE,KACxBuM,EAAMyc,cAAchxB,GAAGiP,QACnB8jB,GAAiB/qB,IAAKuM,EAAMyc,cAAchxB,GAAG3E,UACnD,OAGH,CACDnF,EACAsD,EAASgM,KAAK9M,KACd6/B,GACAC,GACAzF,KAGIgG,IAAa79B,EAAAA,EAAAA,SAAO,IAC1BC,EAAAA,EAAAA,YAAU,KACR,MAAM69B,EAAU,IAAOD,GAAW19B,SAAU,EACtC49B,EAAS,IAAOF,GAAW19B,SAAU,EAG3C,OAFA8pB,OAAO+T,iBAAiB,QAASF,GACjC7T,OAAO+T,iBAAiB,OAAQD,GACzB,KACL9T,OAAOgU,oBAAoB,QAASH,GACpC7T,OAAOgU,oBAAoB,OAAQF,EAAO,CAC3C,GACA,CAACF,KAGJ,MAAMK,IAAcl+B,EAAAA,EAAAA,SAAO,UAE3BC,EAAAA,EAAAA,YAAU,IAAM,IAAMi+B,GAAY/9B,WAAW,IAC7C,MAAMg+B,GChRO,WACb,MAAO,CAAEC,IAAY/iC,EAAAA,EAAAA,YACrB,OAAOuB,EAAAA,EAAAA,cAAaiD,IAClBu+B,GAAS,KACP,MAAMv+B,CAAC,GACP,GACD,GACL,CDyQ2Bw+B,GAEnBC,IAAiB1hC,EAAAA,EAAAA,cAAYyV,UAAY,UAC7C,MAAM,gBACJsM,EAAe,SACftK,EAAQ,YACRjM,EAAW,mBACXkM,EAAkB,wBAClB8N,EAAuB,aACvBwa,EAAY,gBACZC,GACEjnB,EACJ,IAAK5a,IAAiBsZ,EAAoB,OAE1C,MAAMiqB,EDhRH,SACLj0B,EACA8X,EACAwa,GAEA,MAAMnwB,EAA0B,CAC9BhB,KAAM,CAAC,EACPS,OAAQ,CAAEqsB,OAAQ,GAAIC,MAAO,GAAIE,OAAQ,GAAIC,QAAS,GAAIF,MAAO,KAE7Dx+B,EAAO,IAAIwQ,IAEjB,IAAK,MAAMmD,KAAOtD,EAAM,CACtB,MAAMk0B,EAAcrY,GAAAA,GAAAA,cAClBvY,EAAI0X,YACJ1X,EAAI4T,OACJlR,KAAK9B,IAAI8B,KAAK/B,IAAI6T,EAAsC,EAAbxU,EAAI4T,QAAa5T,EAAIyX,QAG5D7nB,EAA0B,CAC9BsP,GAAIc,EAAId,GACRC,IAAKa,EAAIkQ,OACT5R,OAAQ,OAAF,QACJ,CAAC0B,EAAIkQ,QAAS,EACd,CAAClQ,EAAI0X,aAAc1X,EAAI0X,YAAYmZ,SAAS,KACxCD,EAAc,IACdA,GACD7/B,OAAO4N,YACRqB,EAAI2X,SAASrrB,KAAKwkC,GAAY,CAC5BA,EAAQ3jC,IACR2jC,EAAQ3jC,IAAI0jC,SAAS,KACjBC,EAAQC,cAAgB,IACxBD,EAAQC,2BAKbnhC,EAAK0O,OAAO,IACnBO,EAAOP,OAAO0B,EAAI+P,SAAShN,KAAKnT,GAChCmB,OAAO1E,KAAKuD,EAAK0O,QAAQnB,SAASuD,GAAMrU,EAAK4Q,IAAIyD,IACnD,CAEA,GADA7B,EAAOhB,MAAOkB,EAAAA,GAAAA,GAAa,IAAI1S,IAAQE,GAAM,IACzCyiC,EACF,IAAK,MAAMr6B,KAAS5D,OAAOuN,OAAOO,EAAOP,QACvC3J,EAAMoO,KAAK,CAAE7D,GAAI,GAAIZ,OAAQ,CAAC,IAClC,OAAOO,CACT,CCmOkBmyB,CACZrB,GACAnb,EACAwa,GAGIK,GAAW4B,EAAAA,EAAAA,GACfvgC,EACAtD,EACAonB,EACA,IAEF,IAAK6a,EAAU,OACf,MAAM6B,EAEL,OAFe,GAAGC,EAAAA,GAAAA,IAAc9B,EAASA,SAAU3hC,EAAQN,GAC1DA,SACD,EAFkB,EAEhBoL,OAAO5I,KAAM,GAChB,IAAKshC,EAAY,OACjBngC,OAAOqgC,OAAOF,GAAYG,EAAAA,GAAAA,IAAU,CAACH,EAAY5D,MACjD,MAAMgE,GAAoC9N,EAAAA,GAAAA,IACtB,OADkC,EACpD0N,EAAWnmC,SAAO,EAAI,CAAC,EACvB2b,GAEF,IAAK4qB,EAAmC,OACxC,MAAMC,EAAaD,EACbE,EAAqDzgC,OAAOC,QAChEwJ,GAEC2W,SAAQ,EAAE+a,EAASM,KAClBA,EACGtwB,QAAQuwB,IAAaA,EAAQz3B,WAC7B1I,KAAKmgC,IAAY,QAChB,MAAMgF,GAAsBjO,EAAAA,GAAAA,IACR,OADoB,EACtC0N,EAAWnmC,SAAO,EAAI,CAAC,EACvB4Q,KAAKgxB,MAAMT,IAMb,MAAO,CAAEv3B,MAAO88B,EAAYjxB,QAHA,OAAX,OAAf,EAAAixB,EAAWv+B,WAAI,EAAf,EAAiBmmB,MACboT,EAAQ93B,MAAQ,IAChB83B,EAAQ93B,MACgC,MAGnDuH,QAAQwE,GAAMA,EAAE/L,OAAS+L,EAAEF,SAAWnH,MAEzCw0B,OAAa1hC,GAEb,MAAMwX,EAAY,IAAIS,SAAe4B,GAAOsqB,GAAY/9B,QAAUyT,IAE5D0rB,EAAmB,IACpBF,EAAYllC,KAAKoU,GAAMA,EAAE/L,QAC5B28B,GAEI9wB,EAAU,IAAIgxB,EAAYllC,KAAKoU,GAAMA,EAAEF,WAAWnH,KAClDs4B,EACJlrB,IAAY+c,EAAAA,GAAAA,IAA+B,OAAnB,EAAC0N,EAAWnmC,SAAO,EAAI,CAAC,EAAG0b,GACjDkrB,IACFD,EAAiB3uB,KAAK4uB,GACtBnxB,EAAQuC,MAAM1J,MAGhB,MAAM+B,GAAQkM,EAAAA,GAAAA,IACZoqB,EACAR,GACA,EAAGxzB,MAAOmG,MAAe,QAANA,IAEf0f,EAAeoO,EAAkBv2B,EAAM4H,WAAQ7W,EAG/CsZ,EAA2B,CAC/B/I,KAAMi0B,EACNjqB,mBAJ6BtL,EAAM4H,MAKnCxD,UAAWuR,EACXpK,YAAavL,EAAM9O,KAAI,CAACqI,EAAOnI,KAAM,CAAGmI,QAAOgM,IAAKH,EAAQhU,OAE5D6Z,KAAM4oB,EACNxoB,SAAU8c,GAEN7d,EAAoC,CACxC8B,OAAQ,EACRC,OAAQ,EACRC,QAAS,EACTvB,MAAO,EACPkP,UAAWa,YAAYC,OAEnByb,EAAoBC,aACxB,IAAM3D,EAAe,OAAD,QAAGp1B,KAAM,UAAa4M,KAC1C,KAGIosB,EAAoB,IAAI5vB,MAC9B,IACE,MAAM6vB,EAAS,IAAIvsB,GAASC,EAASC,EAAQipB,GAC7ChrB,EAAUsB,MAAK,IAAM8sB,EAAOruB,OAAOouB,KAEnC,MAAME,QAAgBD,EAAOE,QAK7B,GAJAF,EAAOruB,SAEP4sB,GAAY/9B,QAAU,OAElBo/B,EAAiB,SACnB,MAAMO,E5BmIP,SAAmBC,GACxB,IAAIvL,EAAQ,IAGRv6B,EAAO,IAAIwQ,IACbs1B,EAAMhhB,SAASzQ,GACb3P,OAAOuN,OAAOoC,GAAGpU,KAAKsS,GAAM8D,KAAKuT,MAAMrX,EAAE4jB,KAAQoE,QAGrD,KAAOv6B,EAAKoF,KANC,MAOXm1B,GARuB,EASvBv6B,EAAO,IAAIwQ,IAAI,IAAIxQ,GAAMC,KAAKa,GAAQuV,KAAKuT,MAAM9oB,EAT1B,MAWzB,MAAM0R,EAAmB,CAAC,EAC1B,IAAK,MAAM2jB,KAAQ2P,EACjB,IAAK,MAAMlP,KAASlyB,OAAOuN,OAAOkkB,GAAO,CACvC,MAAM9hB,EAAIgC,KAAKuT,MAAMgN,EAAMT,KAAQoE,GAASA,IACvC/nB,EAAO6B,IAAM7B,EAAO6B,GAAI/L,MAAQsuB,EAAMtuB,SAAOkK,EAAO6B,GAAKuiB,EAChE,CACF,OAAOpkB,CACT,C4BvJyBuzB,CAAUJ,EAAQ1lC,KAAKoU,GAAMA,EAAEwxB,YAChD,IAAItiC,EAAOmB,OAAOuN,OAAO4zB,GACK,OAAX,OAAf,EAAAX,EAAWr+B,WAAI,EAAf,EAAiBmmB,QACnBzpB,EAAOA,EAAKtD,KAAI,EAAGqI,QAAO6tB,OAAM1C,kBAAkB,CAChDnrB,MAAe,IAARA,EACP6tB,OACA1C,mBAE+B,OAAX,OAApB,EAAA6R,EAAgBz+B,WAAI,EAApB,EAAsBmmB,QACxBzpB,EAAOA,EAAKtD,KAAI,EAAGqI,QAAO6tB,OAAM1C,kBAAkB,CAChDnrB,QACA6tB,KAAoB,KAAT,MAAJA,EAAAA,EAAQ,GACf1C,mBAEJ+N,EAAa,CACX3J,UAAWqN,EACXtN,SAAU0N,EACV/hC,QAEJ,CACA,MAAM6xB,E5ByGL,SAAqBA,EAAmB4Q,GAC7C,OAAO5Q,EACJtQ,SAASzQ,GAAMA,IACfkH,MAAK,CAAC1G,EAAG2G,IAAMA,EAAElT,MAAQuM,EAAEvM,QAC3Bg1B,MAAM,EAAG0I,EACd,C4B9GqBC,CACbN,EAAQ1lC,KAAKoU,GAAMA,EAAE+gB,SACrBwN,GAEEsD,EAGJlU,GAAoB,CAClBoD,OAAQA,EAAOn1B,KAAK22B,GAAUA,EAAMnD,cACpCsP,UAAWoD,KAAKrc,QAGlB7jB,YAAW,KAEL0/B,GAAWhE,EAAgBz7B,UAC7Bk7B,GAAMgF,OACDxC,GAAW19B,SACdD,YAAW,IAAM+pB,OAAOqW,MAAMhkC,EAAC,UAAC,qBAAkB,GACtD,GACC,IAqBL,CApBE,MAAOuD,GAEHA,IAAM6/B,IACRjP,QAAQC,IAAI,yBACZD,QAAQC,IAAI7wB,GACRA,aAAaiQ,OAAOquB,GAAiBt+B,IAG3Cq+B,GAAY/9B,UACZmT,EAAO8B,OAAS,EAChB9B,EAAO+B,OAAS,EAChB/B,EAAOgC,QAAU,EACjBhC,EAAOS,MAAQ,CACjB,CAAE,QACAwsB,cAAcf,GACd1D,EAAe,OAAD,QACZp1B,KAAM,YACH4M,EAAM,CACT4P,WAAYY,YAAYC,QAE5B,IACC,CACDnO,EACA5a,EACAuiC,GACAj/B,EACAhD,EACAmgC,EACAc,EACAtQ,GACA3vB,EACA6hC,KAGIhb,GAAoC,OAAvB,EAAiB,MAAdtoB,QAAc,EAAdA,GAAgBwB,MAAI,EAAI,iBAExCwyB,IAAcjyB,EAAAA,EAAAA,cACjByX,IACC2B,EAAqB,CAAE3B,aACvBonB,OAAa1hC,EAAU,GAEzB,CAACic,EAAsBylB,IAEnBhd,IAA0ChgB,EAAAA,EAAAA,UAAQ,IAC/CjB,IAAQy/B,IAAY,CAAEz/B,QAAMy/B,cAClC,CAACz/B,GAAMy/B,KAEJuD,IACJ,QAACjP,GAAA,EAA0B,CACzBjd,mBAAoBA,EACpBkd,UAAYprB,GACV4P,EAAqB,CAAE1B,mBAAoBlO,IAE7CxD,WAAYygB,IAIVod,IAAqB7jC,EAAAA,EAAAA,cACxBq9B,IACC,QAAC,KAAK,CAAC39B,EAAGA,EAAG2L,QAAQ,kBAAkB4F,MAAOosB,EAAQ,EAAE,UAAC,UAC/C,CAAEpsB,MAAOosB,EAAQ,OAG7B,CAAC39B,IAEGokC,IAAoB9jC,EAAAA,EAAAA,cAAaq9B,GAAmB,IAAGA,EAAQ,KAAK,IAC1E,OACE,QAACl8B,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAASla,IAAK,EAAE,UAC/Cu4B,IACC,QAAC50B,GAAA,EAAK,CAACC,SAAS,UAAUlK,QAAQ,SAAQ,UACxC,QAAC,KAAK,CAACxB,EAAGA,EAAG2L,QAAQ,UAAS,UAAC,sFAEZ,KACjB,QAAC04B,GAAA,EAAI,CAACl/B,UAAWm/B,EAAAA,GAAYtE,GAAG,aAAY,SAAC,cAErC,IAAI,0BAMjB7d,KACC,QAAChhB,EAAA,WAAoB,CAAC8E,MAAOkc,GAAY,WACvC,QAAC1Y,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,WAEzB,QAAC8M,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJgX,GAAI,EACJpV,GAAI,EACJ1O,QAAQ,OACR2lB,cAAc,SACdla,IAAK,EAAE,WAGP,QAACrG,EAAA,EAAG,WACF,QAAC8iC,GAAA,EAAa,CACZ7lC,aAAcA,EACd0hC,gBAAiBA,OAGrB,QAACja,GAAc,QAIjB,QAAC1c,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJgX,GAAI,EACJpV,GAAI,EACJ1O,QAAQ,OACR2lB,cAAc,SACdla,IAAK,EAAE,WAGP,QAACnF,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,CAAC/C,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,GAAI,WAC3C,QAACvD,EAAA,EAAU,CACTvG,GAAI,CAAEqoB,WAAY,QAAS,SAC3BrmB,EAAC,UAAC,mBACJ,QAACgD,EAAA,EAAO,CAACxF,MAAM,OAAM,SAAE6jC,GAAW74B,SAEpC,QAACvF,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,WACV,QAACyjC,GAAA,EAAmB,CAClBhE,SAAUA,EACVC,UAAWA,GACXgE,OAASjE,GAAa9mB,EAAqB,CAAE8mB,aAC7CkE,QAAUjE,GAAc/mB,EAAqB,CAAE+mB,cAC/CkE,QAAS,CAACnE,EAAUC,IAClB/mB,EAAqB,CAAE8mB,WAAUC,cAEnCn6B,SAAUygB,UAMhB,QAACpkB,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,WACV,QAACwD,EAAA,EAAU,CACTvG,GAAI,CAAEqoB,WAAY,QAAS,SAC3BrmB,EAAC,UAAC,wBAEN,QAACiD,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,WACV,QAACU,EAAA,EAAG,CAACpF,QAAQ,OAAO0L,WAAW,SAASD,IAAK,EAAE,WAC7C,QAAC+d,GAAqB,CACpBC,wBAAyBA,EACzBC,2BACED,GACGpM,EAAqB,CAAEoM,4BAC5Bxf,SAAUygB,KAEZ,QAACpI,GAAA,EAAW,CACV/d,OACE,QAACa,EAAA,EAAG,YACF,QAAC8C,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAExB,EAAC,UAAC,sCAC5B,QAACuE,EAAA,EAAU,UAAEvE,EAAC,UAAC,+CAOzB,QAACs7B,GAAqB,CACpBh1B,SAAUygB,EACVwU,iBAAkBA,YAMxB,QAAC9xB,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJgX,GAAI,EACJpV,GAAI,EACJ1O,QAAQ,OACR2lB,cAAc,SACdla,IAAK,EAAE,WAEP,QAACoa,GAAiB,CAAC5b,SAAUygB,KAG7B,QAACwS,GAAU,CACTjzB,SAAUygB,EACVyS,cAAeA,GAAchxB,MAG/B,QAAC/I,EAAA,EAAM,CACLmK,WAAS,EACTjK,UACE2gC,GAAe,QAAC11B,GAAA,EAAQ,KAAM,QAACC,GAAA,EAAoB,IAErDrN,MAAO8iC,EAAe,UAAY,YAClC5gC,QAAS,IACPga,EAAqB,CAAE4mB,cAAeA,IAExCh6B,SAAUygB,EAAiB,SAE1B/mB,EAAC,UAAC,oBAIL,QAAC4Z,GAAS,CACRtT,SAAUygB,EACVlN,eAAgBA,GAAerR,MAIjC,QAACi2B,GAAc,CAACn4B,SAAUygB,UAI7B+Z,IAAQoD,IACT,QAACn+B,GAAA,EAAW,YACR+6B,IAAQoD,IACV,QAACle,GAAA,EAAc,CACb1f,SAAUygB,IAAqBroB,EAC/BkC,OACE,QAAC,KAAK,CAACZ,EAAGA,EAAG2L,QAAQ,QAAQ4F,MAAOgvB,EAAgB,UACjD,CAAEhvB,MAAOgvB,GAAkB,aAE/B,WAED,QAACra,GAAA,EAAQ,WACP,QAAC3hB,EAAA,EAAU,CAAC/C,QAAQ,UAAUhE,MAAM,YAAW,SAC5CwC,EAAE,0BAGP,QAACiD,EAAA,EAAO,IACP2hC,GAAAA,EAAAA,KAAyB10B,IACxB,QAACgW,GAAA,EAAQ,CAEPxmB,QAAS,IAAMga,EAAqB,CAAE6mB,gBAAiBrwB,IAAK,UAE5D,QAAC,KAAK,CAAClQ,EAAGA,EAAG2L,QAAQ,QAAQ4F,MAAOrB,EAAE,UACnC,CAAEqB,MAAOrB,GAAI,cAJXA,SASX,QAAC8V,GAAA,EAAc,CACb1f,SAAUygB,IAAqBroB,EAC/BV,GAAI,CAAE4hB,aAAc,mBACpBhf,OACE,QAAC,KAAK,CAACZ,EAAGA,EAAG2L,QAAQ,SAAS4F,MAAO0uB,EAAW,UAC7C,CAAE1uB,MAAO0uB,GAAa,cAE1B,WAED,QAAC/Z,GAAA,EAAQ,WACP,QAAC3hB,EAAA,EAAU,CAAC/C,QAAQ,UAAUhE,MAAM,YAAW,SAC5CwC,EAAE,2BAGP,QAACiD,EAAA,EAAO,KACPqQ,EAAAA,GAAAA,IAAM,EAAGssB,GAAAA,GACPrrB,UACA3W,KAAKsS,IACJ,QAACgW,GAAA,EAAQ,CAASxmB,QAAS,IAAMwgC,EAAchwB,GAAG,UAChD,QAAC,KAAK,CAAClQ,EAAGA,EAAG2L,QAAQ,SAAS4F,MAAOrB,EAAE,UACpC,CAAEqB,MAAOrB,GAAI,eAFHA,SAOrB,QAAC2X,GAAA,EAAgB,CAACC,UAAU,MAAMlnB,MAAOZ,EAAC,UAAC,kBAAe,UACxD,QAACP,EAAA,EAAM,CACLzB,GAAI,CAAE4hB,aAAc,GACpBpiB,MAAM,UACNkC,QAAS,IAAM2/B,GAAiB5xB,IAAOA,IAAG,SAEzC2xB,GACC,QAACyF,GAAA,EAAuB,KAExB,QAACC,GAAA,EAAoB,SAI3B,QAACjd,GAAA,EAAgB,CACfC,UAAU,MACVlnB,MAAQoX,EAA8C,GAAzBhY,EAAE,qBAA0B,UAEzD,0BACE,QAACP,EAAA,EAAM,CACL6G,UACG5H,IACAsZ,IACA6oB,IACDA,GAAuBp+B,QAEzBjF,MAAOupB,EAAmB,QAAU,UACpCrnB,QACEqnB,EACI,IAAM6a,GAAY/9B,UAClBm+B,GAENriC,UAAWonB,GAAmB,QAACge,GAAA,EAAK,KAAM,QAACC,EAAA,EAAU,IACrDhnC,GAAI,CAAE4hB,aAAc,mBAAoB,SAGpC5f,EADH+mB,EACK,wBACA,4CAKXroB,IACD,QAACgoB,GAAU,CACH1P,OAAQuoB,EAAa1Y,iBAAe0Z,qBAG9C,QAAC9+B,EAAA,EAAG,WACF,QAAC6wB,GAAS,CACRhsB,SAAUygB,IAAqB/O,EAC/BD,SAAUA,EACVwa,YAAaA,GACbC,aAAcxa,OAGlB,QAACrV,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,YACV,QAACU,EAAA,EAAG,CAACpF,QAAQ,OAAO0L,WAAW,SAASD,IAAK,EAAGnG,GAAI,EAAE,WACpD,QAAC4C,EAAA,EAAU,CAACvG,GAAI,CAAE6I,SAAU,GAAI,SAC7BksB,IACC,0BAAM,UACI,KACR,2BACGA,GAAOnlB,QAAUklB,EAAcA,EAAYllB,OAAS,KAC7C,IAAI,uBACOiZ,GAAc,IAAE,MAClC6Z,KACD,0BAAM,sBACgB,KACpB,2BACG,IAAIoD,KAAKpD,IAAWxZ,0BAM7B,yBAAM,8CAGV,QAACznB,EAAA,EAAM,CACL6G,UAAWysB,GAAOnlB,OAClBpQ,MAAM,QACNkC,QAAS,KACPy2B,OAAe14B,GACfkyB,GAAoB,CAAEoD,OAAQ,GAAI2N,UAAW,GAAI,EACjD,SACH,qBAIH,QAACj3B,GAAA,GAAI,CAACC,WAAS,EAACrN,QAAQ,OAAOM,QAAS,EAAE,WACxC,QAAC8M,GAAA,GAAI,CAACE,MAAI,YACR,QAAC,KAAa,CAAC5G,KAAK,aAEtB,QAAC0G,GAAA,GAAI,CAACE,MAAI,YACR,QAAC,KAAc,CAAC5G,KAAK,aAEvB,QAAC0G,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,KACrB,QAAC4C,GAAA,GAAI,CAACE,MAAI,YACR,QAACkV,GAAA,EAAsB,CACrBC,WAAS,EACT7Y,MAAOi5B,EACPh7B,SAAU,CAAC2Z,EAAI3N,IAAM7I,EAAkB,CAAE63B,YAAahvB,IACtDnN,KAAK,QAAO,WAEZ,QAACmc,GAAA,EAAY,CAACjZ,OAAO,EAAOK,UAAW44B,EAAY,SAAC,qBAGpD,QAAChgB,GAAA,EAAY,CAACjZ,OAAO,EAAMK,SAAU44B,EAAY,SAAC,uCAS5D,QAACpxB,GAA0Bm3B,SAAQ,CAACh/B,MAAO+R,EAAmB,UAC3D8a,IACC,QAACoS,GAAS,CACRnS,OAAQD,EACRp0B,aAAcA,EACdwC,KAAMA,GACNg+B,YAAaA,EACb54B,WAAYygB,EACZoe,SAAUhB,GACViB,UAAWjP,KAGf,QAAC+O,GAAS,CACRnS,OAAQA,GACRr0B,aAAcA,EACdwC,KAAMA,GACNg+B,YAAaA,EACb54B,WAAYygB,EACZoe,SAAUf,aAOxB,CAEA,SAASc,IAAU,OACjBnS,EAAM,UACNqS,EAAS,aACT1mC,EAAY,KACZwC,EAAI,YACJg+B,EAAW,SACX54B,EAAQ,SACR6+B,IAUA,MAAME,GAAc/kC,EAAAA,EAAAA,cACjBq9B,IACC,GAAIyH,EAAW,CACb,MAAME,EAAU,IAAIvS,GACpBuS,EAAQlsB,OAAOukB,EAAO,GACtByH,EAAUE,EACZ,IAEF,CAACvS,EAAQqS,IA0CX,OAvCajjC,EAAAA,EAAAA,UACX,KACE,QAAC,EAAA/C,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAQ,SAEhE,MAANw2B,OAAM,EAANA,EAAQn1B,KACP,CAAC22B,EAAOoJ,IACNj/B,GACAwC,IACE,QAACqkC,GAAkB,CAEjB7mC,aAAcA,EACd61B,MAAOA,EACP3nB,QAAS1L,EAAK,UAEd,QAACskC,GAAgB,CACf7H,MAAOA,EACPz1B,MAAOi9B,EAASxH,GAChBpJ,MAAOA,EACP2K,YAAaA,EACb54B,SAAUA,EACV++B,YAAaD,EAAYC,OAAc5nC,KAXpCkgC,EAAQpJ,EAAMkR,aAkB/B,CACE1S,EACAr0B,EACAwC,EACAg+B,EACA54B,EACA6+B,EACAE,EACAD,GAIN,CACA,SAASI,IAAiB,MACxB7H,EAAK,MACLz1B,EAAK,MACLqsB,EAAK,YACL2K,EAAW,SACX54B,EAAQ,YACR++B,IASA,MAAM,EAAErlC,IAAM1B,EAAAA,EAAAA,IAAe,2BACvB4qB,GAAWwc,EAAAA,EAAAA,MACXC,GAAWC,EAAAA,EAAAA,MACXC,GAAOvlC,EAAAA,EAAAA,cAAY,KACvB,MAAMwlC,EAAQ5c,EAAS6c,SAAS9D,MAAM,KACtC6D,EAAMxxB,MACNqxB,EAAU,GAAEG,EAAML,KAAK,mBAAoB,CAAE3nB,MAAO,CAAEyW,UAAU,GAC/D,CAACoR,EAAUpR,EAAOrL,EAAS6c,WAE9B,OACE,QAAC5Y,GAAgB,CACfjlB,MAAOA,EACPklB,aAAc8R,EACd54B,SAAUA,EACVgnB,kBACE,yBACE,QAAC7tB,EAAA,EAAM,CACLjC,MAAM,OACNuF,KAAK,QACLpD,WAAW,QAACqmC,EAAA,EAAO,IACnBtmC,QAASmmC,EAAK,SAEb7lC,EAAE,uBAEJqlC,IACC,QAAC5lC,EAAA,EAAM,CACLjC,MAAM,QACNuF,KAAK,QACLpD,WAAW,QAAC6+B,GAAA,EAAa,IACzB9+B,QAAS,IAAM2lC,EAAY1H,GAAO,SAEjC39B,EAAE,2BAOjB,CAQA,SAASulC,IAAmB,SAAEpoC,EAAQ,aAAEuB,EAAY,MAAE61B,EAAK,QAAE3nB,IAC3D,MAAM,SAAE5K,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAE9BqX,cAAc,wBAAEwM,IACdzM,GAAgB3a,IAEbunC,EAAOC,IAAY7rB,EAAAA,GAAAA,MAC1B1W,EAAAA,EAAAA,YACE,IAAM3B,EAASgM,KAAKsP,WAAW9M,GAAO+jB,EAAM/nB,SAASgE,IAAO01B,OAC5D,CAAClkC,EAAUuyB,EAAO2R,IAEpB,MAAMC,GAAahkC,EAAAA,EAAAA,UACjB,IACE8jC,GACC1R,EACE32B,KAAKE,GAAMkE,EAASgM,KAAKvG,IAAI3J,KAC7B0P,QAAQgF,GAAMA,KACnB,CAACyzB,EAAO1R,EAAOvyB,IAEX2+B,GAAWC,EAAAA,EAAAA,GACfliC,EACAonB,EACAqgB,GAEIC,GAAgBjkC,EAAAA,EAAAA,UAAQ,KAC5B,MAAMkkC,EAAc,MAAR1F,OAAQ,EAARA,EAAWjiC,GACvB,GAAK2nC,EACL,MAAO,CAAEnlC,KAAMmlC,EAAIv8B,OAAQ62B,WAAU/zB,UAAS,GAC7C,CAAC+zB,EAAU/zB,EAASlO,IACvB,OAAK0nC,GAEH,QAACjlC,EAAA,WAAoB,CAAC8E,MAAOmgC,EAAc,SACxCjpC,IAHsB,IAM7B,C,w4DEl7BMmpC,GAAY,CAChBC,OAAM,GACNC,UAAS,GACTC,KAAI,GACJC,MAAK,GACLC,YAAW,GACXC,QAAO,GACPC,OAAM,GACNC,QAAO,GACPC,QAAO,GACPC,SAAQ,GACRC,OAAM,GACNC,KAAI,GACJC,MAAK,GACLC,MAAK,GACLC,MAAK,GACLC,KAAI,GACJC,KAAI,GACJC,QAAO,GACPC,OAAM,GACNC,MAAK,GACLC,MAAK,GACLC,MAAK,GACLC,KAAI,GACJC,gBAAe,GACfC,MAAK,GACLC,cAAa,GACbC,cAAa,GACbC,OAAM,GACNC,KAAI,GACJC,UAAS,GACTC,YAAW,GACXC,MAAK,GACLC,KAAI,GACJC,KAAI,GACJC,KAAI,GACJC,OAAM,GACNC,MAAK,GACLC,UAAS,GACTC,OAAM,GACNC,KAAI,GACJC,aAAY,GACZC,MAAK,GACLC,QAAO,GACPC,kBAAiB,GACjBC,KAAI,GACJC,OAAM,GACNC,gBAAe,GACfC,QAAO,GACPC,UAAS,GACTC,MAAK,GACLC,SAAQ,GACRC,U,2BACAC,U,2BACAC,MAAK,GACLC,SAAQ,GACRC,UAAS,GACTC,KAAI,GACJC,QAAO,GACPC,OAAM,GACNC,QAAO,GACPC,OAAM,GACNC,OAAM,GACNC,MAAK,GACLC,QAAO,GACPC,OAAM,GACNC,QAAOA,IAGF,SAASC,GAASC,EAAuB1rC,GAA2B,QACzE,OAAQ0rC,GACN,IAAK,gBACL,IAAK,iBACL,IAAK,kBACL,IAAK,cACH,OAAqC,OAArC,EAAOpE,GAAW,WAAUtnC,MAAS,EAAI,GAC3C,QACE,OAAyB,OAAzB,EAAOsnC,GAAUoE,IAAQ,EAAI,GAEnC,C,2LCjIe,SAASC,IAAmB,MACzCC,EAAK,SACLxf,IAKA,MAAM,EAAEprB,IAAM1B,EAAAA,EAAAA,IAAe,mBACtBgB,EAAMurC,EAAQtrC,IAAU2a,EAAAA,EAAAA,IAAa,GAE5C,OACE,yBACE,QAAC3Z,GAAA,EAAY,CACXC,KAAMlB,EACNmB,QAASlB,EACTif,eAAgB,CAAEC,SAAU,MAAO,UAEnC,QAACqsB,GAAc,CAACF,MAAOA,EAAOxf,SAAUA,EAAU7rB,OAAQA,OAE5D,QAAC,KAAO,CACNqB,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,uBACtB8nB,UAAU,MACVyH,OAAK,YAEL,QAAC9vB,EAAA,EAAM,CAACjC,MAAM,OAAOuF,KAAK,QAAQrD,QAASmrC,EAAO,UAChD,QAACE,GAAA,EAAU,UAKrB,CACA,SAASD,IAAe,MACtBF,EAAK,SACLxf,EAAQ,OACR7rB,IAMA,MAAM,SAAEyC,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAE9BzD,WAAaC,IAAKC,EAAY,kBAAE4d,KAC9B3d,EAAAA,EAAAA,YAAWC,EAAAA,IAEb0a,cAAc,wBAAEwM,IACdzM,GAAgB3a,IACZwC,KAAM0L,IAAYjO,EAAAA,EAAAA,YAAWwC,EAAAA,GAC/BozB,GAAQpyB,EAAAA,EAAAA,UAAQ,KACpB,MAAM6oC,EAAShpC,EAASgM,KAAKvG,IAAS,MAALmjC,EAAAA,EAAS,IACpCK,GAASl7B,EAAAA,GAAAA,IAAUuM,GAAmB,CAAC9L,EAAID,IAC/CA,KAAe,MAANy6B,OAAM,EAANA,EAAQ3pB,SAAU2pB,EAAShpC,EAASgM,KAAKvG,IAAI+I,KAExD,OAAOnO,OAAOuN,OAAOq7B,GAAQz9B,QAAQgF,GAAMA,GAAE,GAC5C,CAACxQ,EAAUsa,EAAmBsuB,IAC3BjK,GAAWC,EAAAA,EAAAA,GACfliC,EACAonB,EACAyO,EACAnJ,EAAWppB,EAAS+rB,QAAQtmB,IAAI2jB,QAAY3tB,GAExCytC,GAAoB/oC,EAAAA,EAAAA,UACxB,IACEw+B,GAAY,CAAEz/B,KAAMy/B,EAASjiC,GAAeoL,OAAQ62B,WAAU/zB,YAChE,CAAClO,EAAciiC,EAAU/zB,IAE3B,OACE,QAAC,EAAAxN,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAQ,SAEtE2uC,IACC,QAAC/pC,EAAA,WAAoB,CAAC8E,MAAOilC,EAAkB,UAC7C,QAAC/d,GAAgB,CACfC,cAAc,EACdE,kBACE,yBACE,QAAC,KAAa,CAACvqB,KAAK,WACpB,QAAC,KAAc,CAACA,KAAK,aAGzBsqB,mBACE,QAAC5tB,EAAA,EAAM,CAACsD,KAAK,QAAQvF,MAAM,QAAQkC,QAASH,EAAO,UACjD,QAACwlC,GAAA,EAAK,WAQtB,C,eCxEA,MAAM3K,GAAe,CAAEjxB,GAAI,EAAOgX,GAAI,EAAO/W,GAAI,EAAO2B,GAAI,GAAOqV,GAAI,IACjE8a,IAAwBiQ,EAAAA,EAAAA,OAC5B,IAAM,0CAGO,SAASC,IAAkB,WACxCC,EAAU,QACVhqB,EAAO,KACP/hB,EAAI,QACJmB,IAOA,MAAM,EAAET,IAAM1B,EAAAA,EAAAA,IAAe,mBACvB,SAAE0D,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1Bq4B,GAAeh6B,EAAAA,EAAAA,cAClBkQ,IACC66B,EAAW76B,GACX/P,GAAS,GAEX,CAAC4qC,EAAY5qC,IAET45B,GAAsB/5B,EAAAA,EAAAA,cAC1B,CAACwd,EAAOjd,IAAW,OAAL,UAAWid,EAAUjd,EAAQ,CAAAyqC,SAAU,CAACjqB,MACtD,CAACA,KAGIkZ,EAAcC,IAGjBC,EAAAA,EAAAA,YAAWJ,EAAqB,OAAF,WAC7BK,EAAAA,GAAAA,MAAqB,CACxB4Q,SAAU,CAACjqB,OAGNlH,EAASC,IAAeC,EAAAA,GAAAA,MAC/B1W,EAAAA,EAAAA,YAAU,IACD3B,EAASgM,KAAKsP,UAAUlD,IAC9B,CAACpY,EAAUoY,IAEd,MAAMugB,GAAOC,EAAAA,GAAAA,KAEPC,GAAgB14B,EAAAA,EAAAA,UAAQ,KAAM24B,EAAAA,GAAAA,OAAyB,IACvDC,GAAY54B,EAAAA,EAAAA,UAAQ,KACxB,MAAM64B,GAAazf,EAAAA,GAAAA,GAAegf,EAAcM,GAChD,OACE1gB,GACAnY,EAASgM,KAAK4B,OACXpC,OAAOwtB,GACPp9B,KAAK0T,GAAQA,EAAId,KACjByqB,MAAM,EAAGb,GAAaO,GAAM,GAEhC,CAACxgB,EAASnY,EAAU64B,EAAeN,EAAcI,IAEpD,OACE,QAACp6B,GAAA,EAAY,CACXC,KAAMlB,EACNmB,QAASA,EACT+d,eAAgB,CAAEC,SAAU,MAAO,UAEnC,QAAC/d,EAAA,EAAQ,YACP,QAACK,EAAA,EAAW,CACV/C,GAAI,CACF6P,GAAI,EACJxR,QAAS,OACTiM,eAAgB,gBAChBP,WAAY,UACZ,WAEF,QAACxD,EAAA,EAAU,CAAC/C,QAAQ,KAAI,UACrB6f,GAAU,QAACve,GAAA,EAAO,CAACjD,IAAKipB,GAAAA,EAAAA,KAAYzH,KAAe,KAAM,IACzDrhB,EAAC,UAAC,yBAEL,QAACc,EAAA,EAAW,CAACpB,QAASe,QAExB,QAACwC,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,YACV,QAAC,EAAA3B,SAAQ,CACPC,UACE,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MACtD,UAED,QAAC,GAAqB,CACpBg+B,aAAcA,EACdC,qBAAsBA,EACtBW,YAAaJ,EACbwQ,mBAAiB,OAGrB,QAAC9pC,EAAA,EAAG,CAAC25B,GAAI,EAAE,UACT,QAAC,EAAAh8B,SAAQ,CACPC,UACE,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MACtD,UAED,QAACkN,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAG6O,QAAS,CAAErC,GAAI,EAAGC,GAAI,EAAG2B,GAAI,GAAI,SAC1DgwB,EAAUn9B,KAAK4S,IACd,QAAC/G,GAAA,GAAI,CAACE,MAAI,EAAUR,GAAI,EAAE,UACxB,QAACwlB,GAAA,EAAY,CACXrG,WAAY9X,EACZwe,cAAc,QAAC2b,GAAkB,CAACC,MAAOp6B,IACzC9Q,QAAS46B,KAJG9pB,kBAelC,C,+ECrGA,MAAMg7B,IAAgBvO,EAAAA,GAAAA,GAAkB,IAAIwO,GAAAA,KAE7B,SAASC,IAAgB,WACtCL,EAAU,cACVnuB,EAAa,KACb5d,EAAI,QACJmB,IAOA,MAAM,EAAET,IAAM1B,EAAAA,EAAAA,IAAe,CAC3B,iBACA,cACA,qBAEI,SAAE0D,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB0pC,EAAoBC,IAAyB7sC,EAAAA,EAAAA,WAAS,GACvDu7B,GAAeh6B,EAAAA,EAAAA,cAClBkQ,IACC66B,EAAW76B,GACX/P,GAAS,GAEX,CAAC4qC,EAAY5qC,KAGRorC,EAAcC,IAAmB/sC,EAAAA,EAAAA,UAAS,IAC3CgtC,GAAYzrC,EAAAA,EAAAA,cACf0rC,IACCF,EAAgB9pC,EAAS+rB,QAAQke,KAAIC,EAAAA,GAAAA,IAAcF,IAAY,GAEjE,CAAChqC,EAAU8pC,IAEPK,GAAkB7rC,EAAAA,EAAAA,cAAY,IAAMwrC,EAAgB,KAAK,KAExD3xB,EAASC,IAAeC,EAAAA,GAAAA,MAC/B1W,EAAAA,EAAAA,YACE,IAAM3B,EAAS+rB,QAAQzQ,UAAUlD,IACjC,CAACA,EAAapY,IAGhB,MAAOkjB,EAAQknB,IAAartC,EAAAA,EAAAA,UAAsB,CAAC,EAAG,EAAG,KAClDyb,EAAYC,IAAiB1b,EAAAA,EAAAA,UAAS,IACvC2b,GAAqBH,EAAAA,EAAAA,kBAAiBC,GAEtC6xB,GAAelqC,EAAAA,EAAAA,UACnB,oBAgBiC,OAhBjC,EACGgY,GACCnY,EAAS+rB,QAAQne,OACdpC,QACC+N,EAAAA,GAAAA,GACE,CAAEC,WAAY0B,EAAegI,SAAQnlB,KAAM2a,IAC3C4xB,EAAAA,GAAAA,QAGHpzB,MACCqzB,EAAAA,GAAAA,GACwB,OADZ,EACVC,GAAAA,GAAAA,OAAsB,EAAI,IAC1B,GACAC,EAAAA,GAAAA,QAGH7uC,KAAKytB,GAAWA,EAAO7a,MAAG,EAC/B,EAAE,GACJ,CAAC2J,EAASnY,EAAUkjB,EAAQhI,EAAexC,IAG7C,OACE,QAACna,GAAA,EAAY,CAACC,KAAMlB,EAAMmB,QAASA,EAAQ,UACzC,QAACC,EAAA,EAAQ,YACP,QAAC,EAAAtB,SAAQ,CAACC,UAAU,EAAM,UACxB,QAACqtC,GAAA,QAAoB,CACnBptC,KAAMqsC,EACNpsC,OAAQ,IAAMqsC,GAAsB,GACpCpsC,SAAUusC,EACVY,iBAAkBzvB,OAItB,QAAC,EAAA9d,SAAQ,CAACC,UAAU,EAAM,UACxB,QAACutC,GAAA,QAAY,CACXxhB,SAAUygB,EACVgB,QAAM,EACNpsC,QAAS0rC,OAGb,QAACprC,EAAA,EAAW,CAAC/C,GAAI,CAAE6P,GAAI,GAAI,UACzB,QAACpE,GAAA,GAAI,CAACC,WAAS,aACb,QAACD,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,EAAE,UACrB,QAACtC,EAAA,EAAU,CAAC/C,QAAQ,KAAI,UACrB0b,GACC,QAACpa,GAAA,EAAO,CAACjD,IAAKipB,GAAAA,EAAAA,YAAmB5L,KAC/B,KAAM,IACTld,EAAC,UAAC,6CAGP,QAACyJ,GAAA,GAAI,CAACE,MAAI,YACR,QAAC7I,EAAA,EAAW,CAACpB,QAASe,YAI5B,QAACwC,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,CAAC/C,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WACpE,QAAC2B,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,WACzB,QAAC8M,GAAA,GAAI,CAACE,MAAI,YACR,QAACkV,GAAA,EAAsB,CACrB7gB,GAAI,CAAEzB,OAAQ,QACd0J,MAAOif,EACPniB,KAAK,QAAO,SAEX0oC,GAAAA,GAAAA,KAAmBqB,IAClB,QAAC5tB,GAAA,EAAY,CAEXjZ,MAAO6mC,EACPptC,QAAS,IAAM0sC,EAAUZ,GAActmB,EAAQ4nB,IAAO,UAEtD,QAACrrC,EAAA,EAAG,CAACpF,QAAQ,OAAM,WACjB,2BAASywC,KACT,QAACxnB,GAAA,EAAe,QANbwnB,UAYb,QAACrjC,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,EAAE,UACrB,QAACsY,GAAA,EAAS,CACRC,WAAS,EACTrc,KAAK,QACLkD,MAAOuU,EACPtW,SAAWX,GACTkX,EAAclX,EAAEuG,OAAO7D,OAEzBiC,MAAOlI,EAAE,0BACThC,GAAI,CAAEzB,OAAQ,QACd8iB,WAAY,CACVrhB,GAAI,CAAEzB,OAAQ,iBAKtB,QAACkD,EAAA,EAAM,CACLmK,WAAS,EACTlK,QAAS,IAAMksC,GAAsB,GACrCpuC,MAAM,OACNmC,WAAW,QAAC,KAAG,IAAI,SAElBK,EAAE,4BAEL,QAACyJ,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,SACxB0vC,EAAazuC,KAAKwtB,IACjB,QAAC3hB,GAAA,GAAI,CAACE,MAAI,EAAgBR,GAAI,EAAGgX,GAAI,EAAG/W,GAAI,EAAG2B,GAAI,EAAE,UACnD,QAACgiC,GAAA,EAAU,CACT3hB,SAAUA,EACV1rB,QAAS46B,EACTtL,cAAc,QAAC2b,GAAkB,CAACvf,SAAUA,OAJhCA,cAa9B,C,iCC/JA,MAAMwhB,IAAezB,EAAAA,EAAAA,OAAK,IAAM,0CAEjB,SAAS6B,KAAmB,MACzC,MACExuC,WAAW,eAAEyuC,EAAgBxuC,IAAKC,GAAc,eAChDH,IACEI,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAE+hC,EAAQ,KAAEz/B,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GAChCoqB,EAAoC,OAAzB,EAAGoV,EAASjiC,SAAa,EAAtB,EAAwB6sB,aACrCH,EAAU8hB,IAAenuC,EAAAA,EAAAA,UAAS,IACnCouC,GAAa7sC,EAAAA,EAAAA,cACjB,IAAM4sC,EAAYD,IAClB,CAACA,IAEGG,GAAa9sC,EAAAA,EAAAA,cAAY,IAAM4sC,EAAY,KAAK,KAGtDvpC,EAAAA,EAAAA,YAAU,KACJynB,GAAYA,IAAa6hB,GAAgBC,EAAYD,EAAe,GACvE,CAAC7hB,EAAU6hB,IAEd,MAAM7wC,GAAQysB,EAAAA,GAAAA,KACRwkB,GAAaC,EAAAA,GAAAA,GAAclxC,EAAMmxC,YAAYC,GAAG,OAEhDC,GAAYtrC,EAAAA,EAAAA,UAChB,IACEopB,GACAA,EAAY1J,SAASjU,OAAS,IAC5B,QAACjL,EAAA,EAAS,WACR,QAAClB,EAAA,EAAG,CAAC0T,EAAG,EAAE,UACR,QAAC8M,GAAA,EAAe,CAAC5gB,SAAUkqB,EAAY1J,gBAI/C,CAAC0J,KAEG,SAAEmiB,IAAaC,EAAAA,GAAAA,GAAYjvC,GAC3BkvC,GAAmBrzB,EAAAA,EAAAA,kBAAiBmzB,GACpCG,GAAgB1rC,EAAAA,EAAAA,UACpB,IAAM,IAAIgM,IAAIy/B,IACd,CAACA,IAEH,OACE,QAACnsC,EAAA,EAAG,YACF,QAAC,EAAArC,SAAQ,CAACC,UAAU,EAAM,UACxB,QAAC,GAAY,CACX+rB,SAAUA,EACVyhB,QAAM,EACNpsC,QAAS2sC,EACTpe,cACE,QAAC8e,GAAqB,CACpB5wB,cAAe3e,EAAe2e,qBAKtC,QAACzT,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,UACxB0wC,IACC,QAAC5jC,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJC,GAAI,GACJ2B,GAAI,EACJqV,GAAI,EACJpiB,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,UAExD2lC,GAAaA,GACd,QAACM,GAAmB,QAGxB,QAACtkC,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIC,GAAI,GAAI2B,GAAI,EAAGqV,GAAI,EAAG1W,WAAS,EAAC/M,QAAS,EAAE,WAC5D,QAAC8M,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJgX,GAAI,EACJ/W,GAAI,EACJ/M,QAAQ,OACR2lB,cAAc,SACdla,IAAK,EAAE,UAEP,QAACilC,GAAA,EAAU,CACT3hB,SAAU6hB,EACVe,OAAQb,EACRve,UAAQ,EACRI,cACE,QAACif,GAAgB,CACf/wB,cAAe3e,EAAe2e,oBAKrCiE,GAAAA,GAAAA,KAAyBE,IACxB,QAAC5X,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIgX,GAAI,EAAG/W,GAAI,EAAE,SAC7BlI,EAAKuG,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,OAC/B,QAAC0oB,GAAA,EAAY,CACXrG,WAAYpnB,EAAKuG,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,MAC5CioC,UAAWL,EACX7e,cAAc,QAACmf,GAAkB,CAAC9sB,QAASA,IAC3CwN,YAAa,CAAC,EACdD,UAAQ,KAGV,QAACwf,GAAW,CAAC/sB,QAASA,KAVYA,SAexCgsB,IACA,QAAC5jC,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIC,GAAI,GAAIgX,GAAI,EAAG1W,WAAS,EAAC/M,QAAS,EAAE,UACpD8wC,IACC,QAAChkC,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIC,GAAI,EAAG2B,GAAI,EAAE,SAC7B0iC,KAGL,QAAChkC,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJC,GAAI,EACJ2B,GAAI,EACJ/M,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,UAEzD,QAACimC,GAAmB,cAOlC,CACA,SAASK,IAAY,QAAE/sB,IACrB,MACE7iB,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAEoD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB3C,EAAM2a,EAAQxZ,IAAWyZ,EAAAA,EAAAA,MAC1B,EAAEla,IAAM1B,EAAAA,EAAAA,IAAe,YAC7B,OACE,QAACqE,EAAA,EAAS,CACR3E,GAAI,CACFzB,OAAQ,OACRD,MAAO,OACP+xC,UAAW,IACXhyC,QAAS,OACT2lB,cAAe,UACf,WAEF,QAACjhB,EAAA,EAAW,WACV,QAACwD,EAAA,EAAU,YACT,QAAC6c,GAAA,EAAQ,CAACrY,UAAWC,GAAAA,EAAiBqY,QAASA,IAAY,IAC1DrhB,EAAG,YAAWqhB,WAGnB,QAACpe,EAAA,EAAO,KACR,QAACxB,EAAA,EAAG,CACFzD,GAAI,CACF6I,SAAU,EACVxK,QAAS,OACTiM,eAAgB,SAChBP,WAAY,UACZ,WAEF,QAACqjC,GAAiB,CAChB/pB,QAASA,EACT/hB,KAAMA,EACNmB,QAASA,EACT4qC,WAAa76B,GACXxO,EAASgM,KAAKyC,IAAID,EAAI,CACpB0Y,UAAUzM,EAAAA,EAAAA,IAAoB/d,QAIpC,QAACe,EAAA,EAAM,CAACC,QAASua,EAAQzc,MAAM,OAAOQ,GAAI,CAAE4hB,aAAc,OAAQ,UAChE,QAAC0uB,GAAA,EAAS,CAACtwC,GAAI,CAAEzB,OAAQ,IAAKD,MAAO,cAK/C,CACA,SAAS2xC,IAAiB,cAAE/wB,IAC1B,MAAM,IAAQ5e,EAAAA,EAAAA,IAAe,mBAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAEoD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB3C,EAAM2a,EAAQxZ,IAAWyZ,EAAAA,EAAAA,KAChC,OACE,yBACE,QAAC,KAAO,CACNtZ,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,0BACtB8nB,UAAU,MACVyH,OAAK,YAEL,QAAC9vB,EAAA,EAAM,CAACjC,MAAM,OAAOuF,KAAK,QAAQrD,QAASua,EAAO,UAChD,QAACq0B,GAAA,EAAS,SAGd,QAAC5C,GAAe,CACdxuB,cAAeA,EACfmuB,WAAa76B,GACXxO,EAAS+rB,QAAQtd,IAAID,EAAI,CACvB0Y,UAAUzM,EAAAA,EAAAA,IAAoB/d,KAGlCY,KAAMA,EACNmB,QAASA,MAIjB,CACA,SAASqtC,IAAsB,cAC7B5wB,IAIA,MAAM,IAAQ5e,EAAAA,EAAAA,IAAe,mBAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAEoD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB3C,EAAM2a,EAAQxZ,IAAWyZ,EAAAA,EAAAA,KAChC,OACE,yBACE,QAACza,EAAA,EAAM,CACLjC,MAAM,OACNkC,QAASua,EACTta,WAAW,QAAC2uC,GAAA,EAAS,IAAI,SACzBtuC,EAAC,UAAC,2BACJ,QAAC0rC,GAAe,CACdxuB,cAAeA,EACfmuB,WAAa76B,GACXxO,EAAS+rB,QAAQtd,IAAID,EAAI,CACvB0Y,UAAUzM,EAAAA,EAAAA,IAAoB/d,KAGlCY,KAAMA,EACNmB,QAASA,MAIjB,CACA,SAAS0tC,IAAmB,QAAE9sB,IAC5B,MAAM,IAAQ/iB,EAAAA,EAAAA,IAAe,mBAE3BE,WAAaC,IAAKC,KAChBC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAEoD,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB3C,EAAM2a,EAAQxZ,IAAWyZ,EAAAA,EAAAA,KAChC,OACE,yBACE,QAAC,KAAO,CACNtZ,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,uBACtB8nB,UAAU,MACVyH,OAAK,YAEL,QAAC9vB,EAAA,EAAM,CAACjC,MAAM,OAAOuF,KAAK,QAAQrD,QAASua,EAAO,UAChD,QAACq0B,GAAA,EAAS,SAGd,QAAClD,GAAiB,CAChB/pB,QAASA,EACT/hB,KAAMA,EACNmB,QAASA,EACT4qC,WAAa76B,GACXxO,EAASgM,KAAKyC,IAAID,EAAI,CAAE0Y,UAAUzM,EAAAA,EAAAA,IAAoB/d,SAKhE,CACA,SAASqvC,KACP,MAAM,EAAE/tC,IAAM1B,EAAAA,EAAAA,IAAe,CAAC,iBAAkB,cAC1C,SAAE0D,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,UACJzD,EACAA,WAAaC,IAAKC,EAAY,kBAAE4d,KAC9B3d,EAAAA,EAAAA,YAAWC,EAAAA,IACT,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBotC,GAAcpsC,EAAAA,EAAAA,UAClB,MAAQE,OAAOuN,OAAO0M,GAAmB9O,QAAQ1P,GAAMA,IAAG8P,QAC1D,CAAC0O,IAEGkyB,GAAcluC,EAAAA,EAAAA,cAAY,KACzB9B,GAEFmvB,OAAOC,QACN,uEAIJvrB,OAAOuN,OAAO0M,GAAmB7N,SAASof,GACxC7rB,EAASgM,KAAKyC,IAAIod,EAAK,CAAE3E,SAAU,MACpC,GACA,CAAC1qB,EAAWwD,EAAUsa,IAEnBuI,GAAa1iB,EAAAA,EAAAA,UAAQ,KAAMssC,EAAAA,GAAAA,IAAevtC,IAAO,CAACA,KAClD,SAAEwsC,IAAaC,EAAAA,GAAAA,GAAYjvC,GAC3BgwC,GAAcpuC,EAAAA,EAAAA,cACjBotC,GAAa1rC,EAASka,SAASzL,IAAI/R,EAAc,CAAEgvC,cACpD,CAAC1rC,EAAUtD,KAGNY,EAAMurC,EAAQtrC,IAAU2a,EAAAA,EAAAA,KACzBy0B,GAAmBp0B,EAAAA,EAAAA,kBAAiBmzB,IACpC,QAAEkB,EAAO,SAAEC,IAAa1sC,EAAAA,EAAAA,UAAQ,KACpC,MAAM,kBACJ2sC,EAAiB,mBACjBC,EAAkB,cAClBC,EAAa,eACbC,GACE5sC,OAAOuN,OAAO0M,GAAmB3I,QACnC,CAACnB,EAAG08B,KACF,MAAM59B,EAAMtP,EAASgM,KAAKvG,IAAIynC,GAC9B,GAAI59B,EAAK,CACP,MAAM,kBAAEw9B,EAAiB,cAAEE,GACzBnlB,GAAAA,GAAAA,sBAA+BvY,EAAK,IAAInD,IAAIwgC,KAE5CG,kBAAmBC,EACnBC,cAAeC,GACbplB,GAAAA,GAAAA,sBAA+BvY,EAAK,IAAInD,IAAI2wB,GAAAA,KAChDtsB,EAAEs8B,kBAAoBt8B,EAAEs8B,kBAAoBA,EAC5Ct8B,EAAEw8B,cAAgBx8B,EAAEw8B,cAAgBA,EAEpCx8B,EAAEu8B,mBAAqBv8B,EAAEu8B,mBAAqBA,EAC9Cv8B,EAAEy8B,eAAiBz8B,EAAEy8B,eAAiBA,CACxC,CACA,OAAOz8B,CAAC,GAEV,CACEs8B,kBAAmB,EACnBC,mBAAoB,EACpBC,cAAe,EACfC,eAAgB,IA0BpB,MAAO,CAAEL,QAvBsB,CAC7BO,KAAMnvC,EAAC,UAAC,8BACRiG,MAAS6oC,EAAoBC,GAG3B,2BACE,QAACK,GAAA,EAAY,CAACnpC,MAAO6oC,EAAmB58B,IAAK,KAAMm9B,OAAK,IAAG,KAAG,KAC9D,QAACD,GAAA,EAAY,CAACnpC,MAAO8oC,EAAoB78B,IAAK,KAAMm9B,OAAK,QAJ3D,QAACD,GAAA,EAAY,CAACnpC,MAAO6oC,EAAmB58B,IAAK,KAAMm9B,OAAK,KAoB1CR,SAZc,CAC9BM,KAAMnvC,EAAC,UAAC,8BACRsvC,QAAS,OAASP,EAAqBE,GACvChpC,MAAS+oC,EAAgBC,GAGvB,2BACE,QAACG,GAAA,EAAY,CAACnpC,MAAO+oC,EAAe98B,IAAK,KAAMm9B,OAAK,IAAG,KAAG,KAC1D,QAACD,GAAA,EAAY,CAACnpC,MAAOgpC,EAAgB/8B,IAAK,KAAMm9B,OAAK,QAJvD,QAACD,GAAA,EAAY,CAACnpC,MAAO+oC,EAAe98B,IAAK,KAAMm9B,OAAK,KAQ5B,GAC3B,CAACrvC,EAAG2uC,EAAkBryB,EAAmBta,IAE5C,OACE,QAACW,EAAA,EAAS,WACP4rC,IACC,QAAC9uC,EAAA,EAAM,CACLjC,MAAM,QACNkC,QAAS8uC,EACT5kC,WAAS,EACT5L,GAAI,CAAEuxC,wBAAyB,EAAGC,uBAAwB,GAAI,SAC9DxvC,EAAC,UAAC,4BAEN,QAACyB,EAAA,EAAG,CAAC0T,EAAG,EAAE,UACR,QAAClK,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAAC+D,EAAA,EAAQ,YACP,QAACjB,EAAA,EAAM,CACLmK,WAAS,EACTpM,MAAM,OACNmC,WAAW,QAAC,KAAQ,IACpB3B,GAAI,CAAEwxC,uBAAwB,EAAGD,wBAAyB,GAC1D7vC,QAASmrC,EAAO,SACjB,eAGD,QAACtqC,GAAA,EAAY,CAACC,KAAMlB,EAAMmB,QAASlB,EAAO,UACxC,QAACmB,EAAA,EAAQ,WACP,QAACK,EAAA,EAAW,YACV,QAACwD,EAAA,EAAU,CACTwC,UAAU,SACVkd,cAAY,EACZziB,QAAQ,KAAI,SACZxB,EAAC,UAAC,uCACJ,QAACyvC,GAAA,EAAa,CACZC,aAAchC,EACdxpC,SAAUwqC,YAKlB,QAAC7hC,GAAA,GAAgB,YACf,QAAC,MAAiB,CAAC8iC,MAAOf,EAASzpC,UAAW4H,GAAAA,MACrC,MAAR8hC,GAAiB,MAAjBA,EAAUS,aAAF,EAART,EAAUS,QAAUpuC,MACnB,QAAC,MAAiB,CAACyuC,MAAOd,EAAU1pC,UAAW4H,GAAAA,WAIpD8X,GACCxiB,OAAOC,QAAQuiB,GAAYpC,SAAQ,EAAEjB,EAAQouB,KAC3CA,EAAahyC,KAAK6jB,IAChB,QAAC/gB,EAAA,EAAQ,CAEP1C,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,UAEzD,QAACyZ,GAAgB,CAEfC,OAAQA,EACRC,UAAWA,GAFND,EAASC,IAJXD,EAASC,cAehC,CCnbe,SAASouB,KACtB,MAAMpsC,GAAYC,EAAAA,EAAAA,UACZosC,GAAWxvC,EAAAA,EAAAA,cACf,kBAAe,MAATmD,GAAkB,OAAT,EAATA,EAAWI,UAAuB,MAAlC,EAAoBC,oBAAX,EAAT,EAAoBA,eAAiB,CAAEC,SAAU,UAAW,GAClE,CAACN,IAGH,OACE,QAACwH,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAAC8M,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAGqB,GAAI,CAAEsK,eAAgB,UAAW,WAC3D,QAACmB,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAGgX,GAAI,EAAG/W,GAAI,EAAG2B,GAAI,IAAI,UACtC,QAACglC,GAAoB,OAEvB,QAACtmC,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJgX,GAAI,EACJ/W,GAAI,EACJ2B,GAAI,IACJ/M,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WAEzD,QAACkoC,GAAY,CAACtwC,QAASowC,KACvB,QAACntC,EAAA,EAAS,CAAC3E,GAAI,CAAE6I,SAAU,EAAGsO,EAAG,GAAI,UACnC,QAAC0V,GAAoB,aAI3B,QAACppB,EAAA,EAAG,CAAC0C,IAAKV,EAAU,UAClB,QAACupC,GAAgB,QAIzB,CACA,SAASgD,IAAa,QAAEtwC,IACtB,MACElB,WAAW,eAAEyuC,KACXtuC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GAE5B,OACE,QAACsI,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAG6O,QAAS,CAAErC,GAAI,EAAGgX,GAAI,EAAG/W,GAAI,EAAG2B,GAAI,EAAGqV,GAAI,GAAI,WACzE,QAAC3W,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACgiB,GAAc,CACbC,SAAU6hB,EACVxkB,YAAa9lB,EAAAA,EACbjD,QAASA,MAGZyhB,GAAAA,GAAAA,KAAyBE,IACxB,QAAC5X,GAAA,GAAI,CAACE,MAAI,EAAeR,GAAI,EAAE,UAC7B,QAACkf,GAAgB,CACfC,WAAYpnB,EAAKuG,IAAIC,GAAAA,GAAAA,IAAU2Z,GAAS7Q,IAAIvK,MAC5Cob,QAASA,EACToH,YAAa9lB,EAAAA,EACbjD,QAASA,KALG2hB,OAWxB,CAEA,SAAS0uB,KAAuB,MAC9B,MAAM,SAAE/tC,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,eACJ1D,EACAC,WAAaC,IAAKC,EAAY,KAAEuxC,KAC9BtxC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,OAAEI,IAAWC,EAAAA,EAAAA,MACb,KAAEiC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBkG,GAAoB84B,EAAAA,EAAAA,GAAoBzhC,GACxCinC,GAAWC,EAAAA,EAAAA,MACXx4B,EAAUlM,EAAKuG,IAAIC,GAAAA,GAAAA,SAAezB,MAClCiX,EAAgB3e,EAAe2e,cAC/B6L,EAAQ7nB,EAAKuG,IAAIC,GAAAA,GAAAA,KAAWzB,MAC5B6lB,EAAY5qB,EAAKuG,IAAIC,GAAAA,GAAAA,KAAWzB,MAChCiqC,EAAgBhvC,EAAKuG,IAAIC,GAAAA,GAAAA,eAAqBzB,MAC9CkqC,EAAO,CACXC,KAAMlvC,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,MAAkBzB,MACjCoqC,MAAOnvC,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,OAAmBzB,MACnCqqC,MAAOpvC,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,OAAmBzB,OAE/BsqC,EAAS,CACbH,KAAMlvC,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,WAAuBzB,MACtCoqC,MAAOnvC,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,YAAwBzB,MACxCqqC,MAAOpvC,EAAKuG,IAAIC,GAAAA,GAAAA,MAAAA,YAAwBzB,QAEpC,SAAEkW,IAAawxB,EAAAA,GAAAA,GAAYjvC,GACjC,OACE,QAACiE,EAAA,EAAS,CAAC3E,GAAI,CAAEzB,OAAQ,QAAS,WAChC,QAACkF,EAAA,EAAG,CAACzD,GAAI,CAAEurB,SAAU,YAAa,WAChC,QAAC9nB,EAAA,EAAG,CAACzD,GAAI,CAAEurB,SAAU,WAAYjtB,MAAO,OAAQC,OAAQ,QAAS,WAC/D,QAACgI,EAAA,EAAU,CACT/C,QAAQ,KACRxD,GAAI,CACFurB,SAAU,WACVjtB,MAAO,OACPk0C,KAAM,MACNxmB,OAAQ,EACRxkB,UAAW,wBACXia,QAAS,IACT1Y,UAAW,UACX,UAEF,QAAC,KAAY,CAAC1J,MAAOkB,EAAe2mB,OAAQ5nB,SAAO,OAErD,QAACmE,EAAA,EAAG,CACFzD,GAAI,CACFurB,SAAU,WACVinB,KAAM,MACNxmB,OAAQ,KACRxkB,UAAW,wBACXia,QAAS,IACTnjB,MAAO,OACPD,QAAS,OACTiM,eAAgB,SAChB5B,GAAI,GACJ,UAEF,QAACuB,GAAA,EAAI,CACHzK,MAAO4P,EACPpP,GAAI,CAAEzB,OAAQ,QACd2L,OACE,QAAC3D,EAAA,EAAU,CACT/C,QAAQ,KACRxD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGC,WAAY,UAAW,WAEtD,QAAC,KAAW,CAACe,IAAKsE,KAClB,QAAC3L,EAAA,EAAG,CAACzD,GAAI,CAAEk8B,WAAY,SAAUnzB,UAAW,UAAW,SACpDxI,EAAewB,QAElB,QAAC+C,GAAA,EAAO,CAACjD,IAAuB,OAApB,EAAEipB,GAAAA,EAAAA,kBAAkB,EAAlB,EAAqB5L,aAK3C,QAACzb,EAAA,EAAG,CAACzD,GAAI,CAAEurB,SAAU,WAAYinB,KAAM,EAAGC,IAAK,GAAI,UACjD,QAACnrC,GAAA,EAAU,CACTtH,GAAI,CAAEmX,EAAG,GACT3X,MAAM,QACNkC,QAAS,IACPsC,EAASka,SAASzL,IAAI/R,EAAc,CAAEyd,UAAWA,IAClD,SAEAA,GAAW,QAACu0B,GAAA,EAAQ,KAAM,QAACC,GAAA,EAAc,SAG9C,QAACpsC,EAAA,EAAU,CACTvG,GAAI,CAAEmX,EAAG,EAAGoU,SAAU,WAAYqnB,MAAO,EAAGH,IAAK,EAAGhxB,QAAS,IAAM,UAEnE,QAACzc,EAAA,EAAO,WAAE6tC,EAAAA,GAAAA,IAAe9nB,EAAO+C,WAGpC,QAACrqB,EAAA,EAAG,CACF5B,IAAK4qC,GAAS/rC,EAAcM,GAC5BmG,UAAU,MACV7I,MAAM,OACNC,OAAO,aAGX,QAACkF,EAAA,EAAG,YACF,QAACmnB,GAAA,EAAc,CAAC5qB,GAAI,CAAEmX,EAAG,GAAKzV,QAAS,IAAMimC,EAAS,UAAU,UAC9D,QAACl8B,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAGy+B,IAAK,EAAE,SAC/B,CAAC,OAAQ,QAAS,SAAqCx9B,KACtDkzC,IAAI,aACH,QAACrnC,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAAC4nC,GAAA,EAAK,CACJC,aAAcb,EAAKW,GACnBtzC,MAAO+yC,EAAOO,GAAQ,OAAS,YAC/BG,QAAQ,WACRC,aAAc,CACZC,SAAU,SACVC,WAAY,SAEdpzC,GAAI,CACF1B,MAAO,OACPC,OAAQ,OACR,sBAAuB,CACrBwB,SAAU,SACVqsB,QAAS,aACTxK,aAAc,OACdpjB,WAAY,EACZD,OAAQ,WAEV,UAEF,QAACkF,EAAA,EAAG,CACF0D,UAAU,MACVtF,IAAwC,OAArC,EAAEtB,EAAe8yC,eAAeP,SAAK,EAAnC,EAAqCQ,IAC1Ch1C,MAAM,OACNC,OAAO,YAzBUu0C,EA4BhB,SAKf,QAACvsC,EAAA,EAAU,CAACvG,GAAI,CAAE+I,UAAW,SAAUq0B,GAAI,GAAK55B,QAAQ,KAAI,SACzDjD,EAAegzC,qBAElB,QAAC9nC,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,UACxB2W,EAAAA,GAAAA,IAAM,EAAG,GAAG1V,KAAKE,IAAC,aACjB,QAAC2L,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,EAAE,UACf,QAACyf,GAAA,EAAc,CACblpB,QAAS,IACP2H,EAAkB,CAChB6oC,cAAepyC,IAAMoyC,EAAgBpyC,EAAI,EAAIA,IAEhD,UAED,QAAC2D,EAAA,EAAG,CACF0D,UAAU,MACVtF,IAGG,OAHA,EACDtB,EAAe8yC,eACZ,gBAAevzC,WACjB,EAFD,EAEGwzC,IAELtzC,GAAE,iBACIkyC,GAAiBpyC,EACjB,CAAC,EACD,CAAE0P,OAAQ,oBAEhBlR,MAAM,OACNC,OAAO,YArBUuB,EAwBhB,OAGX,QAAC8qB,GAAA,EAAc,CAAC5qB,GAAI,CAAEmX,EAAG,GAAKzV,QAAS,IAAMimC,EAAS,aAAa,UACjE,QAACl8B,GAAA,GAAI,CAACC,WAAS,EAAC8B,QAAS,EAAG7O,QAAS,EAAE,UACpC2W,EAAAA,GAAAA,IAAM,EAAG,GAAG1V,KAAKE,IAChB,QAAC2L,GAAA,GAAI,CAASE,MAAI,EAACR,GAAI,EAAG5M,OAAO,OAAM,SACpC0zC,EAAKnyC,IACJ,QAACwjB,GAAA,EAAiB,CAAC5iB,aAAcuxC,EAAKnyC,MAEtC,QAAC,KAAsB,CAAC6/B,MAAO7/B,KAJxBA,cAazB,CCvQA,MAAM0zC,GAAgB,CACpBroC,GAAI,GACJgX,GAAI,EACJ/W,GAAI,GAGS,SAASqoC,KACtB,MAAM,UAAEjzC,EAAS,eAAED,IAAmBI,EAAAA,EAAAA,YAAWC,EAAAA,IAC3C,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBkG,GAAoB84B,EAAAA,EAAAA,GAAoB3hC,EAAUC,KAelDqtB,EAAY5qB,EAAKuG,IAAIC,GAAAA,GAAAA,KAAWzB,MAChCiqC,EAAgBhvC,EAAKuG,IAAIC,GAAAA,GAAAA,eAAqBzB,MAE9C7J,GAAQysB,EAAAA,GAAAA,KACR6oB,GAAOpE,EAAAA,GAAAA,GAAclxC,EAAMmxC,YAAYC,GAAG,OAC1CmE,GAAqBxvC,EAAAA,EAAAA,UACzB,KACEmR,EAAAA,GAAAA,IAAM,EAAG,GAAG1V,KAAKE,IACf,QAAC8zC,GAAgB,CACfC,UAAY,gBAAe/zC,IAC3B4pB,SAAW,qBAAoB5pB,IAC/Bg0C,aAAc,IACZzqC,EAAkB,CAChB6oC,cAAepyC,IAAMoyC,EAAgBpyC,EAAI,EAAIA,SAKvD,CAACoyC,EAAe7oC,IAElB,OACE,yBACE,QAAC0qC,GAAe,KAChB,QAACtoC,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,UAExB+0C,IACC,QAACjoC,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJC,GAAI,GACJ2B,GAAI,EACJ/M,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WAEzD,QAACnF,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,WACV,QAACwD,EAAA,EAAU,CAAC/C,QAAQ,KAAKxD,GAAI,CAAE+I,UAAW,UAAW,UAAC,qBACjCmpC,SAIxByB,EAAmB/zC,KAAI,CAACgW,EAAG9V,KAC1B,QAAC2D,EAAA,EAAG,CAASzD,GAAI,CAAEyhB,QAASywB,GAAiBpyC,EAAI,EAAI,EAAI,IAAM,SAC5D8V,GADO9V,SAMhB,QAAC2L,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIC,GAAI,GAAI2B,GAAI,EAAGrB,WAAS,EAAC/M,QAAS,EAAE,UA7DtC,CACrB,CAAC,OAAQ,yBACT,CAAC,QAAS,mBACV,CAAC,QAAS,oBA4DYiB,KAAI,EAAEkzC,EAAMkB,MAC1B,QAACvoC,GAAA,GAAI,eAACE,MAAI,GAAgB6nC,GAAa,WACrC,QAACI,GAAgB,CAACC,UAAWf,EAAMppB,SAAUsqB,MAD/BlB,OAIfvyC,EAAe8yC,eAAe,YAC/B,QAAC5nC,GAAA,GAAI,eAACE,MAAI,GAAK6nC,GAAa,WAC1B,QAACI,GAAgB,CACfC,UAAU,SACVnqB,SAAS,4BAIZnpB,EAAe8yC,eAAe,aAC/B,QAAC5nC,GAAA,GAAI,eAACE,MAAI,GAAK6nC,GAAa,WAC1B,QAACI,GAAgB,CAACC,UAAU,UAAUnqB,SAAS,eArErD,CACJ,CAAC,WAAY,0BAA2B,GACxC,CAAC,WAAY,0BAA2B,GACxC,CAAC,WAAY,sBAAuB,IAsEhB9pB,KAAI,EAAEkzC,EAAMkB,EAAOC,MAC/B,MAAMC,EAAUpmB,GAAammB,EAC7B,OAAK1zC,EAAe8yC,eAAeP,IAEjC,QAACrnC,GAAA,GAAI,eACHE,MAAI,EAEJwgB,MAAO,CAAE1K,QAASyyB,EAAU,EAAI,KAC5BV,GAAa,WAEjB,QAACI,GAAgB,CAACC,UAAWf,EAAMppB,SAAUsqB,MAJxClB,GAJwC,IASxC,QAKXY,IACA,QAACjoC,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIC,GAAI,GAAI2B,GAAI,EAAGrB,WAAS,EAAC/M,QAAS,EAAE,WACrD,QAAC8M,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAG,UAChB,QAACxG,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,WACV,QAACwD,EAAA,EAAU,CAAC/C,QAAQ,KAAKxD,GAAI,CAAE+I,UAAW,UAAW,UAAC,qBACjCmpC,WAK1ByB,EAAmB/zC,KAAI,CAACgW,EAAG9V,KAC1B,QAAC2L,GAAA,GAAI,eACHE,MAAI,EAEJ3L,GAAI,CAAEyhB,QAASywB,GAAiBpyC,EAAI,EAAI,EAAI,KACxC0zC,GAAa,UAEhB59B,IAJI9V,aAYrB,CACA,SAASi0C,KACP,MAAM,KAAE7wC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtB0D,EAAW3D,EAAK6zB,aAAalwB,SACnC,OACE,QAAClC,EAAA,EAAS,WACR,QAAC5B,EAAA,EAAW,WACV,QAAC0I,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,SACxB0F,OAAOC,QAAQuC,GACb2I,QAAO,EAAE3P,EAAG2E,MAAWA,EAAKC,UAC5B7E,KAAI,EAAEa,EAAK+D,MAER,QAACiH,GAAA,GAAI,CAACE,MAAI,YACR,QAACjJ,EAAA,EAAQ,WACP,QAACK,EAAA,EAAW,CAAC/C,GAAI,CAAEmX,EAAG,EAAG,eAAgB,CAAEyJ,GAAI,IAAM,UACnD,QAAC,MAAgB,CAACpc,KAAMA,SAHd/D,UAahC,CAEA,MAAM0zC,GAAe,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAMxC,SAASP,IAAiB,UACxBC,EAAS,SACTnqB,EAAQ,aACRoqB,IAEA,MACEtzC,WAAW,OAAE4zC,GAAQ,eACrB7zC,EAAc,kBACd8I,IACE1I,EAAAA,EAAAA,YAAWC,EAAAA,IACT,KAAEsC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GAEtBwnB,GAAoBroB,EAAAA,EAAAA,cACvBnD,IACC,QAACyrB,GAAA,EAAc,CAAClpB,QAASoyC,EAAa,SAAE30C,KAE1C,CAAC20C,IAGGO,GAAiB/xC,EAAAA,EAAAA,cACrB,CAACwwC,EAA6BwB,IAC5BjrC,EAAkB,CAAE+qC,OAAQ,OAAF,UAAOA,EAAQ,EAACtB,GAAOwB,OACnD,CAACF,EAAQ/qC,IAGX,IAAInF,EAA6B,KAEjC,GAAI2vC,KAAaO,EAAQ,CACvB,MAAMG,EAAarxC,EAAKuG,IACtBC,GAAAA,GAAAA,MAAa,GAAEmqC,WACf5rC,MACI8iB,EAAQ7nB,EAAKuG,IAAIC,GAAAA,GAAAA,MAAYmqC,IAAY5rC,MACzCgsC,EAAM/wC,EAAKuG,IAAIC,GAAAA,GAAAA,KAAWzB,MAEhC/D,GACE,QAAC8jB,GAAA,EAAc,CACbpc,WAAS,EACThJ,MAAQ,cAAamoB,IACrBvrB,MAAO+0C,EAAa,OAAS,UAC7Bv0C,GAAI,CAAE4hB,aAAc,GAAI,UAEvBtM,EAAAA,GAAAA,IAAM,EAAG6+B,GAAaF,IAAMr0C,KAAKE,IAChC,QAACooB,GAAA,EAAQ,CAEP5F,SAAU8xB,EAAOP,KAAe/zC,EAChCwI,SAAU8rC,EAAOP,KAAe/zC,EAChC4B,QAAS,IAAM2yC,EAAeR,EAAW/zC,GAAG,UAC7C,cACaA,EAAIy0C,IALXz0C,MAUf,CACA,MAAM00C,EAAcj0C,EAAe8yC,eAAeQ,GAYlD,OACE,QAAClvC,EAAA,EAAS,CAAC3E,GAAI,CAAEzB,OAAQ,QAAS,UAC/B2F,GACD,QAACnB,EAAA,EAAW,YACV,QAAChE,GAAA,EAAkB,CACjBC,YAAa80C,EACb70C,QAAS0rB,EAAkB,UAE3B,QAAClf,GAAA,GAAI,CAACC,WAAS,EAAC1L,GAAI,CAAEgK,SAAU,UAAW,WACzC,QAACyB,GAAA,GAAI,CAACE,MAAI,YACR,QAAClI,EAAA,EAAG,CACF0D,UAAU,MACVtF,IAAgB,MAAX2yC,OAAW,EAAXA,EAAalB,IAClBtzC,GAAI,CAAE1B,MAAO,GAAIC,OAAQ,aAG7B,QAACkN,GAAA,GAAI,CAACE,MAAI,EAAC9C,SAAU,EAAG7I,GAAI,CAAEy0C,GAAI,GAAI,WACpC,QAACluC,EAAA,EAAU,CAAC/C,QAAQ,KAAI,SAAa,MAAXgxC,OAAW,EAAXA,EAAazyC,QACvC,QAACwE,EAAA,EAAU,CAAC/C,QAAQ,YAAW,SAAEkmB,YAK3B,MAAX8qB,GAAAA,EAAanxC,UACZ,QAAC4gB,GAAA,EAAe,CACd5gB,SAAUmxC,EAAYnxC,SACtBqxC,UAAQ,EACRhxB,WApCUK,IAAsC,MACxD,MAAM4wB,EAA6B,OAAjB,EAAG5wB,EAAQ7f,aAAM,EAAd,EAAgBrB,OACrC,GAAI8xC,GAAwC,iBAAjBA,EAA2B,CAEpD,OADoBA,EAAavtC,MAAMjI,SAASiI,MAAMogB,MAC3ChZ,SAASqlC,EACtB,CACA,OAAO,CAAK,IAgCJ,UAIZ,C,qDC/Pe,SAASe,KACtB,OACE,QAACnxC,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAASla,IAAK,EAAGC,WAAW,UAAS,UACrE,QAAC0B,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAE,WACzB,QAAC8M,GAAA,GAAI,CACHE,MAAI,EACJR,GAAI,GACJC,GAAI,EACJ2B,GAAI,EACJ/M,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WAEzD,QAAC+qC,GAAe,KAChB,QAACC,GAAgB,QAElBx/B,EAAAA,GAAAA,IAAM,EAAG,GAAG1V,KAAKE,IAChB,QAAC2L,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAIC,GAAI,EAAG2B,GAAI,EAAE,UAC9B,QAACgoC,GAAe,CAACpV,MAAO7/B,KADYA,SAOhD,CACO,SAAS+0C,KAAkB,UAChC,MAAM,KAAE3xC,EAAI,QAAE0L,IAAYjO,EAAAA,EAAAA,YAAWwC,EAAAA,GAC/B6xC,EAAY9xC,EAAK+xC,cACjBvmC,EAAgD,GAgBtD,OAfArK,OAAOC,QAAuB,OAAhB,EAAC0wC,EAAUv7B,OAAK,EAAI,CAAC,GAAGhJ,SACpC,EAAEhQ,EAAK+D,MACJA,EAAKC,SAA0B,IAAfD,EAAKyD,OAAeyG,EAAM2H,KAAK,CAAC,CAAC,QAAS5V,GAAM+D,MAErEH,OAAOC,QAAwB,OAAjB,EAAC0wC,EAAUE,QAAM,EAAI,CAAC,GAAGzkC,SACrC,EAAEhQ,EAAK+D,MACJA,EAAKC,SAA0B,IAAfD,EAAKyD,OAAeyG,EAAM2H,KAAK,CAAC,CAAC,SAAU5V,GAAM+D,MAEtEH,OAAOC,QAAuB,OAAhB,EAAC0wC,EAAUG,OAAK,EAAI,CAAC,GAAG1kC,SACpC,EAAEhQ,EAAK+D,MACJA,EAAKC,SACgB,iBAAfD,EAAKyD,OACG,IAAfzD,EAAKyD,OACLyG,EAAM2H,KAAK,CAAC,CAAC,QAAS5V,GAAM+D,MAE3BkK,EAAMkB,QAET,QAACjL,EAAA,EAAS,YACR,QAAC5B,EAAA,EAAW,WACV,QAACwD,EAAA,EAAU,UAAC,kBAEd,QAACtB,EAAA,EAAO,KACR,QAAClC,EAAA,EAAW,WACV,QAAC0I,GAAA,GAAI,CAACC,WAAS,WACZgD,EAAM9O,KACL,EAAEoR,EAAMvB,MAAE,aACRA,IACE,QAAChE,GAAA,GAAI,CAACE,MAAI,EAACR,GAAI,GAAG,UAChB,QAAC,MAAgB,CACf3G,KAAMiL,EACNT,SAAoD,OAA5C,GAAE8nB,EAAAA,GAAAA,IAAoB,MAAPloB,OAAO,EAAPA,EAASqmC,cAAejkC,SAAK,EAA1C,EAA4C/I,SAHlCgH,KAAKC,UAAUO,EAAEjJ,MAM1C,WAlBa,IAwB5B,CACA,SAASsuC,KACP,MAAM,EAAE9yC,IAAM1B,EAAAA,EAAAA,IAAe,mBACvB,KAAE4C,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,IAE1B3C,WAAW,KAAEyxC,KACXtxC,EAAAA,EAAAA,YAAWC,EAAAA,GACTw0C,EAAYnD,EAAKt8B,QAAO,CAACnB,EAAGxS,IAAMwS,GAAKxS,EAAI,EAAI,IAAI,GACzD,OACE,yBACE,QAAC2C,EAAA,EAAS,WACR,QAAChC,EAAA,EAAU,CACTC,OACE,0BACGZ,EAAE,yBAA0B,KAC7B,4BACE,QAAC,KAAS,CAACxC,MAAO41C,GAAa,EAAI,UAAY,UAAU,UAAC,IACtDA,EAAU,WAEN,KACV,QAACz0B,GAAA,EAAiB,CAChB/d,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,qCAI5BqzC,qBAAsB,CAAE7xC,QAAS,iBAGpC8xC,GAAAA,EAAAA,KAAoB,CAACj9B,EAAKvY,KACzB,QAAC6E,EAAA,EAAS,CAAS3E,GAAI,CAAEyhB,QAASpJ,EAAIi5B,QAAQpuC,GAAQ,EAAI,IAAM,WAC9D,QAACP,EAAA,EAAU,CACTC,OACE,0BACGyV,EAAItW,KAAM,KACX,QAAC4e,GAAA,EAAiB,CAChB/d,OAAO,QAAC2D,EAAA,EAAU,UAAE8R,EAAIk9B,YAI9B1yC,OAAQwV,EAAI3T,KACZ2wC,qBAAsB,CAAE7xC,QAAS,eAElC6U,EAAIi5B,QAAQpuC,KAAS,QAAC+B,EAAA,EAAO,IAC7BoT,EAAIi5B,QAAQpuC,KACX,QAACH,EAAA,EAAW,WACV,QAACkhB,GAAA,EAAe,CAAC5gB,SAAUgV,EAAIhV,SAAUmyC,cAAY,EAACd,UAAQ,QAhBpD50C,OAuBxB,CACA,SAASi1C,IAAgB,MAAEpV,IACzB,MAAM,SAAEgD,IAAahiC,EAAAA,EAAAA,YAAWwC,EAAAA,IAC1B,EAAEnB,IAAM1B,EAAAA,EAAAA,IAAe,mBAE3BE,UAAWmzB,EACXnzB,WAAaC,IAAKg1C,GAAoB,kBACtCpsC,IACE1I,EAAAA,EAAAA,YAAWC,EAAAA,GACT80C,EAAc/hB,EAAOse,KAAKtS,GAC1BsS,GAAO9tC,EAAAA,EAAAA,UACX,IACE,CAACsxC,KAAuB9hB,EAAOse,MAAMziC,QAAO,CAACxN,EAAGlC,IAAMA,EAAI,IAAM6/B,KAClE,CAAChM,EAAOse,KAAMwD,EAAoB9V,IAE9BgW,GAAiBx0C,EAAAA,EAAAA,KACjBy0C,GAActzC,EAAAA,EAAAA,cACjBoqC,GACCrjC,EAAkB,CAAE+C,KAAM,OAAQuzB,QAAO+M,aAC3C,CAAC/M,EAAOt2B,IAGJwsC,EAAalT,EAAS+S,GACtBI,GAA4D3xC,EAAAA,EAAAA,UAChE,kBACE0xC,GAAc,CACZr1C,UAAW,OAAF,UACJq1C,EAAWr1C,UAAS,CACvB4jB,YAAgD,OAArC,EAAEuP,EAAOoiB,gBAAgBL,IAAY,EAAI,CAAC,IAEvDn1C,eAAgBs1C,EAAWt1C,eAC3B8I,kBAAoByW,IAClB,IAAK41B,EAAa,OAClB,KAAM,gBAAiB51B,GAAQ,OAC/B,MAAM,YAAEsE,GAAgBtE,EACnBsE,GACL/a,EAAkB,CAChB+C,KAAM,kBACNspC,YAAaA,EACbtxB,eACA,EAEL,GACH,CAACuP,EAAQ+hB,EAAaG,EAAYxsC,IAE9B2sC,GAAkD7xC,EAAAA,EAAAA,UACtD,IACE0xC,GAAc,CACZ3yC,KAAM2yC,EAAW/pC,OACjB62B,SAAUA,IAEd,CAACkT,EAAYlT,IAEf,OACE,QAACh+B,EAAA,EAAS,CAAC3E,GAAI,CAAE+rB,SAAU,WAAY,WACrC,QAACkqB,GAAoB,CACnBv1C,aAAcg1C,EACdzD,KAAMA,EACNiE,QAASN,EACT1rC,MAAOlI,EAAE,WAAY,CAAEuR,MAAOosB,EAAQ,MAEvC+V,GAAeI,IACd,QAACl1C,EAAA,WAAyB,CAACqH,MAAO6tC,EAAyB,SACxDE,IACC,QAAC7yC,EAAA,WAAoB,CAAC8E,MAAO+tC,EAAoB,UAC/C,QAACzP,GAAA,EAAa,CACZ7lC,aAAcg1C,EACdS,cAAeR,EAEfS,kBACE,QAACx1C,EAAA,WAAyB,CAACqH,MAAO6tC,EAAyB,UACzD,QAAC3yC,EAAA,WAAoB,CAAC8E,MAAO+tC,EAAoB,UAC/C,QAACK,GAAuB,QAI9BC,gBACE,QAAC11C,EAAA,WAAyB,CAACqH,MAAO6tC,EAAyB,UACzD,QAAC3yC,EAAA,WAAoB,CAAC8E,MAAO+tC,EAAoB,UAC/C,QAACO,GAAqB,QAI5BC,mBACE,QAAC51C,EAAA,WAAyB,CAACqH,MAAO6tC,EAAyB,UACzD,QAAC3yC,EAAA,WAAoB,CAAC8E,MAAO+tC,EAAoB,UAC/C,QAACS,GAAqB,QAI5BC,gBAAc,UAQ9B,CACA,SAASL,KACP,MAAM,KAAEnzC,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtBE,GAAWc,EAAAA,EAAAA,UACf,IACEE,OAAOC,SAAQmsC,EAAAA,GAAAA,IAAevtC,IAAOuhB,SAAQ,EAAEjB,EAAQmzB,KACrDA,EAAQlyB,SAASmyB,IAAE,aAA8C,OAA9C,GAAKhzB,EAAAA,GAAAA,IAAYJ,GAAQM,kBAAkB8yB,IAAG,EAAI,EAAE,OAE3E,CAAC1zC,IAEH,OAAKG,GACE,QAAC4gB,GAAA,EAAe,CAAC5gB,SAAUA,EAAUmyC,cAAc,IADpC,IAExB,CACA,SAASe,KACP,MACE/1C,WAAaC,IAAKisC,KAChB/rC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAE+hC,IAAahiC,EAAAA,EAAAA,YAAWwC,EAAAA,GAC1BoqB,EAAcoV,EAAS+J,GAAUnf,YACvC,OAAKA,EAAY1J,UACV,QAACI,GAAA,EAAe,CAAC5gB,SAAUkqB,EAAY1J,SAAU2xB,cAAc,IADpC,IAEpC,CACA,SAASiB,KACP,MACEj2C,WAAaC,IAAKisC,KAChB/rC,EAAAA,EAAAA,YAAWC,EAAAA,IACT,SAAE+hC,IAAahiC,EAAAA,EAAAA,YAAWwC,EAAAA,GAC1B5C,EAAiBoiC,EAAS+J,GAAUnsC,eACpC8C,EAAWgB,OAAOuN,OAAOrR,EAAe6zC,QAAQ3vB,SACnDoyB,GAAQA,EAAIxzC,WAEf,OAAKA,GACE,QAAC4gB,GAAA,EAAe,CAAC5gB,SAAUA,EAAUmyC,cAAc,IADpC,IAExB,CAEA,SAASS,IAAqB,aAC5Bv1C,EAAY,KACZuxC,EAAI,MACJ/nC,EAAK,QACLgsC,EAAO,kBACPY,EAAoB,CAAC,IAgBrB,MAAM,EAAE90C,IAAM1B,EAAAA,EAAAA,IAAe,CAAC,gBAAiB,iBAAkB,eAC3D,SAAE0D,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,OAAEjD,IAAWC,EAAAA,EAAAA,KACb81C,GAASz0C,EAAAA,EAAAA,cACZ7B,IAAiB,aAChBA,EAAIu2C,WAAW,YACV,GAAEh1C,EAAG,kBAAgBi1C,EAAAA,EAAAA,IAAkBx2C,EAAKO,UAAegB,EACzD,qBAA6C,OAA3B,GAAEid,EAAAA,EAAAA,GAAaxe,EAAKO,SAAO,EAAzB,EAA2BqO,iBAElDrN,EAAG,iBAAgBvB,IAAM,GAC/B,CAACuB,EAAGhB,IAEAk2C,GAAQ50C,EAAAA,EAAAA,cACX7B,GACCA,GACE,QAACmB,EAAA,EAAS,CACRC,KAAKC,EAAAA,EAAAA,IAAerB,EAAK,WAAYO,GACrChB,GAAI,CAAEm3C,GAAI,MAGZ,QAACC,GAAA,EAAS,KAEd,CAACp2C,IAEGq2C,GAAa/0C,EAAAA,EAAAA,cAChB7B,GAAsBuD,EAASka,SAASzU,IAAIhJ,GAAK0d,UAClD,CAACna,IAEGszC,GAAYh1C,EAAAA,EAAAA,cAChB,EAAG7B,SACDwxC,EAAKziC,QAAQxN,GAAMA,GAAKA,IAAMtB,IAAc8N,SAAS/N,IACpDA,EAAIu2C,WAAW,aACd/E,EAAKv+B,MAAM1R,GAAMA,EAAEg1C,WAAW,eAClC,CAAC/E,EAAMvxC,IAEHkR,GAAoDzN,EAAAA,EAAAA,UACxD,IACEH,EAASqZ,MAAM1d,KACZC,KAAKsS,IAAC,CAAQzR,IAAKyR,EAAGhI,MAAO6sC,EAAO7kC,GAAIiM,SAAUk5B,EAAWnlC,OAC7DgJ,MAAK,CAAC1G,EAAG2G,IACJ3G,EAAE2J,WAAahD,EAAEgD,UAAkB,GAClC3J,EAAE2J,UAAYhD,EAAEgD,SAAiB,EAC/B3J,EAAEtK,MAAMsU,cAAcrD,EAAEjR,UAErC,CAAC6sC,EAAQM,EAAYrzC,IAEvB,OACE,QAAC,EAAA5C,SAAQ,CAACC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,OAAOlF,MAAO,MAAQ,UAC1D,QAACi5C,GAAA,EAAmB,eAClBxyC,KAAK,QACLmF,MAAOA,EACPstC,QAAS5lC,EACT6lC,SAAU/2C,EACVwF,SAAWgI,GAAMgoC,EAAS,MAADhoC,EAAAA,EAAK,IAC9BwpC,kBAAmBJ,EACnBJ,MAAOA,GACHJ,KAIZ,C,yaCtRA,MAAMpI,GAAuBtuC,EAAAA,MAC3B,IAAM,0CAIO,SAASu3C,KAAiB,QACvC,MAAM,SAAE3zC,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACxBf,KAAM0L,IAAYjO,EAAAA,EAAAA,YAAWwC,EAAAA,IAC/B,UACJ3C,EACAA,WAAaC,IAAKC,EAAY,YAAEwgC,GAAa,eAC7C3gC,EAAc,kBACd8I,IACE1I,EAAAA,EAAAA,YAAWC,EAAAA,GACTsC,ECtGO,SACbxC,EACAk3C,GAEA,MAAM,SAAE5zC,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IACzB4zC,EAAQC,IAAa/2C,EAAAA,EAAAA,WAAS,IACnCiD,EAAS+zC,QAAQC,YAAYt3C,EAAck3C,KAgB7C,OAdAjyC,EAAAA,EAAAA,YACE,IAAMmyC,EAAU9zC,EAAS+zC,QAAQC,YAAYt3C,EAAck3C,KAC3D,CAAC5zC,EAAUtD,EAAck3C,KAE3BjyC,EAAAA,EAAAA,YACE,IACEjF,EACIsD,EAAS+zC,QAAQt8B,OACf/a,GACA,CAACwN,EAAGoL,EAAGpH,IAAY,WAANoH,GAAkBw+B,EAAU5lC,UAE3CzS,GACN,CAACiB,EAAco3C,EAAW9zC,IAErB6zC,CACT,CD+EeI,CACXv3C,GACAw3C,EAAAA,GAAAA,IAAwB33C,EAAe2e,gBAEnCi5B,GAAU71C,EAAAA,EAAAA,cACbY,GAAkBc,EAAS+zC,QAAQtlC,IAAI/R,EAAcwC,IACtD,CAACxC,EAAcsD,IAEXo0C,GAAY91C,EAAAA,EAAAA,cAAY,KAC5B61C,GAAQE,EAAAA,GAAAA,IAAWH,EAAAA,GAAAA,IAAwB33C,EAAe2e,gBAAgB,GACzE,CAACi5B,EAAS53C,IACP+3C,GAAYh2C,EAAAA,EAAAA,cACfO,IACCs1C,EAAQ,OAAD,UAAMj1C,EAAM,CAAAmqB,OAAQ,OAAF,UAAOnqB,EAAKmqB,OAAWxqB,KAAW,GAE7D,CAACs1C,EAASj1C,IAGNq1C,GAAWj2C,EAAAA,EAAAA,cACf,CAACk2C,EAAwBjiB,KACvB,MAAMkiB,GAAUJ,EAAAA,GAAAA,GAAWG,EAAQ/3C,KACnCg4C,EAAQC,SAASztB,SAAS7e,KAAOlJ,EAAKw1C,SAASztB,SAAS7e,KAExDqsC,EAAQprB,OAAOtC,MAAQytB,EAAQztB,MAC/B0tB,EAAQprB,OAAOS,UAAY0qB,EAAQ1qB,UACnC2qB,EAAQprB,OAAOM,WAAa6qB,EAAQ7qB,WAEpC,MAAMjJ,EAAO,CAAC,EACd6R,EAAM9lB,SAAS6C,IAAQ,MACrB,IAAKA,EAAK,OACV,MAAM,QAAE+P,EAAO,OAAEG,EAAM,SAAEyH,EAAQ,YAAED,EAAW,MAAED,EAAK,OAAE7D,GAAW5T,EAClEmlC,EAAQC,SAAS/xB,MAAMtD,GAAS0H,MAAQA,EACxC0tB,EAAQC,SAAS/xB,MAAMtD,GAAShX,QAAU2e,EAC1CytB,EAAQC,SAAS/xB,MAAMtD,GAAS6D,OAASA,EACzCxC,EAAKlB,IAAuB,OAAb,EAACkB,EAAKlB,IAAO,EAAI,GAAK,EACrCyH,EAASxa,SAAS2zB,IAAY,MACxBA,EAAQ3jC,MACVg4C,EAAQC,SAASztB,SAAS0tB,MAAMvU,EAAQ3jC,MACO,OAA7C,EAACg4C,EAAQC,SAASztB,SAAS0tB,MAAMvU,EAAQ3jC,MAAI,EAAI,GACjD2jC,EAAQC,cAAa,GACzB,IAEJoU,EAAQC,SAASh0B,KAAOrgB,OAAO4N,YAC7B5N,OAAOC,QAAQogB,GACZ9kB,KAAI,EAAEa,EAAKwH,KAAW,CACrBxH,EACU,IAAVwH,EACI,EACU,IAAVA,EACA,EACU,IAAVA,GAAiBxH,EAAeu2C,WAAW,cAE3C/uC,EADA,KAGLuH,QAAO,EAAE,CAAEvH,KAAWA,KAE3BkwC,EAAQM,EAAQ,GAElB,CAACv1C,EAAMi1C,IAEHjtB,GAAWwc,EAAAA,EAAAA,OACTnR,MAAOqiB,GAA4B,OAAd,EAAA1tB,EAASpL,OAAK,EAEzB,CAAEyW,WAAO92B,IAC3BkG,EAAAA,EAAAA,YAAU,KACR,IAAKizC,EAAU,OACf,MAAMJ,EAAUx0C,EAAS+rB,QAAQtmB,IAAIjJ,EAAUyuC,gBAC/CsJ,EACEC,EACAI,EAASh5C,KAAKE,GAAMkE,EAASgM,KAAKvG,IAAI3J,KACvC,GAGA,CAAC84C,EAAU50C,IAEd,MAAM60C,GAAmBv2C,EAAAA,EAAAA,cAAY,KACnC,MAAMk2C,EAAUx0C,EAAS+rB,QAAQtmB,IAAIjJ,EAAUyuC,gBAC/CsJ,EACEC,EACAn0C,OAAOuN,OAAOpR,EAAU8d,mBACrB1e,KAAK4U,GAAMxQ,EAASgM,KAAKvG,IAAI+K,KAC7BhF,QAAQgF,GAAMA,IAClB,GACA,CACDxQ,EACAxD,EAAU8d,kBACV9d,EAAUyuC,eACVsJ,IAGIlrB,GAAwBlpB,EAAAA,EAAAA,UAAQ,IAC7B,OAAP,UACKjB,EAAKmqB,OAAM,CACdnC,SAAU,GACV4tB,MAAM,EACNtmC,GAAI,MAEL,CAACtP,IACE61C,GAAcz2C,EAAAA,EAAAA,cACjBo2C,IACC,MAAMM,GAAQpzB,EAAAA,GAAAA,IAAU1iB,GACxB81C,EAAMN,SAAWA,EACjBP,EAAQa,EAAM,GAEhB,CAAC91C,EAAMi1C,IAGHc,GAAkB32C,EAAAA,EAAAA,cACrBN,IACC,MAAMg3C,GAAQpzB,EAAAA,GAAAA,IAAU1iB,GACxB81C,EAAMN,SAASztB,SAAS7e,KAAOpK,EAC/Bm2C,EAAQa,EAAM,GAEhB,CAAC91C,EAAMi1C,IAGHe,GAAc52C,EAAAA,EAAAA,cACjB42C,IACC,MAAMF,GAAQpzB,EAAAA,GAAAA,IAAU1iB,GACxB81C,EAAMN,SAASztB,SAAS0tB,MAAQO,EAChCf,EAAQa,EAAM,GAEhB,CAAC91C,EAAMi1C,IAGHgB,GAAe58B,EAAAA,EAAAA,kBAAiBrZ,GAChCk2C,GAAmBj1C,EAAAA,EAAAA,UAAQ,KAC/B,MAAMw0C,EAAQ,OAAH,UAAQQ,EAAaT,SAASztB,SAAS0tB,OAOlD,OANAt0C,OAAOuN,OAAOunC,EAAaT,SAAS/xB,OAAOlW,SACzC,EAAGpE,UAAS6a,SAAQ6D,YAAO,aACxB4tB,EAAMtsC,IACU,OAAf,EAACssC,EAAMtsC,IAAQ,EAAI,GACnBwf,GAAAA,GAAAA,cAAuBxf,EAAS6a,EAAQ6D,EAAM,IAE7C,CACLzX,KAAKvB,EAAAA,GAAAA,IAAU4mC,GAAO,CAACzmC,EAAGhE,IACxBA,EAAEi2B,SAAS,MAAO97B,EAAAA,GAAAA,IAAQ6J,EAAI,MAAOF,EAAAA,GAAAA,IAASE,KAEhDmT,QAAQtT,EAAAA,GAAAA,IAAUonC,EAAaT,SAASh0B,MAAOxS,IAAMF,EAAAA,GAAAA,IAASE,KAC/D,GACA,CAACinC,IAEEE,GAAgCl1C,EAAAA,EAAAA,UACpC,KAAM,CACJqO,GAAI,GACJ0Y,SAAU,GACVzqB,IAAKyC,EAAKmqB,OAAO5sB,IACjBsqB,MAAO7nB,EAAKmqB,OAAOtC,MACnB+C,UAAW5qB,EAAKmqB,OAAOS,UACvBH,WAAYzqB,EAAKmqB,OAAOM,WACxBmrB,MAAM,KAER,CAAC51C,IAEGy/B,GAAWC,EAAAA,EAAAA,GACfliC,EACA,EACA04C,EACAC,IAGMvtC,OAAQwtC,GAAuC,OAA3B,EAAW,MAAR3W,OAAQ,EAARA,EAAWjiC,IAAa,EAAI,CAAC,EAEtD64C,GAA+Cp1C,EAAAA,EAAAA,UAAQ,KAC3D,GAAKw+B,GAAa2W,EAClB,MAAO,CACLp2C,KAAMo2C,EACN3W,WACD,GACA,CAAC2W,EAAY3W,IACV6W,GAAsDr1C,EAAAA,EAAAA,UAAQ,KAClE,GAAKo1C,EACL,OAAO,OAAP,UACKA,EAAgB,CACnB3qC,QAASsyB,EAActyB,OAAUnP,GAAS,GAE3C,CAAC85C,EAAkBrY,EAAatyB,IACnC,OACE,QAAC3B,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAACgG,EAAA,EAAS,WACR,QAAClB,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQyL,IAAK,EAAGqN,EAAG,GAAI,WACzC,QAAC1T,EAAA,EAAG,CAACzD,GAAI,CAAE6I,SAAU,EAAGxK,QAAS,OAAQyL,IAAK,GAAI,WAChD,QAACrI,EAAA,EAAM,CACLjC,MAAM,OACNkC,QAASm3C,EACTl3C,WAAW,QAAC83C,GAAA,EAAO,IAAI,SACxB,wBAGD,QAACh4C,EAAA,EAAM,CAACjC,MAAM,QAAQkC,QAAS02C,EAAWz2C,WAAW,QAAC+3C,GAAA,EAAO,IAAI,SAAC,cAIpE,QAAC74B,GAAA,EAAsB,CACrBC,WAAS,EACT7Y,MAAOi5B,EACPh7B,SAAU,CAACX,EAAG2M,IAAM7I,EAAkB,CAAE63B,YAAahvB,IACrDnN,KAAK,QAAO,WAEZ,QAACmc,GAAA,EAAY,CAACjZ,OAAO,EAAOK,UAAW44B,EAAY,SAAC,mBAGpD,QAAChgB,GAAA,EAAY,CAACjZ,OAAO,EAAMK,SAAU44B,EAAY,SAAC,iCAMvDqY,GACC,QAACp2C,EAAA,WAAoB,CAAC8E,MAAOsxC,EAAiB,UAC5C,QAAC9tC,GAAA,GAAI,CAACC,WAAS,EAAC/M,QAAS,EAAGqB,GAAI,CAAEsK,eAAgB,UAAW,WAC3D,QAACmB,GAAA,GAAI,CAACE,MAAI,EAAC3L,GAAI,CAAE6I,UAAW,GAAI,WAC9B,QAAC8wC,GAAgB,CACftsB,OAAQA,EACRirB,UAAWA,EACXp5B,cAAe3e,EAAe2e,iBAEhC,QAAC06B,GAAqB,CACpBC,aAAc32C,EAAKw1C,SACnBoB,gBAAiBf,QAGrB,QAACttC,GAAA,GAAI,CAACE,MAAI,EAAC3L,GAAI,CAAE6I,SAAU,GAAI,UAC7B,QAACkxC,GAAe,CACd9uB,SAAU/nB,EAAKw1C,SAASztB,SAAS0tB,MACjCO,YAAaA,EACbc,aAAc92C,EAAKw1C,SAASztB,SAAS7e,KACrC6sC,gBAAiBA,EACjBzb,aAAcn5B,OAAOuN,OAAO1O,EAAKw1C,SAAS/xB,OAAO/mB,KAC9CqhB,GAAMA,EAAE5U,oBAOnB,QAAC9I,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,OAEvD,QAACoG,EAAA,EAAS,CAAC3E,GAAI,CAAE6I,SAAU,EAAGsO,EAAG,GAAI,SAClCqiC,GACC,QAACr2C,EAAA,WAAoB,CAAC8E,MAAOuxC,EAAwB,UACnD,QAAC3sB,GAAoB,OAGvB,QAACtpB,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,UAK/D,CAEA,SAASo7C,IAAiB,OACxBtsB,EAAM,UACNirB,EAAS,cACTp5B,IAMA,MAAM,IAAEze,EAAG,MAAEsqB,EAAQ,EAAC,WAAE4C,EAAa,EAAC,UAAEG,EAAY,GAAMT,EACpDE,GAAcC,EAAAA,GAAAA,IAAe/sB,IAC5Ba,EAAMurC,EAAQtrC,IAAU2a,EAAAA,EAAAA,MACzB,KAAEhZ,IAASvC,EAAAA,EAAAA,YAAWwC,EAAAA,GACtB82C,GAAe91C,EAAAA,EAAAA,UACnB,IAAMkpB,IAAUI,EAAAA,GAAAA,IAAc,CAACF,EAAYrqB,MAAMwqB,EAAAA,GAAAA,IAAiBL,MAClE,CAACE,EAAaF,IAEhB,OACE,QAAC1oB,EAAA,EAAS,CAAC3E,GAAI,CAAEmX,EAAG,EAAGxT,GAAI,GAAI,WAC7B,QAAC,GAAoB,CACnBmqB,UAAWA,EACXxsB,KAAMA,EACNC,OAAQA,EACRC,SAAW0M,GAAMoqC,EAAU,CAAE73C,IAAKyN,IAClCygC,iBAAkBzvB,KAEpB,QAACzb,EAAA,EAAG,CAACpF,QAAQ,OAAO2lB,cAAc,SAASla,IAAK,EAAE,WAChD,QAACrG,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAE,WACzB,QAACrG,EAAA,EAAG,CACFwjB,UAAY,QAAOsG,EAAYrG,aAC/B/f,UAAU,MACVtF,KAAKgsB,EAAAA,EAAAA,IAAYR,EAAO5sB,IAAKqtB,GAAa,GAC1C9tB,GAAI,CACFk6C,WAAY,EACZtxC,UAAW,EACX6X,SAAU,MACVmB,aAAc,MAGlB,QAAC3U,GAAA,EAAK,CAACtO,QAAS,EAAGkK,SAAU,EAAE,WAC7B,QAACpH,EAAA,EAAM,CACLmK,WAAS,EACTpM,MAAM,OACNQ,GAAI,CAAE6I,SAAU,GAChBnH,QAASmrC,EAAO,UAEhB,QAACppC,EAAA,EAAG,CAACzD,GAAI,CAAEygB,SAAU,QAAS,SAAa,MAAX8M,OAAW,EAAXA,EAAaxrB,SAE9CwrB,EAAYS,gBACX,QAACmsB,GAAA,EAAkB,CACjBxsB,WAAYA,EACZysB,cAAgB9gC,GAAMg/B,EAAU,CAAE3qB,WAAYrU,aAKtD,QAAC+gC,EAAA,EAAW,CACVtvB,MAAOA,EACP+C,UAAWA,EACX6Y,QAAS2R,EACTgC,QAAS/sB,EAAYS,iBAEvB,QAACtrB,EAAA,EAAQ,YACP,QAACC,EAAA,EAAU,CACTC,MAAO,aACPyyC,qBAAsB,CAAE7xC,QAAS,gBAEnC,QAACyB,EAAA,EAAO,IACPg1C,IACC,QAACprC,GAAA,GAAgB,UACd,CAACnF,GAAAA,GAAAA,OAAAA,KAAmBA,GAAAA,GAAAA,OAAAA,IAAkBA,GAAAA,GAAAA,OAAAA,MAAmB9J,KACvD4E,IACC,MAAMiL,EAAIwqC,EAAaxwC,IAAIjF,GAC3B,OAAIiL,EAAEhL,UAAYgL,EAAExH,MAAc,MAEhC,QAAC,MAAgB,CAEfzD,KAAMiL,EACNtI,UAAW4H,GAAAA,IAFNE,KAAKC,UAAUO,EAAEjJ,MAGtB,SAObtD,IAAmB,MAAXqqB,OAAW,EAAXA,EAAa1J,YACpB,QAACI,GAAA,EAAe,CAAC5gB,SAAUkqB,EAAY1J,gBAKjD,CAEA,SAAS+1B,IAAsB,aAC7BC,EAAY,gBACZC,IAKA,MAAMS,GAAUj4C,EAAAA,EAAAA,cACb+gB,GAA8B9Q,IAC7B,MAAMioC,GAAgB50B,EAAAA,GAAAA,IAAUi0B,GAChCW,EAAc7zB,MAAMtD,GAAW9Q,EAC/BunC,EAAgBU,EAAc,GAEhC,CAACX,EAAcC,IAGXW,GAAYn4C,EAAAA,EAAAA,cACf+iB,IACC,MAAMm1B,GAAgB50B,EAAAA,GAAAA,IAAUi0B,GAChCW,EAAc91B,KAAOW,EACrBy0B,EAAgBU,EAAc,GAEhC,CAACX,EAAcC,IAGjB,OACE,QAAC7sC,GAAA,EAAK,CAACtO,QAAS,EAAE,WAChB,QAACgG,EAAA,EAAS,CAAC3E,GAAI,CAAEmX,EAAG,GAAI,UACtB,QAAClK,GAAA,EAAK,CAACtO,QAAS,EAAE,SACfwkB,GAAAA,GAAAA,KAAyBlC,IACxB,QAACy5B,GAAqB,CAEpBr3B,QAASpC,EACT1O,KAAMsnC,EAAalzB,MAAM1F,GACzBs5B,QAASA,EAAQt5B,IAHZA,UAQb,QAAC,EAAA7f,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAQ,UAEvE,QAACo8C,GAAkB,CAACt1B,OAAQw0B,EAAan1B,KAAM+1B,UAAWA,QAIlE,CACA,SAASC,IAAsB,QAC7Br3B,EAAO,KACP9Q,EACAgoC,QAASK,IAKR,MACD,MAAM,MAAE7vB,EAAK,QAAE1e,EAAO,OAAE6a,GAAW3U,EAC7B5S,EAAOksB,GAAAA,GAAAA,cAAuBxI,GAC9Bk3B,GAAUj4C,EAAAA,EAAAA,cACbO,IACC+3C,EAAY,OAAD,UAAMroC,EAAS1P,GAAS,GAErC,CAAC0P,EAAMqoC,IAEHxM,GAAY9rC,EAAAA,EAAAA,cACfgX,IAAsB,MACrB,MAAMuhC,EAA0B,OAAtB,EAAGC,GAAAA,GAAiBxhC,IAAE,EAAI,EAClBihC,EAAdxvB,EAAQ8vB,EAAc,CAAE3zB,OAAQ5N,EAAGyR,MAAO8vB,GACjC,CAAE3zB,OAAQ5N,GAAI,GAE7B,CAACyR,EAAOwvB,IAGV,OACE,QAAC92C,EAAA,EAAG,CACFpF,QAAQ,OACRyL,IAAK,EACLQ,eAAe,gBACfP,WAAW,SAAQ,WAEnB,QAACqZ,GAAA,EAAQ,CAACC,QAASA,KACnB,QAAC3gB,EAAA,EAAQ,CACP1C,GAAI,CAAEzB,OAAQ,OAAQsjB,SAAU,MAAOhZ,SAAU,EAAGxK,QAAS,QAAS,SAErD,IAAhBsB,EAAKiQ,QACJ,QAACnM,EAAA,EAAG,CACF0T,EAAG,EACH7M,eAAe,SACfP,WAAW,SACXzL,MAAM,OACND,QAAQ,OACRyL,IAAK,EAAE,WAEP,QAACqgB,GAAA,EAAQ,CAAC9d,QAAS1M,EAAK,GAAIoL,UAAWC,GAAAA,IAAoB,IAC1DmB,GAAAA,GAAAA,OAAcxM,EAAK,QAGtB,QAACqoB,GAAA,EAAc,CACbhoB,GAAI,CAAE0I,GAAI,GACVkD,WAAS,EACThJ,OAAO,QAACqnB,GAAY,CAAC5d,QAASA,IAC9B7M,MAAiC,OAA5B,EAAE2M,GAAAA,GAAAA,WAAkBE,IAAQ,EAAI,UAAU,SAE9C1M,EAAKC,KAAKm7C,IACT,QAAC7yB,GAAA,EAAQ,CAEP5f,SAAU+D,IAAY0uC,EACtBr5C,QAAS,IAAM64C,EAAQ,CAAEluC,QAAS0uC,IAAO,UAEzC,QAAC3wB,GAAmB,CAAC/d,QAAS0uC,KAJzBA,UAUf,QAAC/yB,GAAA,EAAc,CACbhoB,GAAI,CAAE0I,GAAI,GACV9F,OACE,QAACa,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQ0L,WAAY,UAAW,UAChDmd,EAAO,KAAC,QAACI,GAAA,EAAe,CAACvnB,SAAS,eAEtC,SAEA,CAAC,EAAG,EAAG,GAAGH,KAAK0Z,IACd,QAAC4O,GAAA,EAAQ,CAEP5f,SAAU4e,IAAW5N,EACrB5X,QAAS,IAAM0sC,EAAU90B,GAAqB,UAE9C,QAAC7V,EAAA,EAAG,CAACzD,GAAI,CAAE3B,QAAS,OAAQ0L,WAAY,UAAW,UAChDuP,EAAE,KAAC,QAACgO,GAAA,EAAe,CAACvnB,SAAS,gBAL3BuZ,QAUX,QAAC3Q,GAAA,GAAiB,CAChBqyC,eAAe,IACf/yC,MAAO8iB,EACPvrB,MAAOqsB,GAAAA,GAAAA,aAAsBd,GAC7B7kB,SAAWqvB,QAAY91B,IAAN81B,GAAmBglB,EAAQ,CAAExvB,MAAOwK,IACrDv1B,GAAI,CAAE4hB,aAAc,EAAG6yB,GAAI,EAAGwG,GAAI,EAAG18C,OAAQ,QAC7CuK,WAAY,CAAE9I,GAAI,CAAEy0C,GAAI,GAAKn2C,MAAO,OAAS4V,IAAK,GAAID,IAAK,MAE7D,QAACvR,EAAA,EAAQ,CAAC1C,GAAI,CAAEzB,OAAQ,OAAQsjB,SAAU,OAAQ,UAChD,QAACpe,EAAA,EAAG,CAAC0T,EAAG,EAAGpO,UAAU,SAAQ,SAAG,IAAEsjB,EAAAA,GAAAA,IAChCR,GAAAA,GAAAA,cAAuBxf,EAAS6a,EAAQ6D,GACxC5e,GAAAA,GAAAA,KAAYE,MACVF,GAAAA,GAAAA,KAAYE,WAIxB,CAEA,SAASsuC,IAAmB,OAC1Bt1B,EAAM,UACNo1B,IAKA,MAAMS,GAAS54C,EAAAA,EAAAA,cACZkhB,IACMA,GACLi3B,EAAU,OAAD,UACJp1B,EAAM,CACT,CAAC7B,GAASkE,SAASrjB,OAAO1E,MAAKikB,EAAAA,GAAAA,IAAYJ,GAAQqD,YAAY,MAC/D,GAEJ,CAACxB,EAAQo1B,IAGLva,GAAW59B,EAAAA,EAAAA,cACdkhB,GAA4Bvb,GAC3BwyC,EAAU,OAAD,UAAMp1B,EAAQ,EAAC7B,GAASvb,MACnC,CAACod,EAAQo1B,IAELU,GAAc74C,EAAAA,EAAAA,cACjBkhB,GAA2B,KAC1B,MAAwB43B,GAAI,QAAK/1B,EAAM,CAA9B7B,GAAM,SACfi3B,EAAU,OAAD,UAAMW,GAAO,GAExB,CAAC/1B,EAAQo1B,IAGLY,EAAY,EAAIh3C,OAAOuN,OAAOyT,GAAQ1P,QAAO,CAACnB,EAAG2G,IAAM3G,EAAI2G,GAAG,GAEpE,OACE,QAAClO,GAAA,EAAK,CAACtO,QAAS,EAAGqB,GAAI,CAAE6I,SAAU,GAAI,UACpCxE,OAAOC,QAAQ+gB,GAAQzlB,KAAI,EAAE4jB,EAAQvb,MACpC,QAACqzC,GAAiB,CAEhB93B,OAAQA,EACRvb,MAAOA,EACPi4B,SAAUA,EAAS1c,GACnB23B,YAAaA,EAAY33B,GACzB63B,UAAWA,GALN73B,MAQT,QAAC7e,EAAA,EAAS,CAAC3E,GAAI,CAAE6I,SAAU,EAAGkjB,SAAU,WAAY,UAClD,QAACwvB,GAAA,EAAuB,CACtBC,UAAW,GACXC,aAAcP,EACdhxC,MAAO,mBACPwtC,kBAAmB,EAAGj3C,SACpB4D,OAAO1E,KAAK0lB,GAAQ7W,SAAS/N,KAC5BA,GACD4D,OAAO1E,MAAKikB,EAAAA,GAAAA,IAAYnjB,GAAKomB,YAAYtiB,OACtCkL,GAAMiY,SAASjY,GAAK4rC,UAOnC,CACA,SAASC,IAAkB,OACzB93B,EAAM,MACNvb,EAAK,SACLi4B,EAAQ,YACRib,EAAW,UACXE,IAQA,MAAMtsB,GAAgBnL,EAAAA,GAAAA,IAAYJ,GAG5BoD,GAAeziB,EAAAA,EAAAA,UAAQ,IACvB8D,EAAQ,EAAU,GACf5D,OAAO1E,KAAKovB,EAAclI,YAAYrX,QAAQiU,IAAS,aACzB,OADyB,EAC5DsL,EAAclI,WAAWpD,SAAU,EAAnC,EAAqCI,SAASnQ,MAC3CoT,GAAQ,WAAYA,GACtB,KAEF,CAACiI,EAAe9mB,IAEnB,OACE,QAACtD,EAAA,EAAS,YACR,QAAClB,EAAA,EAAG,CAACpF,QAAQ,OAAM,WACjB,QAAC6wB,GAAA,EAAkB,CAACH,cAAeA,EAAeC,SAAU/mB,EAAM,UAChE,QAACxE,EAAA,EAAG,CAACoF,SAAU,EAAGsO,EAAG,EAAG9Y,QAAQ,OAAOyL,IAAK,EAAGC,WAAW,SAAQ,WAChE,QAACjF,GAAA,EAAO,CAACC,KAAM,EAAGlD,KAAKslB,EAAAA,GAAAA,IAAgB3D,MACvC,QAAC/f,EAAA,EAAG,UAAEsrB,EAAc2sB,WACpB,QAACC,GAAA,EAAI,UAGT,QAAC5zC,GAAA,EAAW,YACV,QAACigB,GAAA,EAAc,CACbjjB,KAAK,QACLnC,OAAO,QAACa,EAAA,EAAG,CAACy4B,WAAW,SAAQ,UAAEj0B,EAAM,UAAW,SAEjD5D,OAAO1E,KAAKovB,EAAclI,YACxBjnB,KAAK4jB,GAAWkE,SAASlE,KACzB5jB,KAAK4jB,IACJ,QAAC0E,GAAA,EAAQ,CAEP5f,SAAUL,IAAUub,GAAUA,EAAS63B,EAAYpzC,EACnDvG,QAAS,IAAMw+B,EAAS1c,GAAqB,UAE5CA,EAAO,SAJHA,QAQb,QAAC/hB,EAAA,EAAM,CAACjC,MAAM,QAAQuF,KAAK,QAAQrD,QAASy5C,EAAY,UACtD,QAAC3a,GAAA,EAAa,cAIjB5Z,EAAahX,SACd,QAAC3C,GAAA,EAAK,CAACtO,QAAS,EAAGqB,GAAI,CAAEmX,EAAG,GAAI,SAC7ByP,EAAahnB,KAAK6jB,IACjB,QAACF,GAAgB,CAEfC,OAAQA,EACRC,UAAWiE,SAASjE,GACpBC,YAAU,EACVC,kBAAgB,GAJXF,SAWnB,CACA,SAASs2B,IAAgB,SACvB9uB,EAAQ,YACRiuB,EAAW,aACXc,EAAY,gBACZf,EAAe,aACfzb,IAQA,MAAM0C,GAAW59B,EAAAA,EAAAA,cACd7B,GAAqByR,GAAcgnC,EAAY,OAAD,UAAMjuB,EAAU,EAACxqB,GAAMyR,MACtE,CAAC+Y,EAAUiuB,KAEP,EAAEl3C,IAAM1B,EAAAA,EAAAA,IAAe,kBACvBs7C,EAIA,IAHJv3C,OAAOC,QAAQ2mB,GAAUtV,QACvB,CAAC3T,GAAIkM,EAAGgE,KAAOlQ,EAAIkQ,EAAI2Z,GAAAA,GAAAA,aAAsB3d,IAC7C,GAEEse,EAAQnoB,OAAOC,QAAQ2mB,GAAUtV,QACrC,CAAC3T,GAAIkM,EAAGgE,KAAOlQ,EAAIkQ,EAAI2Z,GAAAA,GAAAA,aAAsB3d,OAAGzO,EAAWu6C,IAC3D,GAEF,OACE,QAACr1C,EAAA,EAAS,CAAC3E,GAAI,CAAEmX,EAAG,EAAG5Y,OAAQ,QAAS,WACtC,QAACkF,EAAA,EAAG,CAACzD,GAAI,CAAE2D,GAAI,EAAGtF,QAAS,OAAQyL,IAAK,GAAI,WAC1C,QAACke,GAAA,EAAc,CACbpc,WAAS,EACThJ,MAAOZ,EAAG,8BAA6Bg4C,KAAgB,SAEtD6B,EAAAA,GAAAA,KAAiBC,IAChB,QAAC5zB,GAAA,EAAQ,CAEP5f,SAAU0xC,IAAiB8B,EAC3Bp6C,QAAS,IAAMu3C,EAAgB6C,GAAI,SAElC95C,EAAG,8BAA6B85C,MAJ5BA,QAQX,QAACjyB,GAAA,EAAgB,CACfjnB,OAAO,QAAC2D,EAAA,EAAU,UAAEvE,EAAC,UAAC,mCACtB8nB,UAAU,MAAK,UAEf,QAACpnB,EAAA,EAAQ,CACP1C,GAAI,CACF+I,UAAW,SACX8G,GAAI,GACJnH,GAAI,EACJmZ,SAAU,OACVqa,WAAY,SACZ79B,QAAS,OACTyL,IAAK,EACLQ,eAAgB,WAChBP,WAAY,UACZ,WAEF,QAAC,KAAS,CAACvK,MAAOgtB,EAAQ,GAAK,eAAY/sB,EAAU,UAAC,WAC7C,2BAAS+sB,EAAM7C,QAAQ,SAEhC,QAAC,KAAS,CAACnqB,MAAOgtB,EAAQ,GAAK,eAAY/sB,EAAU,UAAC,QAChD,4BAASm8C,EAAGjyB,QAAQ,GAAG,mBAKnC,QAAC1c,GAAA,EAAK,CAACtO,QAAS,EAAE,SACf0F,OAAOC,QAAQ2mB,GAAUrrB,KAAI,EAAEsO,EAAGgE,MACjC,QAAC6pC,GAAqB,CAEpB1vC,QAAS6B,EACTjG,MAAOiK,EACPguB,SAAUA,EAAShyB,GACnB8rC,aAAcA,EACdxc,aAAcA,GALTtvB,SAWjB,CACA,SAAS6tC,IAAsB,QAC7B1vC,EAAO,MACPpE,EAAK,SACLi4B,EAAQ,aACR8Z,EAAY,aACZxc,IAQA,MAAM,EAAEx7B,IAAM1B,EAAAA,EAAAA,IAAe,kBACvB07C,EAAenwB,GAAAA,GAAAA,aAAsBxf,EAAS,EAAG2tC,IAChDxtB,EAAOyvB,IAAYl7C,EAAAA,EAAAA,WAAS,IAAMkH,EAAQ+zC,KACjDr2C,EAAAA,EAAAA,YAAU,IAAMs2C,EAASh0C,EAAQ+zC,IAAe,CAAC/zC,EAAO+zC,IAExD,MAAMrvB,EAAOxgB,GAAAA,GAAAA,KAAYE,GACnB6vC,EAAe1vB,EAAQwvB,EAEvBJ,EAAOpvB,EAAQwvB,EAAgBnwB,GAAAA,GAAAA,aAAsBxf,GAAY,IACjE8vC,EAAW3e,EAAa7nB,QAC5B,CAAC3T,EAAGo6C,IAAOp6C,GAAKo6C,IAAO/vC,EAAU,EAAI,IACrC,GAEIgwC,EAA4B,GAAhB,EAAIF,GAEhBG,EAAU9vB,EAAQ,KAAS6vB,EAC3BE,GAAYj6C,EAAAA,EAAAA,cACfgX,GAAc4mB,EAAS5mB,EAAI0iC,IAC5B,CAAC9b,EAAU8b,IAGb,OACE,QAAC/uC,GAAA,EAAK,CAACtO,QAAS,GAAI,WAClB,QAAC8E,EAAA,EAAG,CACFpF,QAAQ,OACRyL,IAAK,EACLQ,eAAe,gBACfP,WAAW,SAAQ,WAEnB,QAACrH,EAAA,EAAQ,CACP1C,GAAI,CACFmX,EAAG,GACH0K,SAAU,OACVhZ,SAAU,EACVxK,QAAS,OACTyL,IAAK,EACLC,WAAY,SACZO,eAAgB,UAChB,WAEF,QAAC6f,GAAA,EAAQ,CAAC9d,QAASA,EAAStB,UAAW,CAAEhL,SAAU,aAClDoM,GAAAA,GAAAA,OAAcE,GACdF,GAAAA,GAAAA,KAAYE,OAEf,QAACwd,GAAA,EAAgB,CACfjnB,OACE,QAAC2D,EAAA,EAAU,UACRvE,EACCm6C,EACK,8BACA,0BACL,CAAEl0C,MAAOo0C,MAIfvyB,UAAU,MAAK,UAEf,QAACpnB,EAAA,EAAQ,CAAC1C,GAAI,CAAE+I,UAAW,SAAUoO,EAAG,GAAK0K,SAAU,OAAQ,UAC7D,QAAC,KAAS,CAACriB,MAAO88C,EAAU,eAAY78C,EAAU,UAAC,QAC7C,4BAASm8C,EAAGjyB,QAAQ,GAAG,kBAKnC,QAAClmB,EAAA,EAAG,CACFpF,QAAQ,OACRyL,IAAK,EACLQ,eAAe,gBACfP,WAAW,SAAQ,WAEnB,QAACpB,GAAA,GAAiB,CAChBnJ,MAAO08C,EAAe,UAAY,UAClClzC,MAAgC,MAAzBmD,GAAAA,GAAAA,KAAYE,GACnBpD,aACEkD,GAAAA,GAAAA,KAAYE,KAAY,QAAC5I,EAAA,EAAG,CAACnF,MAAM,MAAM6I,UAAU,SAErDc,MAAOu0C,WAAWN,EAAavyB,QAAQ,IACvCzjB,SAAWgM,QAAYzS,IAANyS,GAAmBguB,EAAShuB,GAC7ClS,GAAI,CAAE4hB,aAAc,EAAGlZ,GAAI,EAAGnK,OAAQ,OAAQD,MAAO,OACrDwK,WAAY,CAAE9I,GAAI,CAAE+I,UAAW,SAAWkL,IAAK,MAEjD,QAACvR,EAAA,EAAQ,CACP1C,GAAI,CACF0I,GAAI,EACJG,SAAU,EACVxK,QAAS,OACTyL,IAAK,EACLC,WAAY,SACZO,eAAgB,SAChByhB,SAAU,WACV,UAEF,QAAC0L,GAAA,GAAM,CACL1yB,KAAK,QACLkD,MAAOukB,EACPtY,IAAKmoC,EACLpoC,IAAK,EACL2jB,KAAM,EACNF,OAAK,EACLG,kBAAkB,OAClB3xB,SAAU,CAACX,EAAG2M,IAAM+pC,EAAS/pC,GAC7BylB,kBAAmB,CAACpyB,EAAG2M,IAAMqqC,EAAUrqC,QAG3C,QAACvJ,GAAA,GAAiB,CAChBnJ,MAAOyI,EAASq0C,EAAU,UAAY,UAAa,UACnDtzC,OAAK,EACLgyC,gBACE,QAACv3C,EAAA,EAAG,CACFzD,GAAI,CACFk8B,WAAY,SACZ59B,MAAO,MACPD,QAAS,OACTiM,eAAgB,iBAChB,WAEF,2BACG+hB,EAAAA,GAAAA,IAAiB2vB,EAAcrvB,GAC/BA,MAEH,yBAAM,SAGV1kB,MAAOu0C,WAAWhwB,EAAM7C,QAAQ,IAChCzjB,SAAWgM,QAAYzS,IAANyS,GAAmBguB,EAAShuB,EAAI8pC,GACjDh8C,GAAI,CAAE4hB,aAAc,EAAGlZ,GAAI,EAAGuyC,GAAI,EAAG18C,OAAQ,OAAQD,MAAO,OAC5DwK,WAAY,CAAE9I,GAAI,CAAE+I,UAAW,QAASouC,GAAI,IAAOljC,IAAK,EAAG2jB,KAAM,UAK3E,C,gBE77Be,SAAS6kB,KACtB,MAAM,UAAEj8C,IAAcG,EAAAA,EAAAA,YAAWC,EAAAA,IAC3B,IAAEH,GAAQD,EACVU,GAAeC,EAAAA,EAAAA,KACrB,IAAKV,EAAIu2C,WAAW,YAAa,OAAO,KAExC,MAAM3nC,EAAawN,GAAAA,GAAAA,MAAqBtX,GAAM9E,EAAIi8C,cAAcluC,SAASjJ,KACzE,OAAK8J,GAGH,QAAC2Y,GAAA,EAAc,CACbxoB,MAAO6P,EACPzM,OAAO,4BAAS+5C,EAAAA,GAAAA,IAAK,WAAUttC,OAAwB,SAEtDutC,EAAAA,GAAAA,KAAsBtwC,IACrB,QAAC4b,GAAA,EAAQ,CAEP5F,SAAUjT,IAAe/C,EACzBhE,SAAU+G,IAAe/C,EACzB5K,QAAS,IACPR,GAAa27C,EAAAA,EAAAA,IAAkBp8C,EAAoB6L,IACpD,UAED,4BACE,QAAC,KAAS,CAAC9M,MAAO8M,EAAO,UAAEqwC,EAAAA,GAAAA,IAAK,WAAUrwC,UARvCA,OATW,IAuB1B,C,4BCjCe,SAASwwC,KACtB,MAAM,EAAE96C,IAAM1B,EAAAA,EAAAA,IAAe,OACvB,SAAE0D,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,IAC1B,UAAEzD,IAAcG,EAAAA,EAAAA,YAAWC,EAAAA,IAC3B,IAAEH,GAAQD,GACV,OAAEQ,IAAWC,EAAAA,EAAAA,KACb87C,GAAez6C,EAAAA,EAAAA,cACnB,IAAM0B,EAASg5C,OAAOvqC,IAAI,CAAEzR,OAAmB,MAAXA,EAAiB,IAAM,OAC3D,CAACA,EAAQgD,IAEX,OAAKvD,EAAIu2C,WAAW,aAElB,QAACv1C,EAAA,EAAM,CACLC,QAASq7C,EACTp7C,UAAsB,MAAXX,GAAiB,QAACi8C,GAAA,EAAM,KAAM,QAACC,GAAA,EAAI,IAAI,WAElD,2BAASl7C,EAAG,UAAShB,OAAoB,OANL,IAS1C,C,eC2Ce,SAASm8C,KACtB,MAAMxV,GAAWC,EAAAA,EAAAA,OACX,SAAE5jC,IAAarD,EAAAA,EAAAA,YAAWsD,EAAAA,GAC1BxB,GAAUH,EAAAA,EAAAA,cAAY,IAAMqlC,EAAS,gBAAgB,CAACA,KACtD,aAAEjnC,IAAiB08C,EAAAA,EAAAA,MAEzB,OADoBp5C,EAASqZ,MAAM1d,KAAK6O,SAAS9N,IAC1B,QAAC,KAAQ,CAACshC,GAAG,iBAGlC,QAACv+B,EAAA,EAAG,CAACw3C,GAAI,EAAG58C,QAAQ,OAAO2lB,cAAc,SAASla,IAAK,EAAE,UACvD,QAAC,EAAA1I,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAS,SAEvEmC,IACC,QAAC28C,GAAoB,CAAC38C,aAAcA,EAAc+B,QAASA,OAKrE,CAMA,SAAS46C,IAAqB,aAC5B38C,EAAY,QACZ+B,IAC4B,UAC5B,MAAMjC,GAAY88C,EAAAA,EAAAA,GAAa58C,IACzB,OAAEM,IAAWC,EAAAA,EAAAA,KACbV,GAAiB0e,EAAAA,EAAAA,GAAave,EAAcM,GAC5C2hC,GAAWC,EAAAA,EAAAA,GAAYliC,IACrBoL,OAAQwtC,GAAuC,OAA3B,EAAW,MAAR3W,OAAQ,EAARA,EAAWjiC,IAAa,EAAI,CAAC,GAE1D68C,QAAQ,IAAEC,EAAM,aAC6C,OAA9D,GAAGC,EAAAA,EAAAA,IAAS,CAAEzsC,KAAM,4BAA6B0sC,KAAK,KAAQ,EAAI,CACjEH,OAAQ,CAAEC,IAAK,cAEX,EAAEx7C,IAAM1B,EAAAA,EAAAA,IAAe,CAAC,gBAAiB,oBAE/Cq9C,EAAAA,EAAAA,IACEx5C,EAAAA,EAAAA,UACE,IACG,GAAEnC,EAAG,kBAAgBi1C,EAAAA,EAAAA,IAAkBv2C,EAAcM,WAAgBgB,EACnE,uBAAsBw7C,QAE3B,CAACx7C,EAAGtB,EAAcM,EAAQw8C,KAI9B,MAAMn0C,GAAoB84B,EAAAA,EAAAA,GAAkC,OAAf,EAAU,MAAT3hC,OAAS,EAATA,EAAWC,KAAG,EAAI,IAE1D84C,GAA+Cp1C,EAAAA,EAAAA,UAAQ,KAC3D,GAAKw+B,GAAa2W,EAClB,MAAO,CACLp2C,KAAMo2C,EACN3W,WACA/zB,aAASnP,EACV,GACA,CAAC65C,EAAY3W,IAEVib,GAAyDz5C,EAAAA,EAAAA,UAAQ,KACrE,GAAK3D,GAAcD,EACnB,MAAO,CACLC,YACAD,iBACA8I,oBACD,GACA,CAAC7I,EAAWD,EAAgB8I,KAExBorB,EAAW0M,IAAgBpgC,EAAAA,EAAAA,eAAStB,IACpCq1B,EAAaqD,IAAkBp3B,EAAAA,EAAAA,YAChC88C,GAAiD15C,EAAAA,EAAAA,UAAQ,KACtD,CACLswB,YACA0M,eACArM,cACAqD,oBAED,CAAC1D,EAAWK,IAQf,OALAnvB,EAAAA,EAAAA,YAAU,KACRw7B,OAAa1hC,GACb04B,OAAe14B,EAAU,GACxB,CAACiB,KAGF,QAACgC,EAAA,EAAQ,UACN62C,GAAoBqE,GAAyBC,GAC5C,QAACj9C,EAAA,WAAyB,CAACqH,MAAO21C,EAAsB,UACtD,QAACz6C,EAAA,WAAoB,CAAC8E,MAAOsxC,EAAiB,UAC5C,QAACt5C,EAAagnC,SAAQ,CAACh/B,MAAO41C,EAAkB,UAC9C,QAAC,IAAkB,WACjB,QAAC96C,EAAA,EAAW,CACV/C,GAAI,CAAE3B,QAAS,OAAQ2lB,cAAe,SAAUla,IAAK,GAAI,WAEzD,QAACrG,EAAA,EAAG,CAACpF,QAAQ,OAAM,WACjB,QAACoF,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAGE,SAAS,OAAOnB,SAAU,EAAE,WACtD,QAACxI,EAAgB,KACjB,QAACo8C,GAAqB,KACtB,QAACK,GAAoB,KACrB,QAACgB,GAAgB,KACjB,QAACC,EAAA,EAAuB,KACxB,QAACC,GAAc,SAEdv7C,IAAW,QAACK,EAAA,EAAW,CAACpB,QAASe,QAEtC,QAACgB,EAAA,EAAG,CAACpF,QAAQ,OAAOyL,IAAK,EAAGE,SAAS,OAAM,UACxCxJ,IACC,QAAC65C,EAAA,EAAW,CACVtvB,MAAOvqB,EAAUuqB,MACjB+C,UAAWttB,EAAUstB,UACrB6Y,QAASt9B,KAGb,QAAC,KAAa,CAACtE,KAAK,WACpB,QAAC,KAAoB,KACrB,QAAC,KAAc,CAACA,KAAK,cAEvB,QAACJ,EAAA,EAAS,WACR,QAACs5C,GAAM,CAACT,IAAKA,OAEf,QAACU,GAAc,KACf,QAACv5C,EAAA,EAAS,WACR,QAACs5C,GAAM,CAACT,IAAKA,kBAQzB,QAACj6C,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,OAI7D,CACA,SAAS2/C,KACP,OACE,QAAC,EAAA98C,SAAQ,CACPC,UAAU,QAACkC,EAAA,EAAQ,CAACC,QAAQ,cAAclF,MAAM,OAAOC,OAAQ,MAAQ,UAEvE,QAAC,KAAM,YAEL,QAAC,KAAK,CAACohC,OAAK,EAACv1B,SAAS,QAACynC,GAAW,OAClC,QAAC,KAAK,CAAC7gC,KAAK,UAAU5G,SAAS,QAAC,GAAS,OACzC,QAAC,KAAK,CAAC4G,KAAK,aAAa5G,SAAS,QAACwqC,GAAY,OAC/C,QAAC,KAAK,CAAC5jC,KAAK,YAAY5G,SAAS,QAAC62B,GAAQ,OAC1C,QAAC,KAAK,CAACjwB,KAAK,eAAe5G,SAAS,QAACutC,GAAc,UAI3D,CACA,SAASsG,IAAO,IAAET,IAChB,MAAM,IAAQl9C,EAAAA,EAAAA,IAAe,kBAC7B,OACE,QAAC69C,EAAA,EAAI,CACHl2C,MAAOu1C,EACPh6C,QAAQ,aACR46C,0BAAwB,EACxBp+C,GAAI,CACF,uBAAwB,CACtByH,WAAY,8BACZwkB,gBAAiB,0BAEnB,WAEF,QAACoyB,EAAA,EAAG,CACFr+C,GAAI,CAAE6hB,SAAU,OAChB5Z,MAAM,WACNiC,MAAOlI,EAAE,iBACT0C,MAAM,QAAC45C,EAAA,EAAM,IACbn3C,UAAWm/B,EAAAA,GACXtE,GAAG,MAEL,QAACqc,EAAA,EAAG,CACFr+C,GAAI,CAAE6hB,SAAU,OAChB5Z,MAAM,SACNiC,MAAOlI,EAAE,eACT0C,MAAM,QAAC65C,EAAA,EAAS,IAChBp3C,UAAWm/B,EAAAA,GACXtE,GAAG,YAEL,QAACqc,EAAA,EAAG,CACFr+C,GAAI,CAAE6hB,SAAU,OAChB5Z,MAAM,YACNiC,MAAOlI,EAAE,kBACT0C,MAAM,QAAC85C,EAAA,EAAM,IACbr3C,UAAWm/B,EAAAA,GACXtE,GAAG,eAEL,QAACqc,EAAA,EAAG,CACFr+C,GAAI,CAAE6hB,SAAU,OAChB5Z,MAAM,WACNiC,MAAOlI,EAAE,iBACT0C,MAAM,QAACsiC,EAAA,EAAU,IACjB7/B,UAAWm/B,EAAAA,GACXtE,GAAG,cAEL,QAACqc,EAAA,EAAG,CACFr+C,GAAI,CAAE6hB,SAAU,OAChB5Z,MAAM,cACNiC,MAAOlI,EAAE,oBACT0C,MAAM,QAACsjC,EAAA,EAAO,IACd7gC,UAAWm/B,EAAAA,GACXtE,GAAG,kBAIX,CAEA,SAAS8b,KACP,MAAM,EAAE97C,IAAM1B,EAAAA,EAAAA,IAAe,mBACtBkC,EAAMyZ,EAAQxZ,IAAWyZ,EAAAA,EAAAA,MAE9B1b,WAAW,WAAE8M,KACX3M,EAAAA,EAAAA,YAAWC,EAAAA,GACT69C,EAAYp6C,OAAO1E,KAAK2N,GAAYsC,OAC1C,OACE,yBACE,QAACnO,EAAA,EAAM,CAACjC,MAAM,OAAOmC,WAAW,QAAC+8C,EAAA,EAAQ,IAAKh9C,QAASua,EAAO,UAC3Dja,EAAC,UAAC,qBACAy8C,IACD,QAACz5C,EAAA,EAAO,CAAChF,GAAI,CAAE2G,GAAI,GAAKnH,MAAM,UAAS,SACpCi/C,QAIP,QAACzxC,GAAS,CAACxK,KAAMA,EAAMC,QAASA,MAGtC,CACA,SAASu7C,KACP,MAAM,YAAEW,IAAgBh+C,EAAAA,EAAAA,YAAWwB,EAAAA,GACnC,OACE,yBACE,QAACV,EAAA,EAAM,CAACjC,MAAM,OAAOmC,WAAW,QAACi9C,EAAA,EAAS,IAAKl9C,QAASi9C,EAAY,UAAC,YACzD,IAAI,aAEhB,QAAC18C,GAAY,MAGnB,C,6DCxTe,SAAS26B,IACtB,MAAMx+B,GAAQysB,EAAAA,EAAAA,KACR1I,GAAKmtB,EAAAA,EAAAA,GAAclxC,EAAMmxC,YAAYC,GAAG,OACxCpkC,GAAKkkC,EAAAA,EAAAA,GAAclxC,EAAMmxC,YAAYC,GAAG,OACxCziC,GAAKuiC,EAAAA,EAAAA,GAAclxC,EAAMmxC,YAAYC,GAAG,OAE9C,OADWF,EAAAA,EAAAA,GAAclxC,EAAMmxC,YAAYC,GAAG,OAC/B,KACXziC,EAAW,KACX3B,EAAW,KACX+W,EAAW,KACR,IACT,C,iDCXO,SAAS8c,EAAqB4f,GACnC,MAAO,CAACC,EAAU5sC,KAChB,MAAM6sC,EAAMD,EAAIlvC,OAChB,OAAImvC,IAAQF,EAAQjvC,OAAe,CAACsC,GACxB,IAAR6sC,GAAaD,EAAI,KAAO5sC,EAAU,IAAI2sC,GACnC,IAAI,IAAI1uC,KAAImhB,EAAAA,EAAAA,IAAUwtB,EAAK5sC,IAAI,CAE1C,C,kBCNO,SAASq8B,EACdyQ,EACAC,EACAC,EACAC,EAA0B,IAE1B,MAAO,CAAC3qC,EAAM2G,KACZ,IAAK,MAAMikC,KAAUJ,EAAY,CAC/B,IAAIK,EAAO,EACX,MAAMC,EAASJ,EAAQE,GACjBG,EAAKD,EAAO9qC,GACZgrC,EAAKF,EAAOnkC,GAIlB,GAFEkkC,EADgB,iBAAPE,GAAiC,iBAAPC,EAC5BD,EAAG/gC,cAAcghC,GACbA,EAAiBD,EACjB,IAATF,EACF,OAAOF,EAAgB3wC,SAAS4wC,GAC5BC,GACCJ,GAAa,EAAI,GAAKI,CAC/B,CACA,OAAO,CAAC,CAEZ,CAWO,SAAS9hC,EACdkiC,EACA5iB,GAEA,OAAQ6iB,GACNr7C,OAAOC,QAAQm7C,GAAel7C,OAC5B,EAAEo7C,EAAWC,KACX/iB,EAAc8iB,IACd9iB,EAAc8iB,GAAkBD,EAAKE,EAAWH,IAExD,C","sources":["webpack:///./src/app/Components/Character/ThumbSide.tsx","webpack:///./src/app/Components/ConditionalWrapper.tsx","webpack:///./src/app/Components/StarDisplay.tsx","webpack:///./src/app/Context/GraphContext.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/CharSelectButton.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/FormulaModal.tsx","webpack:///./src/app/Components/ExpandButton.tsx","webpack:///./src/app/Components/StatInput.tsx","webpack:///./src/app/Components/EnemyEditor.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/StatModal.tsx","webpack:///./src/app/Context/OptimizationTargetContext.tsx","webpack:///./src/app/Solver/common.ts","webpack:///../../libs/util/src/lib/queue.ts","webpack:///./src/app/Solver/coordinator.ts","webpack:///./src/app/Solver/GOSolver/GOSolver.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/useBuildSetting.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/AllowChar.tsx","webpack:///./src/app/Components/Artifact/SetEffectDisplay.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ArtifactSetConfig.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/AssumeFullLevelToggle.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/BonusStatsCard.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/BuildAlert.tsx","webpack:///./src/app/Components/Character/LocationIcon.tsx","webpack:///./src/app/Components/StatDisplay.tsx","webpack:///./src/app/Components/Artifact/ArtifactCardNano.tsx","webpack:///./src/app/Components/Character/StatDisplayComponent.tsx","webpack:///./src/app/Components/Weapon/WeaponCardNano.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ArtifactSetBadges.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/BuildDisplayItem.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/useBuildResult.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/CustomDot.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/CustomTooltip.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/EnhancedPoint.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ChartCard/index.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/ExcludeArt.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/MainStatSelectionCard.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/OptimizationTargetEditorList.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/Components/StatFilterCard.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/foreground.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOptimize/index.tsx","webpack:///./src/app/ReactHooks/useGlobalError.tsx","webpack:///../../libs/char-cards/src/index.ts","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/CompareBuildButton.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/ArtifactSwapModal.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/WeaponSwapModal.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/EquipmentSection.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabOverview/index.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTalent.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTeambuffs.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTheorycraft/index.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/Tabs/TabTheorycraft/useCharTC.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/TravelerElementSelect.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/TravelerGenderSelect.tsx","webpack:///./src/app/PageCharacter/CharacterDisplay/index.tsx","webpack:///./src/app/ReactHooks/useMediaQueryUp.tsx","webpack:///./src/app/Util/MultiSelect.ts","webpack:///./src/app/Util/SortByFilters.ts"],"sourcesContent":["import { styled } from '@mui/material'\n\nconst ThumbSide = styled('img')(({ theme }) => ({\n  display: 'inline-block',\n  width: 'auto',\n  height: `2.3em`,\n  lineHeight: 1,\n  verticalAlign: 'text-bottom',\n  marginTop: theme.spacing(-3),\n  marginLeft: theme.spacing(-1.25),\n  marginRight: theme.spacing(-1),\n  marginBottom: theme.spacing(-1),\n}))\n\nexport default ThumbSide\n","import type { ReactNode } from 'react'\n\ntype Prop = {\n  condition: boolean\n  wrapper: (children: ReactNode) => ReactNode\n  falseWrapper?: (children: ReactNode) => ReactNode\n  children: ReactNode\n}\n// Wrap children with element provided by wrapper func when condition is true.\nexport default function ConditionalWrapper({\n  condition,\n  wrapper,\n  falseWrapper,\n  children,\n}: Prop) {\n  return (\n    condition\n      ? wrapper(children)\n      : falseWrapper\n      ? falseWrapper(children)\n      : children\n  ) as JSX.Element\n}\n","import type { RarityKey } from '@genshin-optimizer/consts'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport ColorText from './ColoredText'\nexport const StarsDisplay = ({\n  stars = 1,\n  colored = false,\n  inline = false,\n}: {\n  stars?: RarityKey\n  colored?: boolean\n  inline?: boolean\n}) => (\n  <ColorText color={colored ? 'warning' : undefined}>\n    {[...Array(stars).keys()].map((_, i) => (\n      <StarRoundedIcon\n        key={i}\n        fontSize={inline ? 'inherit' : undefined}\n        sx={inline ? { verticalAlign: 'text-top' } : undefined}\n      />\n    ))}\n  </ColorText>\n)\n","import { createContext } from 'react'\nimport type { NumNode } from '../Formula/type'\nimport type { Build } from '../Solver/common'\n\nexport type ChartData = {\n  valueNode: NumNode\n  plotNode: NumNode\n  data: Build[]\n}\nexport type GraphContextObj = {\n  chartData?: ChartData\n  setChartData: (data: ChartData | undefined) => void\n  graphBuilds: string[][] | undefined\n  setGraphBuilds: (builds: string[][] | undefined) => void\n}\nexport const GraphContext = createContext({} as GraphContextObj)\n","import { Button } from '@mui/material'\nimport React, { Suspense, useContext, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { characterAsset } from '@genshin-optimizer/g-assets'\nimport ThumbSide from '../../Components/Character/ThumbSide'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport useCharSelectionCallback from '../../ReactHooks/useCharSelectionCallback'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\n\nconst CharacterSelectionModal = React.lazy(\n  () => import('../CharacterSelectionModal')\n)\n\nexport default function CharSelectButton() {\n  const { t } = useTranslation('page_character')\n  const {\n    characterSheet,\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const [showModal, setshowModal] = useState(false)\n  const { gender } = useDBMeta()\n  const setCharacter = useCharSelectionCallback()\n  return (\n    <>\n      <Suspense fallback={false}>\n        <CharacterSelectionModal\n          show={showModal}\n          onHide={() => setshowModal(false)}\n          onSelect={setCharacter}\n        />\n      </Suspense>\n      <Button\n        color=\"info\"\n        onClick={() => setshowModal(true)}\n        startIcon={\n          <ThumbSide src={characterAsset(characterKey, 'iconSide', gender)} />\n        }\n      >\n        {characterSheet?.name ?? t('selectCharacter')}\n      </Button>\n    </>\n  )\n}\n","import { ExpandMore } from '@mui/icons-material'\nimport {\n  Accordion,\n  AccordionDetails,\n  AccordionSummary,\n  Box,\n  CardContent,\n  CardHeader,\n  Divider,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport type { MutableRefObject } from 'react'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport AmpReactionModeText from '../../Components/AmpReactionModeText'\nimport CardDark from '../../Components/Card/CardDark'\nimport CardHeaderCustom from '../../Components/Card/CardHeaderCustom'\nimport CardLight from '../../Components/Card/CardLight'\nimport CloseButton from '../../Components/CloseButton'\nimport ColorText from '../../Components/ColoredText'\nimport ImgIcon from '../../Components/Image/ImgIcon'\nimport ModalWrapper from '../../Components/ModalWrapper'\nimport SqBadge from '../../Components/SqBadge'\nimport { DataContext } from '../../Context/DataContext'\nimport { FormulaDataContext } from '../../Context/FormulaDataContext'\nimport { DatabaseContext } from '../../Database/Database'\nimport { getDisplayHeader, getDisplaySections } from '../../Formula/DisplayUtil'\nimport type { DisplaySub } from '../../Formula/type'\nimport type { NodeDisplay } from '../../Formula/uiData'\nimport { nodeVStr } from '../../Formula/uiData'\nimport type { AmpReactionKey } from '../../Types/consts'\nimport { allAmpReactions } from '../../Types/consts'\n\nexport default function FormulaModal() {\n  const { modalOpen } = useContext(FormulaDataContext)\n  const { setFormulaData } = useContext(FormulaDataContext)\n  const onCloseHandler = useCallback(\n    () => setFormulaData?.(undefined, undefined),\n    [setFormulaData]\n  )\n  return (\n    <ModalWrapper open={!!modalOpen} onClose={onCloseHandler}>\n      <CardDark>\n        <CardHeader\n          title=\"Formulas & Calculations\"\n          action={<CloseButton onClick={onCloseHandler} />}\n        />\n        <CardContent sx={{ pt: 0 }}>\n          <CalculationDisplay />\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n\nfunction CalculationDisplay() {\n  const { data } = useContext(DataContext)\n  const { data: contextData } = useContext(FormulaDataContext)\n  const sections = getDisplaySections(contextData ?? data)\n  return (\n    <Suspense\n      fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={1000} />}\n    >\n      <Box sx={{ mr: -1, mb: -1 }}>\n        {sections.map(([key, Nodes]) => (\n          <FormulaCalc key={key} displayNs={Nodes} sectionKey={key} />\n        ))}\n      </Box>\n    </Suspense>\n  )\n}\nfunction FormulaCalc({\n  sectionKey,\n  displayNs,\n}: {\n  displayNs: DisplaySub<NodeDisplay>\n  sectionKey: string\n}) {\n  const { data } = useContext(DataContext)\n  const { database } = useContext(DatabaseContext)\n  const { data: contextData } = useContext(FormulaDataContext)\n  const header = useMemo(\n    () => getDisplayHeader(contextData ?? data, sectionKey, database),\n    [database, contextData, data, sectionKey]\n  )\n  if (!header) return null\n  if (Object.entries(displayNs).every(([_, node]) => node.isEmpty)) return null\n  const { title, icon, action } = header\n  return (\n    <CardLight sx={{ mb: 1 }}>\n      <CardHeaderCustom\n        avatar={icon && <ImgIcon size={2} src={icon} />}\n        title={title}\n        action={action && <SqBadge>{action}</SqBadge>}\n      />\n      <Divider />\n      <CardContent>\n        {Object.entries(displayNs).map(\n          ([key, node]) =>\n            !node.isEmpty && <FormulaAccordian key={key} node={node} />\n        )}\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction FormulaAccordian({ node }: { node: NodeDisplay }) {\n  const { node: contextNode } = useContext(FormulaDataContext)\n  const [expanded, setExpanded] = useState(false)\n  const handleChange = useCallback(\n    (e: React.SyntheticEvent, isExpanded: boolean) => setExpanded(isExpanded),\n    []\n  )\n  const scrollRef =\n    useRef<HTMLDivElement>() as MutableRefObject<HTMLDivElement | null>\n\n  useEffect(() => {\n    if (node === contextNode)\n      setTimeout(\n        () => scrollRef?.current?.scrollIntoView?.({ behavior: 'smooth' }),\n        300\n      )\n  }, [scrollRef, node, contextNode])\n\n  return (\n    <Accordion\n      sx={{ bgcolor: 'contentDark.main' }}\n      expanded={node === contextNode || expanded}\n      onChange={handleChange}\n      ref={scrollRef}\n    >\n      <AccordionSummary expandIcon={<ExpandMore />}>\n        <Typography>\n          <ColorText color={node.info.variant}>{node.info.name}</ColorText>{' '}\n          <strong>{nodeVStr(node)}</strong>\n        </Typography>\n        {allAmpReactions.includes(node.info.variant as 'vaporize' | 'melt') && (\n          <Box sx={{ display: 'inline-block', ml: 'auto', mr: 2 }}>\n            <AmpReactionModeText\n              reaction={node.info.variant as AmpReactionKey}\n              trigger={\n                node.info.subVariant as 'cryo' | 'pyro' | 'hydro' | undefined\n              }\n            />\n          </Box>\n        )}\n      </AccordionSummary>\n      <AccordionDetails>\n        {node.formulas.map((subform, i) => (\n          <Typography key={i} component=\"div\">\n            {subform}\n          </Typography>\n        ))}\n      </AccordionDetails>\n    </Accordion>\n  )\n}\n","import type { IconButtonProps } from '@mui/material'\nimport { IconButton, styled } from '@mui/material'\n\ninterface ExpandMoreProps extends IconButtonProps {\n  expand: boolean\n}\nconst ExpandButton = styled((props: ExpandMoreProps) => {\n  const { expand, ...other } = props\n  return <IconButton {...other} />\n})(({ theme, expand }) => ({\n  transform: !expand ? 'rotate(0deg)' : 'rotate(180deg)',\n  marginLeft: 'auto',\n  transition: (theme as any).transitions.create('transform', {\n    duration: (theme as any).transitions.duration.shortest,\n  }),\n}))\n\nexport default ExpandButton\n","import { Replay } from '@mui/icons-material'\nimport type { ButtonGroupProps } from '@mui/material'\nimport { Button, ButtonGroup, styled } from '@mui/material'\nimport type { ReactNode } from 'react'\nimport CustomNumberInput, {\n  CustomNumberInputButtonGroupWrapper,\n} from './CustomNumberInput'\nimport TextButton from './TextButton'\n\ntype StatInputInput = ButtonGroupProps & {\n  name: Displayable\n  children?: ReactNode\n  value: number\n  placeholder?: string\n  defaultValue?: number\n  onValueChange: (newValue: number | undefined) => void\n  percent?: boolean\n  disabled?: boolean\n  onReset?: () => void\n}\nconst FlexButtonGroup = styled(ButtonGroup)({\n  display: 'flex',\n})\n\nexport default function StatInput({\n  name,\n  children,\n  value,\n  placeholder,\n  defaultValue = 0,\n  onValueChange,\n  percent = false,\n  disabled = false,\n  onReset,\n  ...restProps\n}: StatInputInput) {\n  return (\n    <FlexButtonGroup {...restProps}>\n      {children}\n      <TextButton sx={{ px: 1 }}>{name}</TextButton>\n      <CustomNumberInputButtonGroupWrapper\n        sx={{ flexBasis: '10em', flexGrow: 1 }}\n      >\n        <CustomNumberInput\n          sx={{ px: 1 }}\n          inputProps={{\n            sx: { textAlign: 'right' },\n          }}\n          float={percent}\n          placeholder={placeholder}\n          value={value}\n          onChange={onValueChange}\n          disabled={disabled}\n          endAdornment={percent ? '%' : undefined}\n        />\n      </CustomNumberInputButtonGroupWrapper>\n      <Button\n        sx={{ flexShrink: 2 }}\n        size=\"small\"\n        color=\"error\"\n        onClick={() => (onReset ? onReset() : onValueChange(defaultValue))}\n        disabled={disabled || value === defaultValue}\n      >\n        <Replay />\n      </Button>\n    </FlexButtonGroup>\n  )\n}\n","import type { ElementWithPhyKey } from '@genshin-optimizer/consts'\nimport { allElementWithPhyKeys } from '@genshin-optimizer/consts'\nimport {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  ExpandMore,\n  Replay,\n} from '@mui/icons-material'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Chip,\n  Collapse,\n  Grid,\n  Typography,\n} from '@mui/material'\nimport { useCallback, useContext, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { CharacterContext } from '../Context/CharacterContext'\nimport { DataContext } from '../Context/DataContext'\nimport { uiInput as input } from '../Formula'\nimport { nodeVStr } from '../Formula/uiData'\nimport KeyMap from '../KeyMap'\nimport { ElementIcon } from '../KeyMap/StatIcon'\nimport { iconInlineProps } from '../SVGIcons'\nimport CardLight from './Card/CardLight'\nimport ColorText from './ColoredText'\nimport ExpandButton from './ExpandButton'\nimport StatInput from './StatInput'\n\nexport function EnemyExpandCard() {\n  const { t } = useTranslation('ui')\n  const { characterDispatch } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const [expanded, setexpanded] = useState(false)\n  const toggle = useCallback(\n    () => setexpanded(!expanded),\n    [setexpanded, expanded]\n  )\n  const eLvlNode = data.get(input.enemy.level)\n  const eDefRed = data.get(input.enemy.defRed)\n  const eDefIgn = data.get(input.enemy.defIgn)\n  const onReset = useCallback(\n    () => characterDispatch({ enemyOverride: {} }),\n    [characterDispatch]\n  )\n\n  return (\n    <CardLight>\n      <CardContent\n        sx={{ display: 'flex', gap: 1, alignItems: 'center', flexWrap: 'wrap' }}\n      >\n        <Chip\n          size=\"small\"\n          color=\"success\"\n          label={\n            <span>\n              {eLvlNode.info.name} <strong>{eLvlNode.value}</strong>\n            </span>\n          }\n        />\n        {allElementWithPhyKeys.map((element) => (\n          <Typography key={element}>\n            <EnemyResText element={element} />\n          </Typography>\n        ))}\n        <Typography>DEF Red. {nodeVStr(eDefRed)}</Typography>\n        <Typography>DEF Ignore {nodeVStr(eDefIgn)}</Typography>\n        <Box flexGrow={1} display=\"flex\" justifyContent=\"flex-end\" gap={1}>\n          <Button\n            size=\"small\"\n            color=\"error\"\n            onClick={onReset}\n            startIcon={<Replay />}\n          >{t`reset`}</Button>\n          <ExpandButton\n            expand={expanded}\n            onClick={toggle}\n            aria-expanded={expanded}\n            aria-label=\"show more\"\n            size=\"small\"\n            sx={{ marginLeft: 0 }}\n          >\n            <ExpandMore />\n          </ExpandButton>\n        </Box>\n      </CardContent>\n      <Collapse in={expanded} timeout=\"auto\" unmountOnExit>\n        <CardContent sx={{ pt: 0 }}>\n          <EnemyEditor />\n        </CardContent>\n      </Collapse>\n    </CardLight>\n  )\n}\n\nexport function EnemyResText({ element }: { element: ElementWithPhyKey }) {\n  const { data } = useContext(DataContext)\n  const node = data.get(input.enemy[`${element}_res_`])\n  const immune = !isFinite(node.value)\n  const icon = <ElementIcon ele={element} iconProps={iconInlineProps} />\n  const content = immune ? (\n    <span>{icon} &#8734;</span>\n  ) : (\n    <span>\n      {icon} <strong>{nodeVStr(node)}</strong>\n    </span>\n  )\n  return <ColorText color={element}>{content}</ColorText>\n}\n\nexport function EnemyEditor({\n  bsProps = { xs: 12, md: 6 },\n}: {\n  bsProps?: object\n}) {\n  const {\n    character: { enemyOverride },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const defaultVal = 10\n\n  const eLvl = enemyOverride.enemyLevel ?? data.get(input.lvl).value\n  const eDefRed = enemyOverride.enemyDefIgn_ ?? 0\n  const eDefIgn = enemyOverride.enemyDefRed_ ?? 0\n  return (\n    <Grid container spacing={1}>\n      <Grid item {...bsProps}>\n        <Button\n          fullWidth\n          sx={{ height: '100%' }}\n          size=\"small\"\n          component=\"a\"\n          color=\"warning\"\n          href=\"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances\"\n          target=\"_blank\"\n          rel=\"noreferrer\"\n        >\n          To get the specific resistance values of enemies, please visit the\n          wiki.\n        </Button>\n      </Grid>\n      <Grid item {...bsProps}>\n        <StatInput\n          sx={{ bgcolor: (t) => t.palette.contentLight.main, width: '100%' }}\n          name={<b>{KeyMap.get('enemyLevel')}</b>}\n          value={eLvl}\n          placeholder={KeyMap.getStr('enemyLevel')}\n          defaultValue={data.get(input.lvl).value}\n          onValueChange={(value) =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyLevel',\n              value,\n            })\n          }\n          onReset={() =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyLevel',\n              value: undefined,\n            })\n          }\n        />\n      </Grid>\n      {allElementWithPhyKeys.map((eleKey) => {\n        const statKey = `${eleKey}_enemyRes_`\n        const val = enemyOverride[statKey]\n        const elementImmunity = val === Number.MAX_VALUE\n        return (\n          <Grid item key={eleKey} {...bsProps}>\n            <StatInput\n              sx={{\n                bgcolor: (t) => t.palette.contentLight.main,\n                width: '100%',\n              }}\n              name={\n                <ColorText color={eleKey}>\n                  <b>{KeyMap.get(statKey)}</b>\n                </ColorText>\n              }\n              value={\n                val !== undefined ? (elementImmunity ? Infinity : val) : 10\n              }\n              placeholder={elementImmunity ? '∞ ' : KeyMap.getStr(statKey)}\n              defaultValue={defaultVal}\n              onValueChange={(value) =>\n                characterDispatch({ type: 'enemyOverride', statKey, value })\n              }\n              disabled={elementImmunity}\n              percent\n            >\n              <Button\n                color={eleKey}\n                onClick={() =>\n                  characterDispatch({\n                    type: 'enemyOverride',\n                    statKey,\n                    value: elementImmunity ? defaultVal : Number.MAX_VALUE,\n                  })\n                }\n                startIcon={\n                  elementImmunity ? <CheckBox /> : <CheckBoxOutlineBlank />\n                }\n              >\n                Immunity\n              </Button>\n            </StatInput>\n          </Grid>\n        )\n      })}\n      <Grid item {...bsProps}>\n        <StatInput\n          sx={{ bgcolor: (t) => t.palette.contentLight.main, width: '100%' }}\n          name={<b>{KeyMap.get('enemyDefIgn_')}</b>}\n          value={eDefRed}\n          placeholder={KeyMap.getStr('enemyDefIgn_')}\n          defaultValue={0}\n          onValueChange={(value) =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyDefIgn_',\n              value,\n            })\n          }\n          percent\n        />\n      </Grid>\n      <Grid item {...bsProps}>\n        <StatInput\n          sx={{ bgcolor: (t) => t.palette.contentLight.main, width: '100%' }}\n          name={<b>{KeyMap.get('enemyDefRed_')}</b>}\n          value={eDefIgn}\n          placeholder={KeyMap.getStr('enemyDefRed_')}\n          defaultValue={0}\n          onValueChange={(value) =>\n            characterDispatch({\n              type: 'enemyOverride',\n              statKey: 'enemyDefRed_',\n              value,\n            })\n          }\n          percent\n        />\n      </Grid>\n      <Grid item xs={12}>\n        <small>\n          Note: Genshin Impact halves resistance shred values below 0%. For the\n          sake of calculations enter the RAW value and GO will do the rest.\n          (e.g. 10% - 20% = -10%)\n        </small>\n      </Grid>\n    </Grid>\n  )\n}\n","import {\n  CardContent,\n  CardHeader,\n  Grid,\n  ListItem,\n  Stack,\n  Typography,\n  Box,\n  Alert,\n} from '@mui/material'\nimport { useCallback, useContext, useMemo } from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport CardDark from '../../Components/Card/CardDark'\nimport CardLight from '../../Components/Card/CardLight'\nimport CloseButton from '../../Components/CloseButton'\nimport ColorText from '../../Components/ColoredText'\nimport { EnemyExpandCard } from '../../Components/EnemyEditor'\nimport {\n  FieldDisplayList,\n  NodeFieldDisplay,\n} from '../../Components/FieldDisplay'\nimport ModalWrapper from '../../Components/ModalWrapper'\nimport StatEditorList from '../../Components/StatEditorList'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport { DataContext } from '../../Context/DataContext'\nimport { allInputPremodKeys, uiInput as input } from '../../Formula'\nimport type { ReadNode } from '../../Formula/type'\nimport { nodeVStr } from '../../Formula/uiData'\nimport { allEleDmgKeys, allEleResKeys } from '../../KeyMap'\n\nconst cols = {\n  xs: 1,\n  md: 2,\n  lg: 3,\n}\n\nexport default function StatModal({ open, onClose }) {\n  const { t } = useTranslation('page_character')\n  return (\n    <ModalWrapper open={open} onClose={onClose}>\n      <CardDark>\n        <CardHeader\n          title={t`addStats.title`}\n          action={<CloseButton onClick={onClose} />}\n        />\n        <CardContent sx={{ pt: 0 }}>\n          <Stack spacing={1}>\n            <BonusStatsEditor />\n            <EnemyExpandCard />\n            <MainStatsCards />\n          </Stack>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\nconst keys = [...allInputPremodKeys]\nconst wrapperFunc = (e: JSX.Element, key?: string) => (\n  <Grid item key={key} xs={1}>\n    {e}\n  </Grid>\n)\nfunction BonusStatsEditor() {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { bonusStats },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const setFilter = useCallback(\n    (bonusStats) => characterDispatch({ bonusStats }),\n    [characterDispatch]\n  )\n  return (\n    <CardLight>\n      <CardContent sx={{ display: 'flex' }}>\n        <Grid container columns={cols} sx={{ pt: 1 }} spacing={1}>\n          <Grid item xs={12}>\n            <Alert severity=\"info\" variant=\"filled\">\n              <Trans i18nKey={'addStats.info'} t={t}>\n                You can use these fields to add buffs/debuffs not directly\n                supported in GO, such as food buffs, abyss cards, or\n                Superconduct. Please refer to the{' '}\n                <a href=\"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki\">\n                  Genshin Impact wiki\n                </a>{' '}\n                for specific values.\n              </Trans>\n            </Alert>\n          </Grid>\n          <StatEditorList\n            statKeys={keys}\n            statFilters={bonusStats}\n            setStatFilters={setFilter}\n            wrapperFunc={wrapperFunc}\n          />\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\n\nconst mainBaseKeys = ['hp', 'atk', 'def'] as const\nconst mainSubKeys = [\n  'eleMas',\n  'critRate_',\n  'critDMG_',\n  'enerRech_',\n  'heal_',\n] as const\nconst mainReadNodes = [...mainBaseKeys, ...mainSubKeys].map(\n  (k) => input.total[k]\n)\nconst mainEditKeys = [\n  'atk_',\n  'atk',\n  'hp_',\n  'hp',\n  'def_',\n  'def',\n  ...mainSubKeys,\n] as const\n\nconst otherStatKeys = [\n  ...allEleDmgKeys,\n  ...allEleResKeys,\n  'stamina',\n  'incHeal_',\n  'shield_',\n  'cdRed_',\n] as const\n\nconst miscStatkeys = allInputPremodKeys.filter(\n  (k) =>\n    !(mainEditKeys as readonly string[]).includes(k) &&\n    !(otherStatKeys as readonly string[]).includes(k)\n)\n\nfunction StatDisplayContent({\n  nodes,\n  extra,\n}: {\n  nodes: ReadNode<number>[]\n  extra?: Displayable\n}) {\n  const { data, oldData } = useContext(DataContext)\n  return (\n    <FieldDisplayList>\n      {nodes.map((rn) => (\n        <NodeFieldDisplay\n          component={ListItem}\n          key={JSON.stringify(rn.info)}\n          node={data.get(rn)}\n          oldValue={oldData?.get(rn)?.value}\n        />\n      ))}\n      {extra}\n    </FieldDisplayList>\n  )\n}\n\nfunction MainStatsCards() {\n  const { characterSheet } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const specialNode = data.get(input.special)\n  const charEle = characterSheet.elementKey\n  const isMelee = characterSheet.isMelee()\n\n  const otherStatReadNodes = useMemo(() => {\n    const nodes = otherStatKeys\n      .filter((k) => {\n        if (k.includes(charEle)) return false\n        if (isMelee && k.includes('physical')) return true\n        return true\n      })\n      .map((k) => input.total[k])\n\n    return nodes.filter((n) => !!data.get(n).value)\n  }, [data, charEle, isMelee])\n\n  const miscStatReadNodes = useMemo(\n    () =>\n      miscStatkeys.map((k) => input.total[k]).filter((n) => data.get(n).value),\n    [data]\n  )\n\n  return (\n    <CardLight>\n      <CardContent>\n        <Grid container columns={cols} spacing={1}>\n          <Grid item xs={1}>\n            <StatDisplayCard title=\"Main Stats\">\n              <StatDisplayContent\n                nodes={mainReadNodes}\n                extra={\n                  specialNode && (\n                    <ListItem\n                      sx={{ display: 'flex', justifyContent: 'space-between' }}\n                    >\n                      <span>\n                        <b>Special:</b>{' '}\n                        <ColorText color={specialNode.info.variant}>\n                          {specialNode.info.icon} {specialNode.info.name}\n                        </ColorText>\n                      </span>\n                      <span>{nodeVStr(specialNode)}</span>\n                    </ListItem>\n                  )\n                }\n              />\n            </StatDisplayCard>\n          </Grid>\n          <Grid item xs={1}>\n            <StatDisplayCard title=\"Other Stats\">\n              <StatDisplayContent nodes={otherStatReadNodes} />\n            </StatDisplayCard>\n          </Grid>\n          {!!miscStatReadNodes.length && (\n            <Grid item xs={1}>\n              <StatDisplayCard title=\"Misc Stats\">\n                <StatDisplayContent nodes={miscStatReadNodes} />\n              </StatDisplayCard>\n            </Grid>\n          )}\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction StatDisplayCard({ title, children }) {\n  return (\n    <CardDark>\n      <CardContent sx={{ py: 1 }}>\n        <Box display=\"flex\" justifyContent=\"space-between\">\n          <Typography variant=\"subtitle1\">{title}</Typography>\n        </Box>\n      </CardContent>\n      {children}\n    </CardDark>\n  )\n}\n","import { createContext } from 'react'\n\nexport const OptimizationTargetContext = createContext(\n  undefined as string[] | undefined\n)\n","import type { ArtSetExclusion } from '../Database/DataManagers/BuildSettingData'\nimport { forEachNodes, mapFormulas } from '../Formula/internal'\nimport type { OptNode } from '../Formula/optimization'\nimport { allOperations, constantFold } from '../Formula/optimization'\nimport type { ConstantNode } from '../Formula/type'\nimport { constant, customRead, max, min, threshold } from '../Formula/utils'\nimport type { ArtifactSetKey, SlotKey } from '../Types/consts'\nimport { allSlotKeys } from '../Types/consts'\nimport { assertUnreachable, objectKeyMap, objectMap, range } from '../Util/Util'\n\ntype MicropassOperation =\n  | 'reaffine'\n  | 'pruneArtRange'\n  | 'pruneNodeRange'\n  | 'pruneOrder'\nexport function pruneAll(\n  nodes: OptNode[],\n  minimum: number[],\n  arts: ArtifactsBySlot,\n  numTop: number,\n  exclusion: ArtSetExclusion,\n  forced: Dict<MicropassOperation, boolean>\n): { nodes: OptNode[]; arts: ArtifactsBySlot } {\n  let should = forced\n  /** If `key` makes progress, all operations in `value` should be performed */\n  const deps: StrictDict<MicropassOperation, Dict<MicropassOperation, true>> = {\n    pruneOrder: { pruneNodeRange: true },\n    pruneArtRange: { pruneNodeRange: true },\n    pruneNodeRange: { reaffine: true },\n    reaffine: { pruneOrder: true, pruneArtRange: true, pruneNodeRange: true },\n  }\n  let count = 0\n  while (Object.values(should).some((x) => x) && count++ < 20) {\n    if (should.pruneOrder) {\n      delete should.pruneOrder\n      const newArts = pruneOrder(arts, numTop, exclusion)\n      if (arts !== newArts) {\n        arts = newArts\n        should = { ...should, ...deps.pruneOrder }\n      }\n    }\n    if (should.pruneArtRange) {\n      delete should.pruneArtRange\n      const newArts = pruneArtRange(nodes, arts, minimum)\n      if (arts !== newArts) {\n        arts = newArts\n        should = { ...should, ...deps.pruneArtRange }\n      }\n    }\n    if (should.pruneNodeRange) {\n      delete should.pruneNodeRange\n      const newNodes = pruneNodeRange(nodes, arts)\n      if (nodes !== newNodes) {\n        nodes = newNodes\n        should = { ...should, ...deps.pruneNodeRange }\n      }\n    }\n    if (should.reaffine) {\n      delete should.reaffine\n      const { nodes: newNodes, arts: newArts } = reaffine(nodes, arts)\n      if (nodes !== newNodes || arts !== newArts) {\n        nodes = newNodes\n        arts = newArts\n        should = { ...should, ...deps.reaffine }\n      }\n    }\n  }\n  return { nodes, arts }\n}\n\nexport function pruneExclusion(\n  nodes: OptNode[],\n  exclusion: ArtSetExclusion\n): OptNode[] {\n  const maxValues: Dict<keyof typeof exclusion, number> = {}\n  for (const [key, e] of Object.entries(exclusion)) {\n    if (!e.includes(4)) continue\n    maxValues[key] = e.includes(2) ? 1 : 3\n  }\n  return mapFormulas(\n    nodes,\n    (f) => f,\n    (f) => {\n      if (f.operation !== 'threshold') return f\n\n      const [v, t, pass, fail] = f.operands\n      if (v.operation === 'read' && t.operation === 'const') {\n        const key = v.path[v.path.length - 1],\n          thres = t.value\n        if (key in maxValues) {\n          const max: number = maxValues[key]\n          if (max < thres) return fail\n          if (thres === 2 && exclusion[key]!.includes(2))\n            return threshold(v, 4, pass, fail)\n        }\n      }\n      return f\n    }\n  )\n}\n\nfunction reaffine(\n  nodes: OptNode[],\n  arts: ArtifactsBySlot,\n  forceRename = false\n): { nodes: OptNode[]; arts: ArtifactsBySlot } {\n  const affineNodes = new Set<OptNode>(),\n    topLevelAffine = new Set<OptNode>()\n\n  function visit(node: OptNode, isAffine: boolean) {\n    if (isAffine) affineNodes.add(node)\n    else\n      node.operands.forEach(\n        (op) => affineNodes.has(op) && topLevelAffine.add(op)\n      )\n  }\n\n  const dynKeys = new Set<string>()\n\n  forEachNodes(\n    nodes,\n    (_) => {},\n    (f) => {\n      const { operation } = f\n      switch (operation) {\n        case 'read':\n          dynKeys.add(f.path[1])\n          visit(f, true)\n          break\n        case 'add':\n          visit(\n            f,\n            f.operands.every((op) => affineNodes.has(op))\n          )\n          break\n        case 'mul': {\n          const nonConst = f.operands.filter((op) => op.operation !== 'const')\n          visit(\n            f,\n            nonConst.length === 0 ||\n              (nonConst.length === 1 && affineNodes.has(nonConst[0]))\n          )\n          break\n        }\n        case 'const':\n          visit(f, true)\n          break\n        case 'res':\n        case 'threshold':\n        case 'sum_frac':\n        case 'max':\n        case 'min':\n          visit(f, false)\n          break\n        default:\n          assertUnreachable(operation)\n      }\n    }\n  )\n\n  if (\n    [...topLevelAffine].every(\n      ({ operation }) => operation === 'read' || operation === 'const'\n    ) &&\n    Object.keys(arts.base).length === dynKeys.size\n  )\n    return { nodes, arts }\n\n  let current = -1\n  function nextDynKey(): string {\n    while (dynKeys.has(`${++current}`));\n    return `${current}`\n  }\n\n  nodes.forEach((node) => affineNodes.has(node) && topLevelAffine.add(node))\n  const affine = [...topLevelAffine].filter((f) => f.operation !== 'const')\n  const affineMap = new Map(\n    affine.map((node) => [\n      node,\n      !forceRename && node.operation === 'read' && node.path[0] === 'dyn'\n        ? node\n        : { ...customRead(['dyn', `${nextDynKey()}`]), accu: 'add' as const },\n    ])\n  )\n  nodes = mapFormulas(\n    nodes,\n    (f) => affineMap.get(f) ?? f,\n    (f) => f\n  )\n\n  function reaffineArt(stat: DynStat): DynStat {\n    const values = constantFold(\n      [...affineMap.keys()],\n      {\n        dyn: objectMap(stat, (value) => constant(value)),\n      } as any,\n      (_) => true\n    )\n    return Object.fromEntries(\n      [...affineMap.values()].map((v, i) => [\n        v.path[1],\n        (values[i] as ConstantNode<number>).value,\n      ])\n    )\n  }\n  const result = {\n    nodes,\n    arts: {\n      base: reaffineArt(arts.base),\n      values: objectKeyMap(allSlotKeys, (slot) =>\n        arts.values[slot].map(({ id, set, values }) => ({\n          id,\n          set,\n          values: reaffineArt(values),\n        }))\n      ),\n    },\n  }\n  const offsets = Object.entries(reaffineArt({}))\n  for (const arts of Object.values(result.arts.values))\n    for (const { values } of arts)\n      for (const [key, baseValue] of offsets) values[key] -= baseValue\n  return result\n}\n/** Remove artifacts that cannot be in top `numTop` builds */\nfunction pruneOrder(\n  arts: ArtifactsBySlot,\n  numTop: number,\n  exclusion: ArtSetExclusion\n): ArtifactsBySlot {\n  let progress = false\n  /**\n   * Note:\n   * This function assumes that every base (reaffined) stats are monotonically increasing. That is, artifacts\n   * with higher stats are better. This remains true as long as the main and substats are in increasing. Set\n   * effects that decrease enemy resistance (which is monotonically decreasing) does not violate this assumption\n   * as set effects are not handled here.\n   */\n  const allowRainbow = !exclusion.rainbow?.length,\n    keys = Object.keys(arts.base)\n  const noSwitchIn = new Set(\n    Object.entries(exclusion)\n      .filter(([_, v]) => v.length)\n      .map(([k]) => k) as ArtifactSetKey[]\n  )\n  const noSwitchOut = new Set(\n    Object.entries(exclusion)\n      .filter(([_, v]) => v.includes(2) && !v.includes(4))\n      .map(([k]) => k) as ArtifactSetKey[]\n  )\n  const values = objectKeyMap(allSlotKeys, (slot) => {\n    const list = arts.values[slot]\n    const newList = list.filter((art) => {\n      let count = 0\n      return list.every((other) => {\n        const otherBetterEqual = keys.every(\n          (k) => (other.values[k] ?? 0) >= (art.values[k] ?? 0)\n        )\n        const otherMaybeBetter = keys.some(\n          (k) => (other.values[k] ?? 0) > (art.values[k] ?? 0)\n        )\n        const otherBetter =\n          otherBetterEqual && (otherMaybeBetter || other.id > art.id)\n        const canSwitch =\n          (allowRainbow &&\n            !noSwitchIn.has(other.set!) &&\n            !noSwitchOut.has(art.set!)) ||\n          art.set === other.set\n        if (otherBetter && canSwitch) count++\n        return count < numTop\n      })\n    })\n    if (newList.length !== list.length) progress = true\n    return newList\n  })\n  return progress ? { base: arts.base, values } : arts\n}\n/** Remove artifacts that cannot reach `minimum` in any build */\nfunction pruneArtRange(\n  nodes: OptNode[],\n  arts: ArtifactsBySlot,\n  minimum: number[]\n): ArtifactsBySlot {\n  const baseRange = Object.fromEntries(\n    Object.entries(arts.base).map(([key, x]) => [key, { min: x, max: x }])\n  )\n  const wrap = { arts }\n  while (true) {\n    const artRanges = objectKeyMap(allSlotKeys, (slot) =>\n      computeArtRange(wrap.arts.values[slot])\n    )\n    const otherArtRanges = objectKeyMap(allSlotKeys, (key) =>\n      addArtRange(\n        Object.entries(artRanges)\n          .map((a) => (a[0] === key ? baseRange : a[1]))\n          .filter((x) => x)\n      )\n    )\n\n    let progress = false\n    const values = objectKeyMap(allSlotKeys, (slot) => {\n      const result = wrap.arts.values[slot].filter((art) => {\n        const read = addArtRange([computeArtRange([art]), otherArtRanges[slot]])\n        const newRange = computeNodeRange(nodes, read)\n        return nodes.every(\n          (node, i) => newRange.get(node)!.max >= (minimum[i] ?? -Infinity)\n        )\n      })\n      if (result.length !== wrap.arts.values[slot].length) progress = true\n      return result\n    })\n    if (!progress) break\n    wrap.arts = { base: wrap.arts.base, values }\n  }\n  return wrap.arts\n}\nfunction pruneNodeRange(nodes: OptNode[], arts: ArtifactsBySlot): OptNode[] {\n  const baseRange = Object.fromEntries(\n    Object.entries(arts.base).map(([key, x]) => [key, { min: x, max: x }])\n  )\n  const reads = addArtRange([\n    baseRange,\n    ...Object.values(arts.values).map((values) => computeArtRange(values)),\n  ])\n  const nodeRange = computeNodeRange(nodes, reads)\n\n  return mapFormulas(\n    nodes,\n    (f) => {\n      {\n        const { min, max } = nodeRange.get(f)!\n        if (min === max) return constant(min)\n      }\n      const { operation } = f\n      const operandRanges = f.operands.map((x) => nodeRange.get(x)!)\n      switch (operation) {\n        case 'threshold': {\n          const [value, threshold, pass, fail] = operandRanges\n          if (value.min >= threshold.max) return f.operands[2]\n          else if (value.max < threshold.min) return f.operands[3]\n          if (\n            pass.max === pass.min &&\n            fail.max === fail.min &&\n            pass.min === fail.min &&\n            isFinite(pass.min)\n          )\n            return constant(pass.max)\n          break\n        }\n        case 'min': {\n          const newOperands = f.operands.filter((_, i) => {\n            const op1 = operandRanges[i]\n            return operandRanges.every((op2) => op1.min <= op2.max)\n          })\n          if (newOperands.length < operandRanges.length)\n            return min(...newOperands)\n          break\n        }\n        case 'max': {\n          const newOperands = f.operands.filter((_, i) => {\n            const op1 = operandRanges[i]\n            return operandRanges.every((op2) => op1.max >= op2.min)\n          })\n          if (newOperands.length < operandRanges.length)\n            return max(...newOperands)\n          break\n        }\n      }\n      return f\n    },\n    (f) => f\n  )\n}\nfunction addArtRange(ranges: DynMinMax[]): DynMinMax {\n  const result: DynMinMax = {}\n  ranges.forEach((range) => {\n    Object.entries(range).forEach(([key, value]) => {\n      if (result[key]) {\n        result[key].min += value.min\n        result[key].max += value.max\n      } else result[key] = { ...value }\n    })\n  })\n  return result\n}\nfunction computeArtRange(arts: ArtifactBuildData[]): DynMinMax {\n  const result: DynMinMax = {}\n  if (arts.length) {\n    Object.keys(arts[0].values)\n      .filter((key) => arts.every((art) => art.values[key]))\n      .forEach(\n        (key) =>\n          (result[key] = { min: arts[0].values[key], max: arts[0].values[key] })\n      )\n    arts.forEach(({ values }) => {\n      for (const [key, value] of Object.entries(values)) {\n        if (!result[key]) result[key] = { min: 0, max: value }\n        else {\n          if (result[key].max < value) result[key].max = value\n          if (result[key].min > value) result[key].min = value\n        }\n      }\n    })\n  }\n  return result\n}\nexport function computeFullArtRange(arts: ArtifactsBySlot): DynMinMax {\n  const baseRange = Object.fromEntries(\n    Object.entries(arts.base).map(([key, x]) => [key, { min: x, max: x }])\n  )\n  return addArtRange([\n    baseRange,\n    ...Object.values(arts.values).map((values) => computeArtRange(values)),\n  ])\n}\nexport function computeNodeRange(\n  nodes: OptNode[],\n  reads: DynMinMax\n): Map<OptNode, MinMax> {\n  const range = new Map<OptNode, MinMax>()\n\n  forEachNodes(\n    nodes,\n    (_) => {},\n    (f) => {\n      const { operation } = f\n      const operands = f.operands.map((op) => range.get(op)!)\n      let current: MinMax\n      switch (operation) {\n        case 'read':\n          if (f.path[0] !== 'dyn')\n            throw new Error(\n              `Found non-dyn path ${f.path} while computing range`\n            )\n          current = reads[f.path[1]] ?? { min: 0, max: 0 }\n          break\n        case 'const':\n          current = computeMinMax([f.value])\n          break\n        case 'add':\n        case 'min':\n        case 'max':\n          current = {\n            min: allOperations[operation](operands.map((x) => x.min)),\n            max: allOperations[operation](operands.map((x) => x.max)),\n          }\n          break\n        case 'res':\n          current = {\n            min: allOperations[operation]([operands[0].max]),\n            max: allOperations[operation]([operands[0].min]),\n          }\n          break\n        case 'mul':\n          current = operands.reduce((accu, current) =>\n            computeMinMax([\n              accu.min * current.min,\n              accu.min * current.max,\n              accu.max * current.min,\n              accu.max * current.max,\n            ])\n          )\n          break\n        case 'threshold':\n          if (operands[0].min >= operands[1].max) current = operands[2]\n          else if (operands[0].max < operands[1].min) current = operands[3]\n          else current = computeMinMax([], [operands[2], operands[3]])\n          break\n        case 'sum_frac': {\n          const [x, c] = operands,\n            sum = { min: x.min + c.min, max: x.max + c.max }\n          if (sum.min <= 0 && sum.max >= 0)\n            current =\n              x.min <= 0 && x.max >= 0\n                ? { min: NaN, max: NaN }\n                : { min: -Infinity, max: Infinity }\n          // TODO: Check this\n          else\n            current = computeMinMax([\n              x.min / sum.min,\n              x.min / sum.max,\n              x.max / sum.min,\n              x.max / sum.max,\n            ])\n          break\n        }\n        default:\n          assertUnreachable(operation)\n      }\n      range.set(f, current)\n    }\n  )\n  return range\n}\nfunction computeMinMax(\n  values: readonly number[],\n  minMaxes: readonly MinMax[] = []\n): MinMax {\n  const max = Math.max(...values, ...minMaxes.map((x) => x.max))\n  const min = Math.min(...values, ...minMaxes.map((x) => x.min))\n  return { min, max }\n}\n\nexport function filterArts(\n  arts: ArtifactsBySlot,\n  filters: RequestFilter\n): ArtifactsBySlot {\n  return {\n    base: arts.base,\n    values: objectKeyMap(allSlotKeys, (slot) => {\n      const filter = filters[slot]\n      switch (filter.kind) {\n        case 'id':\n          return arts.values[slot].filter((art) => filter.ids.has(art.id))\n        case 'exclude':\n          return arts.values[slot].filter((art) => !filter.sets.has(art.set!))\n        case 'required':\n          return arts.values[slot].filter((art) => filter.sets.has(art.set!))\n      }\n    }),\n  }\n}\n\nexport function mergeBuilds(builds: Build[][], maxNum: number): Build[] {\n  return builds\n    .flatMap((x) => x)\n    .sort((a, b) => b.value - a.value)\n    .slice(0, maxNum)\n}\nexport function mergePlot(plots: PlotData[]): PlotData {\n  let scale = 0.01\n  const reductionScaling = 2,\n    maxCount = 1500\n  let keys = new Set(\n    plots.flatMap((x) =>\n      Object.values(x).map((v) => Math.round(v.plot! / scale))\n    )\n  )\n  while (keys.size > maxCount) {\n    scale *= reductionScaling\n    keys = new Set([...keys].map((key) => Math.round(key / reductionScaling)))\n  }\n  const result: PlotData = {}\n  for (const plot of plots)\n    for (const build of Object.values(plot)) {\n      const x = Math.round(build.plot! / scale) * scale\n      if (!result[x] || result[x]!.value < build.value) result[x] = build\n    }\n  return result\n}\n\nexport function countBuilds(arts: ArtifactsBySlot): number {\n  return allSlotKeys.reduce(\n    (_count, slot) => _count * arts.values[slot].length,\n    1\n  )\n}\n\nexport function* filterFeasiblePerm(\n  filters: Iterable<RequestFilter>,\n  _artSets: ArtifactsBySlot\n): Iterable<RequestFilter> {\n  const artSets = objectMap(\n    _artSets.values,\n    (values) => new Set(values.map((v) => v.set))\n  )\n  filter_loop: for (const filter of filters) {\n    for (const [slot, f] of Object.entries(filter)) {\n      const available = artSets[slot]!\n      switch (f.kind) {\n        case 'required':\n          if ([...f.sets].every((s) => !available.has(s))) continue filter_loop\n          break\n        case 'exclude':\n          if ([...available].every((s) => f.sets.has(s!))) continue filter_loop\n          break\n        case 'id':\n          break\n      }\n    }\n    yield filter\n  }\n}\nexport function exclusionToAllowed(\n  exclusion: number[] | undefined\n): Set<number> {\n  return new Set(\n    exclusion?.includes(2)\n      ? exclusion.includes(4)\n        ? [0, 1]\n        : [0, 1, 4, 5]\n      : exclusion?.includes(4)\n      ? [0, 1, 2, 3]\n      : [0, 1, 2, 3, 4, 5]\n  )\n}\n/** A *disjoint* set of `RequestFilter` satisfying the exclusion rules */\nexport function* artSetPerm(\n  exclusion: ArtSetExclusion,\n  _artSets: ArtifactSetKey[]\n): Iterable<RequestFilter> {\n  /**\n   * This generation algorithm is separated into two parts:\n   * - \"Shape\" generation\n   *   - It first generates all build \"shapes\", e.g., AABBC, ABBCD\n   *   - It then filters the generated shapes according to the rainbow exclusion, e.g., removes ABBCD if excluding 3 rainbows\n   *   - It then merges the remaining shapes into wildcards, e.g. AABAA + AABAB + AABAC => AABA*\n   * - Shape filling\n   *   - From the given shapes, it tries to fill in all non-rainbow slots, e.g., slots A and B of AABBC, with actual artifacts\n   *   - It then fills the rainbow slots, e.g., slot C of AABBC while ensuring the exclusion rule of each sets\n   */\n  const artSets = [...new Set(_artSets)],\n    allowedRainbows = exclusionToAllowed(exclusion.rainbow)\n  let shapes: number[][] = []\n  function populateShapes(\n    current: number[],\n    list: Set<number>,\n    rainbows: number[]\n  ) {\n    if (current.length === 5) {\n      if (allowedRainbows.has(rainbows.length)) shapes.push(current)\n      return\n    }\n    for (const i of list)\n      populateShapes(\n        [...current, i],\n        list,\n        rainbows.filter((j) => j !== i)\n      )\n    populateShapes(\n      [...current, current.length],\n      new Set([...list, current.length]),\n      [...rainbows, current.length]\n    )\n  }\n  populateShapes([0], new Set([0]), [0])\n  function indexOfShape(shape: number[], replacing: number) {\n    if (range(replacing + 1, 4).some((i) => shape[i] !== 5)) return undefined\n    shape = [...shape]\n    shape[replacing] = 5\n    return shape.reduce((a, b) => a * 6 + b, 0)\n  }\n  for (let replacing = 4; replacing >= 0; replacing--) {\n    const required: Map<number, number> = new Map()\n    for (const shape of shapes) {\n      const id = indexOfShape(shape, replacing)\n      if (id === undefined) continue\n      required.set(\n        id,\n        (required.get(id) ?? new Set(shape.slice(0, replacing)).size + 1) - 1\n      )\n    }\n    for (const [id, remaining] of required.entries()) {\n      if (remaining === 0) {\n        const shape = [\n          ...shapes.find((shape) => indexOfShape(shape, replacing) === id)!,\n        ]\n        shape[replacing] = 5\n        shapes = shapes.filter((shape) => indexOfShape(shape, replacing) !== id)\n        shapes.push(shape)\n      }\n    }\n  }\n\n  // Shapes are now calculated and merged, proceed to fill in the sets\n\n  const noFilter = { kind: 'exclude' as const, sets: new Set<ArtifactSetKey>() }\n  const result: RequestFilter = objectKeyMap(allSlotKeys, (_) => noFilter)\n\n  const counts = {\n    ...objectMap(exclusion, (_) => 0),\n    ...objectKeyMap(artSets, (_) => 0),\n  }\n  const allowedCounts = objectMap(exclusion, exclusionToAllowed)\n\n  function* check(shape: number[]) {\n    const used: Set<ArtifactSetKey> = new Set(),\n      rainbows: number[] = []\n    let groupped: number[][] = []\n    for (const i of shape) {\n      groupped.push([])\n      if (i === 5) rainbows.push(groupped.length - 1)\n      else groupped[i].push(groupped.length - 1)\n    }\n    groupped = groupped\n      .filter((v) => v.length)\n      .sort((a, b) => b.length - a.length)\n    let usableRainbows = rainbows.length\n\n    // Inception.. because js doesn't like functions inside a for-loop\n    function* check(i: number) {\n      if (i === groupped.length) return yield* check_free(0)\n\n      for (const set of artSets) {\n        if (used.has(set)) continue\n        const length = groupped[i].length,\n          allowedSet = allowedCounts[set]\n        let requiredRainbows = 0\n\n        if (allowedSet && !allowedSet.has(length)) {\n          // Look ahead and see if we have enough rainbows to fill to the next `allowedSet` if we use the current set\n          requiredRainbows =\n            (range(length + 1, 5).find((l) => allowedSet.has(l)) ?? 6) - length\n          if (requiredRainbows > usableRainbows) continue // Not enough rainbows. Next..\n        }\n\n        used.add(set)\n        counts[set] = groupped[i].length\n        groupped[i].forEach(\n          (j) =>\n            (result[allSlotKeys[j]] = {\n              kind: 'required',\n              sets: new Set([set]),\n            })\n        )\n        usableRainbows -= requiredRainbows\n\n        yield* check(i + 1)\n\n        usableRainbows += requiredRainbows\n        counts[set] = 0\n        used.delete(set)\n      }\n    }\n    // We separate filling rainbow slots from groupped slots because it has an entirely\n    // different set of rules regarding what can be filled and what states to be kept.\n    function* check_free(i: number) {\n      const remaining = rainbows.length - i,\n        isolated: ArtifactSetKey[] = [],\n        missing: ArtifactSetKey[] = [],\n        rejected: ArtifactSetKey[] = []\n      let required = 0\n      for (const set of artSets) {\n        const allowedSet = allowedCounts[set],\n          count = counts[set]\n        if (!allowedSet) continue\n        if (range(1, remaining).every((j) => !allowedSet.has(count + j)))\n          rejected.push(set)\n        else if (!allowedSet.has(count)) {\n          required += [...allowedSet].find((x) => x > count)! - count\n          missing.push(set)\n        } else if (range(0, remaining).some((j) => !allowedSet.has(count + j)))\n          isolated.push(set)\n      }\n      if (required > remaining) return\n      if (i === rainbows.length) {\n        yield { ...result }\n        return\n      }\n      if (required === remaining) {\n        for (const set of missing) {\n          counts[set]++\n          result[allSlotKeys[rainbows[i]]] = {\n            kind: 'required',\n            sets: new Set([set]),\n          }\n          yield* check_free(i + 1)\n          counts[set]--\n        }\n        return\n      }\n      for (const set of [...isolated, ...missing]) {\n        counts[set]++\n        result[allSlotKeys[rainbows[i]]] = {\n          kind: 'required',\n          sets: new Set([set]),\n        }\n        yield* check_free(i + 1)\n        counts[set]--\n      }\n      result[allSlotKeys[rainbows[i]]] = {\n        kind: 'exclude',\n        sets: new Set([...missing, ...rejected, ...isolated]),\n      }\n      yield* check_free(i + 1)\n    }\n    yield* check(0)\n  }\n  for (const shape of shapes) yield* check(shape)\n}\n\nexport type RequestFilter = StrictDict<\n  SlotKey,\n  | { kind: 'required'; sets: Set<ArtifactSetKey> }\n  | { kind: 'exclude'; sets: Set<ArtifactSetKey> }\n  | { kind: 'id'; ids: Set<string> }\n>\n\nexport type DynStat = { [key in string]: number }\nexport type ArtifactBuildData = {\n  id: string\n  set?: ArtifactSetKey\n  values: DynStat\n}\nexport type ArtifactsBySlot = {\n  base: DynStat\n  values: StrictDict<SlotKey, ArtifactBuildData[]>\n}\n\nexport type PlotData = Dict<number, Build>\nexport interface Build {\n  value: number\n  plot?: number\n  artifactIds: string[]\n}\n\nexport type DynMinMax = { [key in string]: MinMax }\nexport type MinMax = { min: number; max: number }\n","export class MaxPrio<V> {\n  // Fibonacci Heap\n  list: (PrioNode<V> | undefined)[] = []\n  maxNode: PrioNode<V> | undefined\n\n  insert(key: number, value: V): void {\n    let node: PrioNode<V> | undefined = { key, value, children: [] }\n    if (!this.maxNode || this.maxNode.key < key)\n      [this.maxNode, node] = [node, this.maxNode]\n    if (node) this.addNode(node, node.children.length)\n  }\n  pop(): V | undefined {\n    if (!this.maxNode) return\n    const { value, children } = this.maxNode\n    children.forEach((child, i) => this.addNode(child, i))\n\n    const [_, maxDegree] = this.list.reduce(\n      (max, cur, iCur) =>\n        !cur || (max[0] && max[0].key > cur.key) ? max : [cur, iCur],\n      [undefined as PrioNode<V> | undefined, -1]\n    )\n    if (maxDegree === this.list.length - 1) this.maxNode = this.list.pop()\n    else this.maxNode = this.popNode(maxDegree)\n    return value\n  }\n\n  private addNode(node: PrioNode<V>, degree: number): void {\n    let other: PrioNode<V> | undefined\n    while ((other = this.popNode(degree))) {\n      if (other.key > node.key) {\n        other.children.push(node)\n        node = other\n      } else node.children.push(other)\n      degree += 1\n    }\n    this.list[degree] = node\n  }\n  private popNode(degree: number): PrioNode<V> | undefined {\n    const result = this.list[degree]\n    this.list[degree] = undefined\n    return result\n  }\n}\n\ninterface PrioNode<V> {\n  key: number\n  value: V\n  children: PrioNode<V>[]\n}\n\nexport class FIFO<T> {\n  // Simple two-stack implementation\n  head: T[] = []\n  tail: T[] = []\n\n  get length(): number {\n    return this.head.length + this.tail.length\n  }\n  push(t: T): void {\n    this.tail.push(t)\n  }\n  pop(): T | undefined {\n    if (!this.head.length && this.tail.length)\n      [this.head, this.tail] = [this.tail.reverse(), this.head]\n    return this.head.pop()\n  }\n}\n","import { FIFO } from '@genshin-optimizer/util'\n\nexport class WorkerCoordinator<\n  Command extends { command: string; resultType?: never },\n  Response extends { command?: never; resultType: string }\n> {\n  prio: Map<Command['command'], number>\n  commands: FIFO<Command>[]\n  workers: Promise<Worker>[]\n  workDone: Map<Worker, () => void> = new Map()\n  _workers: Worker[]\n\n  cancel: (e?: Error) => void\n  cancelled: Promise<never>\n  callback: (_: Response, w: Worker) => void\n  notifyNonEmpty: (() => void) | undefined\n\n  constructor(\n    workers: Worker[],\n    prio: Command['command'][],\n    callback: (_: Response, w: Worker) => void\n  ) {\n    this.commands = prio.map((_) => new FIFO())\n    this.prio = new Map(prio.map((p, i) => [p, i]))\n    this.callback = callback\n\n    workers.forEach((worker) => {\n      worker.onmessage = (x) => this.onMessage(x.data, worker)\n      worker.onerror = (e) => this.onError(e)\n    })\n    this._workers = workers\n    this.workers = workers.map((w) => Promise.resolve(w))\n    this.cancel = () => {}\n    this.cancelled = new Promise<never>((_, rej) => (this.cancel = rej))\n    this.cancelled.catch((_) => workers.forEach((w) => w.terminate()))\n  }\n\n  /**\n   * Send `commands` to available workers. If a worker sends back a `Command`,\n   * that command is further sent to an available worker (may be the same worker).\n   * If a worker sends back a `Response`, `this.callback` is invoked.\n   *\n   * Note that `{ resultType: 'done' }` is a special type that the worker is\n   * expected to send back when completing its `command`.\n   */\n  async execute(commands: Iterable<Command> | AsyncIterable<Command>) {\n    const processingInput = (async () => {\n      for await (const command of commands) this.add(command)\n    })()\n\n    while (true) {\n      const command = this.commands.find((x) => x.length)?.pop()\n      if (command === undefined) {\n        const hasCommand = await Promise.race([\n          new Promise<boolean>(\n            (res) => (this.notifyNonEmpty = () => res(true))\n          ),\n          Promise.all([...this.workers, processingInput]).then((_) => false),\n          this.cancelled,\n        ])\n\n        this.notifyNonEmpty = undefined\n        if (hasCommand) continue\n        break\n      }\n\n      const { i, w } = await Promise.race([\n        ...this.workers.map((w, i) => w.then((w) => ({ i, w }))),\n        this.cancelled,\n      ])\n      this.workers[i] = new Promise((res) => this.workDone.set(w, () => res(w)))\n      w.postMessage(command)\n    }\n  }\n\n  onError(e: { message: string }) {\n    this.cancel(new Error(`Worker Error: ${e.message}`))\n  }\n  onMessage(msg: Command | Response, worker: Worker) {\n    if (msg.command !== undefined) this.add(msg)\n    else if (msg.resultType === 'done') this.workDone.get(worker)!()\n    else this.callback(msg, worker)\n  }\n  /** May be ignored after `execute` ends */\n  add(command: Command) {\n    const prio = this.prio.get(command.command)!\n    this.commands[prio].push(command)\n    this.notifyNonEmpty?.()\n  }\n  /** May be ignored after `execute` ends */\n  broadcast(command: Command) {\n    this._workers.forEach((w) => w.postMessage(command))\n  }\n  /** MUST be followed by `execute` and cannot be called while `execute` is running */\n  notifiedBroadcast(command: Command) {\n    this.workers = this.workers.map((worker) =>\n      worker.then(\n        (w) =>\n          new Promise((res) => {\n            this.workDone.set(w, () => res(w))\n          })\n      )\n    )\n    this._workers.forEach((w) => w.postMessage(command))\n  }\n}\n","import type {\n  Count,\n  FinalizeResult,\n  Interim,\n  OptProblemInput,\n  Setup,\n  WorkerCommand,\n  WorkerResult,\n} from '..'\nimport { optimize } from '../../Formula/optimization'\nimport { pruneAll, pruneExclusion } from '../common'\nimport { WorkerCoordinator } from '../coordinator'\n\nexport class GOSolver extends WorkerCoordinator<WorkerCommand, WorkerResult> {\n  private maxIterateSize = 16_000_000\n  private status: Record<'tested' | 'failed' | 'skipped' | 'total', number>\n  private exclusion: Count['exclusion']\n  private topN: number\n  private buildValues: { w: Worker; val: number }[]\n  private finalizedResults: FinalizeResult[] = []\n\n  constructor(\n    problem: OptProblemInput,\n    status: GOSolver['status'],\n    numWorker: number\n  ) {\n    const workers = Array(numWorker)\n      .fill(NaN)\n      .map((_) => new Worker(new URL('./BackgroundWorker.ts', import.meta.url)))\n    super(workers, ['iterate', 'split', 'count'], (r, w) => {\n      switch (r.resultType) {\n        case 'interim':\n          this.interim(r, w)\n          break\n        case 'finalize':\n          this.finalizedResults.push(r)\n          break\n        case 'count':\n          this.status.total = r.count\n          break\n        case 'err':\n          this.onError(r)\n          break\n      }\n    })\n    const { exclusion, topN } = problem\n    this.status = status\n    this.exclusion = exclusion\n    this.topN = topN\n    this.status.total = NaN\n    this.buildValues = Array(topN).fill({ w: undefined as any, val: -Infinity })\n\n    this.notifiedBroadcast(this.preprocess(problem))\n  }\n\n  async solve() {\n    const { exclusion, maxIterateSize } = this\n    this.finalizedResults = []\n    await this.execute([{ command: 'count', exclusion, maxIterateSize }])\n    this.notifiedBroadcast({ command: 'finalize' })\n    await this.execute([])\n    return this.finalizedResults\n  }\n\n  preprocess({\n    plotBase,\n    optimizationTarget,\n    arts,\n    topN,\n    exclusion,\n    constraints,\n  }: OptProblemInput): Setup {\n    constraints = constraints.filter((x) => x.min > -Infinity)\n\n    let nodes = [...constraints.map((x) => x.value), optimizationTarget]\n    const minimums = [...constraints.map((x) => x.min), -Infinity]\n    if (plotBase) {\n      nodes.push(plotBase)\n      minimums.push(-Infinity)\n    }\n\n    nodes = pruneExclusion(nodes, exclusion)\n    ;({ nodes, arts } = pruneAll(nodes, minimums, arts, topN, exclusion, {\n      reaffine: true,\n      pruneArtRange: true,\n      pruneNodeRange: true,\n      pruneOrder: true,\n    }))\n    nodes = optimize(nodes, {}, (_) => false)\n\n    if (plotBase) plotBase = nodes.pop()\n    const optTarget = nodes.pop()!\n\n    return {\n      command: 'setup',\n      arts,\n      optTarget,\n      plotBase,\n      topN,\n      constraints: nodes.map((value, i) => ({ value, min: minimums[i] })),\n    }\n  }\n\n  /** Returns a new `threshold` if altered */\n  private interim(r: Interim, worker: Worker) {\n    this.status.tested += r.tested\n    this.status.failed += r.failed\n    this.status.skipped += r.skipped\n\n    if (r.buildValues) {\n      const { topN } = this,\n        oldThreshold = this.buildValues[topN - 1].val ?? -Infinity\n\n      this.buildValues.filter(({ w }) => w !== worker)\n      this.buildValues.push(\n        ...r.buildValues.map((val) => ({ w: worker!, val }))\n      )\n      this.buildValues.sort((a, b) => b.val - a.val).splice(topN)\n\n      const threshold = this.buildValues[topN - 1].val ?? -Infinity\n      if (oldThreshold !== threshold)\n        this.broadcast({ command: 'threshold', threshold })\n    }\n  }\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { useCallback, useContext, useEffect, useState } from 'react'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport type { BuildSetting } from '../../../../Database/DataManagers/BuildSettingData'\n\nexport default function useBuildSetting(characterKey: CharacterKey) {\n  const { database } = useContext(DatabaseContext)\n  const [buildSetting, setBuildSetting] = useState(() =>\n    database.buildSettings.get(characterKey)\n  )\n  useEffect(\n    () => setBuildSetting(database.buildSettings.get(characterKey)),\n    [database, characterKey]\n  )\n  useEffect(\n    () =>\n      database.buildSettings.follow(\n        characterKey,\n        (k, r, v) => r === 'update' && setBuildSetting(v)\n      ),\n    [characterKey, setBuildSetting, database]\n  )\n  const buildSettingDispatch = useCallback(\n    (action: Partial<BuildSetting>) =>\n      characterKey && database.buildSettings.set(characterKey, action),\n    [characterKey, database]\n  )\n\n  return { buildSetting: buildSetting as BuildSetting, buildSettingDispatch }\n}\n","import type {\n  CharacterKey,\n  LocationCharacterKey,\n} from '@genshin-optimizer/consts'\nimport {\n  allArtifactSlotKeys,\n  allElementKeys,\n  allWeaponTypeKeys,\n  charKeyToLocCharKey,\n} from '@genshin-optimizer/consts'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport ShowChartIcon from '@mui/icons-material/ShowChart'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  Stack,\n  TextField,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport type { ChangeEvent, MouseEvent } from 'react'\nimport {\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport CharacterCardPico from '../../../../../Components/Character/CharacterCardPico'\nimport CloseButton from '../../../../../Components/CloseButton'\nimport InfoTooltip from '../../../../../Components/InfoTooltip'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SolidToggleButtonGroup from '../../../../../Components/SolidToggleButtonGroup'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport ElementToggle from '../../../../../Components/ToggleButton/ElementToggle'\nimport WeaponToggle from '../../../../../Components/ToggleButton/WeaponToggle'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport { getCharSheet } from '../../../../../Data/Characters'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport type { AllowLocationsState } from '../../../../../Database/DataManagers/BuildSettingData'\nimport { allAllowLocationsState } from '../../../../../Database/DataManagers/BuildSettingData'\nimport useBoolState from '../../../../../ReactHooks/useBoolState'\nimport useForceUpdate from '../../../../../ReactHooks/useForceUpdate'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport type { ICachedCharacter } from '../../../../../Types/character'\nimport { characterFilterConfigs } from '../../../../../Util/CharacterSort'\nimport { filterFunction } from '../../../../../Util/SortByFilters'\nimport { bulkCatTotal } from '../../../../../Util/totalUtils'\nimport useBuildSetting from '../useBuildSetting'\n\nenum CharListMode {\n  ToggleToAllow,\n  ToggleToExclude,\n}\n\nexport default function AllowChar({\n  disabled = false,\n  allowListTotal,\n}: {\n  disabled?: boolean\n  allowListTotal: string\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const { t: t_pc } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { excludedLocations, allowLocationsState },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState(false)\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  const deferredDbDirty = useDeferredValue(dbDirty)\n\n  const [searchTerm, setSearchTerm] = useState('')\n  const deferredSearchTerm = useDeferredValue(searchTerm)\n  const [elementKeys, setElementKeys] = useState([...allElementKeys])\n  const deferredElementKeys = useDeferredValue(elementKeys)\n  const [weaponTypeKeys, setWeaponTypeKeys] = useState([...allWeaponTypeKeys])\n  const deferredWeaponTypeKeys = useDeferredValue(weaponTypeKeys)\n\n  const charKeyMap: Dict<CharacterKey, ICachedCharacter> = useMemo(\n    () =>\n      deferredDbDirty &&\n      Object.fromEntries(\n        Array.from(\n          new Set(\n            Object.entries(database.chars.data)\n              .filter(([ck]) => ck !== characterKey)\n              .filter(([ck]) =>\n                filterFunction(\n                  {\n                    element: deferredElementKeys,\n                    weaponType: deferredWeaponTypeKeys,\n                    name: deferredSearchTerm,\n                  },\n                  characterFilterConfigs(database)\n                )(ck)\n              )\n          )\n        )\n      ),\n    [\n      deferredDbDirty,\n      database,\n      deferredElementKeys,\n      deferredWeaponTypeKeys,\n      deferredSearchTerm,\n      characterKey,\n    ]\n  )\n\n  const locList = Object.entries(charKeyMap)\n    .sort(([ck1, c1], [ck2, c2]) => {\n      // sort characters by: star => more artifacts equipped\n      const [choosec1, choosec2] = [-1, 1]\n      const c1f = database.charMeta.get(ck1).favorite\n      const c2f = database.charMeta.get(ck2).favorite\n      if (c1f && !c2f) return choosec1\n      else if (c2f && !c1f) return choosec2\n\n      const art1 = Object.values(c1.equippedArtifacts).filter((id) => id).length\n      const art2 = Object.values(c2.equippedArtifacts).filter((id) => id).length\n      if (art1 > art2) return choosec1\n      else if (art2 > art1) return choosec2\n      return ck1.localeCompare(ck2)\n    })\n    .map(([ck]) => charKeyToLocCharKey(ck))\n\n  const { elementTotals, weaponTypeTotals, locListTotals } = useMemo(() => {\n    const catKeys = {\n      elementTotals: [...allElementKeys],\n      weaponTypeTotals: [...allWeaponTypeKeys],\n      locListTotals: ['allowed', 'excluded'],\n    } as const\n    return bulkCatTotal(catKeys, (ctMap) =>\n      Object.entries(database.chars.data)\n        .filter(([ck]) => ck !== characterKey)\n        .forEach(([ck]) => {\n          const sheet = getCharSheet(ck, database.gender)\n          const eleKey = sheet.elementKey\n          ctMap.elementTotals[eleKey].total++\n          if (charKeyMap[ck]) ctMap.elementTotals[eleKey].current++\n\n          const weaponTypeKey = sheet.weaponTypeKey\n          ctMap.weaponTypeTotals[weaponTypeKey].total++\n          if (charKeyMap[ck]) ctMap.weaponTypeTotals[weaponTypeKey].current++\n\n          const locKey = charKeyToLocCharKey(ck)\n          if (locList.includes(locKey)) {\n            ctMap.locListTotals.allowed.total++\n            ctMap.locListTotals.excluded.total++\n            if (!excludedLocations.includes(locKey))\n              ctMap.locListTotals.allowed.current++\n            else ctMap.locListTotals.excluded.current++\n          }\n        })\n    )\n  }, [\n    charKeyMap,\n    characterKey,\n    database.chars.data,\n    database.gender,\n    excludedLocations,\n    locList,\n  ])\n\n  useEffect(\n    () => database.charMeta.followAny((_) => forceUpdate()),\n    [forceUpdate, database]\n  )\n  useEffect(\n    () => database.chars.followAny((_) => forceUpdate()),\n    [forceUpdate, database]\n  )\n\n  const [mouseUpDetected, setMouseUpDetected] = useState(false)\n\n  const allowAll = useCallback(\n    () =>\n      buildSettingDispatch({\n        excludedLocations: excludedLocations.filter(\n          (key) => !locList.includes(key)\n        ),\n        allowLocationsState: 'customList',\n      }),\n    [buildSettingDispatch, excludedLocations, locList]\n  )\n  const disallowAll = useCallback(\n    () =>\n      buildSettingDispatch({\n        excludedLocations: Array.from(\n          new Set(excludedLocations.concat(locList))\n        ),\n        allowLocationsState: 'customList',\n      }),\n    [buildSettingDispatch, excludedLocations, locList]\n  )\n\n  const setState = useCallback(\n    (_e: MouseEvent, state: AllowLocationsState) =>\n      buildSettingDispatch({ allowLocationsState: state }),\n    [buildSettingDispatch]\n  )\n\n  const toggleList = useCallback(\n    (lkList: Set<LocationCharacterKey>) => {\n      const lkArray = [...lkList]\n      const newExcludedLocations = lkArray\n        .filter((lk) => !excludedLocations.includes(lk))\n        .concat(excludedLocations.filter((lk) => !lkArray.includes(lk)))\n      buildSettingDispatch({\n        excludedLocations: newExcludedLocations,\n        allowLocationsState: 'customList',\n      })\n    },\n    [excludedLocations, buildSettingDispatch]\n  )\n\n  const onMouseUp = useCallback(() => setMouseUpDetected(true), [])\n\n  const total = database.chars.keys.length - 1\n  const useTot = total - excludedLocations.length\n  const totalStr = useTot === total ? useTot : `${useTot}/${total}`\n  const charactersAllowed =\n    allowLocationsState === 'all'\n      ? total\n      : allowLocationsState === 'customList'\n      ? totalStr\n      : 0 // unequippedOnly\n  const stateBadgeColor =\n    allowLocationsState === 'all'\n      ? 'success'\n      : allowLocationsState === 'customList'\n      ? 'info'\n      : 'secondary' // unequippedOnly\n\n  return (\n    <Box display=\"flex\" gap={1}>\n      {/* Begin modal */}\n      <ModalWrapper\n        open={show}\n        onClose={onClose}\n        containerProps={{ maxWidth: 'xl' }}\n        draggable={false}\n        onMouseUp={onMouseUp}\n      >\n        <CardDark>\n          {/* Header */}\n          <CardContent>\n            <Box display=\"flex\" gap={1} alignItems=\"center\">\n              <Typography variant=\"h6\">{t`excludeChar.title`}</Typography>\n              <InfoTooltip\n                title={<Typography>{t`excludeChar.tooltip`}</Typography>}\n              />\n              <Box flexGrow={1} />\n              <CloseButton onClick={onClose} size=\"small\" />\n            </Box>\n          </CardContent>\n          <Divider />\n          {/* Content */}\n          <CardContent sx={{ pb: 0 }}>\n            <Stack gap={1}>\n              {/* State + Search box */}\n              <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                <SolidToggleButtonGroup\n                  exclusive\n                  baseColor=\"secondary\"\n                  size=\"small\"\n                  value={allowLocationsState}\n                  onChange={setState}\n                >\n                  {allAllowLocationsState.map((s) => (\n                    <ToggleButton\n                      key={s}\n                      value={s}\n                      disabled={allowLocationsState === s || disabled}\n                    >\n                      {t(`excludeChar.states.${s}`)}\n                    </ToggleButton>\n                  ))}\n                </SolidToggleButtonGroup>\n                <TextField\n                  autoFocus\n                  value={searchTerm}\n                  onChange={(e: ChangeEvent<HTMLTextAreaElement>) =>\n                    setSearchTerm(e.target.value)\n                  }\n                  label={t_pc('characterName')}\n                  size=\"small\"\n                  sx={{ height: '100%' }}\n                  InputProps={{\n                    sx: { height: '100%' },\n                  }}\n                />\n              </Box>\n              {/* Filter toggles */}\n              <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                <WeaponToggle\n                  sx={{ height: '100%' }}\n                  onChange={setWeaponTypeKeys}\n                  value={deferredWeaponTypeKeys}\n                  totals={weaponTypeTotals}\n                  size=\"small\"\n                />\n                <ElementToggle\n                  sx={{ height: '100%' }}\n                  onChange={setElementKeys}\n                  value={deferredElementKeys}\n                  totals={elementTotals}\n                  size=\"small\"\n                />\n              </Box>\n            </Stack>\n          </CardContent>\n          {/* Allow/Disallow + grid */}\n          <CardContent\n            sx={{ opacity: allowLocationsState === 'customList' ? 1 : 0.6 }}\n          >\n            <Grid container pb={1} gap={1} flexWrap=\"nowrap\">\n              <Grid item xs={6}>\n                <Button color=\"success\" fullWidth onClick={allowAll}>\n                  {t`excludeChar.modal.allow_all`}\n                  <SqBadge sx={{ ml: 1 }}>\n                    <strong>{locListTotals.allowed}</strong>\n                  </SqBadge>\n                </Button>\n              </Grid>\n              <Grid item xs={6}>\n                <Button fullWidth color=\"error\" onClick={disallowAll}>\n                  {t`excludeChar.modal.disallow_All`}\n                  <SqBadge sx={{ ml: 1 }}>\n                    <strong>{locListTotals.excluded}</strong>\n                  </SqBadge>\n                </Button>\n              </Grid>\n            </Grid>\n            <SelectItemGrid\n              locList={locList}\n              excludedLocations={excludedLocations}\n              mouseUpDetected={mouseUpDetected}\n              setMouseUpDetected={setMouseUpDetected}\n              toggleList={toggleList}\n            />\n          </CardContent>\n        </CardDark>\n      </ModalWrapper>\n\n      {/* Button to open modal */}\n      <CardLight sx={{ display: 'flex', width: '100%' }}>\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Stack spacing={1}>\n            <Typography>\n              <strong>{t('excludeChar.title')}</strong>\n            </Typography>\n            <Typography>\n              {t('excludeChar.usingState')}{' '}\n              <SqBadge color={stateBadgeColor}>\n                {t(`excludeChar.states.${allowLocationsState}`)}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t('excludeChar.chars')}{' '}\n              <SqBadge color=\"success\">\n                {charactersAllowed} <ShowChartIcon {...iconInlineProps} />\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t('excludeChar.artis')}{' '}\n              <SqBadge color=\"success\">\n                {allowListTotal} <ShowChartIcon {...iconInlineProps} />\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n          </Stack>\n        </CardContent>\n        <Button\n          sx={{ borderRadius: 0, flexShrink: 1, minWidth: 40 }}\n          onClick={onOpen}\n          disabled={disabled}\n          color=\"info\"\n        >\n          <SettingsIcon />\n        </Button>\n      </CardLight>\n    </Box>\n  )\n}\n\nfunction SelectItemGrid({\n  locList,\n  excludedLocations,\n  mouseUpDetected,\n  setMouseUpDetected,\n  toggleList,\n}: {\n  locList: LocationCharacterKey[]\n  excludedLocations: LocationCharacterKey[]\n  mouseUpDetected: boolean\n  setMouseUpDetected: (v: boolean) => void\n  toggleList: (charList: Set<LocationCharacterKey>) => void\n}) {\n  const [charList, setCharList] = useState(new Set<LocationCharacterKey>())\n  const [charListMode, setCharListMode] = useState<CharListMode>()\n  useEffect(() => {\n    if (mouseUpDetected) {\n      setMouseUpDetected(false)\n      if (charList.size > 0) {\n        toggleList(charList)\n        setCharList(new Set<LocationCharacterKey>())\n        setCharListMode(undefined)\n      }\n    }\n  }, [charList, setCharList, setMouseUpDetected, mouseUpDetected, toggleList])\n  return (\n    <Grid\n      container\n      spacing={1}\n      columns={{ xs: 6, sm: 7, md: 10, lg: 12, xl: 16 }}\n    >\n      {locList.map((lk) => (\n        <Grid item key={lk} xs={1}>\n          <SelectItem\n            locKey={lk}\n            charList={charList}\n            charListMode={charListMode}\n            setCharList={setCharList}\n            setCharListMode={setCharListMode}\n            selected={!excludedLocations.includes(lk)}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n\nfunction SelectItem({\n  locKey,\n  selected,\n  charList,\n  charListMode,\n  setCharList,\n  setCharListMode,\n}: {\n  locKey: LocationCharacterKey\n  selected: boolean\n  charList: Set<LocationCharacterKey>\n  charListMode?: CharListMode\n  setCharList: (list: Set<LocationCharacterKey>) => void\n  setCharListMode: (mode?: CharListMode) => void\n}) {\n  const { database } = useContext(DatabaseContext)\n  const char = database.chars.get(database.chars.LocationToCharacterKey(locKey))\n  const onMouseEnter = useCallback(\n    (e: MouseEvent) =>\n      // Mouse 1 being held down\n      e.buttons === 1 &&\n      // Only select characters with the same exclusion state as the rest of the list\n      ((charListMode === CharListMode.ToggleToAllow && !selected) ||\n        (charListMode === CharListMode.ToggleToExclude && selected)) &&\n      setCharList(new Set([...charList]).add(locKey)),\n    [charListMode, selected, setCharList, charList, locKey]\n  )\n  const onMouseDown = useCallback(() => {\n    const mode = selected\n      ? CharListMode.ToggleToExclude\n      : CharListMode.ToggleToAllow\n    setCharListMode(mode)\n    setCharList(new Set([...charList]).add(locKey))\n  }, [selected, setCharListMode, setCharList, charList, locKey])\n  const disableTooltip = useMemo(() => charList.size !== 0, [charList.size])\n  const allowed =\n    // Character is already allowed, and not selected to be excluded\n    (selected &&\n      !(\n        charListMode === CharListMode.ToggleToExclude && charList.has(locKey)\n      )) ||\n    // Or character is selected to be allowed\n    (charListMode === CharListMode.ToggleToAllow && charList.has(locKey))\n  const sx = {\n    opacity: allowed ? undefined : 0.6,\n    borderColor: allowed ? 'rgb(100,200,100)' : 'rgb(200,100,100)',\n    borderWidth: '3px',\n    borderStyle: 'solid',\n    borderRadius: '8px',\n  }\n  const content = useMemo(\n    () => (\n      <Box\n        fontSize=\"0.85em\"\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        p={0.3}\n      >\n        {allArtifactSlotKeys.map((s) => (\n          <SlotIcon\n            key={s}\n            slotKey={s}\n            iconProps={{\n              fontSize: 'inherit',\n              sx: { opacity: char?.equippedArtifacts[s] ? undefined : 0.5 },\n            }}\n          />\n        ))}\n      </Box>\n    ),\n    [char?.equippedArtifacts]\n  )\n  return (\n    <CardLight sx={sx}>\n      <CharacterCardPico\n        characterKey={database.chars.LocationToCharacterKey(locKey)}\n        onMouseDown={onMouseDown}\n        onMouseEnter={onMouseEnter}\n        disableTooltip={disableTooltip}\n      />\n      {content}\n    </CardLight>\n  )\n}\n","import { Box } from '@mui/material'\nimport { getArtSheet } from '../../Data/Artifacts'\nimport type { ArtifactSetKey, SetNum } from '../../Types/consts'\nimport DocumentDisplay from '../DocumentDisplay'\n\ntype Data = {\n  setKey: ArtifactSetKey\n  setNumKey: SetNum\n  hideHeader?: boolean\n  conditionalsOnly?: boolean\n}\n\nexport default function SetEffectDisplay({\n  setKey,\n  setNumKey,\n  hideHeader = false,\n  conditionalsOnly = false,\n}: Data) {\n  const sheet = getArtSheet(setKey)\n\n  const document = conditionalsOnly\n    ? sheet\n        .setEffectDocument(setNumKey)\n        ?.filter((section) => 'states' in section)\n    : sheet.setEffectDocument(setNumKey)\n  return (\n    <Box display=\"flex\" flexDirection=\"column\">\n      {document ? (\n        <DocumentDisplay sections={document} hideHeader={hideHeader} />\n      ) : null}\n    </Box>\n  )\n}\n","import type { ArtifactSetKey, ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport {\n  allArtifactSetKeys,\n  allArtifactSlotKeys,\n} from '@genshin-optimizer/consts'\nimport { CheckBox, CheckBoxOutlineBlank, Replay } from '@mui/icons-material'\nimport BlockIcon from '@mui/icons-material/Block'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport ShowChartIcon from '@mui/icons-material/ShowChart'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  CardContent,\n  Divider,\n  Grid,\n  Stack,\n  Typography,\n} from '@mui/material'\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport SetEffectDisplay from '../../../../../Components/Artifact/SetEffectDisplay'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport CloseButton from '../../../../../Components/CloseButton'\nimport ColorText from '../../../../../Components/ColoredText'\nimport { InfoTooltipInline } from '../../../../../Components/InfoTooltip'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { Translate } from '../../../../../Components/Translate'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../../../Context/DataContext'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport { getArtSheet, setKeysByRarities } from '../../../../../Data/Artifacts'\nimport { artifactDefIcon } from '../../../../../Data/Artifacts/ArtifactSheet'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport { handleArtSetExclusion } from '../../../../../Database/DataManagers/BuildSettingData'\nimport { UIData } from '../../../../../Formula/uiData'\nimport { constant } from '../../../../../Formula/utils'\nimport useForceUpdate from '../../../../../ReactHooks/useForceUpdate'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport type { SetNum } from '../../../../../Types/consts'\nimport { bulkCatTotal } from '../../../../../Util/totalUtils'\nimport { deepClone, objectKeyMap } from '../../../../../Util/Util'\nimport useBuildSetting from '../useBuildSetting'\n\nexport default function ArtifactSetConfig({\n  disabled,\n}: {\n  disabled?: boolean\n}) {\n  const { t } = useTranslation(['page_character_optimize', 'sheet'])\n  const dataContext = useContext(DataContext)\n  const { database } = useContext(DatabaseContext)\n  const {\n    character: { key: characterKey, conditional },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { artSetExclusion },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const [open, setOpen] = useState(false)\n  const onOpen = useCallback(() => setOpen(true), [setOpen])\n  const onClose = useCallback(() => setOpen(false), [setOpen])\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(() => database.arts.followAny(forceUpdate), [database, forceUpdate])\n\n  const artKeysByRarity = useMemo(\n    () =>\n      Object.entries(setKeysByRarities)\n        .reverse()\n        .flatMap(([, sets]) => sets)\n        .filter((key) => !key.includes('Prayers')),\n    []\n  )\n  const { artKeys, artSlotCount } = useMemo(() => {\n    const artSlotCount = objectKeyMap(artKeysByRarity, (_) =>\n      objectKeyMap(allArtifactSlotKeys, (_) => 0)\n    )\n    database.arts.values.forEach(\n      (art) =>\n        artSlotCount[art.setKey] && artSlotCount[art.setKey][art.slotKey]++\n    )\n    const artKeys = [...artKeysByRarity].sort(\n      (a, b) =>\n        +(getNumSlots(artSlotCount[a]) < 2) -\n        +(getNumSlots(artSlotCount[b]) < 2)\n    )\n    return dbDirty && { artKeys, artSlotCount }\n  }, [dbDirty, database, artKeysByRarity])\n\n  const allowRainbow2 = !artSetExclusion.rainbow?.includes(2)\n  const allowRainbow4 = !artSetExclusion.rainbow?.includes(4)\n\n  const { allowTotals } = useMemo(() => {\n    const catKeys = { allowTotals: ['2', '4'] }\n    return bulkCatTotal(catKeys, (ctMap) =>\n      artKeysByRarity.forEach((setKey) => {\n        ctMap.allowTotals['2'].total++\n        if (!artSetExclusion[setKey]?.includes(2)) {\n          ctMap.allowTotals['2'].current++\n        }\n        ctMap.allowTotals['4'].total++\n        if (!artSetExclusion[setKey]?.includes(4)) {\n          ctMap.allowTotals['4'].current++\n        }\n      })\n    )\n  }, [artKeysByRarity, artSetExclusion])\n  const artifactCondCount = useMemo(\n    () =>\n      Object.keys(conditional).filter(\n        (k) =>\n          allArtifactSetKeys.includes(k as ArtifactSetKey) &&\n          !!Object.keys(conditional[k] ?? {}).length\n      ).length,\n    [conditional]\n  )\n  const fakeDataContextObj = useMemo(\n    () => ({\n      ...dataContext,\n      data: new UIData(\n        {\n          ...dataContext.data.data[0],\n          artSet: objectKeyMap(allArtifactSetKeys, (_) => constant(4)),\n        },\n        undefined\n      ),\n    }),\n    [dataContext]\n  )\n  const resetArtConds = useCallback(() => {\n    const tconditional = Object.fromEntries(\n      Object.entries(conditional).filter(\n        ([k]) => !allArtifactSetKeys.includes(k as any)\n      )\n    )\n    characterDispatch({ conditional: tconditional })\n  }, [conditional, characterDispatch])\n  const setAllExclusion = useCallback(\n    (setnum: number, exclude = true) => {\n      const artSetExclusion_ = deepClone(artSetExclusion)\n      artKeysByRarity.forEach((k) => {\n        if (exclude)\n          artSetExclusion_[k] = [...(artSetExclusion_[k] ?? []), setnum]\n        else if (artSetExclusion_[k])\n          artSetExclusion_[k] = artSetExclusion_[k].filter((n) => n !== setnum)\n      })\n      buildSettingDispatch({ artSetExclusion: artSetExclusion_ })\n    },\n    [artKeysByRarity, artSetExclusion, buildSettingDispatch]\n  )\n\n  return (\n    <>\n      {/* Button to open modal */}\n      <CardLight sx={{ display: 'flex', width: '100%' }}>\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Typography>\n            <strong>{t`artSetConfig.title`}</strong>\n          </Typography>\n          <Stack spacing={1}>\n            <Typography>\n              {t`artSetConfig.setEffCond`}{' '}\n              <SqBadge color={artifactCondCount ? 'success' : 'warning'}>\n                {artifactCondCount} {t('artSetConfig.enabled')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`sheet:2set`}{' '}\n              <SqBadge color=\"success\">\n                {allowTotals['2']} <ShowChartIcon {...iconInlineProps} />{' '}\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`sheet:4set`}{' '}\n              <SqBadge color=\"success\">\n                {allowTotals['4']} <ShowChartIcon {...iconInlineProps} />{' '}\n                {t('artSetConfig.allowed')}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`artSetConfig.2rainbow`}{' '}\n              <SqBadge color={allowRainbow2 ? 'success' : 'secondary'}>\n                {allowRainbow2 ? (\n                  <ShowChartIcon {...iconInlineProps} />\n                ) : (\n                  <BlockIcon {...iconInlineProps} />\n                )}{' '}\n                {allowRainbow2 ? t('artSetConfig.allowed') : 'Excluded'}\n              </SqBadge>\n            </Typography>\n            <Typography>\n              {t`artSetConfig.4rainbow`}{' '}\n              <SqBadge color={allowRainbow4 ? 'success' : 'secondary'}>\n                {allowRainbow4 ? (\n                  <ShowChartIcon {...iconInlineProps} />\n                ) : (\n                  <BlockIcon {...iconInlineProps} />\n                )}{' '}\n                {allowRainbow4 ? t('artSetConfig.allowed') : 'Excluded'}\n              </SqBadge>\n            </Typography>\n          </Stack>\n        </CardContent>\n        <Button\n          onClick={onOpen}\n          disabled={disabled}\n          color=\"info\"\n          sx={{ borderRadius: 0, flexShrink: 1, minWidth: 40 }}\n        >\n          <SettingsIcon />\n        </Button>\n      </CardLight>\n\n      {/* Begin modal */}\n      <ModalWrapper open={open} onClose={onClose}>\n        <CardDark>\n          <CardContent\n            sx={{ display: 'flex', gap: 1, justifyContent: 'space-between' }}\n          >\n            <Typography variant=\"h6\">{t`artSetConfig.title`}</Typography>\n            <CloseButton onClick={onClose} />\n          </CardContent>\n          <Divider />\n          <CardContent>\n            <CardLight sx={{ mb: 1 }}>\n              <CardContent>\n                <Box display=\"flex\" gap={1}>\n                  <Typography>\n                    <strong>{t`artSetConfig.modal.setCond.title`}</strong>\n                  </Typography>\n                  <Typography sx={{ flexGrow: 1 }}>\n                    <SqBadge color={artifactCondCount ? 'success' : 'warning'}>\n                      {artifactCondCount} {t('artSetConfig.selected')}\n                    </SqBadge>\n                  </Typography>\n                  <Button\n                    size=\"small\"\n                    onClick={resetArtConds}\n                    color=\"error\"\n                    startIcon={<Replay />}\n                  >{t`artSetConfig.modal.setCond.reset`}</Button>\n                </Box>\n                <Typography>{t`artSetConfig.modal.setCond.text`}</Typography>\n              </CardContent>\n            </CardLight>\n            <CardLight sx={{ mb: 1 }}>\n              <CardContent>\n                <Typography sx={{ flexGrow: 1 }}>\n                  <strong>\n                    <Trans\n                      t={t}\n                      i18nKey=\"artSetConfig.modal.ArtSetFilter.title\"\n                    >\n                      Artifact Sets{' '}\n                      <ColorText color=\"success\">\n                        Allowed\n                        <ShowChartIcon {...iconInlineProps} />\n                      </ColorText>{' '}\n                      /{' '}\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluded\n                        <BlockIcon {...iconInlineProps} />\n                      </ColorText>\n                    </Trans>\n                  </strong>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.intro\">\n                    You can allow/exclude which sets you want the builder to\n                    consider. In the following examples, <strong>A</strong> is\n                    on-set, and <strong>R</strong> is rainbow(off-set)\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.2set\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 2-Set\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude 2-Set builds:{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AA\n                      </ColorText>\n                      RRR\n                    </strong>{' '}\n                    and{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AAA\n                      </ColorText>\n                      RR\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.4set\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 4-Set\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude 4-Set builds:{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AAAA\n                      </ColorText>\n                      R\n                    </strong>{' '}\n                    and{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        AAAAA\n                      </ColorText>\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.2rain\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 3-Rainbow\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude 2-Set + 3-Rainbow builds:{' '}\n                    <strong>\n                      AA\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        RRR\n                      </ColorText>\n                    </strong>{' '}\n                    and{' '}\n                    <strong>\n                      AAA\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        RR\n                      </ColorText>\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n                <Typography>\n                  <Trans t={t} i18nKey=\"artSetConfig.modal.ArtSetFilter.4rain\">\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        Excluding\n                        <BlockIcon {...iconInlineProps} /> 5-Rainbow\n                      </ColorText>\n                    </strong>{' '}\n                    would exclude full 5-Rainbow builds:{' '}\n                    <strong>\n                      <ColorText color=\"secondary\" variant=\"light\">\n                        RRRRR\n                      </ColorText>\n                    </strong>\n                    .\n                  </Trans>\n                </Typography>\n              </CardContent>\n            </CardLight>\n            <Grid\n              container\n              columns={{ xs: 2, lg: 3 }}\n              sx={{ mb: 1 }}\n              spacing={1}\n            >\n              <Grid item xs={1}>\n                <AllSetAllowExcludeCard\n                  allowTotal={allowTotals['2']}\n                  setNum={2}\n                  setAllExclusion={setAllExclusion}\n                />\n              </Grid>\n              <Grid item xs={1}>\n                <AllSetAllowExcludeCard\n                  allowTotal={allowTotals['4']}\n                  setNum={4}\n                  setAllExclusion={setAllExclusion}\n                />\n              </Grid>\n              <Grid item xs={1}>\n                <CardLight>\n                  <CardContent>\n                    <Typography gutterBottom>\n                      <strong>\n                        <Trans t={t} i18nKey=\"artSetConfig.alExRainbow\">\n                          <ColorText color=\"success\">\n                            Allow <ShowChartIcon {...iconInlineProps} />\n                          </ColorText>{' '}\n                          /{' '}\n                          <ColorText color=\"secondary\" variant=\"light\">\n                            Exclude <BlockIcon {...iconInlineProps} />\n                          </ColorText>{' '}\n                          Rainbow Builds\n                        </Trans>\n                      </strong>\n                    </Typography>\n                    <Box\n                      sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n                    >\n                      <Button\n                        fullWidth\n                        onClick={() =>\n                          buildSettingDispatch({\n                            artSetExclusion: handleArtSetExclusion(\n                              artSetExclusion,\n                              'rainbow',\n                              2\n                            ),\n                          })\n                        }\n                        color={allowRainbow2 ? 'success' : 'secondary'}\n                        startIcon={\n                          !allowRainbow2 ? (\n                            <CheckBoxOutlineBlank />\n                          ) : (\n                            <CheckBox />\n                          )\n                        }\n                        endIcon={\n                          allowRainbow2 ? <ShowChartIcon /> : <BlockIcon />\n                        }\n                      >{t`artSetConfig.2rainbow`}</Button>\n                      <Button\n                        fullWidth\n                        onClick={() =>\n                          buildSettingDispatch({\n                            artSetExclusion: handleArtSetExclusion(\n                              artSetExclusion,\n                              'rainbow',\n                              4\n                            ),\n                          })\n                        }\n                        color={allowRainbow4 ? 'success' : 'secondary'}\n                        startIcon={\n                          !allowRainbow4 ? (\n                            <CheckBoxOutlineBlank />\n                          ) : (\n                            <CheckBox />\n                          )\n                        }\n                        endIcon={\n                          allowRainbow4 ? <ShowChartIcon /> : <BlockIcon />\n                        }\n                      >{t`artSetConfig.4rainbow`}</Button>\n                    </Box>\n                  </CardContent>\n                </CardLight>\n              </Grid>\n            </Grid>\n            <Grid container spacing={1} columns={{ xs: 2, lg: 3 }}>\n              {artKeys.map((setKey) => (\n                <ArtifactSetCard\n                  key={setKey}\n                  setKey={setKey}\n                  fakeDataContextObj={fakeDataContextObj}\n                  slotCount={artSlotCount[setKey]}\n                />\n              ))}\n            </Grid>\n          </CardContent>\n          <Divider />\n          <CardContent sx={{ py: 1 }}>\n            <CloseButton large onClick={onClose} />\n          </CardContent>\n        </CardDark>\n      </ModalWrapper>\n    </>\n  )\n}\nfunction AllSetAllowExcludeCard({\n  allowTotal,\n  setNum,\n  setAllExclusion,\n}: {\n  allowTotal: string\n  setNum: 2 | 4\n  setAllExclusion: (setNum: 2 | 4, exclude?: boolean) => void\n}) {\n  const { t } = useTranslation(['page_character_optimize', 'sheet'])\n  return (\n    <CardLight>\n      <CardContent>\n        <Typography gutterBottom>\n          <strong>{t(`sheet:${setNum}set`)}</strong>{' '}\n          <SqBadge color=\"success\">\n            {allowTotal} <ShowChartIcon {...iconInlineProps} />{' '}\n            {t('artSetConfig.allowed')}\n          </SqBadge>\n        </Typography>\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n          <Button\n            fullWidth\n            disabled={\n              allowTotal.charAt(0) !== '0' && allowTotal.indexOf('/') === -1\n            }\n            onClick={() => setAllExclusion(setNum, false)}\n            color=\"success\"\n            startIcon={<ShowChartIcon />}\n          >\n            {t(`artSetConfig.allowAll${setNum}set`)}\n          </Button>\n          <Button\n            fullWidth\n            disabled={allowTotal.charAt(0) === '0'}\n            onClick={() => setAllExclusion(setNum, true)}\n            color=\"secondary\"\n            startIcon={<BlockIcon />}\n          >\n            {t(`artSetConfig.excludeAll${setNum}set`)}\n          </Button>\n        </Box>\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction ArtifactSetCard({\n  setKey,\n  fakeDataContextObj,\n  slotCount,\n}: {\n  setKey: ArtifactSetKey\n  fakeDataContextObj: dataContextObj\n  slotCount: Record<ArtifactSlotKey, number>\n}) {\n  const { t } = useTranslation('sheet')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { buildSetting, buildSettingDispatch } = useBuildSetting(characterKey)\n  const { artSetExclusion } = buildSetting\n  const setExclusionSet = artSetExclusion?.[setKey] ?? []\n  const allow4 = !setExclusionSet.includes(4)\n  const slots = getNumSlots(slotCount)\n  const sheet = getArtSheet(setKey)\n  /* Assumes that all conditionals are from 4-Set. needs to change if there are 2-Set conditionals */\n  const set4CondNums = useMemo(() => {\n    if (!allow4) return []\n    return Object.keys(sheet.setEffects).filter((setNumKey) =>\n      sheet.setEffects[setNumKey]?.document.some((doc) => 'states' in doc)\n    )\n  }, [sheet.setEffects, allow4])\n  const exclude2 = setExclusionSet.includes(2)\n  const exclude4 = setExclusionSet.includes(4)\n  return (\n    <Grid item key={setKey} xs={1}>\n      <CardLight\n        sx={{ height: '100%', opacity: slots < 2 ? '50%' : undefined }}\n      >\n        <Box\n          className={`grad-${sheet.rarity[0]}star`}\n          width=\"100%\"\n          sx={{ display: 'flex' }}\n        >\n          <Box\n            component=\"img\"\n            src={artifactDefIcon(setKey)}\n            sx={{ height: 100, width: 'auto', mx: -1 }}\n          />\n          <Box\n            sx={{\n              flexGrow: 1,\n              px: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              justifyContent: 'center',\n            }}\n          >\n            <Typography variant=\"h6\">{sheet.name ?? ''}</Typography>\n            <Box>\n              {/* If there is ever a 2-Set conditional, we will need to change this */}\n              <Typography variant=\"subtitle1\">\n                {sheet.rarity.map((ns, i) => (\n                  <Box\n                    component=\"span\"\n                    sx={{ display: 'inline-flex', alignItems: 'center' }}\n                    key={ns}\n                  >\n                    {ns} <StarRoundedIcon fontSize=\"inherit\" />{' '}\n                    {i < sheet.rarity.length - 1 ? '/ ' : null}\n                  </Box>\n                ))}{' '}\n                <InfoTooltipInline\n                  title={\n                    <Box>\n                      <Typography>\n                        <SqBadge color=\"success\">{t`2set`}</SqBadge>\n                      </Typography>\n                      <Typography>\n                        <Translate\n                          ns={`artifact_${setKey}_gen`}\n                          key18={'setEffects.2'}\n                        />\n                      </Typography>\n                      <Box\n                        paddingTop={2}\n                        sx={{ opacity: setExclusionSet.includes(4) ? 0.6 : 1 }}\n                      >\n                        <Typography>\n                          <SqBadge color=\"success\">{t`4set`}</SqBadge>\n                        </Typography>\n                        <Typography>\n                          <Translate\n                            ns={`artifact_${setKey}_gen`}\n                            key18={'setEffects.4'}\n                          />\n                        </Typography>\n                      </Box>\n                    </Box>\n                  }\n                />\n              </Typography>\n            </Box>\n            <Box sx={{ display: 'flex', gap: 1 }}>\n              {Object.entries(slotCount).map(([slotKey, count]) => (\n                <Typography\n                  key={slotKey}\n                  sx={{ flexGrow: 1 }}\n                  variant=\"subtitle2\"\n                >\n                  <SqBadge\n                    sx={{ width: '100%' }}\n                    color={count ? 'primary' : 'secondary'}\n                  >\n                    <SlotIcon slotKey={slotKey} iconProps={iconInlineProps} />{' '}\n                    {count}\n                  </SqBadge>\n                </Typography>\n              ))}\n            </Box>\n          </Box>\n        </Box>\n        <ButtonGroup sx={{ '.MuiButton-root': { borderRadius: 0 } }} fullWidth>\n          <Button\n            startIcon={exclude2 ? <CheckBoxOutlineBlank /> : <CheckBox />}\n            onClick={() =>\n              buildSettingDispatch({\n                artSetExclusion: handleArtSetExclusion(\n                  artSetExclusion,\n                  setKey,\n                  2\n                ),\n              })\n            }\n            color={exclude2 ? 'secondary' : 'success'}\n            endIcon={exclude2 ? <BlockIcon /> : <ShowChartIcon />}\n          >{t`2set`}</Button>\n          <Button\n            startIcon={exclude4 ? <CheckBoxOutlineBlank /> : <CheckBox />}\n            onClick={() =>\n              buildSettingDispatch({\n                artSetExclusion: handleArtSetExclusion(\n                  artSetExclusion,\n                  setKey,\n                  4\n                ),\n              })\n            }\n            color={exclude4 ? 'secondary' : 'success'}\n            endIcon={exclude4 ? <BlockIcon /> : <ShowChartIcon />}\n          >{t`4set`}</Button>\n        </ButtonGroup>\n\n        {!!set4CondNums.length && (\n          <DataContext.Provider value={fakeDataContextObj}>\n            <CardContent\n              sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}\n            >\n              {set4CondNums.map((setNumKey) => (\n                <SetEffectDisplay\n                  key={setNumKey}\n                  setKey={setKey}\n                  setNumKey={parseInt(setNumKey) as SetNum}\n                  hideHeader\n                  conditionalsOnly\n                />\n              ))}\n            </CardContent>\n          </DataContext.Provider>\n        )}\n      </CardLight>\n    </Grid>\n  )\n}\n\nfunction getNumSlots(slotCount: Record<string, number>): number {\n  return Object.values(slotCount).reduce((tot, v) => tot + (v ? 1 : 0), 0)\n}\n","import { MenuItem } from '@mui/material'\nimport { useTranslation } from 'react-i18next'\nimport DropdownButton from '../../../../../Components/DropdownMenu/DropdownButton'\n\nconst levels = [0, 4, 8, 12, 16, 20] as const\nexport default function AssumeFullLevelToggle({\n  mainStatAssumptionLevel = 0,\n  setmainStatAssumptionLevel,\n  disabled,\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  return (\n    <DropdownButton\n      fullWidth\n      color={mainStatAssumptionLevel ? 'success' : 'primary'}\n      disabled={disabled}\n      title={\n        mainStatAssumptionLevel\n          ? t('mainStat.assumptionLvl.lvl', { lvl: mainStatAssumptionLevel })\n          : t('mainStat.assumptionLvl.no')\n      }\n    >\n      {levels.map((lvl) => (\n        <MenuItem key={lvl} onClick={() => setmainStatAssumptionLevel(lvl)}>\n          {lvl\n            ? t('mainStat.assumptionLvl.lvl', { lvl })\n            : t('mainStat.assumptionLvl.no')}\n        </MenuItem>\n      ))}\n    </DropdownButton>\n  )\n}\n","import { CardContent, Divider, Typography } from '@mui/material'\nimport { useContext } from 'react'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport { NodeFieldDisplay } from '../../../../../Components/FieldDisplay'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport { uiInput as input } from '../../../../../Formula'\nimport type { NumNode } from '../../../../../Formula/type'\nimport { useTranslation } from 'react-i18next'\n\nexport default function BonusStatsCard() {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { bonusStats },\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const bonusStatsKeys = Object.keys(bonusStats)\n  if (!bonusStatsKeys.length) return null\n  const nodes = bonusStatsKeys.map((k) =>\n    data.get(input.customBonus[k] as NumNode)\n  )\n  return (\n    <CardLight>\n      <CardContent>\n        <Typography\n          sx={{ fontWeight: 'bold' }}\n        >{t`bonusStats.title`}</Typography>\n      </CardContent>\n      <Divider />\n      <CardContent>\n        {nodes.map((n) => (\n          <NodeFieldDisplay key={JSON.stringify(n.info)} node={n} />\n        ))}\n      </CardContent>\n    </CardLight>\n  )\n}\n","import { Alert, Grid, LinearProgress, styled, Typography } from '@mui/material'\nimport type { ReactNode } from 'react'\nimport { timeStringMs } from '../../../../../Util/TimeUtil'\n\nexport const warningBuildNumber = 10000000\nexport type BuildStatus = {\n  type: 'active' | 'inactive'\n  tested: number // tested, including `failed`\n  failed: number // tested but fail the filter criteria, e.g., not enough EM\n  skipped: number\n  total: number\n  startTime?: number\n  finishTime?: number\n}\n\nconst Monospace = styled('strong')({\n  fontFamily: 'monospace',\n})\n\nconst BorderLinearProgress = styled(LinearProgress)(() => ({\n  height: 10,\n  borderRadius: 5,\n}))\nexport default function BuildAlert({\n  status: { type, tested, failed: _, skipped, total, startTime, finishTime },\n  characterName,\n}: {\n  status: BuildStatus\n  characterName: Displayable\n}) {\n  const hasTotal = isFinite(total)\n\n  const generatingBuilds = type !== 'inactive'\n  const unskipped = total - skipped\n\n  const testedString = <Monospace>{tested.toLocaleString()}</Monospace>\n  const unskippedString = <Monospace>{unskipped.toLocaleString()}</Monospace>\n  const skippedText = !!skipped && (\n    <span>\n      (<b>{<Monospace>{skipped.toLocaleString()}</Monospace>}</b> skipped)\n    </span>\n  )\n\n  const durationString = (\n    <Monospace>\n      {timeStringMs(\n        Math.round((finishTime ?? performance.now()) - (startTime ?? NaN))\n      )}\n    </Monospace>\n  )\n\n  const color = 'success' as 'success' | 'warning' | 'error'\n  let title = '' as ReactNode\n  let subtitle = '' as ReactNode\n  let progress = undefined as undefined | number\n\n  if (generatingBuilds) {\n    progress = (tested * 100) / unskipped\n    title = (\n      <Typography>\n        Generating and testing {testedString}\n        {hasTotal ? <>/{unskippedString}</> : undefined} build configurations\n        against the criteria for <b>{characterName}</b>. {skippedText}\n      </Typography>\n    )\n    subtitle = <Typography>Time elapsed: {durationString}</Typography>\n  } else if (tested + skipped) {\n    progress = 100\n    title = (\n      <Typography>\n        Generated and tested {testedString} Build configurations against the\n        criteria for <b>{characterName}</b>. {skippedText}\n      </Typography>\n    )\n    subtitle = <Typography>Total duration: {durationString}</Typography>\n  } else {\n    return null\n  }\n\n  return (\n    <Alert\n      severity={color}\n      variant=\"filled\"\n      sx={{\n        '& .MuiAlert-message': {\n          flexGrow: 1,\n        },\n      }}\n    >\n      {title}\n      {subtitle}\n      {progress !== undefined && (\n        <Grid container spacing={1} alignItems=\"center\">\n          {hasTotal && (\n            <Grid item>\n              <Typography>{`${progress.toFixed(1)}%`}</Typography>\n            </Grid>\n          )}\n          <Grid item flexGrow={1}>\n            <BorderLinearProgress\n              variant={hasTotal ? 'determinate' : 'indeterminate'}\n              value={progress}\n              color=\"primary\"\n            />\n          </Grid>\n        </Grid>\n      )}\n    </Alert>\n  )\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { characterAsset } from '@genshin-optimizer/g-assets'\nimport { Typography } from '@mui/material'\nimport { getCharSheet } from '../../Data/Characters'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\nimport BootstrapTooltip from '../BootstrapTooltip'\nimport CharIconSide from '../Image/CharIconSide'\n\nexport default function LocationIcon({\n  characterKey,\n}: {\n  characterKey: CharacterKey\n}) {\n  const { gender } = useDBMeta()\n  const characterSheet = getCharSheet(characterKey, gender)\n  if (!characterSheet) return null\n  return (\n    <BootstrapTooltip\n      placement=\"right-end\"\n      title={<Typography>{characterSheet.name}</Typography>}\n    >\n      <CharIconSide\n        src={characterAsset(characterKey, 'iconSide', gender)}\n        size={3}\n        sideMargin\n      />\n    </BootstrapTooltip>\n  )\n}\n","import { Box } from '@mui/material'\nimport type { StatKey } from '../KeyMap'\nimport KeyMap from '../KeyMap'\nimport StatIcon from '../KeyMap/StatIcon'\nimport { iconInlineProps } from '../SVGIcons'\nimport ColorText from './ColoredText'\n\nexport function StatWithUnit({\n  statKey,\n  disableIcon = false,\n}: {\n  statKey: StatKey\n  disableIcon?: boolean\n}) {\n  return (\n    <Box component=\"span\" display=\"flex\" alignItems=\"center\" gap={1}>\n      {!disableIcon && (\n        <StatIcon statKey={statKey} iconProps={iconInlineProps} />\n      )}\n      <span>\n        {KeyMap.get(statKey)}\n        {KeyMap.unit(statKey)}\n      </span>\n    </Box>\n  )\n}\nexport function StatColoredWithUnit({\n  statKey,\n  disableIcon = false,\n}: {\n  statKey: StatKey\n  disableIcon?: boolean\n}) {\n  return (\n    <ColorText color={KeyMap.getVariant(statKey)}>\n      <StatWithUnit statKey={statKey} disableIcon={disableIcon} />\n    </ColorText>\n  )\n}\n","import { artifactAsset } from '@genshin-optimizer/g-assets'\nimport { BusinessCenter } from '@mui/icons-material'\nimport {\n  alpha,\n  Box,\n  CardActionArea,\n  Chip,\n  Typography,\n  useTheme,\n} from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport Assets from '../../Assets/Assets'\nimport Artifact from '../../Data/Artifacts/Artifact'\nimport { DatabaseContext } from '../../Database/Database'\nimport KeyMap, { cacheValueString } from '../../KeyMap'\nimport StatIcon from '../../KeyMap/StatIcon'\nimport useArtifact from '../../ReactHooks/useArtifact'\nimport type { ICachedSubstat } from '../../Types/artifact'\nimport type { ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport { allElementWithPhyKeys } from '@genshin-optimizer/consts'\nimport { clamp } from '../../Util/Util'\nimport BootstrapTooltip from '../BootstrapTooltip'\nimport CardDark from '../Card/CardDark'\nimport LocationIcon from '../Character/LocationIcon'\nimport ColorText from '../ColoredText'\nimport ConditionalWrapper from '../ConditionalWrapper'\nimport { StatColoredWithUnit } from '../StatDisplay'\nimport ArtifactTooltip from './ArtifactTooltip'\n\ntype Data = {\n  artifactId?: string\n  slotKey: ArtifactSlotKey\n  mainStatAssumptionLevel?: number\n  onClick?: () => void\n  showLocation?: boolean\n  BGComponent?: React.ElementType\n}\n\nexport default function ArtifactCardNano({\n  artifactId,\n  slotKey: pSlotKey,\n  mainStatAssumptionLevel = 0,\n  showLocation = false,\n  onClick,\n  BGComponent = CardDark,\n}: Data) {\n  const art = useArtifact(artifactId)\n  const { database } = useContext(DatabaseContext)\n  const actionWrapperFunc = useCallback(\n    (children) => (\n      <CardActionArea onClick={onClick} sx={{ height: '100%' }}>\n        {children}\n      </CardActionArea>\n    ),\n    [onClick]\n  )\n  const theme = useTheme()\n  if (!art)\n    return (\n      <BGComponent\n        sx={{\n          display: 'flex',\n          height: '100%',\n          alignItems: 'center',\n          justifyContent: 'center',\n        }}\n      >\n        <Box\n          component=\"img\"\n          src={Assets.slot[pSlotKey]}\n          sx={{ width: '25%', height: 'auto', opacity: 0.7 }}\n        />\n      </BGComponent>\n    )\n\n  const { slotKey, rarity, level, mainStatKey, substats, location } = art\n  const mainStatLevel = Math.max(\n    Math.min(mainStatAssumptionLevel, rarity * 4),\n    level\n  )\n  const mainStatUnit = KeyMap.unit(mainStatKey)\n  const element = allElementWithPhyKeys.find((ele) =>\n    art.mainStatKey.includes(ele)\n  )\n  const color = element\n    ? alpha(theme.palette[element].main, 0.6)\n    : alpha(theme.palette.secondary.main, 0.6)\n  return (\n    <BGComponent sx={{ height: '100%' }}>\n      <ConditionalWrapper condition={!!onClick} wrapper={actionWrapperFunc}>\n        <Box display=\"flex\" height=\"100%\">\n          <Box\n            className={`grad-${rarity}star`}\n            sx={{\n              position: 'relative',\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n          >\n            <ArtifactTooltip art={art}>\n              <Box\n                component=\"img\"\n                src={artifactAsset(art.setKey, slotKey)}\n                sx={{ m: -1, maxHeight: '110%', maxWidth: '110%' }}\n              />\n            </ArtifactTooltip>\n            <Box\n              sx={{\n                position: 'absolute',\n                width: '100%',\n                height: '100%',\n                p: 0.5,\n                opacity: 0.85,\n                display: 'flex',\n                justifyContent: 'space-between',\n                pointerEvents: 'none',\n              }}\n            >\n              <Chip\n                size=\"small\"\n                label={<strong>{` +${level}`}</strong>}\n                color={Artifact.levelVariant(level)}\n              />\n              {showLocation && (\n                <Chip\n                  size=\"small\"\n                  label={\n                    location ? (\n                      <LocationIcon\n                        characterKey={\n                          location &&\n                          database.chars.LocationToCharacterKey(location)\n                        }\n                      />\n                    ) : (\n                      <BusinessCenter />\n                    )\n                  }\n                  color={'secondary'}\n                  sx={{\n                    overflow: 'visible',\n                    '.MuiChip-label': {\n                      overflow: 'visible',\n                    },\n                  }}\n                />\n              )}\n            </Box>\n            {/* mainstats */}\n            <Chip\n              size=\"small\"\n              sx={{\n                position: 'absolute',\n                bottom: 0,\n                mb: 1,\n                backgroundColor: color,\n                p: 1,\n              }}\n              icon={\n                <BootstrapTooltip\n                  placement=\"top\"\n                  title={\n                    <Typography>\n                      <StatColoredWithUnit statKey={mainStatKey} />\n                    </Typography>\n                  }\n                  disableInteractive\n                >\n                  <Box lineHeight={0}>\n                    <StatIcon\n                      statKey={mainStatKey}\n                      iconProps={{ style: { padding: '4px' } }}\n                    />\n                  </Box>\n                </BootstrapTooltip>\n              }\n              label={\n                <Typography sx={{ mx: -0.7 }}>\n                  <ColorText\n                    color={mainStatLevel !== level ? 'warning' : undefined}\n                  >\n                    {cacheValueString(\n                      Artifact.mainStatValue(\n                        mainStatKey,\n                        rarity,\n                        mainStatLevel\n                      ) ?? 0,\n                      KeyMap.unit(mainStatKey)\n                    )}\n                    {mainStatUnit}\n                  </ColorText>\n                </Typography>\n              }\n            />\n          </Box>\n          {/* substats */}\n          <Box\n            display=\"flex\"\n            flexDirection=\"column\"\n            justifyContent=\"space-between\"\n            sx={{ p: 1 }}\n          >\n            {substats.map((stat: ICachedSubstat, i: number) => (\n              <SubstatDisplay key={i + stat.key} stat={stat} />\n            ))}\n          </Box>\n        </Box>\n      </ConditionalWrapper>\n    </BGComponent>\n  )\n}\nfunction SubstatDisplay({ stat }: { stat: ICachedSubstat }) {\n  if (!stat.value) return null\n  const numRolls = stat.rolls?.length ?? 0\n  const rollColor = `roll${clamp(numRolls, 1, 6)}`\n  const unit = KeyMap.unit(stat.key)\n  return (\n    <Box display=\"flex\" gap={1} alignContent=\"center\">\n      <Typography\n        sx={{ flexGrow: 1, display: 'flex', gap: 0.5, alignItems: 'center' }}\n        color={(numRolls ? `${rollColor}.main` : 'error.main') as any}\n        component=\"span\"\n      >\n        <BootstrapTooltip\n          placement=\"top\"\n          title={\n            <Typography>\n              {stat.key && <StatColoredWithUnit statKey={stat.key} />}\n            </Typography>\n          }\n          disableInteractive\n        >\n          <Box lineHeight={0}>\n            <StatIcon statKey={stat.key} iconProps={{ fontSize: 'inherit' }} />\n          </Box>\n        </BootstrapTooltip>\n        <span>{`${cacheValueString(\n          stat.value,\n          KeyMap.unit(stat.key)\n        )}${unit}`}</span>\n      </Typography>\n    </Box>\n  )\n}\n","import { Masonry } from '@mui/lab'\nimport { Box, Divider, ListItem } from '@mui/material'\nimport { useContext, useMemo } from 'react'\nimport { DataContext } from '../../Context/DataContext'\nimport { OptimizationTargetContext } from '../../Context/OptimizationTargetContext'\nimport { DatabaseContext } from '../../Database/Database'\nimport { getDisplayHeader, getDisplaySections } from '../../Formula/DisplayUtil'\nimport type { DisplaySub } from '../../Formula/type'\nimport type { NodeDisplay } from '../../Formula/uiData'\nimport { customRead } from '../../Formula/utils'\nimport { objectMap } from '../../Util/Util'\nimport CardDark from '../Card/CardDark'\nimport CardHeaderCustom from '../Card/CardHeaderCustom'\nimport { FieldDisplayList, NodeFieldDisplay } from '../FieldDisplay'\nimport ImgIcon from '../Image/ImgIcon'\nimport SqBadge from '../SqBadge'\n\nexport default function StatDisplayComponent() {\n  const { data } = useContext(DataContext)\n  const sections = useMemo(\n    () =>\n      getDisplaySections(data).filter(([, ns]) =>\n        Object.values(ns).some((n) => !n.isEmpty)\n      ),\n    [data]\n  )\n  return (\n    <Box sx={{ mr: -1, mb: -1 }}>\n      <Masonry columns={{ xs: 1, sm: 2, md: 3, xl: 4 }} spacing={1}>\n        {sections.map(([key, Nodes]) => (\n          <Section key={key} displayNs={Nodes} sectionKey={key} />\n        ))}\n      </Masonry>\n    </Box>\n  )\n}\n\nfunction Section({\n  displayNs,\n  sectionKey,\n}: {\n  displayNs: DisplaySub<NodeDisplay>\n  sectionKey: string\n}) {\n  const optimizationTarget = useContext(OptimizationTargetContext)\n  const { data, oldData } = useContext(DataContext)\n  const { database } = useContext(DatabaseContext)\n  const header = useMemo(\n    () => getDisplayHeader(data, sectionKey, database),\n    [database, data, sectionKey]\n  )\n  const displayNsReads = useMemo(\n    () =>\n      objectMap(displayNs, (n, nodeKey) =>\n        customRead(['display', sectionKey, nodeKey])\n      ),\n    [displayNs, sectionKey]\n  )\n  if (!header) return <CardDark></CardDark>\n\n  const { title, icon, action } = header\n  return (\n    <CardDark>\n      <CardHeaderCustom\n        avatar={icon && <ImgIcon size={2} src={icon} />}\n        title={title}\n        action={action && <SqBadge>{action}</SqBadge>}\n      />\n      <Divider />\n      <FieldDisplayList sx={{ m: 0 }}>\n        {Object.entries(displayNs).map(([nodeKey, n]) => (\n          <NodeFieldDisplay\n            key={nodeKey}\n            node={n}\n            oldValue={\n              oldData ? oldData.get(displayNsReads[nodeKey]!).value : undefined\n            }\n            component={ListItem}\n            emphasize={\n              JSON.stringify(optimizationTarget) ===\n              JSON.stringify([sectionKey, nodeKey])\n            }\n          />\n        ))}\n      </FieldDisplayList>\n    </CardDark>\n  )\n}\n","import { weaponAsset } from '@genshin-optimizer/g-assets'\nimport { BusinessCenter } from '@mui/icons-material'\nimport { Box, CardActionArea, Chip, Skeleton, Typography } from '@mui/material'\nimport { useCallback, useContext, useMemo } from 'react'\nimport { getWeaponSheet } from '../../Data/Weapons'\nimport WeaponSheet from '../../Data/Weapons/WeaponSheet'\nimport { DatabaseContext } from '../../Database/Database'\nimport { input } from '../../Formula'\nimport { computeUIData, dataObjForWeapon } from '../../Formula/api'\nimport type { NodeDisplay } from '../../Formula/uiData'\nimport { nodeVStr } from '../../Formula/uiData'\nimport useWeapon from '../../ReactHooks/useWeapon'\nimport BootstrapTooltip from '../BootstrapTooltip'\nimport CardDark from '../Card/CardDark'\nimport LocationIcon from '../Character/LocationIcon'\nimport ConditionalWrapper from '../ConditionalWrapper'\nimport WeaponNameTooltip from './WeaponNameTooltip'\n\ntype Data = {\n  weaponId?: string\n  onClick?: () => void\n  showLocation?: boolean\n  BGComponent?: React.ElementType\n}\n\nexport default function WeaponCardNano({\n  weaponId,\n  showLocation = false,\n  onClick,\n  BGComponent = CardDark,\n}: Data) {\n  const { database } = useContext(DatabaseContext)\n  const weapon = useWeapon(weaponId)\n  const weaponSheet = weapon?.key && getWeaponSheet(weapon.key)\n  const actionWrapperFunc = useCallback(\n    (children) => (\n      <CardActionArea sx={{ height: '100%' }} onClick={onClick}>\n        {children}\n      </CardActionArea>\n    ),\n    [onClick]\n  )\n  const UIData = useMemo(\n    () =>\n      weaponSheet &&\n      weapon &&\n      computeUIData([weaponSheet.data, dataObjForWeapon(weapon)]),\n    [weaponSheet, weapon]\n  )\n  if (!weapon || !weaponSheet || !UIData)\n    return (\n      <BGComponent sx={{ height: '100%' }}>\n        <Skeleton\n          variant=\"rectangular\"\n          sx={{ width: '100%', height: '100%' }}\n        />\n      </BGComponent>\n    )\n  const { refinement, location } = weapon\n  return (\n    <BGComponent sx={{ height: '100%' }}>\n      <ConditionalWrapper condition={!!onClick} wrapper={actionWrapperFunc}>\n        <Box display=\"flex\" height=\"100%\" alignItems=\"stretch\">\n          <Box\n            className={`grad-${weaponSheet.rarity}star`}\n            sx={{\n              height: '100%',\n              position: 'relative',\n              flexGrow: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'flex-end',\n            }}\n          >\n            <WeaponNameTooltip sheet={weaponSheet}>\n              <Box\n                component=\"img\"\n                src={weaponAsset(weapon.key, weapon.ascension >= 2)}\n                sx={{ mx: -1, maxHeight: '100%', maxWidth: '100%' }}\n              />\n            </WeaponNameTooltip>\n            <Box\n              sx={{\n                position: 'absolute',\n                width: '100%',\n                height: '100%',\n                p: 0.5,\n                opacity: 0.85,\n                display: 'flex',\n                justifyContent: 'space-between',\n                pointerEvents: 'none',\n              }}\n            >\n              <Chip\n                size=\"small\"\n                label={<strong>{WeaponSheet.getLevelString(weapon)}</strong>}\n                color=\"primary\"\n              />\n              {showLocation && (\n                <Chip\n                  size=\"small\"\n                  label={\n                    location ? (\n                      <LocationIcon\n                        characterKey={database.chars.LocationToCharacterKey(\n                          location\n                        )}\n                      />\n                    ) : (\n                      <BusinessCenter />\n                    )\n                  }\n                  color={'secondary'}\n                  sx={{\n                    overflow: 'visible',\n                    '.MuiChip-label': {\n                      overflow: 'visible',\n                    },\n                  }}\n                />\n              )}\n            </Box>\n            <Box\n              sx={{\n                position: 'absolute',\n                width: '100%',\n                height: '100%',\n                p: 0.5,\n                opacity: 0.85,\n                display: 'flex',\n                justifyContent: 'flex-end',\n                alignItems: 'flex-end',\n              }}\n            >\n              {weaponSheet.hasRefinement && (\n                <Chip\n                  size=\"small\"\n                  color=\"info\"\n                  label={<strong>R{refinement}</strong>}\n                />\n              )}\n            </Box>\n          </Box>\n          <Box display=\"flex\" flexDirection=\"column\" sx={{ p: 1 }}>\n            <WeaponStat node={UIData.get(input.weapon.main)} />\n            <WeaponStat node={UIData.get(input.weapon.sub)} />\n          </Box>\n        </Box>\n      </ConditionalWrapper>\n    </BGComponent>\n  )\n}\nfunction WeaponStat({ node }: { node: NodeDisplay }) {\n  if (!node.info.name) return null\n  return (\n    <Box display=\"flex\" gap={1} alignContent=\"center\">\n      <Typography\n        sx={{ flexGrow: 1, display: 'flex', gap: 1 }}\n        component=\"span\"\n      >\n        <BootstrapTooltip\n          placement=\"top\"\n          title={<Typography>{node.info.name}</Typography>}\n          disableInteractive\n        >\n          <span>{node.info.icon}</span>\n        </BootstrapTooltip>\n        <span>{nodeVStr(node)}</span>\n      </Typography>\n    </Box>\n  )\n}\n","import type { ArtifactSetKey, ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport { Box, Typography } from '@mui/material'\nimport { useMemo } from 'react'\nimport ArtifactSetTooltip from '../../../../../Components/Artifact/ArtifactSetTooltip'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { getArtSheet } from '../../../../../Data/Artifacts'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport type { ICachedArtifact } from '../../../../../Types/artifact'\n\ntype ArtifactSetBadgesProps = {\n  artifacts: ICachedArtifact[]\n  currentlyEquipped?: boolean\n}\nexport function ArtifactSetBadges({\n  artifacts,\n  currentlyEquipped = false,\n}: ArtifactSetBadgesProps) {\n  const setToSlots: Partial<Record<ArtifactSetKey, ArtifactSlotKey[]>> =\n    useMemo(\n      () =>\n        artifacts\n          .filter((arti) => arti)\n          .reduce((acc, curr) => {\n            acc[curr.setKey]\n              ? acc[curr.setKey].push(curr.slotKey)\n              : (acc[curr.setKey] = [curr.slotKey])\n            return acc\n          }, {}),\n      [artifacts]\n    )\n  return (\n    <>\n      {Object.entries(setToSlots)\n        .sort(\n          ([_k1, slotarr1], [_k2, slotarr2]) =>\n            slotarr2.length - slotarr1.length\n        )\n        .map(([key, slotarr]) => (\n          <ArtifactSetBadge\n            key={key}\n            setKey={key}\n            currentlyEquipped={currentlyEquipped}\n            slotarr={slotarr}\n          />\n        ))}\n    </>\n  )\n}\nfunction ArtifactSetBadge({\n  setKey,\n  currentlyEquipped = false,\n  slotarr,\n}: {\n  setKey: ArtifactSetKey\n  currentlyEquipped: boolean\n  slotarr: ArtifactSlotKey[]\n}) {\n  const artifactSheet = getArtSheet(setKey)\n  const numInSet = slotarr.length\n  const setActive = Object.keys(artifactSheet.setEffects)\n    .map((setKey) => parseInt(setKey))\n    .filter((setNum) => setNum <= numInSet)\n  return (\n    <Box>\n      <ArtifactSetTooltip artifactSheet={artifactSheet} numInSet={numInSet}>\n        <SqBadge\n          sx={{ height: '100%' }}\n          color={currentlyEquipped ? 'success' : 'primary'}\n        >\n          <Typography>\n            {slotarr.map((slotKey) => (\n              <SlotIcon\n                key={slotKey}\n                slotKey={slotKey}\n                iconProps={iconInlineProps}\n              />\n            ))}{' '}\n            {artifactSheet.name ?? ''}\n            {setActive.map((n, i) => (\n              <SqBadge sx={{ ml: 0.5 }} key={'' + n + i} color=\"success\">\n                {n}\n              </SqBadge>\n            ))}\n          </Typography>\n        </SqBadge>\n      </ArtifactSetTooltip>\n    </Box>\n  )\n}\n","import type { LocationCharacterKey } from '@genshin-optimizer/consts'\nimport {\n  allArtifactSlotKeys,\n  charKeyToLocCharKey,\n} from '@genshin-optimizer/consts'\nimport { Checkroom, ChevronRight } from '@mui/icons-material'\nimport BlockIcon from '@mui/icons-material/Block'\nimport CheckBoxIcon from '@mui/icons-material/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank'\nimport ShowChartIcon from '@mui/icons-material/ShowChart'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport { Suspense, useCallback, useContext, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport ArtifactCardNano from '../../../../../Components/Artifact/ArtifactCardNano'\nimport BootstrapTooltip from '../../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport StatDisplayComponent from '../../../../../Components/Character/StatDisplayComponent'\nimport ColorText from '../../../../../Components/ColoredText'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport WeaponCardNano from '../../../../../Components/Weapon/WeaponCardNano'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport { getCharSheet } from '../../../../../Data/Characters'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport type { AllowLocationsState } from '../../../../../Database/DataManagers/BuildSettingData'\nimport { uiInput as input } from '../../../../../Formula'\nimport ArtifactCard from '../../../../../PageArtifact/ArtifactCard'\nimport type { ICachedArtifact } from '../../../../../Types/artifact'\nimport { toggleArr } from '../../../../../Util/Util'\nimport useBuildSetting from '../useBuildSetting'\nimport { ArtifactSetBadges } from './ArtifactSetBadges'\n\ntype NewOld = {\n  newId: string\n  oldId?: string\n}\n\ntype BuildDisplayItemProps = {\n  label?: Displayable\n  compareBuild: boolean\n  disabled?: boolean\n  extraButtonsRight?: JSX.Element\n  extraButtonsLeft?: JSX.Element\n}\n//for displaying each artifact build\nexport default function BuildDisplayItem({\n  label,\n  compareBuild,\n  extraButtonsRight,\n  extraButtonsLeft,\n  disabled,\n}: BuildDisplayItemProps) {\n  const {\n    character: { key: characterKey, equippedArtifacts },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { mainStatAssumptionLevel, allowLocationsState },\n  } = useBuildSetting(characterKey)\n  const { database } = useContext(DatabaseContext)\n  const dataContext = useContext(DataContext)\n\n  const { data, oldData } = dataContext\n  const [newOld, setNewOld] = useState(undefined as NewOld | undefined)\n  const close = useCallback(() => setNewOld(undefined), [setNewOld])\n\n  const equipBuild = useCallback(() => {\n    if (!window.confirm('Do you want to equip this build to this character?'))\n      return\n    const char = database.chars.get(characterKey)\n    if (!char) return\n    allArtifactSlotKeys.forEach((s) => {\n      const aid = data.get(input.art[s].id).value\n      if (aid)\n        database.arts.set(aid, { location: charKeyToLocCharKey(characterKey) })\n      else {\n        const oldAid = char.equippedArtifacts[s]\n        if (oldAid && database.arts.get(oldAid))\n          database.arts.set(oldAid, { location: '' })\n      }\n    })\n    const weapon = data.get(input.weapon.id).value\n    if (weapon)\n      database.weapons.set(weapon, {\n        location: charKeyToLocCharKey(characterKey),\n      })\n  }, [characterKey, data, database])\n\n  const statProviderContext = useMemo(() => {\n    const dataContext_ = { ...dataContext }\n    if (!compareBuild) dataContext_.oldData = undefined\n    return dataContext_\n  }, [dataContext, compareBuild])\n\n  const artifactIdsBySlot = useMemo(\n    () =>\n      Object.fromEntries(\n        allArtifactSlotKeys.map((slotKey) => [\n          slotKey,\n          data.get(input.art[slotKey].id).value,\n        ])\n      ),\n    [data]\n  )\n  const artifacts = useMemo(\n    () =>\n      artifactIdsBySlot &&\n      (Object.values(artifactIdsBySlot)\n        .map((artiId: string) => database.arts.get(artiId))\n        .filter((arti) => arti) as ICachedArtifact[]),\n    [artifactIdsBySlot, database.arts]\n  )\n\n  // Memoize Arts because of its dynamic onClick\n  const artNanos = useMemo(\n    () =>\n      allArtifactSlotKeys.map((slotKey) => (\n        <Grid item xs={1} key={slotKey}>\n          <ArtifactCardNano\n            showLocation\n            slotKey={slotKey}\n            artifactId={artifactIdsBySlot[slotKey]}\n            mainStatAssumptionLevel={mainStatAssumptionLevel}\n            onClick={() => {\n              const oldId = equippedArtifacts[slotKey]\n              const newId = artifactIdsBySlot[slotKey]!\n              setNewOld({ oldId: oldId !== newId ? oldId : undefined, newId })\n            }}\n          />\n        </Grid>\n      )),\n    [setNewOld, equippedArtifacts, mainStatAssumptionLevel, artifactIdsBySlot]\n  )\n\n  if (!oldData) return null\n  const currentlyEquipped =\n    allArtifactSlotKeys.every(\n      (slotKey) =>\n        artifactIdsBySlot[slotKey] === oldData.get(input.art[slotKey].id).value\n    ) && data.get(input.weapon.id).value === oldData.get(input.weapon.id).value\n\n  return (\n    <CardLight>\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={600} />}\n      >\n        {newOld && (\n          <CompareArtifactModal\n            newOld={newOld}\n            mainStatAssumptionLevel={mainStatAssumptionLevel}\n            onClose={close}\n            allowLocationsState={allowLocationsState}\n          />\n        )}\n        <CardContent>\n          <Box display=\"flex\" gap={1} sx={{ pb: 1 }} flexWrap=\"wrap\">\n            {label !== undefined && (\n              <SqBadge color=\"info\">\n                <Typography>\n                  <strong>\n                    {label}\n                    {currentlyEquipped ? ' (Equipped)' : ''}\n                  </strong>\n                </Typography>\n              </SqBadge>\n            )}\n            <ArtifactSetBadges\n              artifacts={artifacts}\n              currentlyEquipped={currentlyEquipped}\n            />\n            <Box\n              sx={{ flexGrow: 1, display: 'flex', justifyContent: 'flex-end' }}\n            />\n            {extraButtonsLeft}\n            <Button\n              size=\"small\"\n              color=\"success\"\n              onClick={equipBuild}\n              disabled={disabled || currentlyEquipped}\n              startIcon={<Checkroom />}\n            >\n              Equip Build\n            </Button>\n            {extraButtonsRight}\n          </Box>\n          <Grid\n            container\n            spacing={1}\n            sx={{ pb: 1 }}\n            columns={{ xs: 2, sm: 3, md: 4, lg: 6 }}\n          >\n            <Grid item xs={1}>\n              <WeaponCardNano\n                showLocation\n                weaponId={data.get(input.weapon.id).value}\n              />\n            </Grid>\n            {artNanos}\n          </Grid>\n          <DataContext.Provider value={statProviderContext}>\n            <StatDisplayComponent />\n          </DataContext.Provider>\n        </CardContent>\n      </Suspense>\n    </CardLight>\n  )\n}\n\nfunction CompareArtifactModal({\n  newOld: { newId, oldId },\n  mainStatAssumptionLevel,\n  onClose,\n  allowLocationsState,\n}: {\n  newOld: NewOld\n  mainStatAssumptionLevel: number\n  onClose: () => void\n  allowLocationsState: AllowLocationsState\n}) {\n  const { database } = useContext(DatabaseContext)\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const onEquip = useCallback(() => {\n    if (\n      !window.confirm('Do you want to equip this artifact to this character?')\n    )\n      return\n    database.arts.set(newId, { location: charKeyToLocCharKey(characterKey) })\n    onClose()\n  }, [newId, database, characterKey, onClose])\n  const newLoc = database.arts.get(newId)?.location ?? ''\n  return (\n    <ModalWrapper\n      open={!!newId}\n      onClose={onClose}\n      containerProps={{ maxWidth: oldId ? 'md' : 'xs' }}\n    >\n      <CardDark>\n        <CardContent\n          sx={{\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'stretch',\n            gap: 2,\n          }}\n        >\n          {oldId && (\n            <Box minWidth={320}>\n              <ArtifactCard\n                artifactId={oldId}\n                mainStatAssumptionLevel={mainStatAssumptionLevel}\n                canEquip\n                editorProps={{ disableSet: true, disableSlot: true }}\n                extraButtons={<ExcludeButton id={oldId} />}\n              />\n            </Box>\n          )}\n          {oldId && <Box display=\"flex\" flexGrow={1} />}\n          {oldId && (\n            <Box display=\"flex\" alignItems=\"center\" justifyContent=\"center\">\n              <Button onClick={onEquip} sx={{ display: 'flex' }}>\n                <ChevronRight sx={{ fontSize: 40 }} />\n              </Button>\n            </Box>\n          )}\n          {oldId && <Box display=\"flex\" flexGrow={1} />}\n          <Box minWidth={320} display=\"flex\" flexDirection=\"column\" gap={1}>\n            <ArtifactCard\n              artifactId={newId}\n              mainStatAssumptionLevel={mainStatAssumptionLevel}\n              canEquip\n              editorProps={{ disableSet: true, disableSlot: true }}\n              extraButtons={<ExcludeButton id={newId} />}\n            />\n            {newLoc &&\n              newLoc !== charKeyToLocCharKey(characterKey) &&\n              allowLocationsState !== 'all' && (\n                <ExcludeEquipButton locationKey={newLoc} />\n              )}\n          </Box>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\nfunction ExcludeButton({ id }: { id: string }) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { artExclusion },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const excluded = artExclusion.includes(id)\n  const toggle = useCallback(\n    () => buildSettingDispatch({ artExclusion: toggleArr(artExclusion, id) }),\n    [id, artExclusion, buildSettingDispatch]\n  )\n\n  return (\n    <BootstrapTooltip\n      title={\n        <Box>\n          <Typography>{t`excludeArt.excludeArtifactTip`}</Typography>\n          <Typography>\n            <ColorText color={excluded ? 'error' : 'success'}>\n              {t(excluded ? 'excludeArt.excluded' : 'excludeArt.included')}\n            </ColorText>\n          </Typography>\n        </Box>\n      }\n      placement=\"top\"\n      arrow\n    >\n      <Button\n        onClick={toggle}\n        color={excluded ? 'error' : 'success'}\n        size=\"small\"\n      >\n        {excluded ? <BlockIcon /> : <ShowChartIcon />}\n      </Button>\n    </BootstrapTooltip>\n  )\n}\nfunction ExcludeEquipButton({\n  locationKey,\n}: {\n  locationKey: LocationCharacterKey\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const characterSheet = getCharSheet(\n    database.chars.LocationToCharacterKey(locationKey)\n  )\n  const {\n    buildSetting: { excludedLocations },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const excluded = excludedLocations.includes(locationKey)\n  const toggle = useCallback(\n    () =>\n      buildSettingDispatch({\n        excludedLocations: toggleArr(excludedLocations, locationKey),\n      }),\n    [locationKey, excludedLocations, buildSettingDispatch]\n  )\n\n  return (\n    <Button\n      onClick={toggle}\n      color={excluded ? 'secondary' : 'success'}\n      size=\"small\"\n      startIcon={excluded ? <CheckBoxOutlineBlankIcon /> : <CheckBoxIcon />}\n    >\n      <span>\n        {t`excludeChar.allowEquip`} <strong>{characterSheet.name}</strong>\n      </span>\n    </Button>\n  )\n}\n","import { useCallback, useContext, useEffect, useState } from 'react'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport type { IBuildResult } from '../../../../Database/DataManagers/BuildResult'\nimport type { CharacterKey } from '../../../../Types/consts'\n\nexport default function useBuildResult(characterKey: CharacterKey) {\n  const { database } = useContext(DatabaseContext)\n  const [buildResult, setBuildResult] = useState(() =>\n    database.buildResult.get(characterKey)\n  )\n  useEffect(\n    () => setBuildResult(database.buildResult.get(characterKey)),\n    [database, characterKey]\n  )\n  useEffect(\n    () =>\n      database.buildResult.follow(\n        characterKey,\n        (k, r, v) => r === 'update' && setBuildResult(v)\n      ),\n    [characterKey, setBuildResult, database]\n  )\n  const buildResultDispatch = useCallback(\n    (action: Partial<IBuildResult>) =>\n      characterKey && database.buildResult.set(characterKey, action),\n    [characterKey, database]\n  )\n\n  return { buildResult, buildResultDispatch }\n}\n","import type { DotProps } from 'recharts'\nimport type EnhancedPoint from './EnhancedPoint'\n\ntype CustomShapeType = 'circle' | 'diamond' | 'square'\ntype CustomDotProps = DotProps & {\n  selectedPoint: EnhancedPoint | undefined\n  payload?: EnhancedPoint\n  radiusSelected?: number\n  radiusUnselected?: number\n  colorSelected?: string\n  colorUnselected: string\n  shape?: CustomShapeType\n}\nexport default function CustomDot({\n  cx,\n  cy,\n  payload,\n  selectedPoint,\n  radiusSelected = 6,\n  radiusUnselected = 3,\n  colorSelected = 'red',\n  colorUnselected,\n  shape = 'circle',\n}: CustomDotProps) {\n  if (!cx || !cy || !payload) {\n    return null\n  }\n\n  const isSelected =\n    selectedPoint &&\n    selectedPoint.x === payload.x &&\n    selectedPoint.y === payload.y\n\n  return (\n    <g\n      className=\"custom-dot\"\n      data-chart-x={cx}\n      data-chart-y={cy}\n      data-x-value={payload.x}\n      data-y-value={payload.y}\n      data-radius={isSelected ? radiusUnselected : radiusSelected}\n    >\n      {!isSelected ? (\n        <CustomShape\n          id=\"customShapeUnselected\"\n          shape={shape}\n          cx={cx}\n          cy={cy}\n          r={radiusUnselected}\n          fill={colorUnselected}\n        />\n      ) : (\n        <>\n          <CustomShape\n            id=\"customShapeSelected\"\n            shape={shape}\n            cx={cx}\n            cy={cy}\n            r={radiusSelected / 2}\n            fill={colorSelected}\n          />\n          <CustomShape\n            id=\"customShapeBorder\"\n            shape={shape}\n            cx={cx}\n            cy={cy}\n            r={radiusSelected}\n            fill=\"none\"\n            stroke={colorSelected}\n          />\n        </>\n      )}\n    </g>\n  )\n}\nfunction CustomShape({\n  shape,\n  id,\n  cx,\n  cy,\n  r,\n  fill,\n  stroke,\n}: {\n  shape: CustomShapeType\n  id?: string\n  cx: number\n  cy: number\n  r: number\n  fill?: string\n  stroke?: string\n}) {\n  switch (shape) {\n    case 'circle':\n      return (\n        <circle id={id} cx={cx} cy={cy} r={r} fill={fill} stroke={stroke} />\n      )\n    case 'square':\n      return (\n        <rect\n          id={id}\n          x={cx - r}\n          y={cy - r}\n          width={r * 2}\n          height={r * 2}\n          fill={fill}\n          stroke={stroke}\n        />\n      )\n    case 'diamond':\n      return (\n        <polygon\n          id={id}\n          points={`${cx},${cy + r * 2.5} ${cx + r * 1.5},${cy} ${cx},${\n            cy - r * 2.5\n          } ${cx - r * 1.5},${cy}`}\n          fill={fill}\n          stroke={stroke}\n        />\n      )\n  }\n}\n","import { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport {\n  Button,\n  CardContent,\n  ClickAwayListener,\n  Grid,\n  Skeleton,\n  Stack,\n  Typography,\n} from '@mui/material'\nimport { Suspense, useCallback, useContext, useMemo } from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport type { TooltipProps } from 'recharts'\nimport ArtifactCardPico from '../../../../../../Components/Artifact/ArtifactCardPico'\nimport BootstrapTooltip from '../../../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../../../Components/Card/CardDark'\nimport CloseButton from '../../../../../../Components/CloseButton'\nimport SqBadge from '../../../../../../Components/SqBadge'\nimport { DataContext } from '../../../../../../Context/DataContext'\nimport { DatabaseContext } from '../../../../../../Database/Database'\nimport { input } from '../../../../../../Formula'\nimport type { Unit } from '../../../../../../KeyMap'\nimport { valueString } from '../../../../../../KeyMap'\nimport type { ICachedArtifact } from '../../../../../../Types/artifact'\nimport { ArtifactSetBadges } from '../ArtifactSetBadges'\nimport type EnhancedPoint from './EnhancedPoint'\n\ntype CustomTooltipProps = TooltipProps<number, string> & {\n  xLabel: Displayable\n  xUnit: Unit | undefined\n  yLabel: Displayable\n  yUnit: Unit | undefined\n  selectedPoint: EnhancedPoint | undefined\n  setSelectedPoint: (pt: EnhancedPoint | undefined) => void\n  addBuildToList: (build: string[]) => void\n}\nexport default function CustomTooltip({\n  xLabel,\n  xUnit,\n  yLabel,\n  yUnit,\n  selectedPoint,\n  setSelectedPoint,\n  addBuildToList,\n  ...tooltipProps\n}: CustomTooltipProps) {\n  const { database } = useContext(DatabaseContext)\n  const { data } = useContext(DataContext)\n  const { t } = useTranslation('page_character_optimize')\n\n  const artifactsBySlot: { [slot: string]: ICachedArtifact } = useMemo(\n    () =>\n      selectedPoint &&\n      selectedPoint.artifactIds &&\n      Object.fromEntries(\n        selectedPoint.artifactIds\n          .map((id) => {\n            const artiObj = database.arts.get(id)\n            return [artiObj?.slotKey, artiObj]\n          })\n          .filter((arti) => arti)\n      ),\n    [database.arts, selectedPoint]\n  )\n  const clickAwayHandler = useCallback(\n    (e) => {\n      if (\n        !(\n          e.target.id.includes('customShape') ||\n          e.target.id.includes('chartContainer')\n        )\n      ) {\n        setSelectedPoint(undefined)\n      }\n    },\n    [setSelectedPoint]\n  )\n\n  const currentlyEquipped =\n    artifactsBySlot &&\n    allArtifactSlotKeys.every(\n      (slotKey) =>\n        artifactsBySlot[slotKey]?.id === data.get(input.art[slotKey].id).value\n    )\n\n  const generLabel = useMemo(\n    () =>\n      selectedPoint?.generBuildNumber !== undefined &&\n      `#${selectedPoint?.generBuildNumber}`,\n    [selectedPoint]\n  )\n  const graphLabel = useMemo(\n    () =>\n      selectedPoint?.graphBuildNumber !== undefined && (\n        <Trans\n          t={t}\n          i18nKey=\"graphBuildLabel\"\n          count={selectedPoint?.graphBuildNumber}\n        >\n          Graph #{{ count: selectedPoint?.graphBuildNumber + 1 }}\n        </Trans>\n      ),\n    [selectedPoint, t]\n  )\n\n  if (tooltipProps.active && selectedPoint) {\n    return (\n      <ClickAwayListener onClickAway={clickAwayHandler}>\n        <CardDark\n          sx={{ minWidth: '400px', maxWidth: '400px' }}\n          onClick={(e) => e.stopPropagation()}\n        >\n          <CardContent>\n            <Stack gap={1}>\n              <Stack direction=\"row\" alignItems=\"start\" gap={1}>\n                <Stack spacing={0.5} flexGrow={99}>\n                  {currentlyEquipped && (\n                    <SqBadge color=\"info\">\n                      <strong>{t('currentlyEquippedBuild')}</strong>\n                    </SqBadge>\n                  )}\n                  {generLabel && <SqBadge color=\"info\">{generLabel}</SqBadge>}\n                  {graphLabel && <SqBadge color=\"info\">{graphLabel}</SqBadge>}\n                  <Suspense fallback={<Skeleton width={300} height={50} />}>\n                    <ArtifactSetBadges\n                      artifacts={Object.values(artifactsBySlot)}\n                      currentlyEquipped={currentlyEquipped}\n                    />\n                  </Suspense>\n                </Stack>\n                <Grid item flexGrow={1} />\n                <CloseButton onClick={() => setSelectedPoint(undefined)} />\n              </Stack>\n              <Grid container direction=\"row\" spacing={0.75} columns={5}>\n                {allArtifactSlotKeys.map((key) => (\n                  <Grid item key={key} xs={1}>\n                    <Suspense fallback={<Skeleton width={75} height={75} />}>\n                      <ArtifactCardPico\n                        artifactObj={artifactsBySlot[key]}\n                        slotKey={key}\n                      />\n                    </Suspense>\n                  </Grid>\n                ))}\n              </Grid>\n              <Typography>\n                <strong>{xLabel}</strong>:{' '}\n                {valueString(\n                  xUnit === '%' ? selectedPoint.x / 100 : selectedPoint.x,\n                  xUnit\n                )}\n              </Typography>\n              <Typography>\n                <strong>{yLabel}</strong>:{' '}\n                {valueString(\n                  yUnit === '%' ? selectedPoint.y / 100 : selectedPoint.y,\n                  yUnit\n                )}\n              </Typography>\n              <BootstrapTooltip\n                title={\n                  selectedPoint.highlighted\n                    ? t('tcGraph.buildAlreadyInList')\n                    : ''\n                }\n                placement=\"top\"\n              >\n                <span>\n                  <Button\n                    sx={{ width: '100%' }}\n                    disabled={selectedPoint?.graphBuildNumber !== undefined}\n                    color=\"info\"\n                    onClick={() => addBuildToList(selectedPoint.artifactIds)}\n                  >\n                    {t('addBuildToList')}\n                  </Button>\n                </span>\n              </BootstrapTooltip>\n            </Stack>\n          </CardContent>\n        </CardDark>\n      </ClickAwayListener>\n    )\n  }\n\n  return null\n}\n","export default class EnhancedPoint {\n  public x: number\n  public trueY?: number\n  public artifactIds: string[]\n  public min?: number\n  public current?: number\n  public highlighted?: number\n  public generBuildNumber?: number\n  public graphBuildNumber?: number\n\n  public constructor(x: number, y: number, artifactIds: string[]) {\n    this.x = x\n    this.trueY = y\n    this.artifactIds = artifactIds\n  }\n\n  public get y(): number {\n    return (this.trueY || this.current || this.highlighted) as number\n  }\n  public set y(y: number | undefined) {\n    this.trueY = y\n  }\n}\n","import { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  Download,\n  Replay,\n} from '@mui/icons-material'\nimport {\n  Button,\n  CardContent,\n  Collapse,\n  Divider,\n  Grid,\n  Slider,\n  Typography,\n} from '@mui/material'\nimport type { TFunction } from 'i18next'\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport type { LegendType } from 'recharts'\nimport {\n  CartesianGrid,\n  ComposedChart,\n  Label,\n  Legend,\n  Line,\n  ResponsiveContainer,\n  Scatter,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from 'recharts'\nimport BootstrapTooltip from '../../../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../../Components/Card/CardLight'\nimport InfoTooltip from '../../../../../../Components/InfoTooltip'\nimport ReadOnlyTextArea from '../../../../../../Components/ReadOnlyTextArea'\nimport { CharacterContext } from '../../../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../../../Context/DataContext'\nimport { GraphContext } from '../../../../../../Context/GraphContext'\nimport { input } from '../../../../../../Formula'\nimport type { NumNode } from '../../../../../../Formula/type'\nimport { valueString } from '../../../../../../KeyMap'\nimport { objectKeyMap, objPathValue } from '../../../../../../Util/Util'\nimport useBuildResult from '../../useBuildResult'\nimport OptimizationTargetSelector from '../OptimizationTargetSelector'\nimport CustomDot from './CustomDot'\nimport CustomTooltip from './CustomTooltip'\nimport EnhancedPoint from './EnhancedPoint'\n\nexport type Point = {\n  x: number\n  y: number\n  artifactIds: string[]\n  min?: number\n}\ntype ChartCardProps = {\n  plotBase?: string[]\n  setPlotBase: (path: string[] | undefined) => void\n  disabled?: boolean\n  showTooltip?: boolean\n}\nexport default function ChartCard({\n  plotBase,\n  setPlotBase,\n  disabled = false,\n  showTooltip = false,\n}: ChartCardProps) {\n  const { t } = useTranslation(['page_character_optimize', 'ui'])\n  const { data } = useContext(DataContext)\n  const { chartData } = useContext(GraphContext)\n  const [showDownload, setshowDownload] = useState(false)\n  const [showMin, setshowMin] = useState(true)\n  const { graphBuilds } = useContext(GraphContext)\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildResult: { builds: generatedBuilds },\n  } = useBuildResult(characterKey)\n\n  const [sliderLow, setSliderLow] = useState(-Infinity)\n  const [sliderHigh, setSliderHigh] = useState(Infinity)\n  const setSlider = useCallback(\n    (_e: unknown, value: number | number[]) => {\n      if (typeof value === 'number') throw new TypeError()\n      const [l, h] = value\n      setSliderLow(l)\n      setSliderHigh(h)\n    },\n    [setSliderLow, setSliderHigh]\n  )\n  useEffect(() => {\n    setSliderLow(-Infinity)\n    setSliderHigh(Infinity)\n  }, [chartData])\n\n  const { displayData, downloadData, sliderMin, sliderMax } = useMemo(() => {\n    if (!chartData) return { displayData: null, downloadData: null }\n    let sliderMin = Infinity\n    let sliderMax = -Infinity\n    const currentBuild = allArtifactSlotKeys.map(\n      (slotKey) => data?.get(input.art[slotKey].id).value ?? ''\n    )\n    // Shape the data so we know the current and highlighted builds\n    const points = chartData.data\n      .map(({ value: y, plot: x, artifactIds }) => {\n        if (x === undefined) return null\n        if (x < sliderMin) sliderMin = x\n        if (x > sliderMax) sliderMax = x\n        const enhancedDatum: EnhancedPoint = new EnhancedPoint(\n          x,\n          y,\n          artifactIds\n        )\n        const datumBuildMap = objectKeyMap(artifactIds, (_) => true)\n\n        const isCurrentBuild = currentBuild.every((aId) => datumBuildMap[aId])\n        if (isCurrentBuild) {\n          enhancedDatum.current = y\n          // Remove the Y-value so there are not 2 dots displayed for these builds\n          enhancedDatum.y = undefined\n          // Don't return yet, still need to check if build is highlighted\n          console.log(enhancedDatum)\n        }\n\n        const graphBuildIndex = graphBuilds?.findIndex((build) =>\n          build.every((aId) => datumBuildMap[aId])\n        )\n        if (graphBuildIndex !== undefined && graphBuildIndex !== -1) {\n          // Skip setting y-value if it has already been set.\n          if (isCurrentBuild) console.log(enhancedDatum)\n          if (enhancedDatum.trueY !== undefined) {\n            enhancedDatum.highlighted = y\n            // Remove the Y-value so there are not 2 dots displayed for these builds\n            enhancedDatum.y = undefined\n          }\n          enhancedDatum.graphBuildNumber = graphBuildIndex + 1\n          if (isCurrentBuild) console.log(enhancedDatum)\n        }\n\n        const generBuildIndex = generatedBuilds.findIndex((build) =>\n          build.every((aId) => datumBuildMap[aId])\n        )\n        if (generBuildIndex !== -1) {\n          // Skip setting y-value if it has already been set.\n          if (isCurrentBuild) console.log(enhancedDatum)\n          if (enhancedDatum.trueY !== undefined) {\n            enhancedDatum.highlighted = y\n            // Remove the Y-value so there are not 2 dots displayed for these builds\n            enhancedDatum.y = undefined\n          }\n          enhancedDatum.generBuildNumber = generBuildIndex + 1\n          if (isCurrentBuild) console.log(enhancedDatum)\n        }\n\n        return enhancedDatum\n      })\n      .filter((pt): pt is NonNullable<EnhancedPoint> => pt !== null)\n      .sort((a, b) => a.x - b.x)\n\n    const minimumData: EnhancedPoint[] = []\n    for (const point of points) {\n      let last: EnhancedPoint | undefined\n      while ((last = minimumData.pop())) {\n        if (last.y > point.y) {\n          minimumData.push(last)\n          break\n        }\n      }\n      minimumData.push(point)\n    }\n\n    // Note:\n    // We can also just use `minimumData` if the plotter supports multiple data sources.\n    // It could be faster too since there're no empty entries in `minimumData`.\n    // From my limited testing, using multiple data sources makes the graph behave strangely though.\n    if (minimumData[0]?.x !== points[0]?.x) points[0].min = minimumData[0].y\n    minimumData.forEach((pt) => {\n      pt.min = pt.y\n    })\n\n    const downloadData = {\n      minimum: minimumData.map((point) => [point.x, point.y]),\n      allData: points.map((point) => [point.x, point.y]),\n    }\n    return {\n      displayData: points.filter(\n        (pt) => pt && pt.x >= sliderLow && pt.x <= sliderHigh\n      ),\n      downloadData,\n      sliderMin,\n      sliderMax,\n    }\n  }, [chartData, generatedBuilds, data, graphBuilds, sliderLow, sliderHigh])\n\n  const plotBaseNode = plotBase && objPathValue(data?.getDisplay(), plotBase)\n  const invalidTarget = plotBase && (!plotBaseNode || plotBaseNode.isEmpty)\n\n  const buttonText = invalidTarget\n    ? t('page_character_optimize:targetSelector.invalidTarget')\n    : t('page_character_optimize:targetSelector.selectGraphTarget')\n\n  return (\n    <CardLight>\n      <CardContent>\n        <Grid container spacing={1} alignItems=\"center\">\n          <Grid item>\n            <Typography>{t`tcGraph.vs`}</Typography>\n          </Grid>\n          <Grid item>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={\n                showTooltip\n                  ? t('page_character_optimize:selectTargetFirst')\n                  : ''\n              }\n            >\n              <span>\n                <OptimizationTargetSelector\n                  optimizationTarget={plotBase}\n                  setTarget={(target) => setPlotBase(target)}\n                  defaultText={buttonText}\n                  disabled={disabled}\n                />\n              </span>\n            </BootstrapTooltip>\n          </Grid>\n          <Grid item>\n            <BootstrapTooltip\n              title={!plotBase ? '' : t('ui:reset')}\n              placement=\"top\"\n            >\n              <span>\n                <Button\n                  color=\"error\"\n                  onClick={() => setPlotBase(undefined)}\n                  disabled={!plotBase || disabled}\n                >\n                  <Replay />\n                </Button>\n              </span>\n            </BootstrapTooltip>\n          </Grid>\n          <Grid item flexGrow={1}>\n            <InfoTooltip\n              placement=\"top\"\n              title={t('page_character_optimize:tcGraph.desc')}\n            />\n          </Grid>\n          {!!downloadData && (\n            <Grid item>\n              <Button\n                size=\"small\"\n                startIcon={showMin ? <CheckBox /> : <CheckBoxOutlineBlank />}\n                color={showMin ? 'success' : 'secondary'}\n                onClick={() => setshowMin(!showMin)}\n              >{t`tcGraph.showStatThr`}</Button>\n            </Grid>\n          )}\n          {!!downloadData && (\n            <Grid item>\n              <Button\n                size=\"small\"\n                color=\"info\"\n                startIcon={<Download />}\n                onClick={() => setshowDownload(!showDownload)}\n              >{t`tcGraph.downloadData`}</Button>\n            </Grid>\n          )}\n        </Grid>\n      </CardContent>\n      {displayData && displayData.length && <Divider />}\n      {chartData && displayData && displayData.length && (\n        <CardContent>\n          <Collapse in={!!downloadData && showDownload}>\n            <CardDark sx={{ mb: 2 }}>\n              <CardContent>\n                <Typography>Min Data</Typography>\n                <ReadOnlyTextArea\n                  value={JSON.stringify(downloadData?.minimum)}\n                />\n                <Typography>All Data</Typography>\n                <ReadOnlyTextArea\n                  value={JSON.stringify(downloadData?.allData)}\n                />\n              </CardContent>\n            </CardDark>\n          </Collapse>\n          <Chart\n            displayData={displayData}\n            plotNode={chartData.plotNode}\n            valueNode={chartData.valueNode}\n            showMin={showMin}\n          />\n          {displayData.length > 1 && (\n            <Slider\n              marks\n              value={[sliderLow, sliderHigh]}\n              onChange={setSlider}\n              onChangeCommitted={setSlider}\n              min={sliderMin}\n              max={sliderMax}\n              step={(sliderMax - sliderMin) / 20}\n              valueLabelDisplay=\"auto\"\n              valueLabelFormat={(n) =>\n                valueString(\n                  chartData.plotNode.info?.unit === '%' ? n / 100 : n,\n                  chartData.plotNode.info?.unit\n                )\n              }\n              sx={{ ml: '6%', width: '93%' }}\n            />\n          )}\n        </CardContent>\n      )}\n    </CardLight>\n  )\n}\n\nconst optTargetColor = '#8884d8'\nconst highlightedColor = 'cyan'\nconst currentColor = '#46a046'\nconst lineColor = '#ff7300'\nfunction Chart({\n  displayData,\n  plotNode,\n  valueNode,\n  showMin,\n}: {\n  displayData: EnhancedPoint[]\n  plotNode: NumNode\n  valueNode: NumNode\n  showMin: boolean\n}) {\n  const { graphBuilds, setGraphBuilds } = useContext(GraphContext)\n  const { t } = useTranslation('page_character_optimize')\n  const [selectedPoint, setSelectedPoint] = useState<EnhancedPoint>()\n  const addBuildToList = useCallback(\n    (build: string[]) => {\n      setGraphBuilds([...(graphBuilds ?? []), build])\n      setSelectedPoint(undefined)\n    },\n    [setGraphBuilds, graphBuilds]\n  )\n  const chartOnClick = useCallback(\n    (props) => {\n      if (props && props.chartX && props.chartY)\n        setSelectedPoint(\n          getNearestPoint(props.chartX, props.chartY, 20, displayData)\n        )\n    },\n    [setSelectedPoint, displayData]\n  )\n\n  // Below works because character translation should already be loaded\n  const xLabelValue = getLabelFromNode(plotNode, t)\n  const yLabelValue = getLabelFromNode(valueNode, t)\n\n  return (\n    <ResponsiveContainer width=\"100%\" height={600}>\n      <ComposedChart\n        id=\"chartContainer\"\n        data={displayData}\n        onClick={chartOnClick}\n        style={{ cursor: 'pointer' }}\n      >\n        <CartesianGrid strokeDasharray=\"3 3\" />\n        <XAxis\n          dataKey=\"x\"\n          scale=\"linear\"\n          unit={plotNode.info?.unit}\n          domain={['auto', 'auto']}\n          tick={{ fill: 'white' }}\n          type=\"number\"\n          tickFormatter={(n) => (n > 10000 ? n.toFixed() : n.toFixed(1))}\n          label={\n            <Label fill=\"white\" dy={10}>\n              {xLabelValue}\n            </Label>\n          }\n          height={50}\n        />\n        <YAxis\n          name=\"DMG\"\n          domain={['auto', 'auto']}\n          unit={valueNode.info?.unit}\n          allowDecimals={false}\n          tick={{ fill: 'white' }}\n          type=\"number\"\n          label={\n            <Label fill=\"white\" angle={-90} dx={-40}>\n              {yLabelValue}\n            </Label>\n          }\n          width={100}\n        />\n        <Tooltip\n          content={\n            <CustomTooltip\n              xLabel={xLabelValue}\n              xUnit={plotNode.info?.unit}\n              yLabel={yLabelValue}\n              yUnit={valueNode.info?.unit}\n              selectedPoint={selectedPoint}\n              setSelectedPoint={setSelectedPoint}\n              addBuildToList={addBuildToList}\n            />\n          }\n          trigger=\"click\"\n          wrapperStyle={{ pointerEvents: 'auto', cursor: 'auto' }}\n          cursor={false}\n        />\n        <Legend\n          payload={[\n            ...(showMin\n              ? [\n                  {\n                    id: 'min',\n                    value: t`tcGraph.statReqThr`,\n                    type: 'line' as LegendType,\n                    color: lineColor,\n                  },\n                ]\n              : []),\n            {\n              id: 'trueY',\n              value: t`tcGraph.generatedBuilds`,\n              type: 'circle',\n              color: optTargetColor,\n            },\n            {\n              id: 'highlighted',\n              value: t`tcGraph.highlightedBuilds`,\n              type: 'square',\n              color: highlightedColor,\n            },\n            {\n              id: 'current',\n              value: t`tcGraph.currentBuild`,\n              type: 'diamond',\n              color: currentColor,\n            },\n          ]}\n        />\n        {showMin && (\n          <Line\n            dataKey=\"min\"\n            stroke={lineColor}\n            type=\"stepBefore\"\n            connectNulls\n            strokeWidth={2}\n            isAnimationActive={false}\n            dot={false}\n            activeDot={false}\n          />\n        )}\n        <Scatter\n          dataKey=\"trueY\"\n          isAnimationActive={false}\n          shape={\n            <CustomDot\n              selectedPoint={selectedPoint}\n              colorUnselected={optTargetColor}\n            />\n          }\n        />\n        <Scatter\n          dataKey=\"highlighted\"\n          isAnimationActive={false}\n          shape={\n            <CustomDot\n              shape=\"square\"\n              selectedPoint={selectedPoint}\n              colorUnselected={highlightedColor}\n            />\n          }\n        />\n        <Scatter\n          dataKey=\"current\"\n          isAnimationActive={false}\n          shape={\n            <CustomDot\n              shape=\"diamond\"\n              selectedPoint={selectedPoint}\n              colorUnselected={currentColor}\n            />\n          }\n        />\n      </ComposedChart>\n    </ResponsiveContainer>\n  )\n}\n\ninterface DomPt extends Element {\n  dataset: {\n    chartX: number\n    chartY: number\n    xValue: string\n    yValue: string\n  }\n}\nfunction getNearestPoint(\n  clickedX: number,\n  clickedY: number,\n  threshold: number,\n  data: EnhancedPoint[]\n) {\n  const nearestDomPtData = Array.from(\n    document.querySelectorAll<DomPt>('.custom-dot')\n  ).reduce((domPtA, domPtB) => {\n    const { chartX: aChartX, chartY: aChartY } = domPtA.dataset\n    const aDistance = Math.sqrt(\n      (clickedX - aChartX) ** 2 + (clickedY - aChartY) ** 2\n    )\n    const { chartX: bChartX, chartY: bChartY } = domPtB.dataset\n    const bDistance = Math.sqrt(\n      (clickedX - bChartX) ** 2 + (clickedY - bChartY) ** 2\n    )\n    return aDistance <= bDistance ? domPtA : domPtB\n  })['dataset']\n\n  // Don't select a point too far away\n  const distance = Math.sqrt(\n    (clickedX - nearestDomPtData.chartX) ** 2 +\n      (clickedY - nearestDomPtData.chartY) ** 2\n  )\n  return distance < threshold\n    ? data.find(\n        (d) =>\n          d.x === +nearestDomPtData.xValue && d.y === +nearestDomPtData.yValue\n      )\n    : undefined\n}\n\nfunction getLabelFromNode(node: NumNode, t: TFunction) {\n  return typeof node.info?.name === 'string'\n    ? node.info.name\n    : `${t(`${node.info?.name?.props.ns}:${node.info?.name?.props.key18}`)}${\n        node.info?.textSuffix ? ` ${node.info?.textSuffix}` : ''\n      }`\n}\n","import AddIcon from '@mui/icons-material/Add'\nimport CheckBoxIcon from '@mui/icons-material/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  CardContent,\n  Divider,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n} from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport ArtifactCardNano from '../../../../../Components/Artifact/ArtifactCardNano'\nimport ArtifactFilterDisplay from '../../../../../Components/Artifact/ArtifactFilterDisplay'\nimport CardDark from '../../../../../Components/Card/CardDark'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport CloseButton from '../../../../../Components/CloseButton'\nimport InfoTooltip from '../../../../../Components/InfoTooltip'\nimport ModalWrapper from '../../../../../Components/ModalWrapper'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport ArtifactCard from '../../../../../PageArtifact/ArtifactCard'\nimport {\n  artifactFilterConfigs,\n  initialFilterOption,\n} from '../../../../../PageArtifact/ArtifactSort'\nimport useBoolState from '../../../../../ReactHooks/useBoolState'\nimport useForceUpdate from '../../../../../ReactHooks/useForceUpdate'\nimport useMediaQueryUp from '../../../../../ReactHooks/useMediaQueryUp'\nimport { filterFunction } from '../../../../../Util/SortByFilters'\nimport useBuildSetting from '../useBuildSetting'\n\nexport default function ExcludeArt({\n  disabled = false,\n  excludedTotal,\n}: {\n  disabled?: boolean\n  excludedTotal: string\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { artExclusion, useExcludedArts },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const [show, onOpen, onClose] = useBoolState(false)\n  const numExcludedArt = artExclusion.length\n  const [showSel, onOpenSel, onCloseSel] = useBoolState(false)\n  const onSelect = useCallback(\n    (id: string) => {\n      buildSettingDispatch({\n        artExclusion: [...artExclusion, id],\n        useExcludedArts: true,\n      })\n    },\n    [buildSettingDispatch, artExclusion]\n  )\n  const onDelSelect = useCallback(\n    (id: string) => {\n      buildSettingDispatch({\n        artExclusion: artExclusion.filter((i) => i !== id),\n        useExcludedArts: true,\n      })\n    },\n    [buildSettingDispatch, artExclusion]\n  )\n  const toggleArtExclusion = useCallback(\n    () => buildSettingDispatch({ useExcludedArts: !useExcludedArts }),\n    [buildSettingDispatch, useExcludedArts]\n  )\n  return (\n    <>\n      {/* Begin modal */}\n      <ModalWrapper\n        open={show}\n        onClose={onClose}\n        containerProps={{ maxWidth: 'xl' }}\n      >\n        <CardDark>\n          <CardContent>\n            <Box display=\"flex\" gap={1} alignItems=\"center\">\n              <Typography variant=\"h6\">{t`excludeArt.title_exclude`}</Typography>\n              <InfoTooltip\n                title={<Typography>{t`excludeArt.title_tooltip`}</Typography>}\n              />\n              <Box flexGrow={1} />\n              <CloseButton onClick={onClose} size=\"small\" />\n            </Box>\n          </CardContent>\n          <Divider />\n          <CardContent>\n            <ArtifactSelectModal\n              show={showSel}\n              onClose={onCloseSel}\n              onSelect={onSelect}\n              artExclusion={artExclusion}\n            />\n            <Button\n              fullWidth\n              onClick={onOpenSel}\n              color=\"info\"\n              sx={{ mb: 1 }}\n              startIcon={<AddIcon />}\n            >{t`excludeArt.addExc`}</Button>\n            {!!numExcludedArt && (\n              <CardLight sx={{ mb: 1 }}>\n                <Typography textAlign=\"center\">{t`excludeArt.deSelectExc`}</Typography>\n              </CardLight>\n            )}\n            <Grid\n              container\n              columns={{ xs: 3, md: 5, lg: 6, xl: 8 }}\n              spacing={1}\n            >\n              {artExclusion.map((id) => (\n                <Grid item key={id} xs={1}>\n                  <ArtifactCardNano\n                    artifactId={id}\n                    slotKey=\"flower\"\n                    BGComponent={CardLight}\n                    onClick={() => onDelSelect(id)}\n                    showLocation\n                  />\n                </Grid>\n              ))}\n            </Grid>\n          </CardContent>\n        </CardDark>\n      </ModalWrapper>\n\n      {/* Button to open modal */}\n      <ButtonGroup sx={{ display: 'flex', width: '100%' }}>\n        <Button\n          onClick={toggleArtExclusion}\n          disabled={disabled}\n          startIcon={\n            useExcludedArts ? <CheckBoxIcon /> : <CheckBoxOutlineBlankIcon />\n          }\n          color={useExcludedArts ? 'success' : 'secondary'}\n          sx={{ flexGrow: 1 }}\n        >\n          <Box sx={{ display: 'flex', gap: 1 }}>\n            <Box>{t('excludeArt.button_text')}</Box>\n            <SqBadge sx={{ whiteSpace: 'normal' }}>\n              {useExcludedArts ? (\n                <Trans t={t} i18nKey=\"excludeArt.usingNum\">\n                  Using {{ totalStr: excludedTotal } as TransObject} excluded\n                  artifacts\n                </Trans>\n              ) : (\n                <Trans t={t} i18nKey=\"excludeArt.excNum\" count={numExcludedArt}>\n                  {{ count: numExcludedArt } as TransObject} artifacts are\n                  excluded\n                </Trans>\n              )}\n            </SqBadge>\n          </Box>\n        </Button>\n        <Button\n          color=\"info\"\n          onClick={onOpen}\n          disabled={disabled}\n          sx={{ flexShrink: 1 }}\n        >\n          <SettingsIcon />\n        </Button>\n      </ButtonGroup>\n    </>\n  )\n}\n\nconst numToShowMap = { xs: 2 * 3, sm: 2 * 3, md: 3 * 3, lg: 4 * 3, xl: 4 * 3 }\nconst filterOptionReducer = (state, action) => ({ ...state, ...action })\nfunction ArtifactSelectModal({\n  onSelect,\n  show,\n  onClose,\n  artExclusion,\n}: {\n  onSelect: (id: string) => void\n  show: boolean\n  onClose: () => void\n  artExclusion: string[]\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const { database } = useContext(DatabaseContext)\n  const clickHandler = useCallback(\n    (id: string) => {\n      onSelect(id)\n      onClose()\n    },\n    [onSelect, onClose]\n  )\n\n  const [filterOption, filterOptionDispatch] = useReducer(\n    filterOptionReducer,\n    initialFilterOption()\n  )\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(() => {\n    return database.arts.followAny(forceUpdate)\n  }, [database, forceUpdate])\n\n  const brPt = useMediaQueryUp()\n\n  const filterConfigs = useMemo(() => artifactFilterConfigs(), [])\n  const artIdList = useMemo(() => {\n    const filterFunc = filterFunction(filterOption, filterConfigs)\n    return (\n      dbDirty &&\n      database.arts.values\n        .filter(filterFunc)\n        .map((art) => art.id)\n        .filter((id) => !artExclusion.includes(id))\n        .slice(0, numToShowMap[brPt])\n    )\n  }, [dbDirty, database, filterConfigs, filterOption, brPt, artExclusion])\n\n  return (\n    <ModalWrapper\n      open={show}\n      onClose={onClose}\n      containerProps={{ maxWidth: 'xl' }}\n    >\n      <CardDark>\n        <CardContent\n          sx={{\n            py: 1,\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <Typography variant=\"h6\">{t`excludeArt.selExc`}</Typography>\n          <CloseButton onClick={onClose} />\n        </CardContent>\n        <Divider />\n        <CardContent>\n          <Suspense\n            fallback={\n              <Skeleton variant=\"rectangular\" width=\"100%\" height={200} />\n            }\n          >\n            <ArtifactFilterDisplay\n              filterOption={filterOption}\n              filterOptionDispatch={filterOptionDispatch}\n              filteredIds={artIdList}\n            />\n          </Suspense>\n          <Box mt={1}>\n            <Suspense\n              fallback={\n                <Skeleton variant=\"rectangular\" width=\"100%\" height={300} />\n              }\n            >\n              <Grid container spacing={1} columns={{ xs: 2, md: 3, lg: 4 }}>\n                {artIdList.map((id) => (\n                  <Grid item key={id} xs={1}>\n                    <ArtifactCard artifactId={id} onClick={clickHandler} />\n                  </Grid>\n                ))}\n              </Grid>\n            </Suspense>\n          </Box>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n","import { allElementWithPhyKeys } from '@genshin-optimizer/consts'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  Typography,\n} from '@mui/material'\nimport { useContext, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport SlotIcon from '../../../../../Components/Artifact/SlotIcon'\nimport BootstrapTooltip from '../../../../../Components/BootstrapTooltip'\nimport SqBadge from '../../../../../Components/SqBadge'\nimport { StatColoredWithUnit } from '../../../../../Components/StatDisplay'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport Artifact from '../../../../../Data/Artifacts/Artifact'\nimport { DatabaseContext } from '../../../../../Database/Database'\nimport StatIcon from '../../../../../KeyMap/StatIcon'\nimport { iconInlineProps } from '../../../../../SVGIcons'\nimport FlowerIcon from '../../../../../SVGIcons/ArtifactSlot/FlowerIcon'\nimport PlumeIcon from '../../../../../SVGIcons/ArtifactSlot/PlumeIcon'\nimport AtkIcon from '../../../../../SVGIcons/Stats/AtkIcon'\nimport HpIcon from '../../../../../SVGIcons/Stats/HpIcon'\nimport { handleMultiSelect } from '../../../../../Util/MultiSelect'\nimport { bulkCatTotal } from '../../../../../Util/totalUtils'\nimport useBuildSetting from '../useBuildSetting'\n\nexport const artifactsSlotsToSelectMainStats = [\n  'sands',\n  'goblet',\n  'circlet',\n] as const\n\nexport default function MainStatSelectionCard({\n  disabled = false,\n  filteredArtIdMap,\n}: {\n  disabled?: boolean\n  filteredArtIdMap: Record<string, boolean>\n}) {\n  const { t } = useTranslation('artifact')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { mainStatKeys },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const { database } = useContext(DatabaseContext)\n  const { mainStatSlotTots, slotTots } = useMemo(() => {\n    const catKeys = {\n      flowerMainStatTots: Artifact.slotMainStats('flower'),\n      plumeMainStatTots: Artifact.slotMainStats('plume'),\n      sandsMainStatTots: Artifact.slotMainStats('sands'),\n      gobletMainStatTots: Artifact.slotMainStats('goblet'),\n      circletMainStatTots: Artifact.slotMainStats('circlet'),\n      slotTots: artifactsSlotsToSelectMainStats,\n    } as const\n    const catTotals = bulkCatTotal(catKeys, (ctMap) =>\n      Object.entries(database.arts.data).forEach(([id, art]) => {\n        const { slotKey, mainStatKey } = art\n        if (\n          (artifactsSlotsToSelectMainStats as readonly string[]).includes(\n            slotKey\n          )\n        ) {\n          ctMap.slotTots[slotKey].total++\n          if (filteredArtIdMap[id]) ctMap.slotTots[slotKey].current++\n        }\n        ctMap[`${slotKey}MainStatTots`][mainStatKey].total++\n        if (filteredArtIdMap[id])\n          ctMap[`${slotKey}MainStatTots`][mainStatKey].current++\n      })\n    )\n    return {\n      mainStatSlotTots: {\n        flower: catTotals.flowerMainStatTots,\n        plume: catTotals.plumeMainStatTots,\n        sands: catTotals.sandsMainStatTots,\n        goblet: catTotals.gobletMainStatTots,\n        circlet: catTotals.circletMainStatTots,\n      },\n      slotTots: catTotals.slotTots,\n    }\n  }, [database, filteredArtIdMap])\n\n  return (\n    <Box display=\"flex\" flexDirection=\"column\">\n      <Divider />\n      <Box display=\"flex\">\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={<Typography>{t(`slotName.flower`)}</Typography>}\n            >\n              <FlowerIcon fontSize=\"inherit\" />\n            </BootstrapTooltip>\n            <Box flexGrow={1}>\n              <SqBadge color=\"info\">\n                <HpIcon {...iconInlineProps} /> {mainStatSlotTots.flower.hp}\n              </SqBadge>\n            </Box>\n          </Box>\n        </CardContent>\n        <Divider orientation=\"vertical\" flexItem />\n        <CardContent sx={{ flexGrow: 1 }}>\n          <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={<Typography>{t(`slotName.plume`)}</Typography>}\n            >\n              <PlumeIcon fontSize=\"inherit\" />\n            </BootstrapTooltip>\n            <Box flexGrow={1}>\n              <SqBadge color=\"info\">\n                <AtkIcon {...iconInlineProps} /> {mainStatSlotTots.plume.atk}\n              </SqBadge>\n            </Box>\n          </Box>\n        </CardContent>\n      </Box>\n      {artifactsSlotsToSelectMainStats.map((slotKey) => {\n        const selectedMainKeys = mainStatKeys[slotKey]\n        const mainKeys = Artifact.slotMainStats(slotKey)\n        const mainKeysHandler = handleMultiSelect([...mainKeys])\n        return (\n          <Box key={slotKey}>\n            <Divider />\n            <CardContent sx={{ pt: 1, pb: 1 }}>\n              <Box\n                sx={{ display: 'flex', gap: 1, alignItems: 'center', pb: 1 }}\n              >\n                <BootstrapTooltip\n                  placement=\"top\"\n                  title={<Typography>{t(`slotName.${slotKey}`)}</Typography>}\n                >\n                  <Box lineHeight={0}>\n                    <SlotIcon\n                      slotKey={slotKey}\n                      iconProps={{ fontSize: 'inherit' }}\n                    />\n                  </Box>\n                </BootstrapTooltip>\n                <Box flexGrow={1}>\n                  <SqBadge color=\"info\">{slotTots[slotKey]}</SqBadge>\n                </Box>\n              </Box>\n              <Grid container spacing={1}>\n                {mainKeys.map((mainStatKey, i) => {\n                  const element = allElementWithPhyKeys.find((ele) =>\n                    mainStatKey.includes(ele)\n                  )\n                  const color = selectedMainKeys.includes(mainStatKey)\n                    ? element ?? 'success'\n                    : 'secondary'\n                  return (\n                    <Grid\n                      item\n                      key={mainStatKey}\n                      flexGrow={1}\n                      xs={\n                        (i < 3 && slotKey !== 'goblet') || slotKey === 'goblet'\n                          ? 4\n                          : undefined\n                      }\n                    >\n                      <BootstrapTooltip\n                        placement=\"top\"\n                        title={\n                          <Typography>\n                            <strong>\n                              <StatColoredWithUnit statKey={mainStatKey} />\n                            </strong>\n                          </Typography>\n                        }\n                        disableInteractive\n                      >\n                        <Button\n                          fullWidth\n                          size=\"small\"\n                          color={color}\n                          sx={{\n                            height: '100%',\n                            pointerEvents: disabled ? 'none' : undefined,\n                            cursor: disabled ? 'none' : undefined,\n                          }}\n                          startIcon={<StatIcon statKey={mainStatKey} />}\n                          onClick={() =>\n                            buildSettingDispatch({\n                              mainStatKeys: {\n                                ...mainStatKeys,\n                                [slotKey]: mainKeysHandler(\n                                  selectedMainKeys,\n                                  mainStatKey\n                                ),\n                              },\n                            })\n                          }\n                        >\n                          {mainStatSlotTots[slotKey][mainStatKey]}\n                        </Button>\n                      </BootstrapTooltip>\n                    </Grid>\n                  )\n                })}\n              </Grid>\n            </CardContent>\n          </Box>\n        )\n      })}\n    </Box>\n  )\n}\n","import {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  DeleteForever,\n} from '@mui/icons-material'\nimport { Button, ButtonGroup } from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CustomNumberInput, {\n  CustomNumberInputButtonGroupWrapper,\n} from '../../../../../Components/CustomNumberInput'\nimport { DataContext } from '../../../../../Context/DataContext'\nimport type {\n  StatFilters,\n  StatFilterSetting,\n} from '../../../../../Database/DataManagers/BuildSettingData'\nimport type { NodeDisplay } from '../../../../../Formula/uiData'\nimport { objPathValue } from '../../../../../Util/Util'\nimport OptimizationTargetSelector from './OptimizationTargetSelector'\n\ntype OptimizationTargetEditorListProps = {\n  statFilters: StatFilters\n  setStatFilters: (statFilters: StatFilters) => void\n  disabled: boolean\n}\n\nexport default function OptimizationTargetEditorList({\n  statFilters,\n  setStatFilters,\n  disabled = false,\n}: OptimizationTargetEditorListProps) {\n  const setTarget = useCallback(\n    (path: string[], oldPath?: string[], oldIndex?: number) => {\n      const statFilters_ = { ...statFilters }\n      const oldPathStr = JSON.stringify(oldPath)\n      const oldFilterArr = oldPath ? [...statFilters[oldPathStr]!] : undefined\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...(statFilters[pathStr] ?? [])]\n      // Copy/create new setting\n      if (oldIndex !== undefined && oldFilterArr)\n        filterArr.push(oldFilterArr[oldIndex])\n      else filterArr.push({ value: 0, disabled: false })\n      statFilters_[pathStr] = filterArr\n      // Remove old setting\n      if (oldIndex !== undefined && oldFilterArr) {\n        oldFilterArr.splice(oldIndex, 1)\n        if (oldFilterArr.length) statFilters_[oldPathStr] = oldFilterArr\n        else delete statFilters_[oldPathStr]\n      }\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  const delTarget = useCallback(\n    (path: string[], index: number) => {\n      const statFilters_ = { ...statFilters }\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...statFilters[pathStr]!]\n      filterArr.splice(index, 1)\n      if (filterArr.length) statFilters_[pathStr] = filterArr\n      else delete statFilters_[pathStr]\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  const setTargetValue = useCallback(\n    (path: string[], index: number, value: number) => {\n      const statFilters_ = { ...statFilters }\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...statFilters[pathStr]!]\n      filterArr[index] = { ...filterArr[index], value } as StatFilterSetting\n      statFilters_[pathStr] = filterArr\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  const setTargetDisabled = useCallback(\n    (path: string[], index: number, disabled: boolean) => {\n      const statFilters_ = { ...statFilters }\n      const pathStr = JSON.stringify(path)\n      const filterArr = [...statFilters[pathStr]!]\n      filterArr[index] = { ...filterArr[index], disabled } as StatFilterSetting\n      statFilters_[pathStr] = filterArr\n      setStatFilters({ ...statFilters_ })\n    },\n    [setStatFilters, statFilters]\n  )\n\n  return (\n    <>\n      {Object.entries(statFilters).flatMap(([pathStr, settings]) =>\n        settings?.map((setting, index) => (\n          <OptimizationTargetEditorItem\n            path={JSON.parse(pathStr)}\n            setting={setting}\n            index={index}\n            setTarget={setTarget}\n            delTarget={delTarget}\n            setValue={setTargetValue}\n            setDisabled={setTargetDisabled}\n            disabled={disabled}\n            key={pathStr + index}\n          />\n        ))\n      )}\n      <OptimizationTargetEditorItem\n        setTarget={setTarget}\n        delTarget={delTarget}\n        setValue={setTargetValue}\n        setDisabled={setTargetDisabled}\n        disabled={disabled}\n      />\n    </>\n  )\n}\n\ntype OptimizationTargetEditorItemProps = {\n  path?: string[]\n  setting?: StatFilterSetting\n  index?: number\n  setTarget: (path: string[], oldPath?: string[], oldIndex?: number) => void\n  delTarget: (path: string[], index: number) => void\n  setValue: (path: string[], index: number, value: number) => void\n  setDisabled: (path: string[], index: number, disabled: boolean) => void\n  disabled: boolean\n}\nfunction OptimizationTargetEditorItem({\n  path,\n  setting,\n  index,\n  setTarget,\n  delTarget,\n  setValue,\n  setDisabled,\n  disabled,\n}: OptimizationTargetEditorItemProps) {\n  const { t } = useTranslation('page_character_optimize')\n  const { data } = useContext(DataContext)\n  const onChange = useCallback(\n    (val: number | undefined) =>\n      path && index !== undefined && setValue(path, index, val ?? 0),\n    [setValue, path, index]\n  )\n  const buttonStyle = { p: 1, flexBasis: 30, flexGrow: 0, flexShrink: 0 }\n\n  const buildConstraintNode: NodeDisplay = objPathValue(\n    data.getDisplay(),\n    path ?? []\n  )\n  const isPercent = buildConstraintNode?.info?.unit === '%'\n\n  return (\n    <ButtonGroup\n      sx={{ '& .MuiButtonGroup-grouped': { minWidth: 24 }, width: '100%' }}\n    >\n      {!!setting && !!path && index !== undefined && (\n        <Button\n          sx={buttonStyle}\n          color={setting.disabled ? 'secondary' : 'success'}\n          onClick={() => setDisabled(path, index, !setting.disabled)}\n          disabled={disabled}\n        >\n          {setting.disabled ? <CheckBoxOutlineBlank /> : <CheckBox />}\n        </Button>\n      )}\n      <OptimizationTargetSelector\n        showEmptyTargets\n        optimizationTarget={path}\n        setTarget={(target) => setTarget(target, path, index)}\n        defaultText={t('targetSelector.selectBuildTarget')}\n      />\n      <CustomNumberInputButtonGroupWrapper sx={{ flexBasis: 150, flexGrow: 1 }}>\n        <CustomNumberInput\n          float\n          disabled={!path || disabled}\n          value={setting?.value}\n          placeholder=\"Stat Value\"\n          onChange={onChange}\n          sx={{ px: 1 }}\n          inputProps={{ sx: { textAlign: 'right' } }}\n          endAdornment={isPercent ? '%' : undefined}\n        />\n      </CustomNumberInputButtonGroupWrapper>\n      {!!path && index !== undefined && (\n        <Button\n          sx={buttonStyle}\n          color=\"error\"\n          onClick={() => delTarget(path, index)}\n          disabled={disabled}\n        >\n          <DeleteForever fontSize=\"small\" />\n        </Button>\n      )}\n    </ButtonGroup>\n  )\n}\n","import { Box, CardContent, Divider, Typography } from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CardLight from '../../../../../Components/Card/CardLight'\nimport InfoTooltip from '../../../../../Components/InfoTooltip'\nimport { CharacterContext } from '../../../../../Context/CharacterContext'\nimport type { StatFilters } from '../../../../../Database/DataManagers/BuildSettingData'\nimport useBuildSetting from '../useBuildSetting'\nimport OptimizationTargetEditorList from './OptimizationTargetEditorList'\n\nexport default function StatFilterCard({\n  disabled = false,\n}: {\n  disabled?: boolean\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { statFilters },\n    buildSettingDispatch,\n  } = useBuildSetting(characterKey)\n  const setStatFilters = useCallback(\n    (statFilters: StatFilters) => buildSettingDispatch({ statFilters }),\n    [buildSettingDispatch]\n  )\n\n  return (\n    <Box>\n      <CardLight>\n        <CardContent\n          sx={{\n            display: 'flex',\n            gap: 1,\n            justifyContent: 'space-between',\n            flexDirection: 'column',\n          }}\n        >\n          <Box display=\"flex\" justifyContent=\"space-between\">\n            <Typography\n              sx={{ fontWeight: 'bold' }}\n            >{t`constraintFilter.title`}</Typography>\n            <InfoTooltip\n              title={<Typography>{t`constraintFilter.tooltip`}</Typography>}\n            />\n          </Box>\n        </CardContent>\n        <Divider />\n        <Box display=\"flex\" flexDirection=\"column\" gap={0.5}>\n          <OptimizationTargetEditorList\n            statFilters={statFilters}\n            setStatFilters={setStatFilters}\n            disabled={disabled}\n          />\n        </Box>\n      </CardLight>\n    </Box>\n  )\n}\n","import Artifact from '../../../../Data/Artifacts/Artifact'\nimport { input } from '../../../../Formula'\nimport { computeUIData } from '../../../../Formula/api'\nimport { formulaString } from '../../../../Formula/debug'\nimport type { Data, NumNode } from '../../../../Formula/type'\nimport { constant, setReadNodeKeys } from '../../../../Formula/utils'\nimport type { ICachedArtifact } from '../../../../Types/artifact'\nimport { allMainStatKeys, allSubstatKeys } from '../../../../Types/artifact'\nimport { deepClone, objectKeyMap, objectMap } from '../../../../Util/Util'\nimport type {\n  ArtifactBuildData,\n  ArtifactsBySlot,\n  DynStat,\n} from '../../../../Solver/common'\n\nconst dynamic = setReadNodeKeys(\n  deepClone({ dyn: { ...input.art, ...input.artSet } })\n)\nexport const dynamicData = {\n  art: objectKeyMap(\n    [...allMainStatKeys, ...allSubstatKeys],\n    (key) => dynamic.dyn[key]\n  ),\n  artSet: objectMap(input.artSet, (_, key) => dynamic.dyn[key]),\n}\n\nexport function compactArtifacts(\n  arts: ICachedArtifact[],\n  mainStatAssumptionLevel: number,\n  allowPartial: boolean\n): ArtifactsBySlot {\n  const result: ArtifactsBySlot = {\n    base: {},\n    values: { flower: [], plume: [], goblet: [], circlet: [], sands: [] },\n  }\n  const keys = new Set<string>()\n\n  for (const art of arts) {\n    const mainStatVal = Artifact.mainStatValue(\n      art.mainStatKey,\n      art.rarity,\n      Math.max(Math.min(mainStatAssumptionLevel, art.rarity * 4), art.level)\n    )\n\n    const data: ArtifactBuildData = {\n      id: art.id,\n      set: art.setKey,\n      values: {\n        [art.setKey]: 1,\n        [art.mainStatKey]: art.mainStatKey.endsWith('_')\n          ? mainStatVal / 100\n          : mainStatVal,\n        ...Object.fromEntries(\n          art.substats.map((substat) => [\n            substat.key,\n            substat.key.endsWith('_')\n              ? substat.accurateValue / 100\n              : substat.accurateValue,\n          ])\n        ),\n      },\n    }\n    delete data.values['']\n    result.values[art.slotKey].push(data)\n    Object.keys(data.values).forEach((x) => keys.add(x))\n  }\n  result.base = objectKeyMap([...keys], (_) => 0)\n  if (allowPartial)\n    for (const value of Object.values(result.values))\n      value.push({ id: '', values: {} })\n  return result\n}\n\nexport function debugCompute(\n  nodes: NumNode[],\n  base: DynStat,\n  arts: ArtifactBuildData[]\n) {\n  const stats = { ...base }\n  for (const art of arts) {\n    for (const [key, value] of Object.entries(art.values)) {\n      stats[key] = (stats[key] ?? 0) + value\n    }\n  }\n  const data = {\n    dyn: Object.fromEntries(\n      Object.entries(stats).map(([key, value]) => [key, constant(value)])\n    ),\n  } as Data\n  const uiData = computeUIData([data])\n  return {\n    base,\n    arts,\n    stats,\n    data,\n    uiData,\n    nodes: nodes.map(formulaString),\n    results: nodes.map((node) => uiData.get(node)),\n  }\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { charKeyToLocCharKey } from '@genshin-optimizer/consts'\nimport {\n  CheckBox,\n  CheckBoxOutlineBlank,\n  Close,\n  DeleteForever,\n  Science,\n  TrendingUp,\n} from '@mui/icons-material'\nimport NotificationsActiveIcon from '@mui/icons-material/NotificationsActive'\nimport NotificationsOffIcon from '@mui/icons-material/NotificationsOff'\nimport {\n  Alert,\n  Box,\n  Button,\n  ButtonGroup,\n  CardContent,\n  Divider,\n  Grid,\n  Link,\n  MenuItem,\n  Skeleton,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport React, {\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { Trans, useTranslation } from 'react-i18next'\nimport { Link as RouterLink, useLocation, useNavigate } from 'react-router-dom'\nimport ArtifactLevelSlider from '../../../../Components/Artifact/ArtifactLevelSlider'\nimport BootstrapTooltip from '../../../../Components/BootstrapTooltip'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport CharacterCard from '../../../../Components/Character/CharacterCard'\nimport DropdownButton from '../../../../Components/DropdownMenu/DropdownButton'\nimport {\n  HitModeToggle,\n  ReactionToggle,\n} from '../../../../Components/HitModeEditor'\nimport InfoTooltip from '../../../../Components/InfoTooltip'\nimport SolidToggleButtonGroup from '../../../../Components/SolidToggleButtonGroup'\nimport SqBadge from '../../../../Components/SqBadge'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../../Context/DataContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { GraphContext } from '../../../../Context/GraphContext'\nimport { OptimizationTargetContext } from '../../../../Context/OptimizationTargetContext'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { defThreads } from '../../../../Database/DataEntries/DisplayOptimizeEntry'\nimport { mergeData, uiDataForTeam } from '../../../../Formula/api'\nimport { optimize } from '../../../../Formula/optimization'\nimport type { NumNode } from '../../../../Formula/type'\nimport type { UIData } from '../../../../Formula/uiData'\nimport useCharacterReducer from '../../../../ReactHooks/useCharacterReducer'\nimport useCharSelectionCallback from '../../../../ReactHooks/useCharSelectionCallback'\nimport useDBMeta from '../../../../ReactHooks/useDBMeta'\nimport useForceUpdate from '../../../../ReactHooks/useForceUpdate'\nimport useGlobalError from '../../../../ReactHooks/useGlobalError'\nimport useMediaQueryUp from '../../../../ReactHooks/useMediaQueryUp'\nimport useTeamData, { getTeamData } from '../../../../ReactHooks/useTeamData'\nimport type { OptProblemInput } from '../../../../Solver'\nimport type { Build } from '../../../../Solver/common'\nimport { mergeBuilds, mergePlot } from '../../../../Solver/common'\nimport { GOSolver } from '../../../../Solver/GOSolver/GOSolver'\nimport type { ICachedArtifact } from '../../../../Types/artifact'\nimport { bulkCatTotal } from '../../../../Util/totalUtils'\nimport { objectKeyMap, objPathValue, range } from '../../../../Util/Util'\nimport { maxBuildsToShowList } from './Build'\nimport AllowChar from './Components/AllowChar'\nimport ArtifactSetConfig from './Components/ArtifactSetConfig'\nimport AssumeFullLevelToggle from './Components/AssumeFullLevelToggle'\nimport BonusStatsCard from './Components/BonusStatsCard'\nimport type { BuildStatus } from './Components/BuildAlert'\nimport BuildAlert from './Components/BuildAlert'\nimport BuildDisplayItem from './Components/BuildDisplayItem'\nimport ChartCard from './Components/ChartCard'\nimport ExcludeArt from './Components/ExcludeArt'\nimport MainStatSelectionCard from './Components/MainStatSelectionCard'\nimport OptimizationTargetSelector from './Components/OptimizationTargetSelector'\nimport StatFilterCard from './Components/StatFilterCard'\nimport { compactArtifacts, dynamicData } from './foreground'\nimport useBuildResult from './useBuildResult'\nimport useBuildSetting from './useBuildSetting'\n\nconst audio = new Audio('notification.mp3')\nexport default function TabBuild() {\n  const { t } = useTranslation('page_character_optimize')\n  const {\n    character: { key: characterKey, compareData },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const { setChartData, graphBuilds, setGraphBuilds } = useContext(GraphContext)\n  const { gender } = useDBMeta()\n\n  const [notification, setnotification] = useState(false)\n  const notificationRef = useRef(false)\n  useEffect(() => {\n    notificationRef.current = notification\n  }, [notification])\n\n  const [buildStatus, setBuildStatus] = useState({\n    type: 'inactive',\n    tested: 0,\n    failed: 0,\n    skipped: 0,\n    total: 0,\n  } as BuildStatus)\n  const generatingBuilds = buildStatus.type !== 'inactive'\n\n  const [artsDirty, setArtsDirty] = useForceUpdate()\n\n  const [{ threads = defThreads }, setDisplayOptimize] = useState(\n    database.displayOptimize.get()\n  )\n  useEffect(\n    () => database.displayOptimize.follow((_r, to) => setDisplayOptimize(to)),\n    [database, setDisplayOptimize]\n  )\n\n  const maxWorkers = threads > defThreads ? defThreads : threads\n  const setMaxWorkers = useCallback(\n    (threads: number) => database.displayOptimize.set({ threads }),\n    [database]\n  )\n\n  const characterDispatch = useCharacterReducer(characterKey)\n  const onClickTeammate = useCharSelectionCallback()\n\n  // Clear state when changing characters\n  useEffect(() => {\n    setBuildStatus({\n      type: 'inactive',\n      tested: 0,\n      failed: 0,\n      skipped: 0,\n      total: 0,\n    })\n  }, [characterKey])\n\n  const noArtifact = useMemo(() => !database.arts.values.length, [database])\n\n  const { buildSetting, buildSettingDispatch } = useBuildSetting(characterKey)\n  const {\n    plotBase,\n    optimizationTarget,\n    mainStatAssumptionLevel,\n    allowPartial,\n    maxBuildsToShow,\n    levelLow,\n    levelHigh,\n  } = buildSetting\n  const {\n    buildResult: { builds, buildDate },\n    buildResultDispatch,\n  } = useBuildResult(characterKey)\n  const teamData = useTeamData(characterKey, mainStatAssumptionLevel)\n  const { characterSheet, target: data } =\n    teamData?.[characterKey as CharacterKey] ?? {}\n  const optimizationTargetNode =\n    optimizationTarget && objPathValue(data?.getDisplay(), optimizationTarget)\n  const isSM = ['xs', 'sm'].includes(useMediaQueryUp())\n\n  //register changes in artifact database\n  useEffect(\n    () => database.arts.followAny(setArtsDirty),\n    [setArtsDirty, database]\n  )\n\n  const deferredArtsDirty = useDeferredValue(artsDirty)\n  const deferredBuildSetting = useDeferredValue(buildSetting)\n  const filteredArts = useMemo(() => {\n    const {\n      mainStatKeys,\n      excludedLocations,\n      artExclusion,\n      levelLow,\n      levelHigh,\n      allowLocationsState,\n      useExcludedArts,\n    } = deferredArtsDirty && deferredBuildSetting\n\n    return database.arts.values.filter((art) => {\n      if (!useExcludedArts && artExclusion.includes(art.id)) return false\n      if (art.level < levelLow) return false\n      if (art.level > levelHigh) return false\n      const mainStats = mainStatKeys[art.slotKey]\n      if (mainStats?.length && !mainStats.includes(art.mainStatKey))\n        return false\n\n      const locKey = charKeyToLocCharKey(characterKey)\n      const unequippedStateAndEquippedElsewhere =\n        allowLocationsState === 'unequippedOnly' &&\n        art.location &&\n        art.location !== locKey\n      const customListStateAndNotOnList =\n        allowLocationsState === 'customList' &&\n        art.location &&\n        art.location !== locKey &&\n        excludedLocations.includes(art.location)\n      if (unequippedStateAndEquippedElsewhere || customListStateAndNotOnList)\n        return false\n\n      return true\n    })\n  }, [database, characterKey, deferredArtsDirty, deferredBuildSetting])\n\n  const filteredArtIdMap = useMemo(\n    () =>\n      objectKeyMap(\n        filteredArts.map(({ id }) => id),\n        (_) => true\n      ),\n    [filteredArts]\n  )\n  const { levelTotal, allowListTotal, excludedTotal } = useMemo(() => {\n    const catKeys = {\n      levelTotal: ['in'],\n      allowListTotal: ['in'],\n      excludedTotal: ['in'],\n    } as const\n    return bulkCatTotal(catKeys, (ctMap) =>\n      Object.entries(database.arts.data).forEach(([id, art]) => {\n        const { level, location } = art\n        const {\n          levelLow,\n          levelHigh,\n          excludedLocations,\n          allowLocationsState,\n          artExclusion,\n        } = deferredArtsDirty && deferredBuildSetting\n        if (level >= levelLow && level <= levelHigh) {\n          ctMap.levelTotal.in.total++\n          if (filteredArtIdMap[id]) ctMap.levelTotal.in.current++\n        }\n        const locKey = charKeyToLocCharKey(characterKey)\n        const allStateAndEquippedSomewhereElse =\n          allowLocationsState === 'all' && location && location !== locKey\n        const customListStateAndNotOnList =\n          allowLocationsState === 'customList' &&\n          location &&\n          location !== locKey &&\n          !excludedLocations.includes(location)\n        if (allStateAndEquippedSomewhereElse || customListStateAndNotOnList) {\n          ctMap.allowListTotal.in.total++\n          if (filteredArtIdMap[id]) ctMap.allowListTotal.in.current++\n        }\n        if (artExclusion.includes(id)) {\n          ctMap.excludedTotal.in.total++\n          if (filteredArtIdMap[id]) ctMap.excludedTotal.in.current++\n        }\n      })\n    )\n  }, [\n    characterKey,\n    database.arts.data,\n    deferredArtsDirty,\n    deferredBuildSetting,\n    filteredArtIdMap,\n  ])\n\n  const tabFocused = useRef(true)\n  useEffect(() => {\n    const onFocus = () => (tabFocused.current = true)\n    const onBlur = () => (tabFocused.current = false)\n    window.addEventListener('focus', onFocus)\n    window.addEventListener('blur', onBlur)\n    return () => {\n      window.removeEventListener('focus', onFocus)\n      window.removeEventListener('blur', onBlur)\n    }\n  }, [tabFocused])\n\n  // Provides a function to cancel the work\n  const cancelToken = useRef(() => {})\n  //terminate worker when component unmounts\n  useEffect(() => () => cancelToken.current(), [])\n  const throwGlobalError = useGlobalError()\n\n  const generateBuilds = useCallback(async () => {\n    const {\n      artSetExclusion,\n      plotBase,\n      statFilters,\n      optimizationTarget,\n      mainStatAssumptionLevel,\n      allowPartial,\n      maxBuildsToShow,\n    } = buildSetting\n    if (!characterKey || !optimizationTarget) return\n\n    const split = compactArtifacts(\n      filteredArts,\n      mainStatAssumptionLevel,\n      allowPartial\n    )\n\n    const teamData = getTeamData(\n      database,\n      characterKey,\n      mainStatAssumptionLevel,\n      []\n    )\n    if (!teamData) return\n    const workerData = uiDataForTeam(teamData.teamData, gender, characterKey)[\n      characterKey\n    ]?.target.data![0]\n    if (!workerData) return\n    Object.assign(workerData, mergeData([workerData, dynamicData])) // Mark art fields as dynamic\n    const unoptimizedOptimizationTargetNode = objPathValue(\n      workerData.display ?? {},\n      optimizationTarget\n    ) as NumNode | undefined\n    if (!unoptimizedOptimizationTargetNode) return\n    const targetNode = unoptimizedOptimizationTargetNode\n    const valueFilter: { value: NumNode; minimum: number }[] = Object.entries(\n      statFilters\n    )\n      .flatMap(([pathStr, settings]) =>\n        settings\n          .filter((setting) => !setting.disabled)\n          .map((setting) => {\n            const filterNode: NumNode = objPathValue(\n              workerData.display ?? {},\n              JSON.parse(pathStr)\n            )\n            const minimum =\n              filterNode.info?.unit === '%'\n                ? setting.value / 100\n                : setting.value // TODO: Conversion\n            return { value: filterNode, minimum: minimum }\n          })\n      )\n      .filter((x) => x.value && x.minimum > -Infinity)\n\n    setChartData(undefined)\n\n    const cancelled = new Promise<void>((r) => (cancelToken.current = r))\n\n    const unoptimizedNodes = [\n      ...valueFilter.map((x) => x.value),\n      unoptimizedOptimizationTargetNode,\n    ]\n    const minimum = [...valueFilter.map((x) => x.minimum), -Infinity]\n    const plotBaseNumNode: NumNode =\n      plotBase && objPathValue(workerData.display ?? {}, plotBase)\n    if (plotBaseNumNode) {\n      unoptimizedNodes.push(plotBaseNumNode)\n      minimum.push(-Infinity)\n    }\n\n    const nodes = optimize(\n      unoptimizedNodes,\n      workerData,\n      ({ path: [p] }) => p !== 'dyn'\n    )\n    const plotBaseNode = plotBaseNumNode ? nodes.pop() : undefined\n    const optimizationTargetNode = nodes.pop()!\n\n    const problem: OptProblemInput = {\n      arts: split,\n      optimizationTarget: optimizationTargetNode,\n      exclusion: artSetExclusion,\n      constraints: nodes.map((value, i) => ({ value, min: minimum[i] })),\n\n      topN: maxBuildsToShow,\n      plotBase: plotBaseNode,\n    }\n    const status: Omit<BuildStatus, 'type'> = {\n      tested: 0,\n      failed: 0,\n      skipped: 0,\n      total: 0,\n      startTime: performance.now(),\n    }\n    const statusUpdateTimer = setInterval(\n      () => setBuildStatus({ type: 'active', ...status }),\n      100\n    )\n\n    const cancellationError = new Error()\n    try {\n      const solver = new GOSolver(problem, status, maxWorkers)\n      cancelled.then(() => solver.cancel(cancellationError))\n\n      const results = await solver.solve()\n      solver.cancel() // Done using `solver`\n\n      cancelToken.current = () => {}\n\n      if (plotBaseNumNode) {\n        const plotData = mergePlot(results.map((x) => x.plotData!))\n        let data = Object.values(plotData)\n        if (targetNode.info?.unit === '%')\n          data = data.map(({ value, plot, artifactIds }) => ({\n            value: value * 100,\n            plot,\n            artifactIds,\n          })) as Build[]\n        if (plotBaseNumNode.info?.unit === '%')\n          data = data.map(({ value, plot, artifactIds }) => ({\n            value,\n            plot: (plot ?? 0) * 100,\n            artifactIds,\n          })) as Build[]\n        setChartData({\n          valueNode: targetNode,\n          plotNode: plotBaseNumNode,\n          data,\n        })\n      }\n      const builds = mergeBuilds(\n        results.map((x) => x.builds),\n        maxBuildsToShow\n      )\n      if (process.env.NODE_ENV === 'development')\n        console.log('Build Result', builds)\n\n      buildResultDispatch({\n        builds: builds.map((build) => build.artifactIds),\n        buildDate: Date.now(),\n      })\n\n      setTimeout(() => {\n        // Using a ref because a user can cancel the notification while the build is going.\n        if (results && notificationRef.current) {\n          audio.play()\n          if (!tabFocused.current)\n            setTimeout(() => window.alert(t`buildCompleted`), 1)\n        }\n      }, 100)\n    } catch (e) {\n      // Worker error, cancelled, printer catches on fire, etc.\n      if (e !== cancellationError) {\n        console.log('Failed to load worker')\n        console.log(e)\n        if (e instanceof Error) throwGlobalError(e)\n      }\n\n      cancelToken.current()\n      status.tested = 0\n      status.failed = 0\n      status.skipped = 0\n      status.total = 0\n    } finally {\n      clearInterval(statusUpdateTimer)\n      setBuildStatus({\n        type: 'inactive',\n        ...status,\n        finishTime: performance.now(),\n      })\n    }\n  }, [\n    buildSetting,\n    characterKey,\n    filteredArts,\n    database,\n    gender,\n    setChartData,\n    maxWorkers,\n    buildResultDispatch,\n    t,\n    throwGlobalError,\n  ])\n\n  const characterName = characterSheet?.name ?? 'Character Name'\n\n  const setPlotBase = useCallback(\n    (plotBase: string[] | undefined) => {\n      buildSettingDispatch({ plotBase })\n      setChartData(undefined)\n    },\n    [buildSettingDispatch, setChartData]\n  )\n  const dataContext: dataContextObj | undefined = useMemo(() => {\n    return data && teamData && { data, teamData }\n  }, [data, teamData])\n\n  const targetSelector = (\n    <OptimizationTargetSelector\n      optimizationTarget={optimizationTarget}\n      setTarget={(target) =>\n        buildSettingDispatch({ optimizationTarget: target })\n      }\n      disabled={!!generatingBuilds}\n    />\n  )\n\n  const getGraphBuildLabel = useCallback(\n    (index: number) => (\n      <Trans t={t} i18nKey=\"graphBuildLabel\" count={index + 1}>\n        Graph #{{ count: index + 1 }}\n      </Trans>\n    ),\n    [t]\n  )\n  const getNormBuildLabel = useCallback((index: number) => `#${index + 1}`, [])\n  return (\n    <Box display=\"flex\" flexDirection=\"column\" gap={1}>\n      {noArtifact && (\n        <Alert severity=\"warning\" variant=\"filled\">\n          <Trans t={t} i18nKey=\"noArtis\">\n            Oops! It looks like you haven't added any artifacts to GO yet! You\n            should go to the{' '}\n            <Link component={RouterLink} to=\"/artifacts\">\n              Artifacts\n            </Link>{' '}\n            page and add some!\n          </Trans>\n        </Alert>\n      )}\n      {/* Build Generator Editor */}\n      {dataContext && (\n        <DataContext.Provider value={dataContext}>\n          <Grid container spacing={1}>\n            {/* 1*/}\n            <Grid\n              item\n              xs={12}\n              sm={6}\n              lg={3}\n              display=\"flex\"\n              flexDirection=\"column\"\n              gap={1}\n            >\n              {/* character card */}\n              <Box>\n                <CharacterCard\n                  characterKey={characterKey}\n                  onClickTeammate={onClickTeammate}\n                />\n              </Box>\n              <BonusStatsCard />\n            </Grid>\n\n            {/* 2 */}\n            <Grid\n              item\n              xs={12}\n              sm={6}\n              lg={4}\n              display=\"flex\"\n              flexDirection=\"column\"\n              gap={1}\n            >\n              {/* Level Filter */}\n              <CardLight>\n                <CardContent sx={{ display: 'flex', gap: 1 }}>\n                  <Typography\n                    sx={{ fontWeight: 'bold' }}\n                  >{t`levelFilter`}</Typography>\n                  <SqBadge color=\"info\">{levelTotal.in}</SqBadge>\n                </CardContent>\n                <Divider />\n                <CardContent>\n                  <ArtifactLevelSlider\n                    levelLow={levelLow}\n                    levelHigh={levelHigh}\n                    setLow={(levelLow) => buildSettingDispatch({ levelLow })}\n                    setHigh={(levelHigh) => buildSettingDispatch({ levelHigh })}\n                    setBoth={(levelLow, levelHigh) =>\n                      buildSettingDispatch({ levelLow, levelHigh })\n                    }\n                    disabled={generatingBuilds}\n                  />\n                </CardContent>\n              </CardLight>\n\n              {/* Main Stat Filters */}\n              <CardLight>\n                <CardContent>\n                  <Typography\n                    sx={{ fontWeight: 'bold' }}\n                  >{t`mainStat.title`}</Typography>\n                </CardContent>\n                <Divider />\n                <CardContent>\n                  <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                    <AssumeFullLevelToggle\n                      mainStatAssumptionLevel={mainStatAssumptionLevel}\n                      setmainStatAssumptionLevel={(\n                        mainStatAssumptionLevel: number\n                      ) => buildSettingDispatch({ mainStatAssumptionLevel })}\n                      disabled={generatingBuilds}\n                    />\n                    <InfoTooltip\n                      title={\n                        <Box>\n                          <Typography variant=\"h6\">{t`mainStat.levelAssTooltip.title`}</Typography>\n                          <Typography>{t`mainStat.levelAssTooltip.desc`}</Typography>\n                        </Box>\n                      }\n                    />\n                  </Box>\n                </CardContent>\n                {/* main stat selector */}\n                <MainStatSelectionCard\n                  disabled={generatingBuilds}\n                  filteredArtIdMap={filteredArtIdMap}\n                />\n              </CardLight>\n            </Grid>\n\n            {/* 3 */}\n            <Grid\n              item\n              xs={12}\n              sm={6}\n              lg={5}\n              display=\"flex\"\n              flexDirection=\"column\"\n              gap={1}\n            >\n              <ArtifactSetConfig disabled={generatingBuilds} />\n\n              {/* use excluded */}\n              <ExcludeArt\n                disabled={generatingBuilds}\n                excludedTotal={excludedTotal.in}\n              />\n\n              <Button\n                fullWidth\n                startIcon={\n                  allowPartial ? <CheckBox /> : <CheckBoxOutlineBlank />\n                }\n                color={allowPartial ? 'success' : 'secondary'}\n                onClick={() =>\n                  buildSettingDispatch({ allowPartial: !allowPartial })\n                }\n                disabled={generatingBuilds}\n              >\n                {t`allowPartial`}\n              </Button>\n\n              {/* use equipped */}\n              <AllowChar\n                disabled={generatingBuilds}\n                allowListTotal={allowListTotal.in}\n              />\n\n              {/*Minimum Final Stat Filter */}\n              <StatFilterCard disabled={generatingBuilds} />\n            </Grid>\n          </Grid>\n          {/* Footer */}\n          {isSM && targetSelector}\n          <ButtonGroup>\n            {!isSM && targetSelector}\n            <DropdownButton\n              disabled={generatingBuilds || !characterKey}\n              title={\n                <Trans t={t} i18nKey=\"build\" count={maxBuildsToShow}>\n                  {{ count: maxBuildsToShow }} Builds\n                </Trans>\n              }\n            >\n              <MenuItem>\n                <Typography variant=\"caption\" color=\"info.main\">\n                  {t('buildDropdownDesc')}\n                </Typography>\n              </MenuItem>\n              <Divider />\n              {maxBuildsToShowList.map((v) => (\n                <MenuItem\n                  key={v}\n                  onClick={() => buildSettingDispatch({ maxBuildsToShow: v })}\n                >\n                  <Trans t={t} i18nKey=\"build\" count={v}>\n                    {{ count: v }} Builds\n                  </Trans>\n                </MenuItem>\n              ))}\n            </DropdownButton>\n            <DropdownButton\n              disabled={generatingBuilds || !characterKey}\n              sx={{ borderRadius: '4px 0px 0px 4px' }}\n              title={\n                <Trans t={t} i18nKey=\"thread\" count={maxWorkers}>\n                  {{ count: maxWorkers }} Threads\n                </Trans>\n              }\n            >\n              <MenuItem>\n                <Typography variant=\"caption\" color=\"info.main\">\n                  {t('threadDropdownDesc')}\n                </Typography>\n              </MenuItem>\n              <Divider />\n              {range(1, defThreads)\n                .reverse()\n                .map((v) => (\n                  <MenuItem key={v} onClick={() => setMaxWorkers(v)}>\n                    <Trans t={t} i18nKey=\"thread\" count={v}>\n                      {{ count: v }} Threads\n                    </Trans>\n                  </MenuItem>\n                ))}\n            </DropdownButton>\n            <BootstrapTooltip placement=\"top\" title={t`notifyTooltip`}>\n              <Button\n                sx={{ borderRadius: 0 }}\n                color=\"warning\"\n                onClick={() => setnotification((n) => !n)}\n              >\n                {notification ? (\n                  <NotificationsActiveIcon />\n                ) : (\n                  <NotificationsOffIcon />\n                )}\n              </Button>\n            </BootstrapTooltip>\n            <BootstrapTooltip\n              placement=\"top\"\n              title={!optimizationTarget ? t('selectTargetFirst') : ''}\n            >\n              <span>\n                <Button\n                  disabled={\n                    !characterKey ||\n                    !optimizationTarget ||\n                    !optimizationTargetNode ||\n                    optimizationTargetNode.isEmpty\n                  }\n                  color={generatingBuilds ? 'error' : 'success'}\n                  onClick={\n                    generatingBuilds\n                      ? () => cancelToken.current()\n                      : generateBuilds\n                  }\n                  startIcon={generatingBuilds ? <Close /> : <TrendingUp />}\n                  sx={{ borderRadius: '0px 4px 4px 0px' }}\n                >\n                  {generatingBuilds\n                    ? t('generateButton.cancel')\n                    : t('generateButton.generateBuilds')}\n                </Button>\n              </span>\n            </BootstrapTooltip>\n          </ButtonGroup>\n          {!!characterKey && (\n            <BuildAlert\n              {...{ status: buildStatus, characterName, maxBuildsToShow }}\n            />\n          )}\n          <Box>\n            <ChartCard\n              disabled={generatingBuilds || !optimizationTarget}\n              plotBase={plotBase}\n              setPlotBase={setPlotBase}\n              showTooltip={!optimizationTarget}\n            />\n          </Box>\n          <CardLight>\n            <CardContent>\n              <Box display=\"flex\" alignItems=\"center\" gap={1} mb={1}>\n                <Typography sx={{ flexGrow: 1 }}>\n                  {builds ? (\n                    <span>\n                      Showing{' '}\n                      <strong>\n                        {builds.length + (graphBuilds ? graphBuilds.length : 0)}\n                      </strong>{' '}\n                      build generated for {characterName}.{' '}\n                      {!!buildDate && (\n                        <span>\n                          Build generated on:{' '}\n                          <strong>\n                            {new Date(buildDate).toLocaleString()}\n                          </strong>\n                        </span>\n                      )}\n                    </span>\n                  ) : (\n                    <span>Select a character to generate builds.</span>\n                  )}\n                </Typography>\n                <Button\n                  disabled={!builds.length}\n                  color=\"error\"\n                  onClick={() => {\n                    setGraphBuilds(undefined)\n                    buildResultDispatch({ builds: [], buildDate: 0 })\n                  }}\n                >\n                  Clear Builds\n                </Button>\n              </Box>\n              <Grid container display=\"flex\" spacing={1}>\n                <Grid item>\n                  <HitModeToggle size=\"small\" />\n                </Grid>\n                <Grid item>\n                  <ReactionToggle size=\"small\" />\n                </Grid>\n                <Grid item flexGrow={1} />\n                <Grid item>\n                  <SolidToggleButtonGroup\n                    exclusive\n                    value={compareData}\n                    onChange={(_e, v) => characterDispatch({ compareData: v })}\n                    size=\"small\"\n                  >\n                    <ToggleButton value={false} disabled={!compareData}>\n                      Show new builds\n                    </ToggleButton>\n                    <ToggleButton value={true} disabled={compareData}>\n                      Compare vs. equipped\n                    </ToggleButton>\n                  </SolidToggleButtonGroup>\n                </Grid>\n              </Grid>\n            </CardContent>\n          </CardLight>\n\n          <OptimizationTargetContext.Provider value={optimizationTarget}>\n            {graphBuilds && (\n              <BuildList\n                builds={graphBuilds}\n                characterKey={characterKey}\n                data={data}\n                compareData={compareData}\n                disabled={!!generatingBuilds}\n                getLabel={getGraphBuildLabel}\n                setBuilds={setGraphBuilds}\n              />\n            )}\n            <BuildList\n              builds={builds}\n              characterKey={characterKey}\n              data={data}\n              compareData={compareData}\n              disabled={!!generatingBuilds}\n              getLabel={getNormBuildLabel}\n            />\n          </OptimizationTargetContext.Provider>\n        </DataContext.Provider>\n      )}\n    </Box>\n  )\n}\n\nfunction BuildList({\n  builds,\n  setBuilds,\n  characterKey,\n  data,\n  compareData,\n  disabled,\n  getLabel,\n}: {\n  builds: string[][]\n  setBuilds?: (builds: string[][] | undefined) => void\n  characterKey?: '' | CharacterKey\n  data?: UIData\n  compareData: boolean\n  disabled: boolean\n  getLabel: (index: number) => Displayable\n}) {\n  const deleteBuild = useCallback(\n    (index: number) => {\n      if (setBuilds) {\n        const builds_ = [...builds]\n        builds_.splice(index, 1)\n        setBuilds(builds_)\n      }\n    },\n    [builds, setBuilds]\n  )\n  // Memoize the build list because calculating/rendering the build list is actually very expensive, which will cause longer optimization times.\n  const list = useMemo(\n    () => (\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={600} />}\n      >\n        {builds?.map(\n          (build, index) =>\n            characterKey &&\n            data && (\n              <DataContextWrapper\n                key={index + build.join()}\n                characterKey={characterKey}\n                build={build}\n                oldData={data}\n              >\n                <BuildItemWrapper\n                  index={index}\n                  label={getLabel(index)}\n                  build={build}\n                  compareData={compareData}\n                  disabled={disabled}\n                  deleteBuild={setBuilds ? deleteBuild : undefined}\n                />\n              </DataContextWrapper>\n            )\n        )}\n      </Suspense>\n    ),\n    [\n      builds,\n      characterKey,\n      data,\n      compareData,\n      disabled,\n      getLabel,\n      deleteBuild,\n      setBuilds,\n    ]\n  )\n  return list\n}\nfunction BuildItemWrapper({\n  index,\n  label,\n  build,\n  compareData,\n  disabled,\n  deleteBuild,\n}: {\n  index: number\n  label: Displayable\n  build: string[]\n  compareData: boolean\n  disabled: boolean\n  deleteBuild?: (index: number) => void\n}) {\n  const { t } = useTranslation('page_character_optimize')\n  const location = useLocation()\n  const navigate = useNavigate()\n  const toTC = useCallback(() => {\n    const paths = location.pathname.split('/')\n    paths.pop()\n    navigate(`${paths.join('/')}/theorycraft`, { state: { build } })\n  }, [navigate, build, location.pathname])\n\n  return (\n    <BuildDisplayItem\n      label={label}\n      compareBuild={compareData}\n      disabled={disabled}\n      extraButtonsLeft={\n        <>\n          <Button\n            color=\"info\"\n            size=\"small\"\n            startIcon={<Science />}\n            onClick={toTC}\n          >\n            {t('theorycraftButton')}\n          </Button>\n          {deleteBuild && (\n            <Button\n              color=\"error\"\n              size=\"small\"\n              startIcon={<DeleteForever />}\n              onClick={() => deleteBuild(index)}\n            >\n              {t('removeBuildButton')}\n            </Button>\n          )}\n        </>\n      }\n    />\n  )\n}\n\ntype Prop = {\n  children: React.ReactNode\n  characterKey: CharacterKey\n  build: string[]\n  oldData: UIData\n}\nfunction DataContextWrapper({ children, characterKey, build, oldData }: Prop) {\n  const { database } = useContext(DatabaseContext)\n  const {\n    buildSetting: { mainStatAssumptionLevel },\n  } = useBuildSetting(characterKey)\n  // Update the build when the build artifacts are changed.\n  const [dirty, setDirty] = useForceUpdate()\n  useEffect(\n    () => database.arts.followAny((id) => build.includes(id) && setDirty()),\n    [database, build, setDirty]\n  )\n  const buildsArts = useMemo(\n    () =>\n      dirty &&\n      (build\n        .map((i) => database.arts.get(i))\n        .filter((a) => a) as ICachedArtifact[]),\n    [dirty, build, database]\n  )\n  const teamData = useTeamData(\n    characterKey,\n    mainStatAssumptionLevel,\n    buildsArts\n  )\n  const providerValue = useMemo(() => {\n    const tdc = teamData?.[characterKey]\n    if (!tdc) return\n    return { data: tdc.target, teamData, oldData }\n  }, [teamData, oldData, characterKey])\n  if (!providerValue) return null\n  return (\n    <DataContext.Provider value={providerValue}>\n      {children}\n    </DataContext.Provider>\n  )\n}\n","import { useCallback, useState } from 'react'\n\n/* Hook to get a callback function for throwing\nsynchronous error from asynchronous code\nWhen this callback is used somewhere within an error boundary,\nit will trigger it, even if you are in an async block\n\n```\nconst throwError = useGlobalError()\nasync function foo() { throwError(new Error()) }\n```\n*/\nexport default function useGlobalError(): (e: Error) => void {\n  const [, setError] = useState()\n  return useCallback((e: Error) => {\n    setError(() => {\n      throw e\n    })\n  }, [])\n}\n","import type { CharacterKey, GenderKey } from '@genshin-optimizer/consts'\nimport Albedo from './Character_Albedo_Card.png'\nimport Alhaitham from './Character_Alhaitham_Card.jpg'\nimport Aloy from './Character_Aloy_Card.png'\nimport Amber from './Character_Amber_Card.jpg'\nimport AratakiItto from './Character_Arataki_Itto_Card.jpg'\nimport Barbara from './Character_Barbara_Card.jpg'\nimport Beidou from './Character_Beidou_Card.jpg'\nimport Bennett from './Character_Bennett_Card.jpg'\nimport Candace from './Character_Candace_Card.jpg'\nimport Chongyun from './Character_Chongyun_Card.jpg'\nimport Collei from './Character_Collei_Card.jpg'\nimport Cyno from './Character_Cyno_Card.jpg'\nimport Dehya from './Character_Dehya_Card.jpg'\nimport Diluc from './Character_Diluc_Card.jpg'\nimport Diona from './Character_Diona_Card.png'\nimport Dori from './Character_Dori_Card.jpg'\nimport Eula from './Character_Eula_Card.png'\nimport Faruzan from './Character_Faruzan_Card.jpg'\nimport Fischl from './Character_Fischl_Card.jpg'\nimport Ganyu from './Character_Ganyu_Card.png'\nimport Gorou from './Character_Gorou_Card.jpg'\nimport HuTao from './Character_Hu_Tao_Card.jpg'\nimport Jean from './Character_Jean_Card.jpg'\nimport Kaeya from './Character_Kaeya_Card.jpg'\nimport KamisatoAyaka from './Character_Kamisato_Ayaka_Card.png'\nimport KamisatoAyato from './Character_Kamisato_Ayato_Card.png'\nimport KaedeharaKazuha from './Character_Kazuha_Card.png'\nimport Keqing from './Character_Keqing_Card.jpg'\nimport Klee from './Character_Klee_Card.jpg'\nimport KujouSara from './Character_Kujou_Sara_Card.jpg'\nimport KukiShinobu from './Character_Kuki_Shinobu_Card.jpg'\nimport Layla from './Character_Layla_Card.jpeg'\nimport Lisa from './Character_Lisa_Card.jpg'\nimport Mika from './Character_Mika_Card.jpg'\nimport Mona from './Character_Mona_Card.jpg'\nimport Nahida from './Character_Nahida_Card.jpeg'\nimport Nilou from './Character_Nilou_Card.jpg'\nimport Ningguang from './Character_Ningguang_Card.jpg'\nimport Noelle from './Character_Noelle_Card.jpg'\nimport Qiqi from './Character_Qiqi_Card.jpg'\nimport RaidenShogun from './Character_Raiden_Shogun_Card.png'\nimport Razor from './Character_Razor_Card.jpg'\nimport Rosaria from './Character_Rosaria_Card.png'\nimport SangonomiyaKokomi from './Character_Sangonomiya_Kokomi_Card.jpg'\nimport Sayu from './Character_Sayu_Card.png'\nimport Shenhe from './Character_Shenhe_Card.jpg'\nimport ShikanoinHeizou from './Character_Shikanoin_Heizou_Card.png'\nimport Sucrose from './Character_Sucrose_Card.jpg'\nimport Tartaglia from './Character_Tartaglia_Card.png'\nimport Thoma from './Character_Thoma_Card.jpg'\nimport Tighnari from './Character_Tighnari_Card.jpg'\nimport Venti from './Character_Venti_Card.jpg'\nimport Wanderer from './Character_Wanderer_Card.jpg'\nimport Xiangling from './Character_Xiangling_Card.jpg'\nimport Xiao from './Character_Xiao_Card.jpg'\nimport Xingqiu from './Character_Xingqiu_Card.jpg'\nimport Xinyan from './Character_Xinyan_Card.jpg'\nimport YaeMiko from './Character_Yae_Miko_Card.png'\nimport Yanfei from './Character_Yanfei_Card.png'\nimport Yaoyao from './Character_Yaoyao_Card.jpg'\nimport Yelan from './Character_Yelan_Card.jpg'\nimport Yoimiya from './Character_Yoimiya_Card.png'\nimport YunJin from './Character_Yun_Jin_Card.jpg'\nimport Zhongli from './Character_Zhongli_Card.png'\nimport TravelerF from './Traveler_Female_Card.jpg'\nimport TravelerM from './Traveler_Male_Card.jpg'\n\nconst charCards = {\n  Albedo,\n  Alhaitham,\n  Aloy,\n  Amber,\n  AratakiItto,\n  Barbara,\n  Beidou,\n  Bennett,\n  Candace,\n  Chongyun,\n  Collei,\n  Cyno,\n  Dehya,\n  Diluc,\n  Diona,\n  Dori,\n  Eula,\n  Faruzan,\n  Fischl,\n  Ganyu,\n  Gorou,\n  HuTao,\n  Jean,\n  KaedeharaKazuha,\n  Kaeya,\n  KamisatoAyaka,\n  KamisatoAyato,\n  Keqing,\n  Klee,\n  KujouSara,\n  KukiShinobu,\n  Layla,\n  Lisa,\n  Mika,\n  Mona,\n  Nahida,\n  Nilou,\n  Ningguang,\n  Noelle,\n  Qiqi,\n  RaidenShogun,\n  Razor,\n  Rosaria,\n  SangonomiyaKokomi,\n  Sayu,\n  Shenhe,\n  ShikanoinHeizou,\n  Sucrose,\n  Tartaglia,\n  Thoma,\n  Tighnari,\n  TravelerF,\n  TravelerM,\n  Venti,\n  Wanderer,\n  Xiangling,\n  Xiao,\n  Xingqiu,\n  Xinyan,\n  YaeMiko,\n  Yanfei,\n  Yaoyao,\n  Yelan,\n  Yoimiya,\n  YunJin,\n  Zhongli,\n} as const\n\nexport function charCard(charKey: CharacterKey, gender: GenderKey): string {\n  switch (charKey) {\n    case 'TravelerAnemo':\n    case 'TravelerDendro':\n    case 'TravelerElectro':\n    case 'TravelerGeo':\n      return charCards[`Traveler${gender}`] ?? ''\n    default:\n      return charCards[charKey] ?? ''\n  }\n}\n","import { Close, Difference } from '@mui/icons-material'\nimport { Button, Skeleton, Tooltip, Typography } from '@mui/material'\nimport { Suspense, useContext, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport {\n  HitModeToggle,\n  ReactionToggle,\n} from '../../../../Components/HitModeEditor'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { DataContext } from '../../../../Context/DataContext'\nimport useBoolState from '../../../../ReactHooks/useBoolState'\nimport useTeamData from '../../../../ReactHooks/useTeamData'\nimport { objectMap } from '../../../../Util/Util'\nimport useBuildSetting from '../TabOptimize/useBuildSetting'\nimport BuildDisplayItem from '../TabOptimize/Components/BuildDisplayItem'\n\nexport default function CompareBuildButton({\n  artId,\n  weaponId,\n}: {\n  artId?: string\n  weaponId?: string\n}) {\n  const { t } = useTranslation('page_character')\n  const [show, onShow, onHide] = useBoolState(false)\n\n  return (\n    <>\n      <ModalWrapper\n        open={show}\n        onClose={onHide}\n        containerProps={{ maxWidth: 'xl' }}\n      >\n        <CompareContent artId={artId} weaponId={weaponId} onHide={onHide} />\n      </ModalWrapper>\n      <Tooltip\n        title={<Typography>{t`tabEquip.compare`}</Typography>}\n        placement=\"top\"\n        arrow\n      >\n        <Button color=\"info\" size=\"small\" onClick={onShow}>\n          <Difference />\n        </Button>\n      </Tooltip>\n    </>\n  )\n}\nfunction CompareContent({\n  artId,\n  weaponId,\n  onHide,\n}: {\n  artId?: string\n  weaponId?: string\n  onHide: () => void\n}) {\n  const { database } = useContext(DatabaseContext)\n  const {\n    character: { key: characterKey, equippedArtifacts },\n  } = useContext(CharacterContext)\n  const {\n    buildSetting: { mainStatAssumptionLevel },\n  } = useBuildSetting(characterKey)\n  const { data: oldData } = useContext(DataContext)\n  const build = useMemo(() => {\n    const newArt = database.arts.get(artId ?? '')\n    const artmap = objectMap(equippedArtifacts, (id, slot) =>\n      slot === newArt?.slotKey ? newArt : database.arts.get(id)\n    )\n    return Object.values(artmap).filter((a) => a)\n  }, [database, equippedArtifacts, artId])\n  const teamData = useTeamData(\n    characterKey,\n    mainStatAssumptionLevel,\n    build,\n    weaponId ? database.weapons.get(weaponId) : undefined\n  )\n  const dataProviderValue = useMemo(\n    () =>\n      teamData && { data: teamData[characterKey]!.target, teamData, oldData },\n    [characterKey, teamData, oldData]\n  )\n  return (\n    <Suspense\n      fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={600} />}\n    >\n      {dataProviderValue && (\n        <DataContext.Provider value={dataProviderValue}>\n          <BuildDisplayItem\n            compareBuild={true}\n            extraButtonsLeft={\n              <>\n                <HitModeToggle size=\"small\" />\n                <ReactionToggle size=\"small\" />\n              </>\n            }\n            extraButtonsRight={\n              <Button size=\"small\" color=\"error\" onClick={onHide}>\n                <Close />\n              </Button>\n            }\n          />\n        </DataContext.Provider>\n      )}\n    </Suspense>\n  )\n}\n","import type { ArtifactSlotKey } from '@genshin-optimizer/consts'\nimport {\n  Box,\n  CardContent,\n  Divider,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport {\n  lazy,\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport Assets from '../../../../Assets/Assets'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CloseButton from '../../../../Components/CloseButton'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport ArtifactCard from '../../../../PageArtifact/ArtifactCard'\nimport type { FilterOption } from '../../../../PageArtifact/ArtifactSort'\nimport {\n  artifactFilterConfigs,\n  initialFilterOption,\n} from '../../../../PageArtifact/ArtifactSort'\nimport useForceUpdate from '../../../../ReactHooks/useForceUpdate'\nimport useMediaQueryUp from '../../../../ReactHooks/useMediaQueryUp'\nimport { filterFunction } from '../../../../Util/SortByFilters'\nimport CompareBuildButton from './CompareBuildButton'\n\nconst numToShowMap = { xs: 2 * 3, sm: 2 * 3, md: 3 * 3, lg: 4 * 3, xl: 4 * 3 }\nconst ArtifactFilterDisplay = lazy(\n  () => import('../../../../Components/Artifact/ArtifactFilterDisplay')\n)\n\nexport default function ArtifactSwapModal({\n  onChangeId,\n  slotKey,\n  show,\n  onClose,\n}: {\n  onChangeId: (id: string) => void\n  slotKey: ArtifactSlotKey\n  show: boolean\n  onClose: () => void\n}) {\n  const { t } = useTranslation('page_character')\n  const { database } = useContext(DatabaseContext)\n  const clickHandler = useCallback(\n    (id) => {\n      onChangeId(id)\n      onClose()\n    },\n    [onChangeId, onClose]\n  )\n  const filterOptionReducer = useCallback(\n    (state, action) => ({ ...state, ...action, slotKeys: [slotKey] }),\n    [slotKey]\n  )\n\n  const [filterOption, filterOptionDispatch]: [\n    FilterOption,\n    (action: any) => void\n  ] = useReducer(filterOptionReducer, {\n    ...initialFilterOption(),\n    slotKeys: [slotKey],\n  })\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(() => {\n    return database.arts.followAny(forceUpdate)\n  }, [database, forceUpdate])\n\n  const brPt = useMediaQueryUp()\n\n  const filterConfigs = useMemo(() => artifactFilterConfigs(), [])\n  const artIdList = useMemo(() => {\n    const filterFunc = filterFunction(filterOption, filterConfigs)\n    return (\n      dbDirty &&\n      database.arts.values\n        .filter(filterFunc)\n        .map((art) => art.id)\n        .slice(0, numToShowMap[brPt])\n    )\n  }, [dbDirty, database, filterConfigs, filterOption, brPt])\n\n  return (\n    <ModalWrapper\n      open={show}\n      onClose={onClose}\n      containerProps={{ maxWidth: 'xl' }}\n    >\n      <CardDark>\n        <CardContent\n          sx={{\n            py: 1,\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <Typography variant=\"h6\">\n            {slotKey ? <ImgIcon src={Assets.slot[slotKey]} /> : null}{' '}\n            {t`tabEquip.swapArt`}\n          </Typography>\n          <CloseButton onClick={onClose} />\n        </CardContent>\n        <Divider />\n        <CardContent>\n          <Suspense\n            fallback={\n              <Skeleton variant=\"rectangular\" width=\"100%\" height={200} />\n            }\n          >\n            <ArtifactFilterDisplay\n              filterOption={filterOption}\n              filterOptionDispatch={filterOptionDispatch}\n              filteredIds={artIdList}\n              disableSlotFilter\n            />\n          </Suspense>\n          <Box mt={1}>\n            <Suspense\n              fallback={\n                <Skeleton variant=\"rectangular\" width=\"100%\" height={300} />\n              }\n            >\n              <Grid container spacing={1} columns={{ xs: 2, md: 3, lg: 4 }}>\n                {artIdList.map((id) => (\n                  <Grid item key={id} xs={1}>\n                    <ArtifactCard\n                      artifactId={id}\n                      extraButtons={<CompareBuildButton artId={id} />}\n                      onClick={clickHandler}\n                    />\n                  </Grid>\n                ))}\n              </Grid>\n            </Suspense>\n          </Box>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n","import type {\n  RarityKey,\n  WeaponKey,\n  WeaponTypeKey,\n} from '@genshin-optimizer/consts'\nimport { allRarityKeys } from '@genshin-optimizer/consts'\nimport { Add } from '@mui/icons-material'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  TextField,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport type { ChangeEvent } from 'react'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport Assets from '../../../../Assets/Assets'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CloseButton from '../../../../Components/CloseButton'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport SolidToggleButtonGroup from '../../../../Components/SolidToggleButtonGroup'\nimport WeaponSelectionModal from '../../../../Components/Weapon/WeaponSelectionModal'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport WeaponCard from '../../../../PageWeapon/WeaponCard'\nimport WeaponEditor from '../../../../PageWeapon/WeaponEditor'\nimport useForceUpdate from '../../../../ReactHooks/useForceUpdate'\nimport { handleMultiSelect } from '../../../../Util/MultiSelect'\nimport { filterFunction, sortFunction } from '../../../../Util/SortByFilters'\nimport {\n  weaponFilterConfigs,\n  weaponSortConfigs,\n  weaponSortMap,\n} from '../../../../Util/WeaponSort'\nimport { initialWeapon } from '../../../../Util/WeaponUtil'\nimport CompareBuildButton from './CompareBuildButton'\n\nconst rarityHandler = handleMultiSelect([...allRarityKeys])\n\nexport default function WeaponSwapModal({\n  onChangeId,\n  weaponTypeKey,\n  show,\n  onClose,\n}: {\n  onChangeId: (id: string) => void\n  weaponTypeKey: WeaponTypeKey\n  show: boolean\n  onClose: () => void\n}) {\n  const { t } = useTranslation([\n    'page_character',\n    'page_weapon',\n    'weaponNames_gen',\n  ])\n  const { database } = useContext(DatabaseContext)\n  const [newWeaponModalShow, setnewWeaponModalShow] = useState(false)\n  const clickHandler = useCallback(\n    (id: string) => {\n      onChangeId(id)\n      onClose()\n    },\n    [onChangeId, onClose]\n  )\n\n  const [editWeaponId, setEditWeaponId] = useState('')\n  const newWeapon = useCallback(\n    (weaponKey: WeaponKey) => {\n      setEditWeaponId(database.weapons.new(initialWeapon(weaponKey)))\n    },\n    [database, setEditWeaponId]\n  )\n  const resetEditWeapon = useCallback(() => setEditWeaponId(''), [])\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n  useEffect(\n    () => database.weapons.followAny(forceUpdate),\n    [forceUpdate, database]\n  )\n\n  const [rarity, setRarity] = useState<RarityKey[]>([5, 4, 3])\n  const [searchTerm, setSearchTerm] = useState('')\n  const deferredSearchTerm = useDeferredValue(searchTerm)\n\n  const weaponIdList = useMemo(\n    () =>\n      (dbDirty &&\n        database.weapons.values\n          .filter(\n            filterFunction(\n              { weaponType: weaponTypeKey, rarity, name: deferredSearchTerm },\n              weaponFilterConfigs()\n            )\n          )\n          .sort(\n            sortFunction(\n              weaponSortMap['level'] ?? [],\n              false,\n              weaponSortConfigs()\n            )\n          )\n          .map((weapon) => weapon.id)) ??\n      [],\n    [dbDirty, database, rarity, weaponTypeKey, deferredSearchTerm]\n  )\n\n  return (\n    <ModalWrapper open={show} onClose={onClose}>\n      <CardDark>\n        <Suspense fallback={false}>\n          <WeaponSelectionModal\n            show={newWeaponModalShow}\n            onHide={() => setnewWeaponModalShow(false)}\n            onSelect={newWeapon}\n            weaponTypeFilter={weaponTypeKey}\n          />\n        </Suspense>\n        {/* Editor/character detail display */}\n        <Suspense fallback={false}>\n          <WeaponEditor\n            weaponId={editWeaponId}\n            footer\n            onClose={resetEditWeapon}\n          />\n        </Suspense>\n        <CardContent sx={{ py: 1 }}>\n          <Grid container>\n            <Grid item flexGrow={1}>\n              <Typography variant=\"h6\">\n                {weaponTypeKey ? (\n                  <ImgIcon src={Assets.weaponTypes[weaponTypeKey]} />\n                ) : null}{' '}\n                {t`page_character:tabEquip.swapWeapon`}\n              </Typography>\n            </Grid>\n            <Grid item>\n              <CloseButton onClick={onClose} />\n            </Grid>\n          </Grid>\n        </CardContent>\n        <Divider />\n        <CardContent sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n          <Grid container spacing={1}>\n            <Grid item>\n              <SolidToggleButtonGroup\n                sx={{ height: '100%' }}\n                value={rarity}\n                size=\"small\"\n              >\n                {allRarityKeys.map((star) => (\n                  <ToggleButton\n                    key={star}\n                    value={star}\n                    onClick={() => setRarity(rarityHandler(rarity, star))}\n                  >\n                    <Box display=\"flex\">\n                      <strong>{star}</strong>\n                      <StarRoundedIcon />\n                    </Box>\n                  </ToggleButton>\n                ))}\n              </SolidToggleButtonGroup>\n            </Grid>\n            <Grid item flexGrow={1}>\n              <TextField\n                autoFocus\n                size=\"small\"\n                value={searchTerm}\n                onChange={(e: ChangeEvent<HTMLTextAreaElement>) =>\n                  setSearchTerm(e.target.value)\n                }\n                label={t('page_weapon:weaponName')}\n                sx={{ height: '100%' }}\n                InputProps={{\n                  sx: { height: '100%' },\n                }}\n              />\n            </Grid>\n          </Grid>\n          <Button\n            fullWidth\n            onClick={() => setnewWeaponModalShow(true)}\n            color=\"info\"\n            startIcon={<Add />}\n          >\n            {t('page_weapon:addWeapon')}\n          </Button>\n          <Grid container spacing={1}>\n            {weaponIdList.map((weaponId) => (\n              <Grid item key={weaponId} xs={6} sm={6} md={4} lg={3}>\n                <WeaponCard\n                  weaponId={weaponId}\n                  onClick={clickHandler}\n                  extraButtons={<CompareBuildButton weaponId={weaponId} />}\n                />\n              </Grid>\n            ))}\n          </Grid>\n        </CardContent>\n      </CardDark>\n    </ModalWrapper>\n  )\n}\n","import type { ArtifactSlotKey, WeaponTypeKey } from '@genshin-optimizer/consts'\nimport { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport { Settings, SwapHoriz } from '@mui/icons-material'\nimport {\n  Box,\n  Button,\n  CardContent,\n  Divider,\n  Grid,\n  ListItem,\n  Stack,\n  Tooltip,\n  Typography,\n  useMediaQuery,\n  useTheme,\n} from '@mui/material'\nimport {\n  lazy,\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport SetEffectDisplay from '../../../../Components/Artifact/SetEffectDisplay'\nimport SlotIcon from '../../../../Components/Artifact/SlotIcon'\nimport SubstatToggle from '../../../../Components/Artifact/SubstatToggle'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport DocumentDisplay from '../../../../Components/DocumentDisplay'\nimport {\n  BasicFieldDisplay,\n  FieldDisplayList,\n} from '../../../../Components/FieldDisplay'\nimport ModalWrapper from '../../../../Components/ModalWrapper'\nimport PercentBadge from '../../../../Components/PercentBadge'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { dataSetEffects } from '../../../../Data/Artifacts'\nimport Artifact from '../../../../Data/Artifacts/Artifact'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { uiInput as input } from '../../../../Formula'\nimport ArtifactCard from '../../../../PageArtifact/ArtifactCard'\nimport WeaponCard from '../../../../PageWeapon/WeaponCard'\nimport useBoolState from '../../../../ReactHooks/useBoolState'\nimport useCharMeta from '../../../../ReactHooks/useCharMeta'\nimport { iconInlineProps } from '../../../../SVGIcons'\nimport { allSubstatKeys } from '../../../../Types/artifact'\nimport { charKeyToLocCharKey } from '../../../../Types/consts'\nimport type { IFieldDisplay } from '../../../../Types/fieldDisplay'\nimport ArtifactSwapModal from './ArtifactSwapModal'\nimport WeaponSwapModal from './WeaponSwapModal'\n\nconst WeaponEditor = lazy(() => import('../../../../PageWeapon/WeaponEditor'))\n\nexport default function EquipmentSection() {\n  const {\n    character: { equippedWeapon, key: characterKey },\n    characterSheet,\n  } = useContext(CharacterContext)\n  const { teamData, data } = useContext(DataContext)\n  const weaponSheet = teamData[characterKey]?.weaponSheet\n  const [weaponId, setweaponId] = useState('')\n  const showWeapon = useCallback(\n    () => setweaponId(equippedWeapon),\n    [equippedWeapon]\n  )\n  const hideWeapon = useCallback(() => setweaponId(''), [])\n\n  //triggers when character swap weapons\n  useEffect(() => {\n    if (weaponId && weaponId !== equippedWeapon) setweaponId(equippedWeapon)\n  }, [weaponId, equippedWeapon])\n\n  const theme = useTheme()\n  const breakpoint = useMediaQuery(theme.breakpoints.up('lg'))\n\n  const weaponDoc = useMemo(\n    () =>\n      weaponSheet &&\n      weaponSheet.document.length > 0 && (\n        <CardLight>\n          <Box p={1}>\n            <DocumentDisplay sections={weaponSheet.document} />\n          </Box>\n        </CardLight>\n      ),\n    [weaponSheet]\n  )\n  const { rvFilter } = useCharMeta(characterKey)\n  const deferredRvFilter = useDeferredValue(rvFilter)\n  const deferredRvSet = useMemo(\n    () => new Set(deferredRvFilter),\n    [deferredRvFilter]\n  )\n  return (\n    <Box>\n      <Suspense fallback={false}>\n        <WeaponEditor\n          weaponId={weaponId}\n          footer\n          onClose={hideWeapon}\n          extraButtons={\n            <LargeWeaponSwapButton\n              weaponTypeKey={characterSheet.weaponTypeKey}\n            />\n          }\n        />\n      </Suspense>\n      <Grid container spacing={1}>\n        {breakpoint && (\n          <Grid\n            item\n            xs={12}\n            md={12}\n            lg={3}\n            xl={3}\n            sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n          >\n            {weaponDoc && weaponDoc}\n            <ArtifactSectionCard />\n          </Grid>\n        )}\n        <Grid item xs={12} md={12} lg={9} xl={9} container spacing={1}>\n          <Grid\n            item\n            xs={12}\n            sm={6}\n            md={4}\n            display=\"flex\"\n            flexDirection=\"column\"\n            gap={1}\n          >\n            <WeaponCard\n              weaponId={equippedWeapon}\n              onEdit={showWeapon}\n              canEquip\n              extraButtons={\n                <WeaponSwapButton\n                  weaponTypeKey={characterSheet.weaponTypeKey}\n                />\n              }\n            />\n          </Grid>\n          {allArtifactSlotKeys.map((slotKey) => (\n            <Grid item xs={12} sm={6} md={4} key={slotKey}>\n              {data.get(input.art[slotKey].id).value ? (\n                <ArtifactCard\n                  artifactId={data.get(input.art[slotKey].id).value}\n                  effFilter={deferredRvSet}\n                  extraButtons={<ArtifactSwapButton slotKey={slotKey} />}\n                  editorProps={{}}\n                  canEquip\n                />\n              ) : (\n                <ArtSwapCard slotKey={slotKey} />\n              )}\n            </Grid>\n          ))}\n        </Grid>\n        {!breakpoint && (\n          <Grid item xs={12} md={12} xl={3} container spacing={1}>\n            {weaponDoc && (\n              <Grid item xs={12} md={6} lg={4}>\n                {weaponDoc}\n              </Grid>\n            )}\n            <Grid\n              item\n              xs={12}\n              md={6}\n              lg={4}\n              sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n            >\n              <ArtifactSectionCard />\n            </Grid>\n          </Grid>\n        )}\n      </Grid>\n    </Box>\n  )\n}\nfunction ArtSwapCard({ slotKey }: { slotKey: ArtifactSlotKey }) {\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  const { t } = useTranslation('artifact')\n  return (\n    <CardLight\n      sx={{\n        height: '100%',\n        width: '100%',\n        minHeight: 300,\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n    >\n      <CardContent>\n        <Typography>\n          <SlotIcon iconProps={iconInlineProps} slotKey={slotKey} />{' '}\n          {t(`slotName.${slotKey}`)}\n        </Typography>\n      </CardContent>\n      <Divider />\n      <Box\n        sx={{\n          flexGrow: 1,\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n        }}\n      >\n        <ArtifactSwapModal\n          slotKey={slotKey}\n          show={show}\n          onClose={onClose}\n          onChangeId={(id) =>\n            database.arts.set(id, {\n              location: charKeyToLocCharKey(characterKey),\n            })\n          }\n        />\n        <Button onClick={onOpen} color=\"info\" sx={{ borderRadius: '1em' }}>\n          <SwapHoriz sx={{ height: 100, width: 100 }} />\n        </Button>\n      </Box>\n    </CardLight>\n  )\n}\nfunction WeaponSwapButton({ weaponTypeKey }: { weaponTypeKey: WeaponTypeKey }) {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  return (\n    <>\n      <Tooltip\n        title={<Typography>{t`tabEquip.swapWeapon`}</Typography>}\n        placement=\"top\"\n        arrow\n      >\n        <Button color=\"info\" size=\"small\" onClick={onOpen}>\n          <SwapHoriz />\n        </Button>\n      </Tooltip>\n      <WeaponSwapModal\n        weaponTypeKey={weaponTypeKey}\n        onChangeId={(id) =>\n          database.weapons.set(id, {\n            location: charKeyToLocCharKey(characterKey),\n          })\n        }\n        show={show}\n        onClose={onClose}\n      />\n    </>\n  )\n}\nfunction LargeWeaponSwapButton({\n  weaponTypeKey,\n}: {\n  weaponTypeKey: WeaponTypeKey\n}) {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  return (\n    <>\n      <Button\n        color=\"info\"\n        onClick={onOpen}\n        startIcon={<SwapHoriz />}\n      >{t`tabEquip.swapWeapon`}</Button>\n      <WeaponSwapModal\n        weaponTypeKey={weaponTypeKey}\n        onChangeId={(id) =>\n          database.weapons.set(id, {\n            location: charKeyToLocCharKey(characterKey),\n          })\n        }\n        show={show}\n        onClose={onClose}\n      />\n    </>\n  )\n}\nfunction ArtifactSwapButton({ slotKey }: { slotKey: ArtifactSlotKey }) {\n  const { t } = useTranslation('page_character')\n  const {\n    character: { key: characterKey },\n  } = useContext(CharacterContext)\n  const { database } = useContext(DatabaseContext)\n  const [show, onOpen, onClose] = useBoolState()\n  return (\n    <>\n      <Tooltip\n        title={<Typography>{t`tabEquip.swapArt`}</Typography>}\n        placement=\"top\"\n        arrow\n      >\n        <Button color=\"info\" size=\"small\" onClick={onOpen}>\n          <SwapHoriz />\n        </Button>\n      </Tooltip>\n      <ArtifactSwapModal\n        slotKey={slotKey}\n        show={show}\n        onClose={onClose}\n        onChangeId={(id) =>\n          database.arts.set(id, { location: charKeyToLocCharKey(characterKey) })\n        }\n      />\n    </>\n  )\n}\nfunction ArtifactSectionCard() {\n  const { t } = useTranslation(['page_character', 'artifact'])\n  const { database } = useContext(DatabaseContext)\n  const {\n    character,\n    character: { key: characterKey, equippedArtifacts },\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const hasEquipped = useMemo(\n    () => !!Object.values(equippedArtifacts).filter((i) => i).length,\n    [equippedArtifacts]\n  )\n  const unequipArts = useCallback(() => {\n    if (!character) return\n    if (\n      !window.confirm(\n        'Do you want to move all currently equipped artifacts to inventory?'\n      )\n    )\n      return\n    Object.values(equippedArtifacts).forEach((aid) =>\n      database.arts.set(aid, { location: '' })\n    )\n  }, [character, database, equippedArtifacts])\n\n  const setEffects = useMemo(() => dataSetEffects(data), [data])\n  const { rvFilter } = useCharMeta(characterKey)\n  const setRVFilter = useCallback(\n    (rvFilter) => database.charMeta.set(characterKey, { rvFilter }),\n    [database, characterKey]\n  )\n\n  const [show, onShow, onHide] = useBoolState()\n  const deferredrvFilter = useDeferredValue(rvFilter)\n  const { rvField, rvmField } = useMemo(() => {\n    const {\n      currentEfficiency,\n      currentEfficiency_,\n      maxEfficiency,\n      maxEfficiency_,\n    } = Object.values(equippedArtifacts).reduce(\n      (a, artid) => {\n        const art = database.arts.get(artid)\n        if (art) {\n          const { currentEfficiency, maxEfficiency } =\n            Artifact.getArtifactEfficiency(art, new Set(deferredrvFilter))\n          const {\n            currentEfficiency: currentEfficiency_,\n            maxEfficiency: maxEfficiency_,\n          } = Artifact.getArtifactEfficiency(art, new Set(allSubstatKeys))\n          a.currentEfficiency = a.currentEfficiency + currentEfficiency\n          a.maxEfficiency = a.maxEfficiency + maxEfficiency\n\n          a.currentEfficiency_ = a.currentEfficiency_ + currentEfficiency_\n          a.maxEfficiency_ = a.maxEfficiency_ + maxEfficiency_\n        }\n        return a\n      },\n      {\n        currentEfficiency: 0,\n        currentEfficiency_: 0,\n        maxEfficiency: 0,\n        maxEfficiency_: 0,\n      }\n    )\n    const rvField: IFieldDisplay = {\n      text: t`artifact:editor.curSubEff`,\n      value: !(currentEfficiency - currentEfficiency_) ? (\n        <PercentBadge value={currentEfficiency} max={4500} valid />\n      ) : (\n        <span>\n          <PercentBadge value={currentEfficiency} max={4500} valid /> /{' '}\n          <PercentBadge value={currentEfficiency_} max={4500} valid />\n        </span>\n      ),\n    }\n    const rvmField: IFieldDisplay = {\n      text: t`artifact:editor.maxSubEff`,\n      canShow: () => !!(currentEfficiency_ - maxEfficiency_),\n      value: !(maxEfficiency - maxEfficiency_) ? (\n        <PercentBadge value={maxEfficiency} max={4500} valid />\n      ) : (\n        <span>\n          <PercentBadge value={maxEfficiency} max={4500} valid /> /{' '}\n          <PercentBadge value={maxEfficiency_} max={4500} valid />\n        </span>\n      ),\n    }\n    return { rvField, rvmField }\n  }, [t, deferredrvFilter, equippedArtifacts, database])\n\n  return (\n    <CardLight>\n      {hasEquipped && (\n        <Button\n          color=\"error\"\n          onClick={unequipArts}\n          fullWidth\n          sx={{ borderBottomRightRadius: 0, borderBottomLeftRadius: 0 }}\n        >{t`tabEquip.unequipArts`}</Button>\n      )}\n      <Box p={1}>\n        <Stack spacing={1}>\n          <CardDark>\n            <Button\n              fullWidth\n              color=\"info\"\n              startIcon={<Settings />}\n              sx={{ borderBottomLeftRadius: 0, borderBottomRightRadius: 0 }}\n              onClick={onShow}\n            >\n              RV Filter\n            </Button>\n            <ModalWrapper open={show} onClose={onHide}>\n              <CardDark>\n                <CardContent>\n                  <Typography\n                    textAlign=\"center\"\n                    gutterBottom\n                    variant=\"h6\"\n                  >{t`artifact:efficiencyFilter.title`}</Typography>\n                  <SubstatToggle\n                    selectedKeys={rvFilter}\n                    onChange={setRVFilter}\n                  />\n                </CardContent>\n              </CardDark>\n            </ModalWrapper>\n            <FieldDisplayList>\n              <BasicFieldDisplay field={rvField} component={ListItem} />\n              {rvmField?.canShow?.(data) && (\n                <BasicFieldDisplay field={rvmField} component={ListItem} />\n              )}\n            </FieldDisplayList>\n          </CardDark>\n          {setEffects &&\n            Object.entries(setEffects).flatMap(([setKey, setNumKeyArr]) =>\n              setNumKeyArr.map((setNumKey) => (\n                <CardDark\n                  key={setKey + setNumKey}\n                  sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}\n                >\n                  <SetEffectDisplay\n                    key={setKey + setNumKey}\n                    setKey={setKey}\n                    setNumKey={setNumKey}\n                  />\n                </CardDark>\n              ))\n            )}\n        </Stack>\n      </Box>\n    </CardLight>\n  )\n}\n","import { charCard } from '@genshin-optimizer/char-cards'\nimport { Favorite, FavoriteBorder } from '@mui/icons-material'\nimport {\n  Badge,\n  Box,\n  CardActionArea,\n  Chip,\n  Grid,\n  IconButton,\n  Stack,\n  Typography,\n} from '@mui/material'\nimport { useCallback, useContext, useRef } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport Assets from '../../../../Assets/Assets'\nimport ArtifactCardNano from '../../../../Components/Artifact/ArtifactCardNano'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport CharacterCardPico, {\n  BlankCharacterCardPico,\n} from '../../../../Components/Character/CharacterCardPico'\nimport StatDisplayComponent from '../../../../Components/Character/StatDisplayComponent'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport SqBadge from '../../../../Components/SqBadge'\nimport { StarsDisplay } from '../../../../Components/StarDisplay'\nimport WeaponCardNano from '../../../../Components/Weapon/WeaponCardNano'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport type { TalentSheetElementKey } from '../../../../Data/Characters/ICharacterSheet'\nimport { getLevelString } from '../../../../Data/LevelData'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { uiInput as input } from '../../../../Formula'\nimport { ElementIcon } from '../../../../KeyMap/StatIcon'\nimport useCharacterReducer from '../../../../ReactHooks/useCharacterReducer'\nimport useCharMeta from '../../../../ReactHooks/useCharMeta'\nimport useDBMeta from '../../../../ReactHooks/useDBMeta'\nimport type {\n  AscensionKey,\n  CharacterKey,\n  ElementKey,\n} from '@genshin-optimizer/consts'\nimport { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport { range } from '../../../../Util/Util'\nimport EquipmentSection from './EquipmentSection'\n\nexport default function TabOverview() {\n  const scrollRef = useRef<HTMLDivElement>()\n  const onScroll = useCallback(\n    () => scrollRef?.current?.scrollIntoView?.({ behavior: 'smooth' }),\n    [scrollRef]\n  )\n\n  return (\n    <Stack spacing={1}>\n      <Grid container spacing={1} sx={{ justifyContent: 'center' }}>\n        <Grid item xs={8} sm={5} md={4} lg={2.3}>\n          <CharacterProfileCard />\n        </Grid>\n        <Grid\n          item\n          xs={12}\n          sm={7}\n          md={8}\n          lg={9.7}\n          sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n        >\n          <EquipmentRow onClick={onScroll} />\n          <CardLight sx={{ flexGrow: 1, p: 1 }}>\n            <StatDisplayComponent />\n          </CardLight>\n        </Grid>\n      </Grid>\n      <Box ref={scrollRef}>\n        <EquipmentSection />\n      </Box>\n    </Stack>\n  )\n}\nfunction EquipmentRow({ onClick }: { onClick: () => void }) {\n  const {\n    character: { equippedWeapon },\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n\n  return (\n    <Grid container spacing={1} columns={{ xs: 2, sm: 2, md: 3, lg: 6, xl: 6 }}>\n      <Grid item xs={1}>\n        <WeaponCardNano\n          weaponId={equippedWeapon}\n          BGComponent={CardLight}\n          onClick={onClick}\n        />\n      </Grid>\n      {allArtifactSlotKeys.map((slotKey) => (\n        <Grid item key={slotKey} xs={1}>\n          <ArtifactCardNano\n            artifactId={data.get(input.art[slotKey].id).value}\n            slotKey={slotKey}\n            BGComponent={CardLight}\n            onClick={onClick}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n/* Image card with star and name and level */\nfunction CharacterProfileCard() {\n  const { database } = useContext(DatabaseContext)\n  const {\n    characterSheet,\n    character: { key: characterKey, team },\n  } = useContext(CharacterContext)\n  const { gender } = useDBMeta()\n  const { data } = useContext(DataContext)\n  const characterDispatch = useCharacterReducer(characterKey)\n  const navigate = useNavigate()\n  const charEle = data.get(input.charEle).value as ElementKey\n  const weaponTypeKey = characterSheet.weaponTypeKey\n  const level = data.get(input.lvl).value\n  const ascension = data.get(input.asc).value as AscensionKey\n  const constellation = data.get(input.constellation).value\n  const tlvl = {\n    auto: data.get(input.total.auto).value,\n    skill: data.get(input.total.skill).value,\n    burst: data.get(input.total.burst).value,\n  }\n  const tBoost = {\n    auto: data.get(input.total.autoBoost).value,\n    skill: data.get(input.total.skillBoost).value,\n    burst: data.get(input.total.burstBoost).value,\n  }\n  const { favorite } = useCharMeta(characterKey)\n  return (\n    <CardLight sx={{ height: '100%' }}>\n      <Box sx={{ position: 'relative' }}>\n        <Box sx={{ position: 'absolute', width: '100%', height: '100%' }}>\n          <Typography\n            variant=\"h6\"\n            sx={{\n              position: 'absolute',\n              width: '100%',\n              left: '50%',\n              bottom: 0,\n              transform: 'translate(-50%, -50%)',\n              opacity: 0.75,\n              textAlign: 'center',\n            }}\n          >\n            <StarsDisplay stars={characterSheet.rarity} colored />\n          </Typography>\n          <Box\n            sx={{\n              position: 'absolute',\n              left: '50%',\n              bottom: '7%',\n              transform: 'translate(-50%, -50%)',\n              opacity: 0.85,\n              width: '100%',\n              display: 'flex',\n              justifyContent: 'center',\n              px: 1,\n            }}\n          >\n            <Chip\n              color={charEle}\n              sx={{ height: 'auto' }}\n              label={\n                <Typography\n                  variant=\"h6\"\n                  sx={{ display: 'flex', gap: 1, alignItems: 'center' }}\n                >\n                  <ElementIcon ele={charEle} />\n                  <Box sx={{ whiteSpace: 'normal', textAlign: 'center' }}>\n                    {characterSheet.name}\n                  </Box>\n                  <ImgIcon src={Assets.weaponTypes?.[weaponTypeKey]} />\n                </Typography>\n              }\n            />\n          </Box>\n          <Box sx={{ position: 'absolute', left: 0, top: 0 }}>\n            <IconButton\n              sx={{ p: 1 }}\n              color=\"error\"\n              onClick={() =>\n                database.charMeta.set(characterKey, { favorite: !favorite })\n              }\n            >\n              {favorite ? <Favorite /> : <FavoriteBorder />}\n            </IconButton>\n          </Box>\n          <Typography\n            sx={{ p: 1, position: 'absolute', right: 0, top: 0, opacity: 0.8 }}\n          >\n            <SqBadge>{getLevelString(level, ascension)}</SqBadge>\n          </Typography>\n        </Box>\n        <Box\n          src={charCard(characterKey, gender)}\n          component=\"img\"\n          width=\"100%\"\n          height=\"auto\"\n        />\n      </Box>\n      <Box>\n        <CardActionArea sx={{ p: 1 }} onClick={() => navigate('talent')}>\n          <Grid container spacing={1} mt={-1}>\n            {(['auto', 'skill', 'burst'] as TalentSheetElementKey[]).map(\n              (tKey) => (\n                <Grid item xs={4} key={tKey}>\n                  <Badge\n                    badgeContent={tlvl[tKey]}\n                    color={tBoost[tKey] ? 'info' : 'secondary'}\n                    overlap=\"circular\"\n                    anchorOrigin={{\n                      vertical: 'bottom',\n                      horizontal: 'right',\n                    }}\n                    sx={{\n                      width: '100%',\n                      height: '100%',\n                      '& > .MuiBadge-badge': {\n                        fontSize: '1.25em',\n                        padding: '.25em .4em',\n                        borderRadius: '.5em',\n                        lineHeight: 1,\n                        height: '1.25em',\n                      },\n                    }}\n                  >\n                    <Box\n                      component=\"img\"\n                      src={characterSheet.getTalentOfKey(tKey)?.img}\n                      width=\"100%\"\n                      height=\"auto\"\n                    />\n                  </Badge>\n                </Grid>\n              )\n            )}\n          </Grid>\n        </CardActionArea>\n        <Typography sx={{ textAlign: 'center', mt: 1 }} variant=\"h6\">\n          {characterSheet.constellationName}\n        </Typography>\n        <Grid container spacing={1}>\n          {range(1, 6).map((i) => (\n            <Grid item xs={4} key={i}>\n              <CardActionArea\n                onClick={() =>\n                  characterDispatch({\n                    constellation: i === constellation ? i - 1 : i,\n                  })\n                }\n              >\n                <Box\n                  component=\"img\"\n                  src={\n                    characterSheet.getTalentOfKey(\n                      `constellation${i}` as TalentSheetElementKey\n                    )?.img\n                  }\n                  sx={{\n                    ...(constellation >= i\n                      ? {}\n                      : { filter: 'brightness(50%)' }),\n                  }}\n                  width=\"100%\"\n                  height=\"auto\"\n                />\n              </CardActionArea>\n            </Grid>\n          ))}\n        </Grid>\n        <CardActionArea sx={{ p: 1 }} onClick={() => navigate('teambuffs')}>\n          <Grid container columns={3} spacing={1}>\n            {range(0, 2).map((i) => (\n              <Grid key={i} item xs={1} height=\"100%\">\n                {team[i] ? (\n                  <CharacterCardPico characterKey={team[i] as CharacterKey} />\n                ) : (\n                  <BlankCharacterCardPico index={i} />\n                )}\n              </Grid>\n            ))}\n          </Grid>\n        </CardActionArea>\n      </Box>\n    </CardLight>\n  )\n}\n","import {\n  Box,\n  CardActionArea,\n  CardContent,\n  Grid,\n  MenuItem,\n  Typography,\n  useMediaQuery,\n  useTheme,\n} from '@mui/material'\nimport { useCallback, useContext, useMemo } from 'react'\nimport CardDark from '../../../Components/Card/CardDark'\nimport CardLight from '../../../Components/Card/CardLight'\nimport ConditionalWrapper from '../../../Components/ConditionalWrapper'\nimport DocumentDisplay from '../../../Components/DocumentDisplay'\nimport DropdownButton from '../../../Components/DropdownMenu/DropdownButton'\nimport { NodeFieldDisplay } from '../../../Components/FieldDisplay'\nimport { CharacterContext } from '../../../Context/CharacterContext'\nimport { DataContext } from '../../../Context/DataContext'\nimport type { TalentSheetElementKey } from '../../../Data/Characters/ICharacterSheet'\nimport { uiInput as input } from '../../../Formula'\nimport type { NumNode } from '../../../Formula/type'\nimport type { NodeDisplay } from '../../../Formula/uiData'\nimport useCharacterReducer from '../../../ReactHooks/useCharacterReducer'\nimport type { DocumentSection } from '../../../Types/sheet'\nimport { range } from '../../../Util/Util'\n\nconst talentSpacing = {\n  xs: 12,\n  sm: 6,\n  md: 4,\n}\n\nexport default function CharacterTalentPane() {\n  const { character, characterSheet } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n  const characterDispatch = useCharacterReducer(character.key)\n  const skillBurstList = [\n    ['auto', 'Normal/Charged Attack'],\n    ['skill', 'Elemental Skill'],\n    ['burst', 'Elemental Burst'],\n  ] as [TalentSheetElementKey, string][]\n  const passivesList: [\n    tKey: TalentSheetElementKey,\n    tText: string,\n    asc: number\n  ][] = [\n    ['passive1', 'Unlocked at Ascension 1', 1],\n    ['passive2', 'Unlocked at Ascension 4', 4],\n    ['passive3', 'Unlocked by Default', 0],\n  ]\n  const ascension = data.get(input.asc).value\n  const constellation = data.get(input.constellation).value\n\n  const theme = useTheme()\n  const grlg = useMediaQuery(theme.breakpoints.up('lg'))\n  const constellationCards = useMemo(\n    () =>\n      range(1, 6).map((i) => (\n        <SkillDisplayCard\n          talentKey={`constellation${i}` as TalentSheetElementKey}\n          subtitle={`Constellation Lv. ${i}`}\n          onClickTitle={() =>\n            characterDispatch({\n              constellation: i === constellation ? i - 1 : i,\n            })\n          }\n        />\n      )),\n    [constellation, characterDispatch]\n  )\n  return (\n    <>\n      <ReactionDisplay />\n      <Grid container spacing={1}>\n        {/* constellations for 4column */}\n        {grlg && (\n          <Grid\n            item\n            xs={12}\n            md={12}\n            lg={3}\n            sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n          >\n            <CardLight>\n              <CardContent>\n                <Typography variant=\"h6\" sx={{ textAlign: 'center' }}>\n                  Constellation Lv. {constellation}\n                </Typography>\n              </CardContent>\n            </CardLight>\n            {constellationCards.map((c, i) => (\n              <Box key={i} sx={{ opacity: constellation >= i + 1 ? 1 : 0.5 }}>\n                {c}\n              </Box>\n            ))}\n          </Grid>\n        )}\n        <Grid item xs={12} md={12} lg={9} container spacing={1}>\n          {/* auto, skill, burst */}\n          {skillBurstList.map(([tKey, tText]) => (\n            <Grid item key={tKey} {...talentSpacing}>\n              <SkillDisplayCard talentKey={tKey} subtitle={tText} />\n            </Grid>\n          ))}\n          {!!characterSheet.getTalentOfKey('sprint') && (\n            <Grid item {...talentSpacing}>\n              <SkillDisplayCard\n                talentKey=\"sprint\"\n                subtitle=\"Alternative Sprint\"\n              />\n            </Grid>\n          )}\n          {!!characterSheet.getTalentOfKey('passive') && (\n            <Grid item {...talentSpacing}>\n              <SkillDisplayCard talentKey=\"passive\" subtitle=\"Passive\" />\n            </Grid>\n          )}\n          {/* passives */}\n          {passivesList.map(([tKey, tText, asc]) => {\n            const enabled = ascension >= asc\n            if (!characterSheet.getTalentOfKey(tKey)) return null\n            return (\n              <Grid\n                item\n                key={tKey}\n                style={{ opacity: enabled ? 1 : 0.5 }}\n                {...talentSpacing}\n              >\n                <SkillDisplayCard talentKey={tKey} subtitle={tText} />\n              </Grid>\n            )\n          })}\n        </Grid>\n        {/* constellations for < 4 columns */}\n        {!grlg && (\n          <Grid item xs={12} md={12} lg={3} container spacing={1}>\n            <Grid item xs={12}>\n              <CardLight>\n                <CardContent>\n                  <Typography variant=\"h6\" sx={{ textAlign: 'center' }}>\n                    Constellation Lv. {constellation}\n                  </Typography>\n                </CardContent>\n              </CardLight>\n            </Grid>\n            {constellationCards.map((c, i) => (\n              <Grid\n                item\n                key={i}\n                sx={{ opacity: constellation >= i + 1 ? 1 : 0.5 }}\n                {...talentSpacing}\n              >\n                {c}\n              </Grid>\n            ))}\n          </Grid>\n        )}\n      </Grid>\n    </>\n  )\n}\nfunction ReactionDisplay() {\n  const { data } = useContext(DataContext)\n  const reaction = data.getDisplay().reaction as { [key: string]: NodeDisplay }\n  return (\n    <CardLight>\n      <CardContent>\n        <Grid container spacing={1}>\n          {Object.entries(reaction)\n            .filter(([_, node]) => !node.isEmpty)\n            .map(([key, node]) => {\n              return (\n                <Grid item key={key}>\n                  <CardDark>\n                    <CardContent sx={{ p: 1, '&:last-child': { pb: 1 } }}>\n                      <NodeFieldDisplay node={node} />\n                    </CardContent>\n                  </CardDark>\n                </Grid>\n              )\n            })}\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\n\nconst talentLimits = [1, 1, 2, 4, 6, 8, 10]\ntype SkillDisplayCardProps = {\n  talentKey: TalentSheetElementKey\n  subtitle: string\n  onClickTitle?: (any) => any\n}\nfunction SkillDisplayCard({\n  talentKey,\n  subtitle,\n  onClickTitle,\n}: SkillDisplayCardProps) {\n  const {\n    character: { talent },\n    characterSheet,\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const { data } = useContext(DataContext)\n\n  const actionWrapperFunc = useCallback(\n    (children) => (\n      <CardActionArea onClick={onClickTitle}>{children}</CardActionArea>\n    ),\n    [onClickTitle]\n  )\n\n  const setTalentLevel = useCallback(\n    (tKey: TalentSheetElementKey, newTalentLevelKey: number) =>\n      characterDispatch({ talent: { ...talent, [tKey]: newTalentLevelKey } }),\n    [talent, characterDispatch]\n  )\n\n  let header: Displayable | null = null\n\n  if (talentKey in talent) {\n    const levelBoost = data.get(\n      input.total[`${talentKey}Boost`] as NumNode\n    ).value\n    const level = data.get(input.total[talentKey]).value\n    const asc = data.get(input.asc).value\n\n    header = (\n      <DropdownButton\n        fullWidth\n        title={`Talent Lv. ${level}`}\n        color={levelBoost ? 'info' : 'primary'}\n        sx={{ borderRadius: 0 }}\n      >\n        {range(1, talentLimits[asc]).map((i) => (\n          <MenuItem\n            key={i}\n            selected={talent[talentKey] === i}\n            disabled={talent[talentKey] === i}\n            onClick={() => setTalentLevel(talentKey, i)}\n          >\n            Talent Lv. {i + levelBoost}\n          </MenuItem>\n        ))}\n      </DropdownButton>\n    )\n  }\n  const talentSheet = characterSheet.getTalentOfKey(talentKey)\n\n  // Hide header if the header matches the current talent\n  const hideHeader = (section: DocumentSection): boolean => {\n    const headerAction = section.header?.action\n    if (headerAction && typeof headerAction !== 'string') {\n      const key: string = headerAction.props.children.props.key18\n      return key.includes(talentKey)\n    }\n    return false\n  }\n\n  return (\n    <CardLight sx={{ height: '100%' }}>\n      {header}\n      <CardContent>\n        <ConditionalWrapper\n          condition={!!onClickTitle}\n          wrapper={actionWrapperFunc}\n        >\n          <Grid container sx={{ flexWrap: 'nowrap' }}>\n            <Grid item>\n              <Box\n                component=\"img\"\n                src={talentSheet?.img}\n                sx={{ width: 60, height: 'auto' }}\n              />\n            </Grid>\n            <Grid item flexGrow={1} sx={{ pl: 1 }}>\n              <Typography variant=\"h6\">{talentSheet?.name}</Typography>\n              <Typography variant=\"subtitle1\">{subtitle}</Typography>\n            </Grid>\n          </Grid>\n        </ConditionalWrapper>\n        {/* Display document sections */}\n        {talentSheet?.sections ? (\n          <DocumentDisplay\n            sections={talentSheet.sections}\n            hideDesc\n            hideHeader={hideHeader}\n          />\n        ) : null}\n      </CardContent>\n    </CardLight>\n  )\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport { characterAsset } from '@genshin-optimizer/g-assets'\nimport { PersonAdd } from '@mui/icons-material'\nimport type { AutocompleteProps } from '@mui/material'\nimport {\n  Box,\n  CardContent,\n  CardHeader,\n  Divider,\n  Grid,\n  Skeleton,\n  Typography,\n} from '@mui/material'\nimport { Suspense, useCallback, useContext, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport CardLight from '../../../Components/Card/CardLight'\nimport CharacterCard from '../../../Components/Character/CharacterCard'\nimport ThumbSide from '../../../Components/Character/ThumbSide'\nimport ColorText from '../../../Components/ColoredText'\nimport DocumentDisplay from '../../../Components/DocumentDisplay'\nimport { NodeFieldDisplay } from '../../../Components/FieldDisplay'\nimport type { GeneralAutocompleteOption } from '../../../Components/GeneralAutocomplete'\nimport { GeneralAutocomplete } from '../../../Components/GeneralAutocomplete'\nimport { InfoTooltipInline } from '../../../Components/InfoTooltip'\nimport type { CharacterContextObj } from '../../../Context/CharacterContext'\nimport { CharacterContext } from '../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../Context/DataContext'\nimport { DataContext } from '../../../Context/DataContext'\nimport { dataSetEffects, getArtSheet } from '../../../Data/Artifacts'\nimport { getCharSheet } from '../../../Data/Characters'\nimport { resonanceSheets } from '../../../Data/Resonance'\nimport { DatabaseContext } from '../../../Database/Database'\nimport type { NodeDisplay } from '../../../Formula/uiData'\nimport useCharSelectionCallback from '../../../ReactHooks/useCharSelectionCallback'\nimport useDBMeta from '../../../ReactHooks/useDBMeta'\nimport { charKeyToCharName } from '../../../Types/consts'\nimport { objPathValue, range } from '../../../Util/Util'\n\nexport default function TabTeambuffs() {\n  return (\n    <Box display=\"flex\" flexDirection=\"column\" gap={1} alignItems=\"stretch\">\n      <Grid container spacing={1}>\n        <Grid\n          item\n          xs={12}\n          md={6}\n          lg={3}\n          sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n        >\n          <TeamBuffDisplay />\n          <ResonanceDisplay />\n        </Grid>\n        {range(0, 2).map((i) => (\n          <Grid item xs={12} md={6} lg={3} key={i}>\n            <TeammateDisplay index={i} />\n          </Grid>\n        ))}\n      </Grid>\n    </Box>\n  )\n}\nexport function TeamBuffDisplay() {\n  const { data, oldData } = useContext(DataContext)\n  const teamBuffs = data.getTeamBuff()\n  const nodes: Array<[string[], NodeDisplay<number>]> = []\n  Object.entries(teamBuffs.total ?? {}).forEach(\n    ([key, node]) =>\n      !node.isEmpty && node.value !== 0 && nodes.push([['total', key], node])\n  )\n  Object.entries(teamBuffs.premod ?? {}).forEach(\n    ([key, node]) =>\n      !node.isEmpty && node.value !== 0 && nodes.push([['premod', key], node])\n  )\n  Object.entries(teamBuffs.enemy ?? {}).forEach(\n    ([key, node]) =>\n      !node.isEmpty &&\n      typeof node.value === 'number' &&\n      node.value !== 0 &&\n      nodes.push([['enemy', key], node as NodeDisplay<number>])\n  )\n  if (!nodes.length) return null\n  return (\n    <CardLight>\n      <CardContent>\n        <Typography>Team Buffs</Typography>\n      </CardContent>\n      <Divider />\n      <CardContent>\n        <Grid container>\n          {nodes.map(\n            ([path, n]) =>\n              n && (\n                <Grid item xs={12} key={JSON.stringify(n.info)}>\n                  <NodeFieldDisplay\n                    node={n}\n                    oldValue={objPathValue(oldData?.getTeamBuff(), path)?.value}\n                  />\n                </Grid>\n              )\n          )}\n        </Grid>\n      </CardContent>\n    </CardLight>\n  )\n}\nfunction ResonanceDisplay() {\n  const { t } = useTranslation('page_character')\n  const { data } = useContext(DataContext)\n  const {\n    character: { team },\n  } = useContext(CharacterContext)\n  const teamCount = team.reduce((a, t) => a + (t ? 1 : 0), 1)\n  return (\n    <>\n      <CardLight>\n        <CardHeader\n          title={\n            <span>\n              {t('tabTeambuff.team_reso')}{' '}\n              <strong>\n                <ColorText color={teamCount >= 4 ? 'success' : 'warning'}>\n                  ({teamCount}/4)\n                </ColorText>\n              </strong>{' '}\n              <InfoTooltipInline\n                title={<Typography>{t`tabTeambuff.resonance_tip`}</Typography>}\n              />\n            </span>\n          }\n          titleTypographyProps={{ variant: 'subtitle2' }}\n        />\n      </CardLight>\n      {resonanceSheets.map((res, i) => (\n        <CardLight key={i} sx={{ opacity: res.canShow(data) ? 1 : 0.5 }}>\n          <CardHeader\n            title={\n              <span>\n                {res.name}{' '}\n                <InfoTooltipInline\n                  title={<Typography>{res.desc}</Typography>}\n                />\n              </span>\n            }\n            action={res.icon}\n            titleTypographyProps={{ variant: 'subtitle2' }}\n          />\n          {res.canShow(data) && <Divider />}\n          {res.canShow(data) && (\n            <CardContent>\n              <DocumentDisplay sections={res.sections} teamBuffOnly hideDesc />\n            </CardContent>\n          )}\n        </CardLight>\n      ))}\n    </>\n  )\n}\nfunction TeammateDisplay({ index }: { index: number }) {\n  const { teamData } = useContext(DataContext)\n  const { t } = useTranslation('page_character')\n  const {\n    character: active,\n    character: { key: activeCharacterKey },\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const teamMateKey = active.team[index]\n  const team = useMemo(\n    () =>\n      [activeCharacterKey, ...active.team].filter((t, i) => i - 1 !== index),\n    [active.team, activeCharacterKey, index]\n  )\n  const onClickHandler = useCharSelectionCallback()\n  const setTeammate = useCallback(\n    (charKey: CharacterKey | '') =>\n      characterDispatch({ type: 'team', index, charKey }),\n    [index, characterDispatch]\n  )\n\n  const dataBundle = teamData[teamMateKey]\n  const teammateCharacterContext: CharacterContextObj | undefined = useMemo(\n    () =>\n      dataBundle && {\n        character: {\n          ...dataBundle.character,\n          conditional: active.teamConditional[teamMateKey] ?? {},\n        },\n        characterSheet: dataBundle.characterSheet,\n        characterDispatch: (state) => {\n          if (!teamMateKey) return\n          if (!('conditional' in state)) return\n          const { conditional } = state\n          if (!conditional) return\n          characterDispatch({\n            type: 'teamConditional',\n            teamMateKey: teamMateKey,\n            conditional,\n          })\n        },\n      },\n    [active, teamMateKey, dataBundle, characterDispatch]\n  )\n  const teamMateDataContext: dataContextObj | undefined = useMemo(\n    () =>\n      dataBundle && {\n        data: dataBundle.target,\n        teamData: teamData,\n      },\n    [dataBundle, teamData]\n  )\n  return (\n    <CardLight sx={{ overflow: 'visible' }}>\n      <TeammateAutocomplete\n        characterKey={teamMateKey}\n        team={team}\n        setChar={setTeammate}\n        label={t('teammate', { count: index + 1 })}\n      />\n      {teamMateKey && teammateCharacterContext && (\n        <CharacterContext.Provider value={teammateCharacterContext}>\n          {teamMateDataContext && (\n            <DataContext.Provider value={teamMateDataContext}>\n              <CharacterCard\n                characterKey={teamMateKey}\n                onClickHeader={onClickHandler}\n                // Need to wrap these elements with the providers for them to use the correct functions.\n                artifactChildren={\n                  <CharacterContext.Provider value={teammateCharacterContext}>\n                    <DataContext.Provider value={teamMateDataContext}>\n                      <CharArtifactCondDisplay />\n                    </DataContext.Provider>\n                  </CharacterContext.Provider>\n                }\n                weaponChildren={\n                  <CharacterContext.Provider value={teammateCharacterContext}>\n                    <DataContext.Provider value={teamMateDataContext}>\n                      <CharWeaponCondDisplay />\n                    </DataContext.Provider>\n                  </CharacterContext.Provider>\n                }\n                characterChildren={\n                  <CharacterContext.Provider value={teammateCharacterContext}>\n                    <DataContext.Provider value={teamMateDataContext}>\n                      <CharTalentCondDisplay />\n                    </DataContext.Provider>\n                  </CharacterContext.Provider>\n                }\n                isTeammateCard\n              />\n            </DataContext.Provider>\n          )}\n        </CharacterContext.Provider>\n      )}\n    </CardLight>\n  )\n}\nfunction CharArtifactCondDisplay() {\n  const { data } = useContext(DataContext)\n  const sections = useMemo(\n    () =>\n      Object.entries(dataSetEffects(data)).flatMap(([setKey, setNums]) =>\n        setNums.flatMap((sn) => getArtSheet(setKey).setEffectDocument(sn) ?? [])\n      ),\n    [data]\n  )\n  if (!sections) return null\n  return <DocumentDisplay sections={sections} teamBuffOnly={true} />\n}\nfunction CharWeaponCondDisplay() {\n  const {\n    character: { key: charKey },\n  } = useContext(CharacterContext)\n  const { teamData } = useContext(DataContext)\n  const weaponSheet = teamData[charKey]!.weaponSheet\n  if (!weaponSheet.document) return null\n  return <DocumentDisplay sections={weaponSheet.document} teamBuffOnly={true} />\n}\nfunction CharTalentCondDisplay() {\n  const {\n    character: { key: charKey },\n  } = useContext(CharacterContext)\n  const { teamData } = useContext(DataContext)\n  const characterSheet = teamData[charKey]!.characterSheet\n  const sections = Object.values(characterSheet.talent).flatMap(\n    (sts) => sts.sections\n  )\n  if (!sections) return null\n  return <DocumentDisplay sections={sections} teamBuffOnly={true} />\n}\n\nfunction TeammateAutocomplete({\n  characterKey,\n  team,\n  label,\n  setChar,\n  autoCompleteProps = {},\n}: {\n  characterKey: CharacterKey | ''\n  team: Array<CharacterKey | ''>\n  label: string\n  setChar: (k: CharacterKey | '') => void\n  autoCompleteProps?: Omit<\n    AutocompleteProps<\n      GeneralAutocompleteOption<CharacterKey | ''>,\n      false,\n      false,\n      false\n    >,\n    'renderInput' | 'onChange' | 'options'\n  >\n}) {\n  const { t } = useTranslation(['charNames_gen', 'page_character', 'sheet_gen'])\n  const { database } = useContext(DatabaseContext)\n  const { gender } = useDBMeta()\n  const toText = useCallback(\n    (key: CharacterKey): string =>\n      key.startsWith('Traveler')\n        ? `${t(`charNames_gen:${charKeyToCharName(key, gender)}`)} (${t(\n            `sheet_gen:element.${getCharSheet(key, gender)?.elementKey}`\n          )})`\n        : t(`charNames_gen:${key}`),\n    [t, gender]\n  )\n  const toImg = useCallback(\n    (key: CharacterKey | '') =>\n      key ? (\n        <ThumbSide\n          src={characterAsset(key, 'iconSide', gender)}\n          sx={{ pr: 1 }}\n        />\n      ) : (\n        <PersonAdd />\n      ),\n    [gender]\n  ) //\n  const isFavorite = useCallback(\n    (key: CharacterKey) => database.charMeta.get(key).favorite,\n    [database]\n  )\n  const onDisable = useCallback(\n    ({ key }: { key: CharacterKey | '' }) =>\n      team.filter((t) => t && t !== characterKey).includes(key) ||\n      (key.startsWith('Traveler') &&\n        team.some((t) => t.startsWith('Traveler'))),\n    [team, characterKey]\n  )\n  const values: GeneralAutocompleteOption<CharacterKey>[] = useMemo(\n    () =>\n      database.chars.keys\n        .map((v) => ({ key: v, label: toText(v), favorite: isFavorite(v) }))\n        .sort((a, b) => {\n          if (a.favorite && !b.favorite) return -1\n          if (!a.favorite && b.favorite) return 1\n          return a.label.localeCompare(b.label)\n        }),\n    [toText, isFavorite, database]\n  )\n  return (\n    <Suspense fallback={<Skeleton variant=\"text\" width={100} />}>\n      <GeneralAutocomplete\n        size=\"small\"\n        label={label}\n        options={values}\n        valueKey={characterKey}\n        onChange={(k) => setChar(k ?? '')}\n        getOptionDisabled={onDisable}\n        toImg={toImg}\n        {...autoCompleteProps}\n      />\n    </Suspense>\n  )\n}\n","import type {\n  ArtifactSetKey,\n  ArtifactSlotKey,\n  WeaponTypeKey,\n} from '@genshin-optimizer/consts'\nimport { allArtifactSlotKeys } from '@genshin-optimizer/consts'\nimport { weaponAsset } from '@genshin-optimizer/g-assets'\nimport { CopyAll, DeleteForever, Info, Refresh } from '@mui/icons-material'\nimport StarRoundedIcon from '@mui/icons-material/StarRounded'\nimport {\n  Box,\n  Button,\n  ButtonGroup,\n  CardHeader,\n  Divider,\n  Grid,\n  ListItem,\n  MenuItem,\n  Skeleton,\n  Slider,\n  Stack,\n  ToggleButton,\n  Typography,\n} from '@mui/material'\nimport React, {\n  Suspense,\n  useCallback,\n  useContext,\n  useDeferredValue,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useLocation } from 'react-router-dom'\nimport ArtifactSetAutocomplete from '../../../../Components/Artifact/ArtifactSetAutocomplete'\nimport ArtifactSetTooltip from '../../../../Components/Artifact/ArtifactSetTooltip'\nimport SetEffectDisplay from '../../../../Components/Artifact/SetEffectDisplay'\nimport SlotIcon from '../../../../Components/Artifact/SlotIcon'\nimport BootstrapTooltip from '../../../../Components/BootstrapTooltip'\nimport CardDark from '../../../../Components/Card/CardDark'\nimport CardLight from '../../../../Components/Card/CardLight'\nimport StatDisplayComponent from '../../../../Components/Character/StatDisplayComponent'\nimport ColorText from '../../../../Components/ColoredText'\nimport CustomNumberInput from '../../../../Components/CustomNumberInput'\nimport DocumentDisplay from '../../../../Components/DocumentDisplay'\nimport DropdownButton from '../../../../Components/DropdownMenu/DropdownButton'\nimport {\n  FieldDisplayList,\n  NodeFieldDisplay,\n} from '../../../../Components/FieldDisplay'\nimport ImgIcon from '../../../../Components/Image/ImgIcon'\nimport LevelSelect from '../../../../Components/LevelSelect'\nimport RefinementDropdown from '../../../../Components/RefinementDropdown'\nimport SolidToggleButtonGroup from '../../../../Components/SolidToggleButtonGroup'\nimport {\n  StatColoredWithUnit,\n  StatWithUnit,\n} from '../../../../Components/StatDisplay'\nimport { CharacterContext } from '../../../../Context/CharacterContext'\nimport type { dataContextObj } from '../../../../Context/DataContext'\nimport { DataContext } from '../../../../Context/DataContext'\nimport { getArtSheet } from '../../../../Data/Artifacts'\nimport Artifact, { maxArtifactLevel } from '../../../../Data/Artifacts/Artifact'\nimport { artifactDefIcon } from '../../../../Data/Artifacts/ArtifactSheet'\nimport { getWeaponSheet } from '../../../../Data/Weapons'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport { initCharTC } from '../../../../Database/DataManagers/CharacterTCData'\nimport { uiInput as input } from '../../../../Formula'\nimport { computeUIData, dataObjForWeapon } from '../../../../Formula/api'\nimport { constant, percent } from '../../../../Formula/utils'\nimport KeyMap, { cacheValueString } from '../../../../KeyMap'\nimport StatIcon from '../../../../KeyMap/StatIcon'\nimport useBoolState from '../../../../ReactHooks/useBoolState'\nimport useTeamData from '../../../../ReactHooks/useTeamData'\nimport { iconInlineProps } from '../../../../SVGIcons'\nimport type {\n  ICachedArtifact,\n  MainStatKey,\n  SubstatKey,\n} from '../../../../Types/artifact'\nimport type { ICharTC, ICharTCArtifactSlot } from '../../../../Types/character'\nimport type {\n  ArtifactRarity,\n  SetNum,\n  SubstatType,\n} from '../../../../Types/consts'\nimport { substatType } from '../../../../Types/consts'\nimport type { ICachedWeapon } from '../../../../Types/weapon'\nimport { deepClone, objectMap } from '../../../../Util/Util'\nimport { defaultInitialWeaponKey } from '../../../../Util/WeaponUtil'\nimport useCharTC from './useCharTC'\nconst WeaponSelectionModal = React.lazy(\n  () => import('../../../../Components/Weapon/WeaponSelectionModal')\n)\n\ntype ISet = Partial<Record<ArtifactSetKey, 1 | 2 | 4>>\nexport default function TabTheorycraft() {\n  const { database } = useContext(DatabaseContext)\n  const { data: oldData } = useContext(DataContext)\n  const {\n    character,\n    character: { key: characterKey, compareData },\n    characterSheet,\n    characterDispatch,\n  } = useContext(CharacterContext)\n  const data = useCharTC(\n    characterKey,\n    defaultInitialWeaponKey(characterSheet.weaponTypeKey)\n  )\n  const setData = useCallback(\n    (data: ICharTC) => database.charTCs.set(characterKey, data),\n    [characterKey, database]\n  )\n  const resetData = useCallback(() => {\n    setData(initCharTC(defaultInitialWeaponKey(characterSheet.weaponTypeKey)))\n  }, [setData, characterSheet])\n  const setWeapon = useCallback(\n    (action: Partial<ICharTC['weapon']>) => {\n      setData({ ...data, weapon: { ...data.weapon, ...action } })\n    },\n    [setData, data]\n  )\n\n  const copyFrom = useCallback(\n    (eWeapon: ICachedWeapon, build: ICachedArtifact[]) => {\n      const newData = initCharTC(eWeapon.key)\n      newData.artifact.substats.type = data.artifact.substats.type\n\n      newData.weapon.level = eWeapon.level\n      newData.weapon.ascension = eWeapon.ascension\n      newData.weapon.refinement = eWeapon.refinement\n\n      const sets = {}\n      build.forEach((art) => {\n        if (!art) return\n        const { slotKey, setKey, substats, mainStatKey, level, rarity } = art\n        newData.artifact.slots[slotKey].level = level\n        newData.artifact.slots[slotKey].statKey = mainStatKey\n        newData.artifact.slots[slotKey].rarity = rarity\n        sets[setKey] = (sets[setKey] ?? 0) + 1\n        substats.forEach((substat) => {\n          if (substat.key)\n            newData.artifact.substats.stats[substat.key] =\n              (newData.artifact.substats.stats[substat.key] ?? 0) +\n              substat.accurateValue\n        })\n      })\n      newData.artifact.sets = Object.fromEntries(\n        Object.entries(sets)\n          .map(([key, value]) => [\n            key,\n            value === 3\n              ? 2\n              : value === 5\n              ? 4\n              : value === 1 && !(key as string).startsWith('PrayersFor')\n              ? 0\n              : value,\n          ])\n          .filter(([, value]) => value)\n      )\n      setData(newData)\n    },\n    [data, setData]\n  )\n  const location = useLocation()\n  const { build: locBuild } = (location.state as\n    | { build: string[] }\n    | undefined) ?? { build: undefined }\n  useEffect(() => {\n    if (!locBuild) return\n    const eWeapon = database.weapons.get(character.equippedWeapon)!\n    copyFrom(\n      eWeapon,\n      locBuild.map((i) => database.arts.get(i)!)\n    )\n    // WARNING: if copyFrom is included, it will cause a render loop due to its setData <---> data\n    // eslint-disable-next-line\n  }, [locBuild, database])\n\n  const copyFromEquipped = useCallback(() => {\n    const eWeapon = database.weapons.get(character.equippedWeapon)!\n    copyFrom(\n      eWeapon,\n      Object.values(character.equippedArtifacts)\n        .map((a) => database.arts.get(a)!)\n        .filter((a) => a)\n    )\n  }, [\n    database,\n    character.equippedArtifacts,\n    character.equippedWeapon,\n    copyFrom,\n  ])\n\n  const weapon: ICachedWeapon = useMemo(() => {\n    return {\n      ...data.weapon,\n      location: '',\n      lock: false,\n      id: '',\n    }\n  }, [data])\n  const setArtifact = useCallback(\n    (artifact: ICharTC['artifact']) => {\n      const data_ = deepClone(data)\n      data_.artifact = artifact\n      setData(data_)\n    },\n    [data, setData]\n  )\n\n  const setSubstatsType = useCallback(\n    (t: SubstatType) => {\n      const data_ = deepClone(data)\n      data_.artifact.substats.type = t\n      setData(data_)\n    },\n    [data, setData]\n  )\n\n  const setSubstats = useCallback(\n    (setSubstats: Record<SubstatKey, number>) => {\n      const data_ = deepClone(data)\n      data_.artifact.substats.stats = setSubstats\n      setData(data_)\n    },\n    [data, setData]\n  )\n\n  const deferredData = useDeferredValue(data)\n  const overriderArtData = useMemo(() => {\n    const stats = { ...deferredData.artifact.substats.stats }\n    Object.values(deferredData.artifact.slots).forEach(\n      ({ statKey, rarity, level }) =>\n        (stats[statKey] =\n          (stats[statKey] ?? 0) +\n          Artifact.mainStatValue(statKey, rarity, level))\n    )\n    return {\n      art: objectMap(stats, (v, k) =>\n        k.endsWith('_') ? percent(v / 100) : constant(v)\n      ),\n      artSet: objectMap(deferredData.artifact.sets, (v) => constant(v)),\n    }\n  }, [deferredData])\n\n  const overrideWeapon: ICachedWeapon = useMemo(\n    () => ({\n      id: '',\n      location: '',\n      key: data.weapon.key,\n      level: data.weapon.level,\n      ascension: data.weapon.ascension,\n      refinement: data.weapon.refinement,\n      lock: false,\n    }),\n    [data]\n  )\n  const teamData = useTeamData(\n    characterKey,\n    0,\n    overriderArtData,\n    overrideWeapon\n  )\n\n  const { target: charUIData } = teamData?.[characterKey] ?? {}\n\n  const dataContextValue: dataContextObj | undefined = useMemo(() => {\n    if (!teamData || !charUIData) return undefined\n    return {\n      data: charUIData,\n      teamData,\n    }\n  }, [charUIData, teamData])\n  const dataContextValueWithOld: dataContextObj | undefined = useMemo(() => {\n    if (!dataContextValue) return undefined\n    return {\n      ...dataContextValue,\n      oldData: compareData ? oldData : undefined,\n    }\n  }, [dataContextValue, compareData, oldData])\n  return (\n    <Stack spacing={1}>\n      <CardLight>\n        <Box sx={{ display: 'flex', gap: 1, p: 1 }}>\n          <Box sx={{ flexGrow: 1, display: 'flex', gap: 1 }}>\n            <Button\n              color=\"info\"\n              onClick={copyFromEquipped}\n              startIcon={<CopyAll />}\n            >\n              Copy from equipped\n            </Button>\n            <Button color=\"error\" onClick={resetData} startIcon={<Refresh />}>\n              Reset\n            </Button>\n          </Box>\n          <SolidToggleButtonGroup\n            exclusive\n            value={compareData}\n            onChange={(e, v) => characterDispatch({ compareData: v })}\n            size=\"small\"\n          >\n            <ToggleButton value={false} disabled={!compareData}>\n              Show TC stats\n            </ToggleButton>\n            <ToggleButton value={true} disabled={compareData}>\n              Compare vs. equipped\n            </ToggleButton>\n          </SolidToggleButtonGroup>\n        </Box>\n      </CardLight>\n      {dataContextValue ? (\n        <DataContext.Provider value={dataContextValue}>\n          <Grid container spacing={1} sx={{ justifyContent: 'center' }}>\n            <Grid item sx={{ flexGrow: -1 }}>\n              <WeaponEditorCard\n                weapon={weapon}\n                setWeapon={setWeapon}\n                weaponTypeKey={characterSheet.weaponTypeKey}\n              />\n              <ArtifactMainLevelCard\n                artifactData={data.artifact}\n                setArtifactData={setArtifact}\n              />\n            </Grid>\n            <Grid item sx={{ flexGrow: 1 }}>\n              <ArtifactSubCard\n                substats={data.artifact.substats.stats}\n                setSubstats={setSubstats}\n                substatsType={data.artifact.substats.type}\n                setSubstatsType={setSubstatsType}\n                mainStatKeys={Object.values(data.artifact.slots).map(\n                  (s) => s.statKey\n                )}\n              />\n            </Grid>\n          </Grid>\n        </DataContext.Provider>\n      ) : (\n        <Skeleton variant=\"rectangular\" width=\"100%\" height={500} />\n      )}\n      <CardLight sx={{ flexGrow: 1, p: 1 }}>\n        {dataContextValueWithOld ? (\n          <DataContext.Provider value={dataContextValueWithOld}>\n            <StatDisplayComponent />\n          </DataContext.Provider>\n        ) : (\n          <Skeleton variant=\"rectangular\" width=\"100%\" height={500} />\n        )}\n      </CardLight>\n    </Stack>\n  )\n}\n\nfunction WeaponEditorCard({\n  weapon,\n  setWeapon,\n  weaponTypeKey,\n}: {\n  weapon: ICachedWeapon\n  weaponTypeKey: WeaponTypeKey\n  setWeapon: (action: Partial<ICharTC['weapon']>) => void\n}) {\n  const { key, level = 0, refinement = 1, ascension = 0 } = weapon\n  const weaponSheet = getWeaponSheet(key)\n  const [show, onShow, onHide] = useBoolState()\n  const { data } = useContext(DataContext)\n  const weaponUIData = useMemo(\n    () => weapon && computeUIData([weaponSheet.data, dataObjForWeapon(weapon)]),\n    [weaponSheet, weapon]\n  )\n  return (\n    <CardLight sx={{ p: 1, mb: 1 }}>\n      <WeaponSelectionModal\n        ascension={ascension}\n        show={show}\n        onHide={onHide}\n        onSelect={(k) => setWeapon({ key: k })}\n        weaponTypeFilter={weaponTypeKey}\n      />\n      <Box display=\"flex\" flexDirection=\"column\" gap={1}>\n        <Box display=\"flex\" gap={1}>\n          <Box\n            className={`grad-${weaponSheet.rarity}star`}\n            component=\"img\"\n            src={weaponAsset(weapon.key, ascension >= 2)}\n            sx={{\n              flexshrink: 1,\n              flexBasis: 0,\n              maxWidth: '30%',\n              borderRadius: 1,\n            }}\n          />\n          <Stack spacing={1} flexGrow={1}>\n            <Button\n              fullWidth\n              color=\"info\"\n              sx={{ flexGrow: 1 }}\n              onClick={onShow}\n            >\n              <Box sx={{ maxWidth: '10em' }}>{weaponSheet?.name}</Box>\n            </Button>\n            {weaponSheet.hasRefinement && (\n              <RefinementDropdown\n                refinement={refinement}\n                setRefinement={(r) => setWeapon({ refinement: r })}\n              />\n            )}\n          </Stack>\n        </Box>\n        <LevelSelect\n          level={level}\n          ascension={ascension}\n          setBoth={setWeapon}\n          useLow={!weaponSheet.hasRefinement}\n        />\n        <CardDark>\n          <CardHeader\n            title={'Main Stats'}\n            titleTypographyProps={{ variant: 'subtitle2' }}\n          />\n          <Divider />\n          {weaponUIData && (\n            <FieldDisplayList>\n              {[input.weapon.main, input.weapon.sub, input.weapon.sub2].map(\n                (node) => {\n                  const n = weaponUIData.get(node)\n                  if (n.isEmpty || !n.value) return null\n                  return (\n                    <NodeFieldDisplay\n                      key={JSON.stringify(n.info)}\n                      node={n}\n                      component={ListItem}\n                    />\n                  )\n                }\n              )}\n            </FieldDisplayList>\n          )}\n        </CardDark>\n        {data && weaponSheet?.document && (\n          <DocumentDisplay sections={weaponSheet.document} />\n        )}\n      </Box>\n    </CardLight>\n  )\n}\n\nfunction ArtifactMainLevelCard({\n  artifactData,\n  setArtifactData,\n}: {\n  artifactData: ICharTC['artifact']\n  setArtifactData: (a: ICharTC['artifact']) => void\n}) {\n  const setSlot = useCallback(\n    (slotKey: ArtifactSlotKey) => (slot: ICharTCArtifactSlot) => {\n      const artifactData_ = deepClone(artifactData)\n      artifactData_.slots[slotKey] = slot\n      setArtifactData(artifactData_)\n    },\n    [artifactData, setArtifactData]\n  )\n\n  const setArtSet = useCallback(\n    (artSet: ISet) => {\n      const artifactData_ = deepClone(artifactData)\n      artifactData_.sets = artSet\n      setArtifactData(artifactData_)\n    },\n    [artifactData, setArtifactData]\n  )\n\n  return (\n    <Stack spacing={1}>\n      <CardLight sx={{ p: 1 }}>\n        <Stack spacing={1}>\n          {allArtifactSlotKeys.map((s) => (\n            <ArtifactMainLevelSlot\n              key={s}\n              slotKey={s}\n              slot={artifactData.slots[s]}\n              setSlot={setSlot(s)}\n            />\n          ))}\n        </Stack>\n      </CardLight>\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={200} />}\n      >\n        <ArtifactSetsEditor artSet={artifactData.sets} setArtSet={setArtSet} />\n      </Suspense>\n    </Stack>\n  )\n}\nfunction ArtifactMainLevelSlot({\n  slotKey,\n  slot,\n  setSlot: setSlotProp,\n}: {\n  slotKey: ArtifactSlotKey\n  slot: ICharTCArtifactSlot\n  setSlot: (s: ICharTCArtifactSlot) => void\n}) {\n  const { level, statKey, rarity } = slot\n  const keys = Artifact.slotMainStats(slotKey)\n  const setSlot = useCallback(\n    (action: Partial<ICharTCArtifactSlot>) => {\n      setSlotProp({ ...slot, ...action })\n    },\n    [slot, setSlotProp]\n  )\n  const setRarity = useCallback(\n    (r: ArtifactRarity) => {\n      const mLvl = maxArtifactLevel[r] ?? 0\n      if (level > mLvl) setSlot({ rarity: r, level: mLvl })\n      else setSlot({ rarity: r })\n    },\n    [level, setSlot]\n  )\n\n  return (\n    <Box\n      display=\"flex\"\n      gap={1}\n      justifyContent=\"space-between\"\n      alignItems=\"center\"\n    >\n      <SlotIcon slotKey={slotKey} />\n      <CardDark\n        sx={{ height: '100%', minWidth: '5em', flexGrow: 1, display: 'flex' }}\n      >\n        {keys.length === 1 ? (\n          <Box\n            p={1}\n            justifyContent=\"center\"\n            alignItems=\"center\"\n            width=\"100%\"\n            display=\"flex\"\n            gap={1}\n          >\n            <StatIcon statKey={keys[0]} iconProps={iconInlineProps} />{' '}\n            {KeyMap.getStr(keys[0])}\n          </Box>\n        ) : (\n          <DropdownButton\n            sx={{ px: 0 }}\n            fullWidth\n            title={<StatWithUnit statKey={statKey} />}\n            color={KeyMap.getVariant(statKey) ?? 'success'}\n          >\n            {keys.map((msk) => (\n              <MenuItem\n                key={msk}\n                disabled={statKey === msk}\n                onClick={() => setSlot({ statKey: msk })}\n              >\n                <StatColoredWithUnit statKey={msk} />\n              </MenuItem>\n            ))}\n          </DropdownButton>\n        )}\n      </CardDark>\n      <DropdownButton\n        sx={{ px: 0 }}\n        title={\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n            {rarity} <StarRoundedIcon fontSize=\"inherit\" />\n          </Box>\n        }\n      >\n        {[5, 4, 3].map((r) => (\n          <MenuItem\n            key={r}\n            disabled={rarity === r}\n            onClick={() => setRarity(r as ArtifactRarity)}\n          >\n            <Box sx={{ display: 'flex', alignItems: 'center' }}>\n              {r} <StarRoundedIcon fontSize=\"inherit\" />\n            </Box>\n          </MenuItem>\n        ))}\n      </DropdownButton>\n      <CustomNumberInput\n        startAdornment=\"+\"\n        value={level}\n        color={Artifact.levelVariant(level)}\n        onChange={(l) => l !== undefined && setSlot({ level: l })}\n        sx={{ borderRadius: 1, pl: 1, my: 0, height: '100%' }}\n        inputProps={{ sx: { pl: 0.5, width: '2em' }, max: 20, min: 0 }}\n      />\n      <CardDark sx={{ height: '100%', minWidth: '4em' }}>\n        <Box p={1} textAlign=\"center\">{`${cacheValueString(\n          Artifact.mainStatValue(statKey, rarity, level),\n          KeyMap.unit(statKey)\n        )}${KeyMap.unit(statKey)}`}</Box>\n      </CardDark>\n    </Box>\n  )\n}\n\nfunction ArtifactSetsEditor({\n  artSet,\n  setArtSet,\n}: {\n  artSet: ISet\n  setArtSet(artSet: ISet)\n}) {\n  const setSet = useCallback(\n    (setKey: ArtifactSetKey | '') => {\n      if (!setKey) return\n      setArtSet({\n        ...artSet,\n        [setKey]: parseInt(Object.keys(getArtSheet(setKey).setEffects)[0]),\n      })\n    },\n    [artSet, setArtSet]\n  )\n\n  const setValue = useCallback(\n    (setKey: ArtifactSetKey) => (value: 1 | 2 | 4) =>\n      setArtSet({ ...artSet, [setKey]: value }),\n    [artSet, setArtSet]\n  )\n  const deleteValue = useCallback(\n    (setKey: ArtifactSetKey) => () => {\n      const { [setKey]: _, ...rest } = artSet\n      setArtSet({ ...rest })\n    },\n    [artSet, setArtSet]\n  )\n\n  const remaining = 5 - Object.values(artSet).reduce((a, b) => a + b, 0)\n\n  return (\n    <Stack spacing={1} sx={{ flexGrow: 1 }}>\n      {Object.entries(artSet).map(([setKey, value]) => (\n        <ArtifactSetEditor\n          key={setKey}\n          setKey={setKey}\n          value={value}\n          setValue={setValue(setKey)}\n          deleteValue={deleteValue(setKey)}\n          remaining={remaining}\n        />\n      ))}\n      <CardLight sx={{ flexGrow: 1, overflow: 'visible' }}>\n        <ArtifactSetAutocomplete\n          artSetKey={''}\n          setArtSetKey={setSet}\n          label={'New Artifact Set'}\n          getOptionDisabled={({ key }) =>\n            Object.keys(artSet).includes(key as ArtifactSetKey) ||\n            !key ||\n            Object.keys(getArtSheet(key).setEffects).every(\n              (n) => parseInt(n) > remaining\n            )\n          }\n        />\n      </CardLight>\n    </Stack>\n  )\n}\nfunction ArtifactSetEditor({\n  setKey,\n  value,\n  setValue,\n  deleteValue,\n  remaining,\n}: {\n  setKey: ArtifactSetKey\n  value: 1 | 2 | 4\n  setValue: (v: 1 | 2 | 4) => void\n  deleteValue: () => void\n  remaining: number\n}) {\n  const artifactSheet = getArtSheet(setKey)\n\n  /* Assumes that all conditionals are from 4-Set. needs to change if there are 2-Set conditionals */\n  const set4CondNums = useMemo(() => {\n    if (value < 4) return []\n    return Object.keys(artifactSheet.setEffects).filter((setNumKey) =>\n      artifactSheet.setEffects[setNumKey]?.document.some(\n        (doc) => 'states' in doc\n      )\n    )\n  }, [artifactSheet, value])\n\n  return (\n    <CardLight>\n      <Box display=\"flex\">\n        <ArtifactSetTooltip artifactSheet={artifactSheet} numInSet={value}>\n          <Box flexGrow={1} p={1} display=\"flex\" gap={1} alignItems=\"center\">\n            <ImgIcon size={2} src={artifactDefIcon(setKey)} />\n            <Box>{artifactSheet.setName}</Box>\n            <Info />\n          </Box>\n        </ArtifactSetTooltip>\n        <ButtonGroup>\n          <DropdownButton\n            size=\"small\"\n            title={<Box whiteSpace=\"nowrap\">{value}-set</Box>}\n          >\n            {Object.keys(artifactSheet.setEffects)\n              .map((setKey) => parseInt(setKey))\n              .map((setKey) => (\n                <MenuItem\n                  key={setKey}\n                  disabled={value === setKey || setKey > remaining + value}\n                  onClick={() => setValue(setKey as 1 | 2 | 4)}\n                >\n                  {setKey}-set\n                </MenuItem>\n              ))}\n          </DropdownButton>\n          <Button color=\"error\" size=\"small\" onClick={deleteValue}>\n            <DeleteForever />\n          </Button>\n        </ButtonGroup>\n      </Box>\n      {!!set4CondNums.length && (\n        <Stack spacing={1} sx={{ p: 1 }}>\n          {set4CondNums.map((setNumKey) => (\n            <SetEffectDisplay\n              key={setNumKey}\n              setKey={setKey}\n              setNumKey={parseInt(setNumKey) as SetNum}\n              hideHeader\n              conditionalsOnly\n            />\n          ))}\n        </Stack>\n      )}\n    </CardLight>\n  )\n}\nfunction ArtifactSubCard({\n  substats,\n  setSubstats,\n  substatsType,\n  setSubstatsType,\n  mainStatKeys,\n}: {\n  substats: Record<SubstatKey, number>\n  setSubstats: (substats: Record<SubstatKey, number>) => void\n  substatsType: SubstatType\n  setSubstatsType: (t: SubstatType) => void\n  mainStatKeys: MainStatKey[]\n}) {\n  const setValue = useCallback(\n    (key: SubstatKey) => (v: number) => setSubstats({ ...substats, [key]: v }),\n    [substats, setSubstats]\n  )\n  const { t } = useTranslation('page_character')\n  const rv =\n    Object.entries(substats).reduce(\n      (t, [k, v]) => t + v / Artifact.substatValue(k),\n      0\n    ) * 100\n  const rolls = Object.entries(substats).reduce(\n    (t, [k, v]) => t + v / Artifact.substatValue(k, undefined, substatsType),\n    0\n  )\n  return (\n    <CardLight sx={{ p: 1, height: '100%' }}>\n      <Box sx={{ mb: 1, display: 'flex', gap: 1 }}>\n        <DropdownButton\n          fullWidth\n          title={t(`tabTheorycraft.substatType.${substatsType}`)}\n        >\n          {substatType.map((st) => (\n            <MenuItem\n              key={st}\n              disabled={substatsType === st}\n              onClick={() => setSubstatsType(st)}\n            >\n              {t(`tabTheorycraft.substatType.${st}`)}\n            </MenuItem>\n          ))}\n        </DropdownButton>\n        <BootstrapTooltip\n          title={<Typography>{t`tabTheorycraft.maxTotalRolls`}</Typography>}\n          placement=\"top\"\n        >\n          <CardDark\n            sx={{\n              textAlign: 'center',\n              py: 0.5,\n              px: 1,\n              minWidth: '15em',\n              whiteSpace: 'nowrap',\n              display: 'flex',\n              gap: 2,\n              justifyContent: 'flex-end',\n              alignItems: 'center',\n            }}\n          >\n            <ColorText color={rolls > 45 ? 'warning' : undefined}>\n              Rolls: <strong>{rolls.toFixed(0)}</strong>\n            </ColorText>\n            <ColorText color={rolls > 45 ? 'warning' : undefined}>\n              RV: <strong>{rv.toFixed(1)}%</strong>\n            </ColorText>\n          </CardDark>\n        </BootstrapTooltip>\n      </Box>\n      <Stack spacing={1}>\n        {Object.entries(substats).map(([k, v]) => (\n          <ArtifactSubstatEditor\n            key={k}\n            statKey={k}\n            value={v}\n            setValue={setValue(k)}\n            substatsType={substatsType}\n            mainStatKeys={mainStatKeys}\n          />\n        ))}\n      </Stack>\n    </CardLight>\n  )\n}\nfunction ArtifactSubstatEditor({\n  statKey,\n  value,\n  setValue,\n  substatsType,\n  mainStatKeys,\n}: {\n  statKey: SubstatKey\n  value: number\n  setValue: (v: number) => void\n  substatsType: SubstatType\n  mainStatKeys: MainStatKey[]\n}) {\n  const { t } = useTranslation('page_character')\n  const substatValue = Artifact.substatValue(statKey, 5, substatsType)\n  const [rolls, setRolls] = useState(() => value / substatValue)\n  useEffect(() => setRolls(value / substatValue), [value, substatValue])\n\n  const unit = KeyMap.unit(statKey)\n  const displayValue = rolls * substatValue\n\n  const rv = ((rolls * substatValue) / Artifact.substatValue(statKey)) * 100\n  const numMains = mainStatKeys.reduce(\n    (t, ms) => t + (ms === statKey ? 1 : 0),\n    0\n  )\n  const maxRolls = (5 - numMains) * 6\n  // 0.0001 to nudge float comparasion\n  const invalid = rolls - 0.0001 > maxRolls\n  const setRValue = useCallback(\n    (r: number) => setValue(r * substatValue),\n    [setValue, substatValue]\n  )\n\n  return (\n    <Stack spacing={0.5}>\n      <Box\n        display=\"flex\"\n        gap={1}\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n      >\n        <CardDark\n          sx={{\n            p: 0.5,\n            minWidth: '11em',\n            flexGrow: 1,\n            display: 'flex',\n            gap: 1,\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <StatIcon statKey={statKey} iconProps={{ fontSize: 'inherit' }} />\n          {KeyMap.getStr(statKey)}\n          {KeyMap.unit(statKey)}\n        </CardDark>\n        <BootstrapTooltip\n          title={\n            <Typography>\n              {t(\n                numMains\n                  ? `tabTheorycraft.maxRollsMain`\n                  : `tabTheorycraft.maxRolls`,\n                { value: maxRolls }\n              )}\n            </Typography>\n          }\n          placement=\"top\"\n        >\n          <CardDark sx={{ textAlign: 'center', p: 0.5, minWidth: '8em' }}>\n            <ColorText color={invalid ? 'warning' : undefined}>\n              RV: <strong>{rv.toFixed(1)}%</strong>\n            </ColorText>\n          </CardDark>\n        </BootstrapTooltip>\n      </Box>\n      <Box\n        display=\"flex\"\n        gap={1}\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n      >\n        <CustomNumberInput\n          color={displayValue ? 'success' : 'primary'}\n          float={KeyMap.unit(statKey) === '%'}\n          endAdornment={\n            KeyMap.unit(statKey) || <Box width=\"1em\" component=\"span\" />\n          }\n          value={parseFloat(displayValue.toFixed(2))}\n          onChange={(v) => v !== undefined && setValue(v)}\n          sx={{ borderRadius: 1, px: 1, height: '100%', width: '6em' }}\n          inputProps={{ sx: { textAlign: 'right' }, min: 0 }}\n        />\n        <CardDark\n          sx={{\n            px: 2,\n            flexGrow: 1,\n            display: 'flex',\n            gap: 1,\n            alignItems: 'center',\n            justifyContent: 'center',\n            overflow: 'visible',\n          }}\n        >\n          <Slider\n            size=\"small\"\n            value={rolls}\n            max={maxRolls}\n            min={0}\n            step={1}\n            marks\n            valueLabelDisplay=\"auto\"\n            onChange={(e, v) => setRolls(v as number)}\n            onChangeCommitted={(e, v) => setRValue(v as number)}\n          />\n        </CardDark>\n        <CustomNumberInput\n          color={value ? (invalid ? 'warning' : 'success') : 'primary'}\n          float\n          startAdornment={\n            <Box\n              sx={{\n                whiteSpace: 'nowrap',\n                width: '7em',\n                display: 'flex',\n                justifyContent: 'space-between',\n              }}\n            >\n              <span>\n                {cacheValueString(substatValue, unit)}\n                {unit}\n              </span>\n              <span>x</span>\n            </Box>\n          }\n          value={parseFloat(rolls.toFixed(2))}\n          onChange={(v) => v !== undefined && setValue(v * substatValue)}\n          sx={{ borderRadius: 1, px: 1, my: 0, height: '100%', width: '7em' }}\n          inputProps={{ sx: { textAlign: 'right', pr: 0.5 }, min: 0, step: 1 }}\n        />\n      </Box>\n    </Stack>\n  )\n}\n","import { useContext, useEffect, useState } from 'react'\nimport { DatabaseContext } from '../../../../Database/Database'\nimport type { CharacterKey, WeaponKey } from '../../../../Types/consts'\n\nexport default function useCharTC(\n  characterKey: CharacterKey,\n  defWeapon: WeaponKey\n) {\n  const { database } = useContext(DatabaseContext)\n  const [charTC, setCharTC] = useState(() =>\n    database.charTCs.getWithInit(characterKey, defWeapon)\n  )\n  useEffect(\n    () => setCharTC(database.charTCs.getWithInit(characterKey, defWeapon)),\n    [database, characterKey, defWeapon]\n  )\n  useEffect(\n    () =>\n      characterKey\n        ? database.charTCs.follow(\n            characterKey,\n            (k, r, v) => r === 'update' && setCharTC(v)\n          )\n        : undefined,\n    [characterKey, setCharTC, database]\n  )\n  return charTC\n}\n","import type { TravelerKey } from '@genshin-optimizer/consts'\nimport { allElementKeys } from '@genshin-optimizer/consts'\nimport { MenuItem } from '@mui/material'\nimport { useContext } from 'react'\nimport ColorText from '../../Components/ColoredText'\nimport DropdownButton from '../../Components/DropdownMenu/DropdownButton'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport { stg } from '../../Data/SheetUtil'\nimport useCharSelectionCallback from '../../ReactHooks/useCharSelectionCallback'\nimport { travelerElements, TravelerToElement } from '../../Types/consts'\n\nexport default function TravelerElementSelect() {\n  const { character } = useContext(CharacterContext)\n  const { key } = character\n  const setCharacter = useCharSelectionCallback()\n  if (!key.startsWith('Traveler')) return null\n\n  const elementKey = allElementKeys.find((e) => key.toLowerCase().includes(e))\n  if (!elementKey) return null\n\n  return (\n    <DropdownButton\n      color={elementKey}\n      title={<strong>{stg(`element.${elementKey}`)}</strong>}\n    >\n      {travelerElements.map((eleKey) => (\n        <MenuItem\n          key={eleKey}\n          selected={elementKey === eleKey}\n          disabled={elementKey === eleKey}\n          onClick={() =>\n            setCharacter(TravelerToElement(key as TravelerKey, eleKey))\n          }\n        >\n          <strong>\n            <ColorText color={eleKey}>{stg(`element.${eleKey}`)}</ColorText>\n          </strong>\n        </MenuItem>\n      ))}\n    </DropdownButton>\n  )\n}\n","import { Female, Male } from '@mui/icons-material'\nimport { Button } from '@mui/material'\nimport { useCallback, useContext } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport { DatabaseContext } from '../../Database/Database'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\n\nexport default function TravelerGenderSelect() {\n  const { t } = useTranslation('ui')\n  const { database } = useContext(DatabaseContext)\n  const { character } = useContext(CharacterContext)\n  const { key } = character\n  const { gender } = useDBMeta()\n  const toggleGender = useCallback(\n    () => database.dbMeta.set({ gender: gender === 'F' ? 'M' : 'F' }),\n    [gender, database]\n  )\n  if (!key.startsWith('Traveler')) return null\n  return (\n    <Button\n      onClick={toggleGender}\n      startIcon={gender === 'F' ? <Female /> : <Male />}\n    >\n      <strong>{t(`gender.${gender}`)}</strong>{' '}\n    </Button>\n  )\n}\n","import type { CharacterKey } from '@genshin-optimizer/consts'\nimport {\n  BarChart,\n  Calculate,\n  FactCheck,\n  Groups,\n  Person,\n  Science,\n  TrendingUp,\n} from '@mui/icons-material'\nimport { Box, Button, CardContent, Skeleton, Tab, Tabs } from '@mui/material'\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport { useTranslation } from 'react-i18next'\nimport {\n  Link as RouterLink,\n  Navigate,\n  Route,\n  Routes,\n  useMatch,\n  useNavigate,\n  useParams,\n} from 'react-router-dom'\nimport CardDark from '../../Components/Card/CardDark'\nimport CardLight from '../../Components/Card/CardLight'\nimport CloseButton from '../../Components/CloseButton'\nimport {\n  HitModeToggle,\n  InfusionAuraDropdown,\n  ReactionToggle,\n} from '../../Components/HitModeEditor'\nimport LevelSelect from '../../Components/LevelSelect'\nimport SqBadge from '../../Components/SqBadge'\nimport type { CharacterContextObj } from '../../Context/CharacterContext'\nimport { CharacterContext } from '../../Context/CharacterContext'\nimport type { dataContextObj } from '../../Context/DataContext'\nimport { DataContext } from '../../Context/DataContext'\nimport {\n  FormulaDataContext,\n  FormulaDataWrapper,\n} from '../../Context/FormulaDataContext'\nimport type { ChartData, GraphContextObj } from '../../Context/GraphContext'\nimport { GraphContext } from '../../Context/GraphContext'\nimport { getCharSheet } from '../../Data/Characters'\nimport { DatabaseContext } from '../../Database/Database'\nimport useBoolState from '../../ReactHooks/useBoolState'\nimport useCharacter from '../../ReactHooks/useCharacter'\nimport useCharacterReducer from '../../ReactHooks/useCharacterReducer'\nimport useDBMeta from '../../ReactHooks/useDBMeta'\nimport useTeamData from '../../ReactHooks/useTeamData'\nimport useTitle from '../../ReactHooks/useTitle'\nimport { charKeyToCharName } from '../../Types/consts'\nimport { CustomMultiTargetButton } from '../CustomMultiTarget'\nimport CharSelectButton from './CharSelectButton'\nimport FormulaModal from './FormulaModal'\nimport StatModal from './StatModal'\nimport TabBuild from './Tabs/TabOptimize'\nimport TabOverview from './Tabs/TabOverview'\nimport TabTalent from './Tabs/TabTalent'\nimport TabTeambuffs from './Tabs/TabTeambuffs'\nimport TabTheorycraft from './Tabs/TabTheorycraft'\nimport TravelerElementSelect from './TravelerElementSelect'\nimport TravelerGenderSelect from './TravelerGenderSelect'\n\nexport default function CharacterDisplay() {\n  const navigate = useNavigate()\n  const { database } = useContext(DatabaseContext)\n  const onClose = useCallback(() => navigate('/characters'), [navigate])\n  const { characterKey } = useParams<{ characterKey?: CharacterKey }>()\n  const invalidKey = !database.chars.keys.includes(characterKey as CharacterKey)\n  if (invalidKey) return <Navigate to=\"/characters\" />\n\n  return (\n    <Box my={1} display=\"flex\" flexDirection=\"column\" gap={1}>\n      <Suspense\n        fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={1000} />}\n      >\n        {characterKey && (\n          <CharacterDisplayCard characterKey={characterKey} onClose={onClose} />\n        )}\n      </Suspense>\n    </Box>\n  )\n}\n\ntype CharacterDisplayCardProps = {\n  characterKey: CharacterKey\n  onClose?: () => void\n}\nfunction CharacterDisplayCard({\n  characterKey,\n  onClose,\n}: CharacterDisplayCardProps) {\n  const character = useCharacter(characterKey)\n  const { gender } = useDBMeta()\n  const characterSheet = getCharSheet(characterKey, gender)\n  const teamData = useTeamData(characterKey)\n  const { target: charUIData } = teamData?.[characterKey] ?? {}\n  const {\n    params: { tab = 'overview' },\n  } = useMatch({ path: '/characters/:charKey/:tab', end: false }) ?? {\n    params: { tab: 'overview' },\n  }\n  const { t } = useTranslation(['charNames_gen', 'page_character'])\n\n  useTitle(\n    useMemo(\n      () =>\n        `${t(`charNames_gen:${charKeyToCharName(characterKey, gender)}`)} - ${t(\n          `page_character:tabs.${tab}`\n        )}`,\n      [t, characterKey, gender, tab]\n    )\n  )\n\n  const characterDispatch = useCharacterReducer(character?.key ?? '')\n\n  const dataContextValue: dataContextObj | undefined = useMemo(() => {\n    if (!teamData || !charUIData) return undefined\n    return {\n      data: charUIData,\n      teamData,\n      oldData: undefined,\n    }\n  }, [charUIData, teamData])\n\n  const characterContextValue: CharacterContextObj | undefined = useMemo(() => {\n    if (!character || !characterSheet) return undefined\n    return {\n      character,\n      characterSheet,\n      characterDispatch,\n    }\n  }, [character, characterSheet, characterDispatch])\n\n  const [chartData, setChartData] = useState(undefined as ChartData | undefined)\n  const [graphBuilds, setGraphBuilds] = useState<string[][]>()\n  const graphContextValue: GraphContextObj | undefined = useMemo(() => {\n    return {\n      chartData,\n      setChartData,\n      graphBuilds,\n      setGraphBuilds,\n    }\n  }, [chartData, graphBuilds])\n\n  // Clear state when switching characters\n  useEffect(() => {\n    setChartData(undefined)\n    setGraphBuilds(undefined)\n  }, [characterKey])\n\n  return (\n    <CardDark>\n      {dataContextValue && characterContextValue && graphContextValue ? (\n        <CharacterContext.Provider value={characterContextValue}>\n          <DataContext.Provider value={dataContextValue}>\n            <GraphContext.Provider value={graphContextValue}>\n              <FormulaDataWrapper>\n                <CardContent\n                  sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}\n                >\n                  <Box display=\"flex\">\n                    <Box display=\"flex\" gap={1} flexWrap=\"wrap\" flexGrow={1}>\n                      <CharSelectButton />\n                      <TravelerElementSelect />\n                      <TravelerGenderSelect />\n                      <DetailStatButton />\n                      <CustomMultiTargetButton />\n                      <FormulasButton />\n                    </Box>\n                    {!!onClose && <CloseButton onClick={onClose} />}\n                  </Box>\n                  <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                    {character && (\n                      <LevelSelect\n                        level={character.level}\n                        ascension={character.ascension}\n                        setBoth={characterDispatch}\n                      />\n                    )}\n                    <HitModeToggle size=\"small\" />\n                    <InfusionAuraDropdown />\n                    <ReactionToggle size=\"small\" />\n                  </Box>\n                  <CardLight>\n                    <TabNav tab={tab} />\n                  </CardLight>\n                  <CharacterPanel />\n                  <CardLight>\n                    <TabNav tab={tab} />\n                  </CardLight>\n                </CardContent>\n              </FormulaDataWrapper>\n            </GraphContext.Provider>\n          </DataContext.Provider>\n        </CharacterContext.Provider>\n      ) : (\n        <Skeleton variant=\"rectangular\" width=\"100%\" height={1000} />\n      )}\n    </CardDark>\n  )\n}\nfunction CharacterPanel() {\n  return (\n    <Suspense\n      fallback={<Skeleton variant=\"rectangular\" width=\"100%\" height={500} />}\n    >\n      <Routes>\n        {/* Character Panel */}\n        <Route index element={<TabOverview />} />\n        <Route path=\"/talent\" element={<TabTalent />} />\n        <Route path=\"/teambuffs\" element={<TabTeambuffs />} />\n        <Route path=\"/optimize\" element={<TabBuild />} />\n        <Route path=\"/theorycraft\" element={<TabTheorycraft />} />\n      </Routes>\n    </Suspense>\n  )\n}\nfunction TabNav({ tab }: { tab: string }) {\n  const { t } = useTranslation('page_character')\n  return (\n    <Tabs\n      value={tab}\n      variant=\"scrollable\"\n      allowScrollButtonsMobile\n      sx={{\n        '& .MuiTab-root:hover': {\n          transition: 'background-color 0.25s ease',\n          backgroundColor: 'rgba(255,255,255,0.1)',\n        },\n      }}\n    >\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"overview\"\n        label={t('tabs.overview')}\n        icon={<Person />}\n        component={RouterLink}\n        to=\"\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"talent\"\n        label={t('tabs.talent')}\n        icon={<FactCheck />}\n        component={RouterLink}\n        to=\"talent\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"teambuffs\"\n        label={t('tabs.teambuffs')}\n        icon={<Groups />}\n        component={RouterLink}\n        to=\"teambuffs\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"optimize\"\n        label={t('tabs.optimize')}\n        icon={<TrendingUp />}\n        component={RouterLink}\n        to=\"optimize\"\n      />\n      <Tab\n        sx={{ minWidth: '20%' }}\n        value=\"theorycraft\"\n        label={t('tabs.theorycraft')}\n        icon={<Science />}\n        component={RouterLink}\n        to=\"theorycraft\"\n      />\n    </Tabs>\n  )\n}\n\nfunction DetailStatButton() {\n  const { t } = useTranslation('page_character')\n  const [open, onOpen, onClose] = useBoolState()\n  const {\n    character: { bonusStats },\n  } = useContext(CharacterContext)\n  const bStatsNum = Object.keys(bonusStats).length\n  return (\n    <>\n      <Button color=\"info\" startIcon={<BarChart />} onClick={onOpen}>\n        {t`addStats.title`}\n        {!!bStatsNum && (\n          <SqBadge sx={{ ml: 1 }} color=\"success\">\n            {bStatsNum}\n          </SqBadge>\n        )}\n      </Button>\n      <StatModal open={open} onClose={onClose} />\n    </>\n  )\n}\nfunction FormulasButton() {\n  const { onModalOpen } = useContext(FormulaDataContext)\n  return (\n    <>\n      <Button color=\"info\" startIcon={<Calculate />} onClick={onModalOpen}>\n        Formulas {'&'} Calcs\n      </Button>\n      <FormulaModal />\n    </>\n  )\n}\n","import { useMediaQuery, useTheme } from '@mui/material'\n\nexport default function useMediaQueryUp() {\n  const theme = useTheme()\n  const sm = useMediaQuery(theme.breakpoints.up('sm'))\n  const md = useMediaQuery(theme.breakpoints.up('md'))\n  const lg = useMediaQuery(theme.breakpoints.up('lg'))\n  const xl = useMediaQuery(theme.breakpoints.up('xl'))\n  if (xl) return 'xl'\n  if (lg) return 'lg'\n  if (md) return 'md'\n  if (sm) return 'sm'\n  return 'xs'\n}\n","import { toggleArr } from './Util'\n\nexport function handleMultiSelect<T>(allKeys: T[]) {\n  return (arr: T[], v: T): T[] => {\n    const len = arr.length\n    if (len === allKeys.length) return [v]\n    if (len === 1 && arr[0] === v) return [...allKeys]\n    return [...new Set(toggleArr(arr, v))]\n  }\n}\n","type SortConfig<T> = (id: T) => number | string\nexport type SortConfigs<Keys extends string, T> = Record<Keys, SortConfig<T>>\n\nexport function sortFunction<Keys extends string, T>(\n  sortbyKeys: Keys[],\n  ascending: boolean,\n  configs: SortConfigs<Keys, T>,\n  ascendingBypass: Keys[] = []\n) {\n  return (a: T, b: T): number => {\n    for (const sortby of sortbyKeys) {\n      let diff = 0\n      const config = configs[sortby]\n      const aV = config(a)\n      const bV = config(b)\n      if (typeof aV === 'string' && typeof bV === 'string')\n        diff = aV.localeCompare(bV)\n      else diff = (bV as number) - (aV as number)\n      if (diff !== 0)\n        return ascendingBypass.includes(sortby)\n          ? diff\n          : (ascending ? -1 : 1) * diff\n    }\n    return 0\n  }\n}\n\ntype FilterConfig<T> = (\n  obj: T,\n  filter: any,\n  filters: { [str: string]: any }\n) => boolean\nexport type FilterConfigs<Keys extends string, T> = Record<\n  Keys,\n  FilterConfig<T>\n>\nexport function filterFunction<Keys extends string, T>(\n  filterOptions: Partial<Record<Keys, any>>,\n  filterConfigs: FilterConfigs<Keys, T>\n) {\n  return (obj: T) =>\n    Object.entries(filterOptions).every(\n      ([optionKey, optionVal]) =>\n        filterConfigs[optionKey as any] &&\n        filterConfigs[optionKey as any](obj, optionVal, filterOptions)\n    )\n}\n"],"names":["styled","theme","display","width","height","lineHeight","verticalAlign","marginTop","spacing","marginLeft","marginRight","marginBottom","ConditionalWrapper","condition","wrapper","falseWrapper","children","StarsDisplay","stars","colored","inline","color","undefined","Array","keys","map","_","i","fontSize","sx","GraphContext","createContext","CharacterSelectionModal","React","CharSelectButton","useTranslation","characterSheet","character","key","characterKey","useContext","CharacterContext","showModal","setshowModal","useState","gender","useDBMeta","setCharacter","useCharSelectionCallback","Suspense","fallback","show","onHide","onSelect","Button","onClick","startIcon","ThumbSide","src","characterAsset","name","t","FormulaModal","modalOpen","FormulaDataContext","setFormulaData","onCloseHandler","useCallback","ModalWrapper","open","onClose","CardDark","CardHeader","title","action","CloseButton","CardContent","pt","CalculationDisplay","data","DataContext","contextData","sections","getDisplaySections","Skeleton","variant","Box","mr","mb","Nodes","FormulaCalc","displayNs","sectionKey","database","DatabaseContext","header","useMemo","getDisplayHeader","Object","entries","every","node","isEmpty","icon","CardLight","CardHeaderCustom","avatar","ImgIcon","size","SqBadge","Divider","FormulaAccordian","contextNode","expanded","setExpanded","handleChange","e","isExpanded","scrollRef","useRef","useEffect","setTimeout","current","scrollIntoView","behavior","Accordion","bgcolor","onChange","ref","AccordionSummary","expandIcon","ExpandMore","Typography","info","nodeVStr","allAmpReactions","ml","AmpReactionModeText","reaction","trigger","subVariant","AccordionDetails","formulas","subform","component","props","other","IconButton","expand","transform","transition","transitions","create","duration","shortest","FlexButtonGroup","ButtonGroup","StatInput","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset","restProps","TextButton","px","CustomNumberInput","flexBasis","flexGrow","inputProps","textAlign","float","endAdornment","flexShrink","Replay","EnemyExpandCard","characterDispatch","setexpanded","toggle","eLvlNode","get","input","eDefRed","eDefIgn","enemyOverride","gap","alignItems","flexWrap","Chip","label","allElementWithPhyKeys","element","EnemyResText","justifyContent","Collapse","in","timeout","unmountOnExit","EnemyEditor","immune","isFinite","ele","iconProps","iconInlineProps","content","bsProps","xs","md","eLvl","enemyLevel","enemyDefIgn_","enemyDefRed_","Grid","container","item","fullWidth","href","target","rel","palette","contentLight","main","KeyMap","type","statKey","eleKey","val","elementImmunity","Number","MAX_VALUE","Infinity","CheckBox","CheckBoxOutlineBlank","cols","lg","StatModal","Stack","BonusStatsEditor","MainStatsCards","allInputPremodKeys","wrapperFunc","bonusStats","setFilter","columns","Alert","severity","i18nKey","StatEditorList","statKeys","statFilters","setStatFilters","mainSubKeys","mainReadNodes","k","mainEditKeys","otherStatKeys","allEleDmgKeys","allEleResKeys","miscStatkeys","includes","StatDisplayContent","nodes","extra","oldData","FieldDisplay","rn","ListItem","oldValue","JSON","stringify","specialNode","charEle","elementKey","isMelee","otherStatReadNodes","filter","n","miscStatReadNodes","StatDisplayCard","length","py","OptimizationTargetContext","reaffine","arts","forceRename","affineNodes","Set","topLevelAffine","visit","isAffine","add","operands","forEach","op","has","dynKeys","forEachNodes","f","operation","path","nonConst","assertUnreachable","base","nextDynKey","affine","affineMap","Map","customRead","accu","reaffineArt","stat","values","constantFold","dyn","objectMap","constant","fromEntries","v","result","mapFormulas","objectKeyMap","allSlotKeys","slot","id","set","offsets","baseValue","pruneOrder","numTop","exclusion","progress","allowRainbow","rainbow","noSwitchIn","noSwitchOut","list","newList","art","count","otherBetterEqual","otherMaybeBetter","some","otherBetter","canSwitch","pruneArtRange","minimum","baseRange","x","min","max","wrap","artRanges","computeArtRange","otherArtRanges","addArtRange","a","read","newRange","computeNodeRange","pruneNodeRange","nodeRange","operandRanges","threshold","pass","fail","newOperands","op1","op2","ranges","range","reads","Error","computeMinMax","allOperations","reduce","c","sum","NaN","minMaxes","Math","FIFO","head","tail","this","push","pop","reverse","WorkerCoordinator","constructor","workers","prio","callback","commands","workDone","_workers","cancel","cancelled","notifyNonEmpty","p","worker","onmessage","onMessage","onerror","onError","w","Promise","resolve","rej","catch","terminate","async","processingInput","command","find","hasCommand","race","res","all","then","postMessage","message","msg","resultType","broadcast","notifiedBroadcast","GOSolver","problem","status","numWorker","super","fill","Worker","URL","r","interim","finalizedResults","total","maxIterateSize","topN","buildValues","preprocess","execute","plotBase","optimizationTarget","constraints","minimums","maxValues","thres","pruneExclusion","forced","should","deps","newArts","newNodes","pruneAll","optimize","optTarget","tested","failed","skipped","oldThreshold","sort","b","splice","useBuildSetting","buildSetting","setBuildSetting","buildSettings","follow","buildSettingDispatch","CharListMode","AllowChar","allowListTotal","t_pc","excludedLocations","allowLocationsState","onOpen","useBoolState","dbDirty","forceUpdate","useForceUpdate","deferredDbDirty","useDeferredValue","searchTerm","setSearchTerm","deferredSearchTerm","elementKeys","setElementKeys","allElementKeys","deferredElementKeys","weaponTypeKeys","setWeaponTypeKeys","allWeaponTypeKeys","deferredWeaponTypeKeys","charKeyMap","from","chars","ck","filterFunction","weaponType","characterFilterConfigs","locList","ck1","c1","ck2","c2","choosec1","choosec2","c1f","charMeta","favorite","c2f","art1","equippedArtifacts","art2","localeCompare","charKeyToLocCharKey","elementTotals","weaponTypeTotals","locListTotals","catKeys","bulkCatTotal","ctMap","sheet","getCharSheet","weaponTypeKey","locKey","allowed","excluded","followAny","mouseUpDetected","setMouseUpDetected","allowAll","disallowAll","concat","setState","_e","state","toggleList","lkList","lkArray","newExcludedLocations","lk","onMouseUp","useTot","charactersAllowed","stateBadgeColor","containerProps","maxWidth","draggable","InfoTooltip","pb","SolidToggleButtonGroup","exclusive","baseColor","allAllowLocationsState","s","ToggleButton","TextField","autoFocus","InputProps","WeaponToggle","totals","ElementToggle","opacity","SelectItemGrid","ShowChart","borderRadius","minWidth","Settings","charList","setCharList","charListMode","setCharListMode","sm","xl","SelectItem","selected","char","LocationToCharacterKey","onMouseEnter","buttons","ToggleToAllow","ToggleToExclude","onMouseDown","mode","disableTooltip","borderColor","borderWidth","borderStyle","allArtifactSlotKeys","SlotIcon","slotKey","CharacterCardPico","SetEffectDisplay","setKey","setNumKey","hideHeader","conditionalsOnly","getArtSheet","document","setEffectDocument","section","flexDirection","DocumentDisplay","ArtifactSetConfig","dataContext","conditional","artSetExclusion","setOpen","artKeysByRarity","setKeysByRarities","flatMap","sets","artKeys","artSlotCount","getNumSlots","allowRainbow2","allowRainbow4","allowTotals","artifactCondCount","allArtifactSetKeys","fakeDataContextObj","UIData","artSet","resetArtConds","tconditional","setAllExclusion","setnum","exclude","artSetExclusion_","deepClone","Block","AllSetAllowExcludeCard","allowTotal","setNum","gutterBottom","handleArtSetExclusion","endIcon","ArtifactSetCard","slotCount","large","charAt","indexOf","setExclusionSet","allow4","slots","set4CondNums","setEffects","doc","exclude2","exclude4","className","rarity","artifactDefIcon","mx","ns","StarRounded","Translate","key18","paddingTop","parseInt","tot","levels","AssumeFullLevelToggle","mainStatAssumptionLevel","setmainStatAssumptionLevel","DropdownButton","lvl","MenuItem","BonusStatsCard","bonusStatsKeys","fontWeight","Monospace","fontFamily","BorderLinearProgress","LinearProgress","BuildAlert","startTime","finishTime","characterName","hasTotal","generatingBuilds","unskipped","testedString","toLocaleString","unskippedString","skippedText","durationString","timeStringMs","round","performance","now","subtitle","toFixed","LocationIcon","BootstrapTooltip","placement","CharIconSide","sideMargin","StatWithUnit","disableIcon","StatIcon","StatColoredWithUnit","ArtifactCardNano","artifactId","pSlotKey","showLocation","BGComponent","useArtifact","actionWrapperFunc","CardActionArea","useTheme","Assets","level","mainStatKey","substats","location","mainStatLevel","mainStatUnit","alpha","secondary","position","ArtifactTooltip","artifactAsset","m","maxHeight","pointerEvents","Artifact","BusinessCenter","overflow","bottom","backgroundColor","disableInteractive","style","padding","cacheValueString","SubstatDisplay","numRolls","rolls","rollColor","clamp","unit","alignContent","StatDisplayComponent","Masonry","Section","displayNsReads","nodeKey","emphasize","WeaponCardNano","weaponId","weapon","useWeapon","weaponSheet","getWeaponSheet","computeUIData","dataObjForWeapon","refinement","WeaponNameTooltip","weaponAsset","ascension","WeaponSheet","hasRefinement","WeaponStat","ArtifactSetBadges","artifacts","currentlyEquipped","setToSlots","arti","acc","curr","_k1","slotarr1","_k2","slotarr2","slotarr","ArtifactSetBadge","artifactSheet","numInSet","setActive","ArtifactSetTooltip","BuildDisplayItem","compareBuild","extraButtonsRight","extraButtonsLeft","newOld","setNewOld","close","equipBuild","window","confirm","aid","oldAid","weapons","statProviderContext","dataContext_","artifactIdsBySlot","artiId","artNanos","oldId","newId","CompareArtifactModal","Checkroom","onEquip","newLoc","ArtifactCard","canEquip","editorProps","disableSet","disableSlot","extraButtons","ExcludeButton","ChevronRight","ExcludeEquipButton","locationKey","artExclusion","toggleArr","arrow","useBuildResult","buildResult","setBuildResult","buildResultDispatch","CustomDot","cx","cy","payload","selectedPoint","radiusSelected","radiusUnselected","colorSelected","colorUnselected","shape","isSelected","y","CustomShape","stroke","points","CustomTooltip","xLabel","xUnit","yLabel","yUnit","setSelectedPoint","addBuildToList","tooltipProps","artifactsBySlot","artifactIds","artiObj","clickAwayHandler","generLabel","generBuildNumber","graphLabel","graphBuildNumber","active","ClickAwayListener","onClickAway","stopPropagation","direction","ArtifactCardPico","artifactObj","valueString","highlighted","EnhancedPoint","trueY","ChartCard","setPlotBase","showTooltip","chartData","showDownload","setshowDownload","showMin","setshowMin","graphBuilds","builds","generatedBuilds","sliderLow","setSliderLow","sliderHigh","setSliderHigh","setSlider","TypeError","l","h","displayData","downloadData","sliderMin","sliderMax","currentBuild","plot","enhancedDatum","datumBuildMap","isCurrentBuild","aId","console","log","graphBuildIndex","findIndex","build","generBuildIndex","minimumData","point","last","allData","plotBaseNode","objPathValue","getDisplay","buttonText","OptimizationTargetSelector","setTarget","defaultText","Download","ReadOnlyTextArea","Chart","plotNode","valueNode","Slider","marks","onChangeCommitted","step","valueLabelDisplay","valueLabelFormat","optTargetColor","highlightedColor","currentColor","lineColor","setGraphBuilds","chartOnClick","chartX","chartY","clickedX","clickedY","nearestDomPtData","querySelectorAll","domPtA","domPtB","aChartX","aChartY","dataset","aDistance","sqrt","bChartX","bChartY","d","xValue","yValue","getNearestPoint","xLabelValue","getLabelFromNode","yLabelValue","ResponsiveContainer","ComposedChart","cursor","CartesianGrid","strokeDasharray","XAxis","dataKey","scale","domain","tick","tickFormatter","Label","dy","YAxis","allowDecimals","angle","dx","Tooltip","wrapperStyle","Legend","Line","connectNulls","strokeWidth","isAnimationActive","dot","activeDot","Scatter","textSuffix","ExcludeArt","excludedTotal","useExcludedArts","numExcludedArt","showSel","onOpenSel","onCloseSel","onDelSelect","toggleArtExclusion","ArtifactSelectModal","Add","whiteSpace","totalStr","numToShowMap","filterOptionReducer","clickHandler","filterOption","filterOptionDispatch","useReducer","initialFilterOption","brPt","useMediaQueryUp","filterConfigs","artifactFilterConfigs","artIdList","filterFunc","slice","ArtifactFilterDisplay","filteredIds","mt","artifactsSlotsToSelectMainStats","MainStatSelectionCard","filteredArtIdMap","mainStatKeys","mainStatSlotTots","slotTots","flowerMainStatTots","plumeMainStatTots","sandsMainStatTots","gobletMainStatTots","circletMainStatTots","catTotals","flower","plume","sands","goblet","circlet","FlowerIcon","HpIcon","hp","orientation","flexItem","PlumeIcon","AtkIcon","atk","selectedMainKeys","mainKeys","mainKeysHandler","handleMultiSelect","OptimizationTargetEditorList","oldPath","oldIndex","statFilters_","oldPathStr","oldFilterArr","pathStr","filterArr","delTarget","index","setTargetValue","setTargetDisabled","settings","setting","OptimizationTargetEditorItem","parse","setValue","setDisabled","buttonStyle","buildConstraintNode","isPercent","showEmptyTargets","DeleteForever","StatFilterCard","dynamic","setReadNodeKeys","dynamicData","allMainStatKeys","allSubstatKeys","audio","Audio","TabBuild","compareData","setChartData","notification","setnotification","notificationRef","buildStatus","setBuildStatus","artsDirty","setArtsDirty","threads","defThreads","setDisplayOptimize","displayOptimize","_r","to","maxWorkers","setMaxWorkers","useCharacterReducer","onClickTeammate","noArtifact","allowPartial","maxBuildsToShow","levelLow","levelHigh","buildDate","teamData","useTeamData","optimizationTargetNode","isSM","deferredArtsDirty","deferredBuildSetting","filteredArts","mainStats","unequippedStateAndEquippedElsewhere","customListStateAndNotOnList","levelTotal","allStateAndEquippedSomewhereElse","tabFocused","onFocus","onBlur","addEventListener","removeEventListener","cancelToken","throwGlobalError","setError","useGlobalError","generateBuilds","split","mainStatVal","endsWith","substat","accurateValue","compactArtifacts","getTeamData","workerData","uiDataForTeam","assign","mergeData","unoptimizedOptimizationTargetNode","targetNode","valueFilter","filterNode","unoptimizedNodes","plotBaseNumNode","statusUpdateTimer","setInterval","cancellationError","solver","results","solve","plotData","plots","mergePlot","maxNum","mergeBuilds","process","Date","play","alert","clearInterval","targetSelector","getGraphBuildLabel","getNormBuildLabel","Link","RouterLink","CharacterCard","ArtifactLevelSlider","setLow","setHigh","setBoth","maxBuildsToShowList","NotificationsActive","NotificationsOff","Close","TrendingUp","Provider","BuildList","getLabel","setBuilds","deleteBuild","builds_","DataContextWrapper","BuildItemWrapper","join","useLocation","navigate","useNavigate","toTC","paths","pathname","Science","dirty","setDirty","buildsArts","providerValue","tdc","charCards","Albedo","Alhaitham","Aloy","Amber","AratakiItto","Barbara","Beidou","Bennett","Candace","Chongyun","Collei","Cyno","Dehya","Diluc","Diona","Dori","Eula","Faruzan","Fischl","Ganyu","Gorou","HuTao","Jean","KaedeharaKazuha","Kaeya","KamisatoAyaka","KamisatoAyato","Keqing","Klee","KujouSara","KukiShinobu","Layla","Lisa","Mika","Mona","Nahida","Nilou","Ningguang","Noelle","Qiqi","RaidenShogun","Razor","Rosaria","SangonomiyaKokomi","Sayu","Shenhe","ShikanoinHeizou","Sucrose","Tartaglia","Thoma","Tighnari","TravelerF","TravelerM","Venti","Wanderer","Xiangling","Xiao","Xingqiu","Xinyan","YaeMiko","Yanfei","Yaoyao","Yelan","Yoimiya","YunJin","Zhongli","charCard","charKey","CompareBuildButton","artId","onShow","CompareContent","Difference","newArt","artmap","dataProviderValue","lazy","ArtifactSwapModal","onChangeId","slotKeys","disableSlotFilter","rarityHandler","allRarityKeys","WeaponSwapModal","newWeaponModalShow","setnewWeaponModalShow","editWeaponId","setEditWeaponId","newWeapon","weaponKey","new","initialWeapon","resetEditWeapon","setRarity","weaponIdList","weaponFilterConfigs","sortFunction","weaponSortMap","weaponSortConfigs","WeaponSelectionModal","weaponTypeFilter","WeaponEditor","footer","star","WeaponCard","EquipmentSection","equippedWeapon","setweaponId","showWeapon","hideWeapon","breakpoint","useMediaQuery","breakpoints","up","weaponDoc","rvFilter","useCharMeta","deferredRvFilter","deferredRvSet","LargeWeaponSwapButton","ArtifactSectionCard","onEdit","WeaponSwapButton","effFilter","ArtifactSwapButton","ArtSwapCard","minHeight","SwapHoriz","hasEquipped","unequipArts","dataSetEffects","setRVFilter","deferredrvFilter","rvField","rvmField","currentEfficiency","currentEfficiency_","maxEfficiency","maxEfficiency_","artid","text","PercentBadge","valid","canShow","borderBottomRightRadius","borderBottomLeftRadius","SubstatToggle","selectedKeys","field","setNumKeyArr","TabOverview","onScroll","CharacterProfileCard","EquipmentRow","team","constellation","tlvl","auto","skill","burst","tBoost","left","top","Favorite","FavoriteBorder","right","getLevelString","tKey","Badge","badgeContent","overlap","anchorOrigin","vertical","horizontal","getTalentOfKey","img","constellationName","talentSpacing","CharacterTalentPane","grlg","constellationCards","SkillDisplayCard","talentKey","onClickTitle","ReactionDisplay","tText","asc","enabled","talentLimits","talent","setTalentLevel","newTalentLevelKey","levelBoost","talentSheet","pl","hideDesc","headerAction","TabTeambuffs","TeamBuffDisplay","ResonanceDisplay","TeammateDisplay","teamBuffs","getTeamBuff","premod","enemy","teamCount","titleTypographyProps","resonanceSheets","desc","teamBuffOnly","activeCharacterKey","teamMateKey","onClickHandler","setTeammate","dataBundle","teammateCharacterContext","teamConditional","teamMateDataContext","TeammateAutocomplete","setChar","onClickHeader","artifactChildren","CharArtifactCondDisplay","weaponChildren","CharWeaponCondDisplay","characterChildren","CharTalentCondDisplay","isTeammateCard","setNums","sn","sts","autoCompleteProps","toText","startsWith","charKeyToCharName","toImg","pr","PersonAdd","isFavorite","onDisable","GeneralAutocomplete","options","valueKey","getOptionDisabled","TabTheorycraft","defWeapon","charTC","setCharTC","charTCs","getWithInit","useCharTC","defaultInitialWeaponKey","setData","resetData","initCharTC","setWeapon","copyFrom","eWeapon","newData","artifact","stats","locBuild","copyFromEquipped","lock","setArtifact","data_","setSubstatsType","setSubstats","deferredData","overriderArtData","overrideWeapon","charUIData","dataContextValue","dataContextValueWithOld","CopyAll","Refresh","WeaponEditorCard","ArtifactMainLevelCard","artifactData","setArtifactData","ArtifactSubCard","substatsType","weaponUIData","flexshrink","RefinementDropdown","setRefinement","LevelSelect","useLow","setSlot","artifactData_","setArtSet","ArtifactMainLevelSlot","ArtifactSetsEditor","setSlotProp","mLvl","maxArtifactLevel","msk","startAdornment","my","setSet","deleteValue","rest","remaining","ArtifactSetEditor","ArtifactSetAutocomplete","artSetKey","setArtSetKey","setName","Info","rv","substatType","st","ArtifactSubstatEditor","substatValue","setRolls","displayValue","numMains","ms","maxRolls","invalid","setRValue","parseFloat","TravelerElementSelect","toLowerCase","stg","travelerElements","TravelerToElement","TravelerGenderSelect","toggleGender","dbMeta","Female","Male","CharacterDisplay","useParams","CharacterDisplayCard","useCharacter","params","tab","useMatch","end","useTitle","characterContextValue","graphContextValue","DetailStatButton","CustomMultiTarget","FormulasButton","TabNav","CharacterPanel","Tabs","allowScrollButtonsMobile","Tab","Person","FactCheck","Groups","bStatsNum","BarChart","onModalOpen","Calculate","allKeys","arr","len","sortbyKeys","ascending","configs","ascendingBypass","sortby","diff","config","aV","bV","filterOptions","obj","optionKey","optionVal"],"sourceRoot":""}